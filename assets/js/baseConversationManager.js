
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x1e8f(_0x56c113,_0xa05d17){const _0x2ca0e8=_0x2ca0();return _0x1e8f=function(_0x1e8fa6,_0x366149){_0x1e8fa6=_0x1e8fa6-0x158;let _0x3b9488=_0x2ca0e8[_0x1e8fa6];return _0x3b9488;},_0x1e8f(_0x56c113,_0xa05d17);}const _0x3e43c5=_0x1e8f;(function(_0x3591d0,_0x28ec89){const _0x5a3ebd=_0x1e8f,_0x1bfa0c=_0x3591d0();while(!![]){try{const _0x17ab17=-parseInt(_0x5a3ebd(0x195))/0x1+parseInt(_0x5a3ebd(0x16e))/0x2+-parseInt(_0x5a3ebd(0x18b))/0x3+parseInt(_0x5a3ebd(0x167))/0x4*(-parseInt(_0x5a3ebd(0x18a))/0x5)+-parseInt(_0x5a3ebd(0x15a))/0x6*(parseInt(_0x5a3ebd(0x173))/0x7)+parseInt(_0x5a3ebd(0x199))/0x8*(parseInt(_0x5a3ebd(0x191))/0x9)+parseInt(_0x5a3ebd(0x178))/0xa;if(_0x17ab17===_0x28ec89)break;else _0x1bfa0c['push'](_0x1bfa0c['shift']());}catch(_0x382c68){_0x1bfa0c['push'](_0x1bfa0c['shift']());}}}(_0x2ca0,0xb57bf));import{Logger}from'./common.js';class Conversation{constructor(_0x5d344c,_0x5d72ae){const _0x4bb30f=_0x1e8f,_0x37a258={'jixMd':function(_0x32ba99,_0x9e3660){return _0x32ba99||_0x9e3660;},'iycLO':_0x4bb30f(0x162)};this['id']=_0x5d344c,this['title']=_0x37a258['jixMd'](_0x5d72ae,_0x37a258[_0x4bb30f(0x17e)]),this[_0x4bb30f(0x180)]=[],this['createdAt']=new Date()[_0x4bb30f(0x17b)](),this[_0x4bb30f(0x196)]=new Date()['toISOString']();}}class BaseConversationManager{constructor(){const _0x484def=_0x1e8f,_0x9cbc5f={'YUeSF':'4|1|0|6|5|2|3','SXeor':function(_0x1a8481,_0x1a08ab){return _0x1a8481*_0x1a08ab;}},_0x1224df=_0x9cbc5f[_0x484def(0x185)][_0x484def(0x171)]('|');let _0x257f69=0x0;while(!![]){switch(_0x1224df[_0x257f69++]){case'0':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'1':this[_0x484def(0x16d)]=null;continue;case'2':this[_0x484def(0x19a)]();continue;case'3':(!this[_0x484def(0x16d)]||!this[_0x484def(0x186)][this[_0x484def(0x16d)]])&&this['createNewConversation']();continue;case'4':this[_0x484def(0x186)]={};continue;case'5':this[_0x484def(0x17f)]=0x32;continue;case'6':this[_0x484def(0x176)]=_0x9cbc5f['SXeor'](_0x9cbc5f[_0x484def(0x184)](4.5,0x400),0x400);continue;}break;}}[_0x3e43c5(0x19a)](){const _0xcff952=_0x3e43c5,_0x3614fd={'DLwFJ':_0xcff952(0x186),'pEmkK':'Failed\x20to\x20load\x20conversations'};try{const _0x4e8ca3=JSON['parse'](localStorage['getItem'](_0x3614fd[_0xcff952(0x19c)]))||[];Array[_0xcff952(0x18f)](_0x4e8ca3)&&(this['conversations']=Object[_0xcff952(0x190)](_0x4e8ca3[_0xcff952(0x166)](_0x1889aa=>[_0x1889aa['id'],new Conversation(_0x1889aa['id'],_0x1889aa[_0xcff952(0x179)])]))),Logger[_0xcff952(0x15c)]('Loaded\x20'+Object[_0xcff952(0x164)](this[_0xcff952(0x186)])['length']+_0xcff952(0x161));}catch(_0x29cc79){Logger[_0xcff952(0x198)](_0x3614fd[_0xcff952(0x175)],_0x29cc79),this[_0xcff952(0x186)]={};}}[_0x3e43c5(0x16c)](){const _0x31ba61=_0x3e43c5,_0x10f3e2={'WGWNF':function(_0x20457a,_0x48fc24){return _0x20457a>_0x48fc24;},'waKrv':_0x31ba61(0x186),'MdQVc':_0x31ba61(0x189),'QvhOu':_0x31ba61(0x174)};try{let _0x31f1ec=JSON[_0x31ba61(0x158)](Object[_0x31ba61(0x170)](this[_0x31ba61(0x186)]));_0x10f3e2[_0x31ba61(0x187)](_0x31f1ec[_0x31ba61(0x18d)],this[_0x31ba61(0x176)])&&this['cleanupStorage'](),localStorage[_0x31ba61(0x15f)](_0x10f3e2[_0x31ba61(0x177)],_0x31f1ec),this[_0x31ba61(0x17d)](),Logger['info'](_0x10f3e2['MdQVc']);}catch(_0x5b3f64){Logger['error'](_0x10f3e2[_0x31ba61(0x169)],_0x5b3f64);}}[_0x3e43c5(0x160)](){const _0x1dbabb=_0x3e43c5,_0x26b227={'MnESu':function(_0x236c41,_0x6e0aa5){return _0x236c41>_0x6e0aa5;},'RgWEa':'Storage\x20cleanup\x20completed'};Logger[_0x1dbabb(0x15b)]('Storage\x20cleanup\x20initiated');let _0x395020=Object['values'](this[_0x1dbabb(0x186)])['sort']((_0x1a4ca3,_0x3001ce)=>new Date(_0x3001ce['updatedAt'])-new Date(_0x1a4ca3['updatedAt']));_0x395020[_0x1dbabb(0x18d)]>this[_0x1dbabb(0x17f)]&&(_0x395020=_0x395020[_0x1dbabb(0x192)](0x0,this[_0x1dbabb(0x17f)]),this[_0x1dbabb(0x186)]=Object[_0x1dbabb(0x190)](_0x395020['map'](_0x5e1589=>[_0x5e1589['id'],_0x5e1589])),Logger[_0x1dbabb(0x15c)](_0x1dbabb(0x16b)+this['MAX_CONVERSATIONS']+_0x1dbabb(0x161)));let _0x213de7=JSON[_0x1dbabb(0x158)](_0x395020)[_0x1dbabb(0x18d)];while(_0x26b227['MnESu'](_0x213de7,this['MAX_STORAGE_SIZE'])&&_0x26b227[_0x1dbabb(0x159)](_0x395020['length'],0x0)){const _0x53550f=_0x395020[_0x1dbabb(0x194)]();delete this[_0x1dbabb(0x186)][_0x53550f['id']],_0x213de7=JSON[_0x1dbabb(0x158)](Object[_0x1dbabb(0x170)](this[_0x1dbabb(0x186)]))['length'];}Logger[_0x1dbabb(0x15c)](_0x26b227[_0x1dbabb(0x16a)]);}[_0x3e43c5(0x181)](_0x1181e6=_0x3e43c5(0x162)){const _0x30eadc=_0x3e43c5,_0x509ab5=Date['now']()[_0x30eadc(0x172)]();return this['conversations'][_0x509ab5]=new Conversation(_0x509ab5,_0x1181e6),this[_0x30eadc(0x16d)]=_0x509ab5,this['saveConversations'](),this['notifyCurrentConversationChange'](),_0x509ab5;}[_0x3e43c5(0x15e)](_0x5bcb72){const _0x2718fe=_0x3e43c5;this[_0x2718fe(0x186)][_0x5bcb72]&&(delete this['conversations'][_0x5bcb72],this['currentConversationId']===_0x5bcb72&&(this[_0x2718fe(0x16d)]=null,this[_0x2718fe(0x181)]()),this[_0x2718fe(0x16c)]());}[_0x3e43c5(0x163)](_0x18689c){const _0x3526f5=_0x3e43c5;if(this[_0x3526f5(0x186)][_0x18689c])return this[_0x3526f5(0x16d)]=_0x18689c,this[_0x3526f5(0x165)](),!![];return![];}['getCurrentConversation'](){return this['conversations'][this['currentConversationId']]||null;}[_0x3e43c5(0x19b)](_0x42f178,_0x7f604e){const _0x4d3a07=_0x3e43c5,_0x1e08c6={'xjZMv':function(_0x3733e1,_0x38299e){return _0x3733e1===_0x38299e;},'yEcYY':function(_0xcfc6aa,_0x50f628){return _0xcfc6aa===_0x50f628;},'ZssXA':function(_0x31f506,_0x3eee97){return _0x31f506+_0x3eee97;},'nrDAb':function(_0x423b1d,_0xb1024c){return _0x423b1d>_0xb1024c;}},_0x404174=this[_0x4d3a07(0x17c)]();if(!_0x404174)return![];return _0x404174[_0x4d3a07(0x180)]['push']({'role':_0x7f604e,'content':_0x42f178,'timestamp':new Date()[_0x4d3a07(0x17b)]()}),_0x404174[_0x4d3a07(0x196)]=new Date()['toISOString'](),_0x1e08c6[_0x4d3a07(0x18e)](_0x7f604e,'user')&&_0x1e08c6[_0x4d3a07(0x183)](_0x404174[_0x4d3a07(0x180)]['length'],0x1)&&(_0x404174['title']=_0x1e08c6['ZssXA'](_0x42f178[_0x4d3a07(0x192)](0x0,0x1e),_0x1e08c6[_0x4d3a07(0x197)](_0x42f178['length'],0x1e)?_0x4d3a07(0x168):'')),this[_0x4d3a07(0x16c)](),!![];}[_0x3e43c5(0x17d)](){const _0x57ee42=_0x3e43c5;this[_0x57ee42(0x15d)][_0x57ee42(0x18c)][_0x57ee42(0x193)](_0xe71d20=>_0xe71d20(this[_0x57ee42(0x186)]));}[_0x3e43c5(0x165)](){const _0x1bed8f=_0x3e43c5;this[_0x1bed8f(0x15d)][_0x1bed8f(0x188)][_0x1bed8f(0x193)](_0x4ce468=>_0x4ce468(this[_0x1bed8f(0x17c)]()));}[_0x3e43c5(0x16f)](_0x599a87,_0x4eae49){const _0x31dcd7=_0x3e43c5;this[_0x31dcd7(0x15d)][_0x599a87]&&this['listeners'][_0x599a87][_0x31dcd7(0x182)](_0x4eae49);}['removeEventListener'](_0x1fe138,_0x42c488){const _0x460459=_0x3e43c5;this[_0x460459(0x15d)][_0x1fe138]&&(this[_0x460459(0x15d)][_0x1fe138]=this[_0x460459(0x15d)][_0x1fe138][_0x460459(0x17a)](_0x5ca3a9=>_0x5ca3a9!==_0x42c488));}}function _0x2ca0(){const _0x3e6e4f=['toString','176323hVMsEl','Failed\x20to\x20save\x20conversations','pEmkK','MAX_STORAGE_SIZE','waKrv','15442210jyFvpH','title','filter','toISOString','getCurrentConversation','notifyConversationUpdate','iycLO','MAX_CONVERSATIONS','messages','createNewConversation','push','yEcYY','SXeor','YUeSF','conversations','WGWNF','onCurrentConversationChange','Conversations\x20saved\x20successfully','75XtksxT','4193709tRSiCL','onConversationUpdate','length','xjZMv','isArray','fromEntries','27GVuYEX','slice','forEach','pop','54378Wcxruy','updatedAt','nrDAb','error','1417472UbqCgT','loadConversations','addMessage','DLwFJ','stringify','MnESu','54yMRAyG','warn','info','listeners','deleteConversation','setItem','cleanupStorage','\x20conversations','New\x20Chat','switchConversation','keys','notifyCurrentConversationChange','map','32268sTAAdC','...','QvhOu','RgWEa','Trimmed\x20to\x20','saveConversations','currentConversationId','935146vsKNVi','addEventListener','values','split'];_0x2ca0=function(){return _0x3e6e4f;};return _0x2ca0();}export{BaseConversationManager};