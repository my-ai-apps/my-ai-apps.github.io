
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x19711e=_0x17a3;(function(_0x46d9d4,_0x1d9f42){const _0x263c75=_0x17a3,_0x4183b4=_0x46d9d4();while(!![]){try{const _0x4a3659=parseInt(_0x263c75(0x1a1))/0x1+parseInt(_0x263c75(0x197))/0x2*(-parseInt(_0x263c75(0x190))/0x3)+-parseInt(_0x263c75(0x1ac))/0x4+parseInt(_0x263c75(0x1bd))/0x5+-parseInt(_0x263c75(0x18a))/0x6+-parseInt(_0x263c75(0x1bf))/0x7*(-parseInt(_0x263c75(0x1cd))/0x8)+parseInt(_0x263c75(0x1cc))/0x9;if(_0x4a3659===_0x1d9f42)break;else _0x4183b4['push'](_0x4183b4['shift']());}catch(_0x30a5f0){_0x4183b4['push'](_0x4183b4['shift']());}}}(_0x4a76,0xc7964));import{Logger}from'./common.js';function _0x17a3(_0x3e4f74,_0x5c67b2){const _0x4a7631=_0x4a76();return _0x17a3=function(_0x17a347,_0x4b0405){_0x17a347=_0x17a347-0x186;let _0x39d8ac=_0x4a7631[_0x17a347];return _0x39d8ac;},_0x17a3(_0x3e4f74,_0x5c67b2);}class Conversation{constructor(_0x7c9fb5,_0x24749a){const _0x1330a9=_0x17a3,_0x145254={'kzHDP':_0x1330a9(0x1be)},_0x462554=_0x1330a9(0x1a7)[_0x1330a9(0x19f)]('|');let _0x4327bb=0x0;while(!![]){switch(_0x462554[_0x4327bb++]){case'0':this[_0x1330a9(0x1b8)]=new Date()['toISOString']();continue;case'1':this[_0x1330a9(0x193)]=[];continue;case'2':this['id']=_0x7c9fb5;continue;case'3':this['title']=_0x24749a||_0x145254[_0x1330a9(0x1af)];continue;case'4':this[_0x1330a9(0x192)]=new Date()[_0x1330a9(0x19b)]();continue;}break;}}}class BaseConversationManager{constructor(){const _0x3be06c=_0x17a3,_0x474833={'eZnot':_0x3be06c(0x1a2),'ubyeD':function(_0x32a109,_0x17f2c4){return _0x32a109*_0x17f2c4;},'tnTBV':function(_0x573395,_0x1e803d){return _0x573395*_0x1e803d;}},_0x4e55f9=_0x474833[_0x3be06c(0x1d1)][_0x3be06c(0x19f)]('|');let _0x40dc76=0x0;while(!![]){switch(_0x4e55f9[_0x40dc76++]){case'0':this[_0x3be06c(0x1b2)]();continue;case'1':this[_0x3be06c(0x1b7)]={};continue;case'2':this[_0x3be06c(0x18b)]=0x32;continue;case'3':this['MAX_STORAGE_SIZE']=_0x474833['ubyeD'](_0x474833[_0x3be06c(0x1bb)](4.5,0x400),0x400);continue;case'4':this[_0x3be06c(0x1ce)]=null;continue;case'5':this[_0x3be06c(0x1c8)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;}break;}}[_0x19711e(0x1b2)](){const _0x55b0db=_0x19711e,_0x1dd5d9={'PniBB':_0x55b0db(0x1b7)};try{const _0x5a431c=JSON[_0x55b0db(0x188)](localStorage['getItem'](_0x1dd5d9[_0x55b0db(0x194)]))||[];Array[_0x55b0db(0x18e)](_0x5a431c)&&(this[_0x55b0db(0x1b7)]=Object[_0x55b0db(0x19a)](_0x5a431c['map'](_0x1ae366=>[_0x1ae366['id'],new Conversation(_0x1ae366['id'],_0x1ae366[_0x55b0db(0x18c)])]))),Logger[_0x55b0db(0x1ae)](_0x55b0db(0x1b1)+Object[_0x55b0db(0x1b9)](this[_0x55b0db(0x1b7)])[_0x55b0db(0x1c9)]+_0x55b0db(0x1d0));}catch(_0x16659c){Logger[_0x55b0db(0x1a0)](_0x55b0db(0x1a4),_0x16659c),this[_0x55b0db(0x1b7)]={};}}['saveConversations'](){const _0x59f314=_0x19711e,_0x53bd35={'zPbYt':function(_0x4e4295,_0x2f921c){return _0x4e4295>_0x2f921c;},'yPKyl':_0x59f314(0x1a5),'krXfp':_0x59f314(0x1b6)};try{let _0x3cbe22=JSON[_0x59f314(0x195)](Object[_0x59f314(0x191)](this[_0x59f314(0x1b7)]));_0x53bd35[_0x59f314(0x1c6)](_0x3cbe22[_0x59f314(0x1c9)],this[_0x59f314(0x1a8)])&&this[_0x59f314(0x1aa)](),localStorage[_0x59f314(0x1c2)](_0x59f314(0x1b7),_0x3cbe22),this[_0x59f314(0x1c3)](),Logger[_0x59f314(0x1ae)](_0x53bd35[_0x59f314(0x1a9)]);}catch(_0x55cb7c){Logger[_0x59f314(0x1a0)](_0x53bd35['krXfp'],_0x55cb7c);}}[_0x19711e(0x1aa)](){const _0x20f4b5=_0x19711e,_0x48ccc2={'jAVPg':function(_0x4e8e17,_0x53047c){return _0x4e8e17>_0x53047c;},'IYwre':function(_0x1db3d7,_0x2e2024){return _0x1db3d7>_0x2e2024;},'KnLbz':_0x20f4b5(0x1c4)};Logger[_0x20f4b5(0x1b4)](_0x20f4b5(0x1c5));let _0x56374e=Object['values'](this[_0x20f4b5(0x1b7)])[_0x20f4b5(0x1ba)]((_0x59fbd8,_0x26ce90)=>new Date(_0x26ce90[_0x20f4b5(0x1b8)])-new Date(_0x59fbd8[_0x20f4b5(0x1b8)]));_0x48ccc2[_0x20f4b5(0x19d)](_0x56374e['length'],this[_0x20f4b5(0x18b)])&&(_0x56374e=_0x56374e['slice'](0x0,this[_0x20f4b5(0x18b)]),this[_0x20f4b5(0x1b7)]=Object['fromEntries'](_0x56374e[_0x20f4b5(0x1ad)](_0x1d427c=>[_0x1d427c['id'],_0x1d427c])),Logger[_0x20f4b5(0x1ae)]('Trimmed\x20to\x20'+this[_0x20f4b5(0x18b)]+'\x20conversations'));let _0x7098e1=JSON[_0x20f4b5(0x195)](_0x56374e)[_0x20f4b5(0x1c9)];while(_0x48ccc2[_0x20f4b5(0x19d)](_0x7098e1,this[_0x20f4b5(0x1a8)])&&_0x48ccc2[_0x20f4b5(0x18f)](_0x56374e['length'],0x0)){const _0x41b9ba=_0x56374e[_0x20f4b5(0x1a3)]();delete this[_0x20f4b5(0x1b7)][_0x41b9ba['id']],_0x7098e1=JSON[_0x20f4b5(0x195)](Object[_0x20f4b5(0x191)](this['conversations']))[_0x20f4b5(0x1c9)];}Logger['info'](_0x48ccc2['KnLbz']);}[_0x19711e(0x1cb)](_0x1f2e08=_0x19711e(0x1be)){const _0x1b2871=_0x19711e,_0x2e6b5f=Date[_0x1b2871(0x198)]()[_0x1b2871(0x1c1)]();return this[_0x1b2871(0x1b7)][_0x2e6b5f]=new Conversation(_0x2e6b5f,_0x1f2e08),this[_0x1b2871(0x1ce)]=_0x2e6b5f,this[_0x1b2871(0x1c0)](),this[_0x1b2871(0x186)](),_0x2e6b5f;}[_0x19711e(0x1b0)](_0x162ea3){const _0x498f5c=_0x19711e;this[_0x498f5c(0x1b7)][_0x162ea3]&&(delete this['conversations'][_0x162ea3],this[_0x498f5c(0x1ce)]===_0x162ea3&&(this[_0x498f5c(0x1ce)]=null,this['createNewConversation']()),this[_0x498f5c(0x1c0)]());}[_0x19711e(0x1b5)](_0x134ad6){const _0x5aa936=_0x19711e;if(this[_0x5aa936(0x1b7)][_0x134ad6])return this[_0x5aa936(0x1ce)]=_0x134ad6,this[_0x5aa936(0x186)](),!![];return![];}[_0x19711e(0x1bc)](){const _0x3f5a2f=_0x19711e;return this[_0x3f5a2f(0x1b7)][this[_0x3f5a2f(0x1ce)]]||null;}[_0x19711e(0x189)](_0x23b4ba,_0x1992d8){const _0x1d45b3=_0x19711e,_0xd3d55c={'oxiVy':function(_0x3d4065,_0x21007b){return _0x3d4065===_0x21007b;},'sWudy':function(_0x3469e2,_0x3a06de){return _0x3469e2===_0x3a06de;},'uTNgO':function(_0xd52765,_0x33349b){return _0xd52765+_0x33349b;},'xJNWa':function(_0x532c4e,_0x3e7278){return _0x532c4e>_0x3e7278;},'LNImm':_0x1d45b3(0x1b3)},_0x3d9a71=this[_0x1d45b3(0x1bc)]();if(!_0x3d9a71)return![];return _0x3d9a71[_0x1d45b3(0x193)][_0x1d45b3(0x1a6)]({'role':_0x1992d8,'content':_0x23b4ba,'timestamp':new Date()[_0x1d45b3(0x19b)]()}),_0x3d9a71[_0x1d45b3(0x1b8)]=new Date()[_0x1d45b3(0x19b)](),_0xd3d55c[_0x1d45b3(0x199)](_0x1992d8,_0x1d45b3(0x196))&&_0xd3d55c['sWudy'](_0x3d9a71[_0x1d45b3(0x193)][_0x1d45b3(0x1c9)],0x1)&&(_0x3d9a71[_0x1d45b3(0x18c)]=_0xd3d55c['uTNgO'](_0x23b4ba[_0x1d45b3(0x18d)](0x0,0x1e),_0xd3d55c[_0x1d45b3(0x1ab)](_0x23b4ba['length'],0x1e)?_0xd3d55c[_0x1d45b3(0x1c7)]:'')),this[_0x1d45b3(0x1c0)](),!![];}[_0x19711e(0x1c3)](){const _0x36bf27=_0x19711e;this['listeners'][_0x36bf27(0x1cf)][_0x36bf27(0x1ca)](_0x5f7ff=>_0x5f7ff(this[_0x36bf27(0x1b7)]));}[_0x19711e(0x186)](){const _0x189b7b=_0x19711e;this[_0x189b7b(0x1c8)]['onCurrentConversationChange'][_0x189b7b(0x1ca)](_0x300b29=>_0x300b29(this[_0x189b7b(0x1bc)]()));}[_0x19711e(0x19e)](_0x270ed2,_0x16c8e2){const _0x924144=_0x19711e;this[_0x924144(0x1c8)][_0x270ed2]&&this[_0x924144(0x1c8)][_0x270ed2][_0x924144(0x1a6)](_0x16c8e2);}[_0x19711e(0x187)](_0x2d94b8,_0x45c682){const _0x4494dd=_0x19711e;this[_0x4494dd(0x1c8)][_0x2d94b8]&&(this[_0x4494dd(0x1c8)][_0x2d94b8]=this[_0x4494dd(0x1c8)][_0x2d94b8][_0x4494dd(0x19c)](_0x255691=>_0x255691!==_0x45c682));}}export{BaseConversationManager};function _0x4a76(){const _0x7e6184=['deleteConversation','Loaded\x20','loadConversations','...','warn','switchConversation','Failed\x20to\x20save\x20conversations','conversations','updatedAt','keys','sort','tnTBV','getCurrentConversation','6778270XIkqkl','New\x20Chat','1099jsHTmD','saveConversations','toString','setItem','notifyConversationUpdate','Storage\x20cleanup\x20completed','Storage\x20cleanup\x20initiated','zPbYt','LNImm','listeners','length','forEach','createNewConversation','8350794rsjcmi','34072iJdnpr','currentConversationId','onConversationUpdate','\x20conversations','eZnot','notifyCurrentConversationChange','removeEventListener','parse','addMessage','3977280EJxnzg','MAX_CONVERSATIONS','title','slice','isArray','IYwre','32439mmgOxL','values','createdAt','messages','PniBB','stringify','user','166TuGFrf','now','oxiVy','fromEntries','toISOString','filter','jAVPg','addEventListener','split','error','649802DhsKLa','1|4|5|3|2|0','pop','Failed\x20to\x20load\x20conversations','Conversations\x20saved\x20successfully','push','2|3|1|4|0','MAX_STORAGE_SIZE','yPKyl','cleanupStorage','xJNWa','4896472xsWGBD','map','info','kzHDP'];_0x4a76=function(){return _0x7e6184;};return _0x4a76();}