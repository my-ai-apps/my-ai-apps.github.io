
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x43da7e=_0x132e;(function(_0x16f96b,_0x1cb9b5){const _0x1ca08b=_0x132e,_0x5d07f8=_0x16f96b();while(!![]){try{const _0x2fe225=-parseInt(_0x1ca08b(0xcc))/0x1+parseInt(_0x1ca08b(0xef))/0x2+-parseInt(_0x1ca08b(0xd6))/0x3*(parseInt(_0x1ca08b(0xd9))/0x4)+-parseInt(_0x1ca08b(0xf3))/0x5*(parseInt(_0x1ca08b(0xb0))/0x6)+parseInt(_0x1ca08b(0xb7))/0x7*(-parseInt(_0x1ca08b(0xc1))/0x8)+-parseInt(_0x1ca08b(0xca))/0x9+parseInt(_0x1ca08b(0xd3))/0xa;if(_0x2fe225===_0x1cb9b5)break;else _0x5d07f8['push'](_0x5d07f8['shift']());}catch(_0x59842e){_0x5d07f8['push'](_0x5d07f8['shift']());}}}(_0x2955,0xbc956));import{Logger}from'./common.js';class Conversation{constructor(_0x402ec3,_0x10ad5d){const _0x38d81e=_0x132e,_0x5e2668={'kMVKe':'1|2|0|3|4','MWzHf':function(_0xa5f8e8,_0x2e3290){return _0xa5f8e8||_0x2e3290;}},_0x292cd4=_0x5e2668[_0x38d81e(0xe9)]['split']('|');let _0x1aabcd=0x0;while(!![]){switch(_0x292cd4[_0x1aabcd++]){case'0':this[_0x38d81e(0xe1)]=[];continue;case'1':this['id']=_0x402ec3;continue;case'2':this['title']=_0x5e2668[_0x38d81e(0xbc)](_0x10ad5d,'New\x20Chat');continue;case'3':this[_0x38d81e(0xda)]=new Date()[_0x38d81e(0xbe)]();continue;case'4':this['updatedAt']=new Date()[_0x38d81e(0xbe)]();continue;}break;}}}class BaseConversationManager{constructor(){const _0x48674b=_0x132e,_0x3a7f1c={'deKbb':function(_0x100b0c,_0x497315){return _0x100b0c*_0x497315;}},_0x69a1a5=_0x48674b(0xd8)['split']('|');let _0x513638=0x0;while(!![]){switch(_0x69a1a5[_0x513638++]){case'0':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'1':this[_0x48674b(0xdd)]=null;continue;case'2':this[_0x48674b(0xf1)]=0x32;continue;case'3':this[_0x48674b(0xeb)]();continue;case'4':this[_0x48674b(0xc8)]={};continue;case'5':this[_0x48674b(0xb1)]=_0x3a7f1c[_0x48674b(0xd0)](4.5*0x400,0x400);continue;}break;}}[_0x43da7e(0xeb)](){const _0x4ca6e=_0x43da7e,_0x574a50={'Okssn':'conversations'};try{const _0x44b83f=JSON[_0x4ca6e(0xd1)](localStorage[_0x4ca6e(0xea)](_0x574a50[_0x4ca6e(0xd2)]))||[];Array[_0x4ca6e(0xba)](_0x44b83f)&&(this[_0x4ca6e(0xc8)]=Object['fromEntries'](_0x44b83f[_0x4ca6e(0xbd)](_0x49f577=>[_0x49f577['id'],new Conversation(_0x49f577['id'],_0x49f577[_0x4ca6e(0xc5)])]))),Logger[_0x4ca6e(0xf5)]('Loaded\x20'+Object[_0x4ca6e(0xcb)](this[_0x4ca6e(0xc8)])['length']+'\x20conversations');}catch(_0x5aebc7){Logger['error']('Failed\x20to\x20load\x20conversations',_0x5aebc7),this['conversations']={};}}[_0x43da7e(0xe5)](){const _0x2c4c93=_0x43da7e,_0x568e11={'AtzyA':function(_0x422844,_0x2e24aa){return _0x422844>_0x2e24aa;},'iLSuX':_0x2c4c93(0xee)};try{let _0x143f18=JSON[_0x2c4c93(0xc4)](Object[_0x2c4c93(0xd5)](this['conversations']));_0x568e11[_0x2c4c93(0xc2)](_0x143f18[_0x2c4c93(0xb3)],this[_0x2c4c93(0xb1)])&&this[_0x2c4c93(0xb5)](),localStorage[_0x2c4c93(0xe6)](_0x2c4c93(0xc8),_0x143f18),this[_0x2c4c93(0xf2)](),Logger[_0x2c4c93(0xf5)](_0x2c4c93(0xb8));}catch(_0x52faee){Logger[_0x2c4c93(0xde)](_0x568e11[_0x2c4c93(0xc6)],_0x52faee);}}[_0x43da7e(0xb5)](){const _0x16735d=_0x43da7e,_0x2e3eb8={'oJGdG':_0x16735d(0xc0),'Popys':function(_0x1f404b,_0x40cddd){return _0x1f404b>_0x40cddd;},'UrPom':_0x16735d(0xe8)};Logger['warn'](_0x2e3eb8[_0x16735d(0xaf)]);let _0x3ad52f=Object['values'](this[_0x16735d(0xc8)])[_0x16735d(0xd4)]((_0x349ede,_0x112cf0)=>new Date(_0x112cf0[_0x16735d(0xd7)])-new Date(_0x349ede[_0x16735d(0xd7)]));_0x2e3eb8[_0x16735d(0xf4)](_0x3ad52f[_0x16735d(0xb3)],this[_0x16735d(0xf1)])&&(_0x3ad52f=_0x3ad52f[_0x16735d(0xb6)](0x0,this[_0x16735d(0xf1)]),this[_0x16735d(0xc8)]=Object[_0x16735d(0xe4)](_0x3ad52f[_0x16735d(0xbd)](_0x4ac7a4=>[_0x4ac7a4['id'],_0x4ac7a4])),Logger[_0x16735d(0xf5)](_0x16735d(0xc7)+this['MAX_CONVERSATIONS']+'\x20conversations'));let _0x5cd04d=JSON['stringify'](_0x3ad52f)[_0x16735d(0xb3)];while(_0x2e3eb8['Popys'](_0x5cd04d,this[_0x16735d(0xb1)])&&_0x2e3eb8[_0x16735d(0xf4)](_0x3ad52f[_0x16735d(0xb3)],0x0)){const _0x1903f7=_0x3ad52f['pop']();delete this[_0x16735d(0xc8)][_0x1903f7['id']],_0x5cd04d=JSON[_0x16735d(0xc4)](Object[_0x16735d(0xd5)](this[_0x16735d(0xc8)]))['length'];}Logger[_0x16735d(0xf5)](_0x2e3eb8[_0x16735d(0xe2)]);}[_0x43da7e(0xf0)](_0x2d3705='New\x20Chat'){const _0x51fc2b=_0x43da7e,_0x54fb55=Date[_0x51fc2b(0xed)]()[_0x51fc2b(0xe0)]();return this[_0x51fc2b(0xc8)][_0x54fb55]=new Conversation(_0x54fb55,_0x2d3705),this[_0x51fc2b(0xdd)]=_0x54fb55,this['saveConversations'](),this[_0x51fc2b(0xdf)](),_0x54fb55;}[_0x43da7e(0xb2)](_0x18fb07){const _0xf5e1c8=_0x43da7e,_0x40028e={'HmMGU':function(_0x5b06e6,_0x1844a8){return _0x5b06e6===_0x1844a8;}};this['conversations'][_0x18fb07]&&(delete this[_0xf5e1c8(0xc8)][_0x18fb07],_0x40028e[_0xf5e1c8(0xb9)](this['currentConversationId'],_0x18fb07)&&(this[_0xf5e1c8(0xdd)]=null,this['createNewConversation']()),this[_0xf5e1c8(0xe5)]());}['switchConversation'](_0x5ea5c4){const _0xddc351=_0x43da7e;if(this[_0xddc351(0xc8)][_0x5ea5c4])return this['currentConversationId']=_0x5ea5c4,this[_0xddc351(0xdf)](),!![];return![];}[_0x43da7e(0xdc)](){const _0x3addb9=_0x43da7e;return this[_0x3addb9(0xc8)][this[_0x3addb9(0xdd)]]||null;}[_0x43da7e(0xdb)](_0x11ff63,_0x433da2){const _0x5a7249=_0x43da7e,_0x2449da={'KuPMc':function(_0x27b19e,_0x2159e9){return _0x27b19e===_0x2159e9;},'UXHjt':_0x5a7249(0xce),'vTmRw':function(_0x40de44,_0x1da9f0){return _0x40de44+_0x1da9f0;},'CkAJL':function(_0x2398f8,_0x15e8c0){return _0x2398f8>_0x15e8c0;}},_0x38386e=this['getCurrentConversation']();if(!_0x38386e)return![];return _0x38386e[_0x5a7249(0xe1)]['push']({'role':_0x433da2,'content':_0x11ff63,'timestamp':new Date()[_0x5a7249(0xbe)]()}),_0x38386e[_0x5a7249(0xd7)]=new Date()[_0x5a7249(0xbe)](),_0x2449da['KuPMc'](_0x433da2,_0x2449da[_0x5a7249(0xcd)])&&_0x2449da['KuPMc'](_0x38386e['messages'][_0x5a7249(0xb3)],0x1)&&(_0x38386e[_0x5a7249(0xc5)]=_0x2449da[_0x5a7249(0xb4)](_0x11ff63['slice'](0x0,0x1e),_0x2449da[_0x5a7249(0xcf)](_0x11ff63[_0x5a7249(0xb3)],0x1e)?'...':'')),this[_0x5a7249(0xe5)](),!![];}[_0x43da7e(0xf2)](){const _0x3981b5=_0x43da7e;this[_0x3981b5(0xe7)]['onConversationUpdate'][_0x3981b5(0xec)](_0x455ab9=>_0x455ab9(this[_0x3981b5(0xc8)]));}[_0x43da7e(0xdf)](){const _0x43c566=_0x43da7e;this['listeners'][_0x43c566(0xe3)]['forEach'](_0x35c27d=>_0x35c27d(this['getCurrentConversation']()));}[_0x43da7e(0xbf)](_0x42fc6e,_0x4d95c4){const _0x3f776b=_0x43da7e;this[_0x3f776b(0xe7)][_0x42fc6e]&&this[_0x3f776b(0xe7)][_0x42fc6e][_0x3f776b(0xbb)](_0x4d95c4);}[_0x43da7e(0xc3)](_0x5dcfe4,_0x424d5f){const _0xc02943=_0x43da7e;this[_0xc02943(0xe7)][_0x5dcfe4]&&(this[_0xc02943(0xe7)][_0x5dcfe4]=this['listeners'][_0x5dcfe4][_0xc02943(0xc9)](_0x4e964a=>_0x4e964a!==_0x424d5f));}}function _0x2955(){const _0x292bce=['532154yoecGE','Conversations\x20saved\x20successfully','HmMGU','isArray','push','MWzHf','map','toISOString','addEventListener','Storage\x20cleanup\x20initiated','136athdbp','AtzyA','removeEventListener','stringify','title','iLSuX','Trimmed\x20to\x20','conversations','filter','9686574IvUsLZ','keys','86231NXtOBD','UXHjt','user','CkAJL','deKbb','parse','Okssn','32671240KlKrJH','sort','values','1923783LbiRQk','updatedAt','4|1|0|5|2|3','4RoIaoj','createdAt','addMessage','getCurrentConversation','currentConversationId','error','notifyCurrentConversationChange','toString','messages','UrPom','onCurrentConversationChange','fromEntries','saveConversations','setItem','listeners','Storage\x20cleanup\x20completed','kMVKe','getItem','loadConversations','forEach','now','Failed\x20to\x20save\x20conversations','1733916mXEzYx','createNewConversation','MAX_CONVERSATIONS','notifyConversationUpdate','1327460nEUjvU','Popys','info','oJGdG','6rKmfst','MAX_STORAGE_SIZE','deleteConversation','length','vTmRw','cleanupStorage','slice'];_0x2955=function(){return _0x292bce;};return _0x2955();}function _0x132e(_0xa518c,_0x11cddd){const _0x2955b5=_0x2955();return _0x132e=function(_0x132e68,_0x153cb3){_0x132e68=_0x132e68-0xaf;let _0x3e5635=_0x2955b5[_0x132e68];return _0x3e5635;},_0x132e(_0xa518c,_0x11cddd);}export{BaseConversationManager};