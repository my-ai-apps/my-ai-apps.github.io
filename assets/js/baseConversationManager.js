
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x4f5d(){const _0x1941ec=['map','Storage\x20cleanup\x20completed','createNewConversation','fromEntries','1119256nLIBqc','Loaded\x20','Trimmed\x20to\x20','updatedAt','1261629AMyhmY','filter','New\x20Chat','isArray','switchConversation','Failed\x20to\x20save\x20conversations','messages','createdAt','7NhTpuN','689005SHXYVU','conversations','MAX_STORAGE_SIZE','VEOJG','skBoP','now','addEventListener','keys','cleanupStorage','8109261WHRkfS','rBzrZ','2|0|1|3|4','currentConversationId','toISOString','onCurrentConversationChange','length','\x20conversations','loadConversations','push','user','saveConversations','0|3|1|6|5|4|2','393720WwpYmg','getItem','rsgMv','KOluh','bINWT','toString','notifyConversationUpdate','133151ffGKud','stringify','onConversationUpdate','cgLeP','listeners','title','...','values','getCurrentConversation','Conversations\x20saved\x20successfully','MAX_CONVERSATIONS','fUQQd','XvZiC','Failed\x20to\x20load\x20conversations','gqqpj','8mWyaIP','removeEventListener','notifyCurrentConversationChange','error','vNZYp','446978zvsWix','forEach','sort','warn','UWHbQ','split','pop','MjhMa','addMessage','FcISd','info','tmSDT','qoFEw'];_0x4f5d=function(){return _0x1941ec;};return _0x4f5d();}const _0xba86b3=_0x12a9;function _0x12a9(_0x568ecb,_0x497484){const _0x4f5d4f=_0x4f5d();return _0x12a9=function(_0x12a92b,_0xe79a09){_0x12a92b=_0x12a92b-0x1b9;let _0xd59a48=_0x4f5d4f[_0x12a92b];return _0xd59a48;},_0x12a9(_0x568ecb,_0x497484);}(function(_0x13eb71,_0x36b3a7){const _0x3ad218=_0x12a9,_0x4dc026=_0x13eb71();while(!![]){try{const _0x4611c5=parseInt(_0x3ad218(0x1e3))/0x1+parseInt(_0x3ad218(0x1f7))/0x2+parseInt(_0x3ad218(0x1bd))/0x3+parseInt(_0x3ad218(0x1f2))/0x4*(parseInt(_0x3ad218(0x1c6))/0x5)+-parseInt(_0x3ad218(0x1dc))/0x6+-parseInt(_0x3ad218(0x1c5))/0x7*(-parseInt(_0x3ad218(0x1b9))/0x8)+-parseInt(_0x3ad218(0x1cf))/0x9;if(_0x4611c5===_0x36b3a7)break;else _0x4dc026['push'](_0x4dc026['shift']());}catch(_0x1ab548){_0x4dc026['push'](_0x4dc026['shift']());}}}(_0x4f5d,0x372fb));import{Logger}from'./common.js';class Conversation{constructor(_0x404ab0,_0x120f5b){const _0x5f4041=_0x12a9,_0x1b76ea={'MjhMa':_0x5f4041(0x1d1),'skBoP':function(_0x5266ec,_0x3352ea){return _0x5266ec||_0x3352ea;},'FcISd':_0x5f4041(0x1bf)},_0x2565a9=_0x1b76ea[_0x5f4041(0x1fe)][_0x5f4041(0x1fc)]('|');let _0x2d2fc0=0x0;while(!![]){switch(_0x2565a9[_0x2d2fc0++]){case'0':this[_0x5f4041(0x1e8)]=_0x1b76ea[_0x5f4041(0x1ca)](_0x120f5b,_0x1b76ea[_0x5f4041(0x200)]);continue;case'1':this[_0x5f4041(0x1c3)]=[];continue;case'2':this['id']=_0x404ab0;continue;case'3':this[_0x5f4041(0x1c4)]=new Date()[_0x5f4041(0x1d3)]();continue;case'4':this[_0x5f4041(0x1bc)]=new Date()[_0x5f4041(0x1d3)]();continue;}break;}}}class BaseConversationManager{constructor(){const _0x146235=_0x12a9,_0x4eac4a={'tmSDT':_0x146235(0x1db),'rsgMv':function(_0x3b362f,_0x209921){return _0x3b362f*_0x209921;}},_0x51d964=_0x4eac4a[_0x146235(0x202)][_0x146235(0x1fc)]('|');let _0x2a87bf=0x0;while(!![]){switch(_0x51d964[_0x2a87bf++]){case'0':this[_0x146235(0x1c7)]={};continue;case'1':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'2':(!this['currentConversationId']||!this[_0x146235(0x1c7)][this['currentConversationId']])&&this[_0x146235(0x206)]();continue;case'3':this[_0x146235(0x1d2)]=null;continue;case'4':this[_0x146235(0x1d7)]();continue;case'5':this[_0x146235(0x1ed)]=0x32;continue;case'6':this[_0x146235(0x1c8)]=_0x4eac4a[_0x146235(0x1de)](4.5,0x400)*0x400;continue;}break;}}[_0xba86b3(0x1d7)](){const _0x477591=_0xba86b3,_0x4c4dcd={'yxUdJ':_0x477591(0x1c7),'cgLeP':_0x477591(0x1f0)};try{const _0x2175a2=JSON['parse'](localStorage[_0x477591(0x1dd)](_0x4c4dcd['yxUdJ']))||[];Array[_0x477591(0x1c0)](_0x2175a2)&&(this[_0x477591(0x1c7)]=Object[_0x477591(0x207)](_0x2175a2[_0x477591(0x204)](_0x1df010=>[_0x1df010['id'],new Conversation(_0x1df010['id'],_0x1df010[_0x477591(0x1e8)])]))),Logger['info'](_0x477591(0x1ba)+Object[_0x477591(0x1cd)](this['conversations'])[_0x477591(0x1d5)]+_0x477591(0x1d6));}catch(_0x4a9313){Logger[_0x477591(0x1f5)](_0x4c4dcd[_0x477591(0x1e6)],_0x4a9313),this[_0x477591(0x1c7)]={};}}[_0xba86b3(0x1da)](){const _0x3c1dc5=_0xba86b3,_0x8dff60={'qqSnh':function(_0x502c4f,_0xcb4dd4){return _0x502c4f>_0xcb4dd4;},'bINWT':_0x3c1dc5(0x1c7),'VEOJG':_0x3c1dc5(0x1ec)};try{let _0x5be1be=JSON[_0x3c1dc5(0x1e4)](Object[_0x3c1dc5(0x1ea)](this[_0x3c1dc5(0x1c7)]));_0x8dff60['qqSnh'](_0x5be1be[_0x3c1dc5(0x1d5)],this[_0x3c1dc5(0x1c8)])&&this[_0x3c1dc5(0x1ce)](),localStorage['setItem'](_0x8dff60[_0x3c1dc5(0x1e0)],_0x5be1be),this[_0x3c1dc5(0x1e2)](),Logger['info'](_0x8dff60[_0x3c1dc5(0x1c9)]);}catch(_0x31d9e9){Logger[_0x3c1dc5(0x1f5)](_0x3c1dc5(0x1c2),_0x31d9e9);}}[_0xba86b3(0x1ce)](){const _0x10f008=_0xba86b3,_0x15aa3a={'GXfUw':'Storage\x20cleanup\x20initiated','miNcW':function(_0xdda5e5,_0x352d7e){return _0xdda5e5>_0x352d7e;},'gqqpj':function(_0x31dda7,_0x3032cd){return _0x31dda7>_0x3032cd;},'rBzrZ':_0x10f008(0x205)};Logger[_0x10f008(0x1fa)](_0x15aa3a['GXfUw']);let _0x5e21b6=Object[_0x10f008(0x1ea)](this['conversations'])[_0x10f008(0x1f9)]((_0x43abcd,_0x58e160)=>new Date(_0x58e160[_0x10f008(0x1bc)])-new Date(_0x43abcd[_0x10f008(0x1bc)]));_0x15aa3a['miNcW'](_0x5e21b6[_0x10f008(0x1d5)],this[_0x10f008(0x1ed)])&&(_0x5e21b6=_0x5e21b6['slice'](0x0,this[_0x10f008(0x1ed)]),this[_0x10f008(0x1c7)]=Object['fromEntries'](_0x5e21b6[_0x10f008(0x204)](_0x58ae9a=>[_0x58ae9a['id'],_0x58ae9a])),Logger[_0x10f008(0x201)](_0x10f008(0x1bb)+this[_0x10f008(0x1ed)]+_0x10f008(0x1d6)));let _0x53733c=JSON['stringify'](_0x5e21b6)[_0x10f008(0x1d5)];while(_0x15aa3a[_0x10f008(0x1f1)](_0x53733c,this[_0x10f008(0x1c8)])&&_0x15aa3a[_0x10f008(0x1f1)](_0x5e21b6['length'],0x0)){const _0x341fb8=_0x5e21b6[_0x10f008(0x1fd)]();delete this[_0x10f008(0x1c7)][_0x341fb8['id']],_0x53733c=JSON[_0x10f008(0x1e4)](Object['values'](this[_0x10f008(0x1c7)]))[_0x10f008(0x1d5)];}Logger['info'](_0x15aa3a[_0x10f008(0x1d0)]);}[_0xba86b3(0x206)](_0x4c8daa=_0xba86b3(0x1bf)){const _0x3d18fb=_0xba86b3,_0x5e38c0=Date[_0x3d18fb(0x1cb)]()[_0x3d18fb(0x1e1)]();return this[_0x3d18fb(0x1c7)][_0x5e38c0]=new Conversation(_0x5e38c0,_0x4c8daa),this[_0x3d18fb(0x1d2)]=_0x5e38c0,this['saveConversations'](),this['notifyCurrentConversationChange'](),_0x5e38c0;}['deleteConversation'](_0x3e0348){const _0x3dbad8=_0xba86b3,_0x40e170={'UWHbQ':function(_0x281bce,_0x16eb00){return _0x281bce===_0x16eb00;}};this['conversations'][_0x3e0348]&&(delete this['conversations'][_0x3e0348],_0x40e170[_0x3dbad8(0x1fb)](this[_0x3dbad8(0x1d2)],_0x3e0348)&&(this['currentConversationId']=null,this['createNewConversation']()),this[_0x3dbad8(0x1da)]());}[_0xba86b3(0x1c1)](_0x8d48f7){const _0x50bf33=_0xba86b3;if(this[_0x50bf33(0x1c7)][_0x8d48f7])return this[_0x50bf33(0x1d2)]=_0x8d48f7,this[_0x50bf33(0x1f4)](),!![];return![];}['getCurrentConversation'](){const _0x650ccd=_0xba86b3;return this['conversations'][this[_0x650ccd(0x1d2)]]||null;}[_0xba86b3(0x1ff)](_0x52e6f9,_0x7ab261){const _0x3d479f=_0xba86b3,_0x293e39={'qoFEw':function(_0x2ccc3a,_0x5200d2){return _0x2ccc3a===_0x5200d2;},'vNZYp':_0x3d479f(0x1d9),'KOluh':function(_0x192c90,_0x159f70){return _0x192c90===_0x159f70;},'XvZiC':function(_0x55d8e5,_0x56f6fb){return _0x55d8e5+_0x56f6fb;},'fUQQd':function(_0x5a51e6,_0x2d53e3){return _0x5a51e6>_0x2d53e3;},'dyDGe':_0x3d479f(0x1e9)},_0x5800d9=this[_0x3d479f(0x1eb)]();if(!_0x5800d9)return![];return _0x5800d9['messages']['push']({'role':_0x7ab261,'content':_0x52e6f9,'timestamp':new Date()['toISOString']()}),_0x5800d9[_0x3d479f(0x1bc)]=new Date()[_0x3d479f(0x1d3)](),_0x293e39[_0x3d479f(0x203)](_0x7ab261,_0x293e39[_0x3d479f(0x1f6)])&&_0x293e39[_0x3d479f(0x1df)](_0x5800d9[_0x3d479f(0x1c3)][_0x3d479f(0x1d5)],0x1)&&(_0x5800d9['title']=_0x293e39[_0x3d479f(0x1ef)](_0x52e6f9['slice'](0x0,0x1e),_0x293e39[_0x3d479f(0x1ee)](_0x52e6f9['length'],0x1e)?_0x293e39['dyDGe']:'')),this[_0x3d479f(0x1da)](),!![];}[_0xba86b3(0x1e2)](){const _0xa10ad2=_0xba86b3;this['listeners'][_0xa10ad2(0x1e5)][_0xa10ad2(0x1f8)](_0x3fd520=>_0x3fd520(this['conversations']));}['notifyCurrentConversationChange'](){const _0x35992b=_0xba86b3;this[_0x35992b(0x1e7)][_0x35992b(0x1d4)][_0x35992b(0x1f8)](_0x498a9f=>_0x498a9f(this[_0x35992b(0x1eb)]()));}[_0xba86b3(0x1cc)](_0x2de791,_0x4c86c6){const _0x366f14=_0xba86b3;this['listeners'][_0x2de791]&&this['listeners'][_0x2de791][_0x366f14(0x1d8)](_0x4c86c6);}[_0xba86b3(0x1f3)](_0x4b9f03,_0x3f86b2){const _0x34541b=_0xba86b3;this[_0x34541b(0x1e7)][_0x4b9f03]&&(this['listeners'][_0x4b9f03]=this[_0x34541b(0x1e7)][_0x4b9f03][_0x34541b(0x1be)](_0x109283=>_0x109283!==_0x3f86b2));}}export{BaseConversationManager};