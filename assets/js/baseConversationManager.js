
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x21d695=_0xc26c;function _0x5789(){const _0x27eef4=['info','2820181UKCQMb','toISOString','ajuwc','createNewConversation','notifyConversationUpdate','cleanupStorage','72455ysYgTZ','toString','length','setItem','380164PamMhW','MAX_STORAGE_SIZE','OHcew','notifyCurrentConversationChange','...','forEach','now','zDCNw','IoVTt','user','Failed\x20to\x20load\x20conversations','uJonx','currentConversationId','deleteConversation','conversations','split','Conversations\x20saved\x20successfully','sort','updatedAt','push','slice','Trimmed\x20to\x20','YMKLM','saveConversations','6159096auWpbK','fromEntries','1|0|4|2|3','\x20conversations','title','Storage\x20cleanup\x20initiated','808874EHMcOo','getItem','pop','listeners','XvbWU','44RGGZBW','messages','createdAt','onConversationUpdate','kGiWb','Storage\x20cleanup\x20completed','map','AruTd','MAX_CONVERSATIONS','onCurrentConversationChange','New\x20Chat','keys','6719784DinGJo','getCurrentConversation','stringify','MNdIY','2357556ZGRcrM','values','addEventListener','error'];_0x5789=function(){return _0x27eef4;};return _0x5789();}function _0xc26c(_0x45464c,_0x1972dd){const _0x5789ca=_0x5789();return _0xc26c=function(_0xc26c12,_0x4fcb3f){_0xc26c12=_0xc26c12-0x15e;let _0xa50219=_0x5789ca[_0xc26c12];return _0xa50219;},_0xc26c(_0x45464c,_0x1972dd);}(function(_0x5f3fee,_0x4e1ed9){const _0x3854ab=_0xc26c,_0x276b37=_0x5f3fee();while(!![]){try{const _0x595fff=-parseInt(_0x3854ab(0x15e))/0x1+parseInt(_0x3854ab(0x182))/0x2+parseInt(_0x3854ab(0x173))/0x3+-parseInt(_0x3854ab(0x163))/0x4*(-parseInt(_0x3854ab(0x17e))/0x5)+-parseInt(_0x3854ab(0x19a))/0x6+parseInt(_0x3854ab(0x178))/0x7+parseInt(_0x3854ab(0x16f))/0x8;if(_0x595fff===_0x4e1ed9)break;else _0x276b37['push'](_0x276b37['shift']());}catch(_0x5e89d5){_0x276b37['push'](_0x276b37['shift']());}}}(_0x5789,0x84851));import{Logger}from'./common.js';class Conversation{constructor(_0x10e399,_0x143af4){const _0x1e7383=_0xc26c,_0xb92946={'YMKLM':_0x1e7383(0x19c),'BaXPe':function(_0x3b653d,_0x159992){return _0x3b653d||_0x159992;},'kGiWb':_0x1e7383(0x16d)},_0x147d8d=_0xb92946[_0x1e7383(0x198)][_0x1e7383(0x191)]('|');let _0x2002fe=0x0;while(!![]){switch(_0x147d8d[_0x2002fe++]){case'0':this[_0x1e7383(0x19e)]=_0xb92946['BaXPe'](_0x143af4,_0xb92946[_0x1e7383(0x167)]);continue;case'1':this['id']=_0x10e399;continue;case'2':this[_0x1e7383(0x165)]=new Date()[_0x1e7383(0x179)]();continue;case'3':this[_0x1e7383(0x194)]=new Date()[_0x1e7383(0x179)]();continue;case'4':this[_0x1e7383(0x164)]=[];continue;}break;}}}class BaseConversationManager{constructor(){const _0x58dc85=_0xc26c,_0x2cad81={'uJonx':function(_0x538944,_0x1635e9){return _0x538944*_0x1635e9;}};this[_0x58dc85(0x190)]={},this['currentConversationId']=null,this[_0x58dc85(0x161)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]},this[_0x58dc85(0x183)]=_0x2cad81[_0x58dc85(0x18d)](4.5,0x400)*0x400,this[_0x58dc85(0x16b)]=0x32,this['loadConversations'](),(!this[_0x58dc85(0x18e)]||!this[_0x58dc85(0x190)][this['currentConversationId']])&&this['createNewConversation']();}['loadConversations'](){const _0x4219fb=_0xc26c,_0x53614b={'MNdIY':'conversations'};try{const _0x487276=JSON['parse'](localStorage[_0x4219fb(0x15f)](_0x53614b[_0x4219fb(0x172)]))||[];Array['isArray'](_0x487276)&&(this['conversations']=Object[_0x4219fb(0x19b)](_0x487276[_0x4219fb(0x169)](_0x370ccf=>[_0x370ccf['id'],new Conversation(_0x370ccf['id'],_0x370ccf[_0x4219fb(0x19e)])]))),Logger['info']('Loaded\x20'+Object[_0x4219fb(0x16e)](this[_0x4219fb(0x190)])[_0x4219fb(0x180)]+_0x4219fb(0x19d));}catch(_0x2cf117){Logger[_0x4219fb(0x176)](_0x4219fb(0x18c),_0x2cf117),this['conversations']={};}}[_0x21d695(0x199)](){const _0x73ed3f=_0x21d695,_0x3ac80d={'ajuwc':function(_0x28a3fd,_0x5ef17e){return _0x28a3fd>_0x5ef17e;},'jYOZg':_0x73ed3f(0x192),'hnvjY':'Failed\x20to\x20save\x20conversations'};try{let _0x2d8244=JSON['stringify'](Object[_0x73ed3f(0x174)](this[_0x73ed3f(0x190)]));_0x3ac80d[_0x73ed3f(0x17a)](_0x2d8244['length'],this['MAX_STORAGE_SIZE'])&&this['cleanupStorage'](),localStorage[_0x73ed3f(0x181)](_0x73ed3f(0x190),_0x2d8244),this[_0x73ed3f(0x17c)](),Logger[_0x73ed3f(0x177)](_0x3ac80d['jYOZg']);}catch(_0x49ba49){Logger[_0x73ed3f(0x176)](_0x3ac80d['hnvjY'],_0x49ba49);}}[_0x21d695(0x17d)](){const _0x4211fe=_0x21d695,_0x10cf43={'OHcew':_0x4211fe(0x19f),'AruTd':function(_0x4f195a,_0x205a8b){return _0x4f195a>_0x205a8b;},'KZQZA':_0x4211fe(0x168)};Logger['warn'](_0x10cf43[_0x4211fe(0x184)]);let _0x25c27b=Object[_0x4211fe(0x174)](this[_0x4211fe(0x190)])[_0x4211fe(0x193)]((_0x1ea6bf,_0x137c72)=>new Date(_0x137c72[_0x4211fe(0x194)])-new Date(_0x1ea6bf[_0x4211fe(0x194)]));_0x10cf43[_0x4211fe(0x16a)](_0x25c27b[_0x4211fe(0x180)],this[_0x4211fe(0x16b)])&&(_0x25c27b=_0x25c27b[_0x4211fe(0x196)](0x0,this[_0x4211fe(0x16b)]),this[_0x4211fe(0x190)]=Object[_0x4211fe(0x19b)](_0x25c27b[_0x4211fe(0x169)](_0x8bae6d=>[_0x8bae6d['id'],_0x8bae6d])),Logger[_0x4211fe(0x177)](_0x4211fe(0x197)+this['MAX_CONVERSATIONS']+'\x20conversations'));let _0x32d9f8=JSON[_0x4211fe(0x171)](_0x25c27b)['length'];while(_0x10cf43[_0x4211fe(0x16a)](_0x32d9f8,this[_0x4211fe(0x183)])&&_0x25c27b[_0x4211fe(0x180)]>0x0){const _0x148153=_0x25c27b[_0x4211fe(0x160)]();delete this[_0x4211fe(0x190)][_0x148153['id']],_0x32d9f8=JSON['stringify'](Object[_0x4211fe(0x174)](this[_0x4211fe(0x190)]))[_0x4211fe(0x180)];}Logger['info'](_0x10cf43['KZQZA']);}['createNewConversation'](_0x516d29=_0x21d695(0x16d)){const _0x3a84fb=_0x21d695,_0x244740=Date[_0x3a84fb(0x188)]()[_0x3a84fb(0x17f)]();return this[_0x3a84fb(0x190)][_0x244740]=new Conversation(_0x244740,_0x516d29),this[_0x3a84fb(0x18e)]=_0x244740,this[_0x3a84fb(0x199)](),this[_0x3a84fb(0x185)](),_0x244740;}[_0x21d695(0x18f)](_0x5ebb72){const _0x1146c4=_0x21d695;this[_0x1146c4(0x190)][_0x5ebb72]&&(delete this['conversations'][_0x5ebb72],this[_0x1146c4(0x18e)]===_0x5ebb72&&(this['currentConversationId']=null,this[_0x1146c4(0x17b)]()),this[_0x1146c4(0x199)]());}['switchConversation'](_0x5cde5a){const _0x5f48ca=_0x21d695;if(this[_0x5f48ca(0x190)][_0x5cde5a])return this['currentConversationId']=_0x5cde5a,this[_0x5f48ca(0x185)](),!![];return![];}['getCurrentConversation'](){const _0xb7d53d=_0x21d695;return this[_0xb7d53d(0x190)][this[_0xb7d53d(0x18e)]]||null;}['addMessage'](_0x537407,_0x371276){const _0x255ec8=_0x21d695,_0x48a1c4={'IoVTt':function(_0x4f8fbc,_0x2c3176){return _0x4f8fbc===_0x2c3176;},'xRsif':_0x255ec8(0x18b),'zDCNw':function(_0x42c6f2,_0x133e5f){return _0x42c6f2>_0x133e5f;},'XvbWU':_0x255ec8(0x186)},_0x20925f=this[_0x255ec8(0x170)]();if(!_0x20925f)return![];return _0x20925f['messages'][_0x255ec8(0x195)]({'role':_0x371276,'content':_0x537407,'timestamp':new Date()[_0x255ec8(0x179)]()}),_0x20925f[_0x255ec8(0x194)]=new Date()[_0x255ec8(0x179)](),_0x48a1c4[_0x255ec8(0x18a)](_0x371276,_0x48a1c4['xRsif'])&&_0x48a1c4[_0x255ec8(0x18a)](_0x20925f['messages'][_0x255ec8(0x180)],0x1)&&(_0x20925f['title']=_0x537407['slice'](0x0,0x1e)+(_0x48a1c4[_0x255ec8(0x189)](_0x537407[_0x255ec8(0x180)],0x1e)?_0x48a1c4[_0x255ec8(0x162)]:'')),this[_0x255ec8(0x199)](),!![];}['notifyConversationUpdate'](){const _0x13e6bd=_0x21d695;this['listeners'][_0x13e6bd(0x166)][_0x13e6bd(0x187)](_0x5d3187=>_0x5d3187(this[_0x13e6bd(0x190)]));}[_0x21d695(0x185)](){const _0x21c096=_0x21d695;this['listeners'][_0x21c096(0x16c)][_0x21c096(0x187)](_0x366fd4=>_0x366fd4(this[_0x21c096(0x170)]()));}[_0x21d695(0x175)](_0x1c5bcd,_0x13d06a){const _0x40476b=_0x21d695;this[_0x40476b(0x161)][_0x1c5bcd]&&this[_0x40476b(0x161)][_0x1c5bcd]['push'](_0x13d06a);}['removeEventListener'](_0x3b6013,_0x43ecd6){const _0x55989d=_0x21d695;this[_0x55989d(0x161)][_0x3b6013]&&(this[_0x55989d(0x161)][_0x3b6013]=this[_0x55989d(0x161)][_0x3b6013]['filter'](_0x9fc5ae=>_0x9fc5ae!==_0x43ecd6));}}export{BaseConversationManager};