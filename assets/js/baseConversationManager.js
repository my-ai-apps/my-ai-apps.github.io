
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x2a9aae=_0x2aec;function _0x2aec(_0x23463f,_0xc60f50){const _0x31fa4e=_0x31fa();return _0x2aec=function(_0x2aec6e,_0x43ce66){_0x2aec6e=_0x2aec6e-0x179;let _0x1e77cf=_0x31fa4e[_0x2aec6e];return _0x1e77cf;},_0x2aec(_0x23463f,_0xc60f50);}function _0x31fa(){const _0x326408=['nZuYD','...','createNewConversation','conversations','Csqig','info','OFXQE','joWWT','10OkJIQx','switchConversation','IJWbu','Loaded\x20','isArray','KvZlJ','saveConversations','188SLxDIt','title','getCurrentConversation','7968719PMqhPN','8MMtquk','996aOiXGI','FQbJG','notifyConversationUpdate','MAX_STORAGE_SIZE','slice','sort','addEventListener','listeners','toISOString','updatedAt','fromEntries','createdAt','cleanupStorage','deleteConversation','keys','PYGtO','New\x20Chat','\x20conversations','101685cHWNoy','values','2920211ywubEm','currentConversationId','pop','filter','parse','Trimmed\x20to\x20','Storage\x20cleanup\x20initiated','error','1334208Qocgul','stringify','5|1|2|3|4|0','split','notifyCurrentConversationChange','dPaCv','length','MAX_CONVERSATIONS','849VEsTmq','push','messages','7386606EDsJgn','SbNOA','Conversations\x20saved\x20successfully','onConversationUpdate','forEach','7381416IDaamz','qSxTl','map'];_0x31fa=function(){return _0x326408;};return _0x31fa();}(function(_0x2970cb,_0x455f5c){const _0x2693ec=_0x2aec,_0x33e38d=_0x2970cb();while(!![]){try{const _0x5dfc60=-parseInt(_0x2693ec(0x179))/0x1+parseInt(_0x2693ec(0x1a0))/0x2*(-parseInt(_0x2693ec(0x181))/0x3)+parseInt(_0x2693ec(0x19b))/0x4*(-parseInt(_0x2693ec(0x1b2))/0x5)+parseInt(_0x2693ec(0x189))/0x6+-parseInt(_0x2693ec(0x1b4))/0x7*(-parseInt(_0x2693ec(0x19f))/0x8)+-parseInt(_0x2693ec(0x184))/0x9*(-parseInt(_0x2693ec(0x194))/0xa)+parseInt(_0x2693ec(0x19e))/0xb;if(_0x5dfc60===_0x455f5c)break;else _0x33e38d['push'](_0x33e38d['shift']());}catch(_0x376783){_0x33e38d['push'](_0x33e38d['shift']());}}}(_0x31fa,0xb9ef7));import{Logger}from'./common.js';class Conversation{constructor(_0x3a97cf,_0x1d8f5a){const _0x8d9a00=_0x2aec,_0x33f48e={'Csqig':_0x8d9a00(0x1b0)};this['id']=_0x3a97cf,this[_0x8d9a00(0x19c)]=_0x1d8f5a||_0x33f48e[_0x8d9a00(0x190)],this[_0x8d9a00(0x183)]=[],this[_0x8d9a00(0x1ab)]=new Date()[_0x8d9a00(0x1a8)](),this[_0x8d9a00(0x1a9)]=new Date()[_0x8d9a00(0x1a8)]();}}class BaseConversationManager{constructor(){const _0x4d593b=_0x2aec,_0x244c4a={'PYGtO':_0x4d593b(0x17b),'joWWT':function(_0x283655,_0x1d9f84){return _0x283655*_0x1d9f84;}},_0x16472b=_0x244c4a[_0x4d593b(0x1af)][_0x4d593b(0x17c)]('|');let _0x2d91eb=0x0;while(!![]){switch(_0x16472b[_0x2d91eb++]){case'0':this['loadConversations']();continue;case'1':this[_0x4d593b(0x1b5)]=null;continue;case'2':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'3':this[_0x4d593b(0x1a3)]=_0x244c4a[_0x4d593b(0x193)](_0x244c4a[_0x4d593b(0x193)](4.5,0x400),0x400);continue;case'4':this[_0x4d593b(0x180)]=0x32;continue;case'5':this['conversations']={};continue;}break;}}['loadConversations'](){const _0xd934ab=_0x2aec,_0x31c3e1={'OFXQE':_0xd934ab(0x18f),'dPaCv':'Failed\x20to\x20load\x20conversations'};try{const _0x45d544=JSON[_0xd934ab(0x1b8)](localStorage['getItem'](_0x31c3e1[_0xd934ab(0x192)]))||[];Array[_0xd934ab(0x198)](_0x45d544)&&(this['conversations']=Object[_0xd934ab(0x1aa)](_0x45d544[_0xd934ab(0x18b)](_0x3b83ea=>[_0x3b83ea['id'],new Conversation(_0x3b83ea['id'],_0x3b83ea[_0xd934ab(0x19c)])]))),Logger[_0xd934ab(0x191)](_0xd934ab(0x197)+Object[_0xd934ab(0x1ae)](this['conversations'])['length']+_0xd934ab(0x1b1));}catch(_0x5c8549){Logger[_0xd934ab(0x1bb)](_0x31c3e1[_0xd934ab(0x17e)],_0x5c8549),this[_0xd934ab(0x18f)]={};}}['saveConversations'](){const _0x591ebc=_0x2aec,_0x43697a={'tlkJN':function(_0xb131c9,_0x51d714){return _0xb131c9>_0x51d714;},'KvZlJ':_0x591ebc(0x18f),'qSxTl':_0x591ebc(0x186)};try{let _0x386842=JSON[_0x591ebc(0x17a)](Object['values'](this[_0x591ebc(0x18f)]));_0x43697a['tlkJN'](_0x386842[_0x591ebc(0x17f)],this[_0x591ebc(0x1a3)])&&this[_0x591ebc(0x1ac)](),localStorage['setItem'](_0x43697a[_0x591ebc(0x199)],_0x386842),this[_0x591ebc(0x1a2)](),Logger['info'](_0x43697a[_0x591ebc(0x18a)]);}catch(_0x469ff7){Logger[_0x591ebc(0x1bb)]('Failed\x20to\x20save\x20conversations',_0x469ff7);}}['cleanupStorage'](){const _0x8bc3ce=_0x2aec,_0x55db0f={'BJbqb':_0x8bc3ce(0x1ba),'nZuYD':function(_0x3919c0,_0x19135a){return _0x3919c0>_0x19135a;},'vyaje':function(_0x551532,_0x1fe7e8){return _0x551532>_0x1fe7e8;},'CqnDy':'Storage\x20cleanup\x20completed'};Logger['warn'](_0x55db0f['BJbqb']);let _0x5c6915=Object['values'](this[_0x8bc3ce(0x18f)])[_0x8bc3ce(0x1a5)]((_0x29c228,_0x5a80fc)=>new Date(_0x5a80fc[_0x8bc3ce(0x1a9)])-new Date(_0x29c228['updatedAt']));_0x55db0f[_0x8bc3ce(0x18c)](_0x5c6915[_0x8bc3ce(0x17f)],this['MAX_CONVERSATIONS'])&&(_0x5c6915=_0x5c6915[_0x8bc3ce(0x1a4)](0x0,this[_0x8bc3ce(0x180)]),this[_0x8bc3ce(0x18f)]=Object['fromEntries'](_0x5c6915[_0x8bc3ce(0x18b)](_0x1071e2=>[_0x1071e2['id'],_0x1071e2])),Logger[_0x8bc3ce(0x191)](_0x8bc3ce(0x1b9)+this[_0x8bc3ce(0x180)]+_0x8bc3ce(0x1b1)));let _0x42c535=JSON['stringify'](_0x5c6915)['length'];while(_0x55db0f['vyaje'](_0x42c535,this['MAX_STORAGE_SIZE'])&&_0x5c6915['length']>0x0){const _0x836209=_0x5c6915[_0x8bc3ce(0x1b6)]();delete this[_0x8bc3ce(0x18f)][_0x836209['id']],_0x42c535=JSON[_0x8bc3ce(0x17a)](Object[_0x8bc3ce(0x1b3)](this['conversations']))['length'];}Logger['info'](_0x55db0f['CqnDy']);}['createNewConversation'](_0x381e6d='New\x20Chat'){const _0x17b82b=_0x2aec,_0x5378a1=Date['now']()['toString']();return this[_0x17b82b(0x18f)][_0x5378a1]=new Conversation(_0x5378a1,_0x381e6d),this['currentConversationId']=_0x5378a1,this['saveConversations'](),this[_0x17b82b(0x17d)](),_0x5378a1;}[_0x2a9aae(0x1ad)](_0x525cb8){const _0xd02cd8=_0x2a9aae,_0x49f668={'FQbJG':function(_0x15693a,_0xdc2211){return _0x15693a===_0xdc2211;}};this[_0xd02cd8(0x18f)][_0x525cb8]&&(delete this[_0xd02cd8(0x18f)][_0x525cb8],_0x49f668[_0xd02cd8(0x1a1)](this[_0xd02cd8(0x1b5)],_0x525cb8)&&(this['currentConversationId']=null,this[_0xd02cd8(0x18e)]()),this['saveConversations']());}[_0x2a9aae(0x195)](_0x1bfad4){const _0x32f546=_0x2a9aae;if(this[_0x32f546(0x18f)][_0x1bfad4])return this[_0x32f546(0x1b5)]=_0x1bfad4,this[_0x32f546(0x17d)](),!![];return![];}[_0x2a9aae(0x19d)](){const _0x7c32a7=_0x2a9aae;return this['conversations'][this[_0x7c32a7(0x1b5)]]||null;}['addMessage'](_0x38a491,_0x14bf5c){const _0x4c84be=_0x2a9aae,_0x57b13a={'SbNOA':function(_0x36f53a,_0x56ea1a){return _0x36f53a===_0x56ea1a;},'Erlnh':'user','wXBou':function(_0x405726,_0x35fef1){return _0x405726+_0x35fef1;},'ANYMK':function(_0x544622,_0x564c49){return _0x544622>_0x564c49;},'IJWbu':_0x4c84be(0x18d)},_0x1d5280=this['getCurrentConversation']();if(!_0x1d5280)return![];return _0x1d5280[_0x4c84be(0x183)][_0x4c84be(0x182)]({'role':_0x14bf5c,'content':_0x38a491,'timestamp':new Date()[_0x4c84be(0x1a8)]()}),_0x1d5280[_0x4c84be(0x1a9)]=new Date()['toISOString'](),_0x57b13a[_0x4c84be(0x185)](_0x14bf5c,_0x57b13a['Erlnh'])&&_0x1d5280[_0x4c84be(0x183)]['length']===0x1&&(_0x1d5280['title']=_0x57b13a['wXBou'](_0x38a491['slice'](0x0,0x1e),_0x57b13a['ANYMK'](_0x38a491[_0x4c84be(0x17f)],0x1e)?_0x57b13a[_0x4c84be(0x196)]:'')),this[_0x4c84be(0x19a)](),!![];}[_0x2a9aae(0x1a2)](){const _0x26ff33=_0x2a9aae;this['listeners'][_0x26ff33(0x187)][_0x26ff33(0x188)](_0x4664d5=>_0x4664d5(this[_0x26ff33(0x18f)]));}[_0x2a9aae(0x17d)](){const _0x390da8=_0x2a9aae;this['listeners']['onCurrentConversationChange']['forEach'](_0x2908bb=>_0x2908bb(this[_0x390da8(0x19d)]()));}[_0x2a9aae(0x1a6)](_0x6ce59f,_0x29b867){const _0x1b382d=_0x2a9aae;this['listeners'][_0x6ce59f]&&this[_0x1b382d(0x1a7)][_0x6ce59f][_0x1b382d(0x182)](_0x29b867);}['removeEventListener'](_0x265c6a,_0x1ba385){const _0x51cd0b=_0x2a9aae;this[_0x51cd0b(0x1a7)][_0x265c6a]&&(this[_0x51cd0b(0x1a7)][_0x265c6a]=this[_0x51cd0b(0x1a7)][_0x265c6a][_0x51cd0b(0x1b7)](_0x22215f=>_0x22215f!==_0x1ba385));}}export{BaseConversationManager};