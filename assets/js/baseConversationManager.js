
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x5d45(_0x1b0ed5,_0x517798){const _0x4ceafb=_0x4cea();return _0x5d45=function(_0x5d4567,_0xd3d756){_0x5d4567=_0x5d4567-0x7e;let _0x489a1e=_0x4ceafb[_0x5d4567];return _0x489a1e;},_0x5d45(_0x1b0ed5,_0x517798);}const _0x3a12eb=_0x5d45;(function(_0x4e34ad,_0xdd566b){const _0x3fb88f=_0x5d45,_0x463d58=_0x4e34ad();while(!![]){try{const _0x444c9c=-parseInt(_0x3fb88f(0xc1))/0x1*(-parseInt(_0x3fb88f(0xa4))/0x2)+-parseInt(_0x3fb88f(0x96))/0x3*(-parseInt(_0x3fb88f(0x9d))/0x4)+parseInt(_0x3fb88f(0x90))/0x5*(parseInt(_0x3fb88f(0xa2))/0x6)+parseInt(_0x3fb88f(0xa6))/0x7+parseInt(_0x3fb88f(0x9f))/0x8*(-parseInt(_0x3fb88f(0x7f))/0x9)+parseInt(_0x3fb88f(0xa5))/0xa*(-parseInt(_0x3fb88f(0x89))/0xb)+-parseInt(_0x3fb88f(0x8c))/0xc*(parseInt(_0x3fb88f(0xaa))/0xd);if(_0x444c9c===_0xdd566b)break;else _0x463d58['push'](_0x463d58['shift']());}catch(_0x2915d7){_0x463d58['push'](_0x463d58['shift']());}}}(_0x4cea,0x35410));import{Logger}from'./common.js';function _0x4cea(){const _0x1930c4=['loadConversations','slice','currentConversationId','onConversationUpdate','messages','sxCCo','kpwwL','toString','saveConversations','toISOString','notifyConversationUpdate','addMessage','parse','fromEntries','title','split','Failed\x20to\x20load\x20conversations','conversations','map','uiadO','keys','filter','326734ERWgZp','setItem','info','UTObm','3|0|1|4|2|5','4419HRTAgQ','getCurrentConversation','addEventListener','EcLHf','createdAt','Loaded\x20','Storage\x20cleanup\x20initiated','getItem','stringify','notifyCurrentConversationChange','22dgCuXQ','listeners','Conversations\x20saved\x20successfully','624JAguwj','length','FKvov','deleteConversation','534115dbZoxF','now','ElVwm','ENrde','createNewConversation','error','309954OCGwxp','New\x20Chat','MAX_CONVERSATIONS','updatedAt','removeEventListener','onCurrentConversationChange','MAX_STORAGE_SIZE','16FBpcTD','Trimmed\x20to\x20','2544bJkAfU','KLmdw','cleanupStorage','6LEmxEQ','vGXFD','2hzMUyz','616620fLyTwv','650419dtmKZk','\x20conversations','user','values','110539uRwjMQ'];_0x4cea=function(){return _0x1930c4;};return _0x4cea();}class Conversation{constructor(_0x59f93f,_0x42ab76){const _0x1d91b4=_0x5d45,_0x3e48ae={'NrIAB':function(_0x4bf277,_0x3ca89a){return _0x4bf277||_0x3ca89a;},'UTObm':_0x1d91b4(0x97)};this['id']=_0x59f93f,this[_0x1d91b4(0xb9)]=_0x3e48ae['NrIAB'](_0x42ab76,_0x3e48ae[_0x1d91b4(0xc4)]),this[_0x1d91b4(0xaf)]=[],this[_0x1d91b4(0x83)]=new Date()[_0x1d91b4(0xb4)](),this[_0x1d91b4(0x99)]=new Date()[_0x1d91b4(0xb4)]();}}class BaseConversationManager{constructor(){const _0x1930fa=_0x5d45,_0x3678f5={'ElVwm':_0x1930fa(0x7e),'FKvov':function(_0x1578a8,_0x3f2b14){return _0x1578a8*_0x3f2b14;}},_0x88c314=_0x3678f5[_0x1930fa(0x92)][_0x1930fa(0xba)]('|');let _0x2d4243=0x0;while(!![]){switch(_0x88c314[_0x2d4243++]){case'0':this['currentConversationId']=null;continue;case'1':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'2':this[_0x1930fa(0x98)]=0x32;continue;case'3':this['conversations']={};continue;case'4':this[_0x1930fa(0x9c)]=_0x3678f5[_0x1930fa(0x8e)](4.5*0x400,0x400);continue;case'5':this['loadConversations']();continue;}break;}}[_0x3a12eb(0xab)](){const _0x3e3421=_0x3a12eb,_0x4386c9={'LtWZo':_0x3e3421(0xbc),'vGXFD':_0x3e3421(0xbb)};try{const _0x3b0495=JSON[_0x3e3421(0xb7)](localStorage[_0x3e3421(0x86)](_0x4386c9['LtWZo']))||[];Array['isArray'](_0x3b0495)&&(this[_0x3e3421(0xbc)]=Object[_0x3e3421(0xb8)](_0x3b0495['map'](_0x2a5b3c=>[_0x2a5b3c['id'],new Conversation(_0x2a5b3c['id'],_0x2a5b3c[_0x3e3421(0xb9)])]))),Logger[_0x3e3421(0xc3)](_0x3e3421(0x84)+Object[_0x3e3421(0xbf)](this[_0x3e3421(0xbc)])[_0x3e3421(0x8d)]+_0x3e3421(0xa7));}catch(_0x2c5530){Logger[_0x3e3421(0x95)](_0x4386c9[_0x3e3421(0xa3)],_0x2c5530),this[_0x3e3421(0xbc)]={};}}[_0x3a12eb(0xb3)](){const _0x282ad3=_0x3a12eb,_0x12668e={'PeKoB':function(_0x155402,_0x18cf35){return _0x155402>_0x18cf35;},'kpwwL':'conversations','sxCCo':_0x282ad3(0x8b)};try{let _0x2b2ffc=JSON[_0x282ad3(0x87)](Object['values'](this[_0x282ad3(0xbc)]));_0x12668e['PeKoB'](_0x2b2ffc[_0x282ad3(0x8d)],this[_0x282ad3(0x9c)])&&this['cleanupStorage'](),localStorage[_0x282ad3(0xc2)](_0x12668e[_0x282ad3(0xb1)],_0x2b2ffc),this[_0x282ad3(0xb5)](),Logger['info'](_0x12668e[_0x282ad3(0xb0)]);}catch(_0x26ab91){Logger[_0x282ad3(0x95)]('Failed\x20to\x20save\x20conversations',_0x26ab91);}}[_0x3a12eb(0xa1)](){const _0x2103c3=_0x3a12eb,_0x5230d4={'uiadO':_0x2103c3(0x85),'YxjCt':function(_0x4d0cf9,_0x147bb0){return _0x4d0cf9>_0x147bb0;},'KsDOV':function(_0x45863c,_0x3618d6){return _0x45863c>_0x3618d6;},'QhZxK':function(_0x4ce9f2,_0x3ff5fe){return _0x4ce9f2>_0x3ff5fe;},'EcLHf':'Storage\x20cleanup\x20completed'};Logger['warn'](_0x5230d4[_0x2103c3(0xbe)]);let _0x3ac24b=Object['values'](this[_0x2103c3(0xbc)])['sort']((_0x3f630c,_0x3294ed)=>new Date(_0x3294ed[_0x2103c3(0x99)])-new Date(_0x3f630c[_0x2103c3(0x99)]));_0x5230d4['YxjCt'](_0x3ac24b['length'],this[_0x2103c3(0x98)])&&(_0x3ac24b=_0x3ac24b['slice'](0x0,this['MAX_CONVERSATIONS']),this[_0x2103c3(0xbc)]=Object[_0x2103c3(0xb8)](_0x3ac24b[_0x2103c3(0xbd)](_0x5f3d66=>[_0x5f3d66['id'],_0x5f3d66])),Logger[_0x2103c3(0xc3)](_0x2103c3(0x9e)+this[_0x2103c3(0x98)]+_0x2103c3(0xa7)));let _0x23aeca=JSON[_0x2103c3(0x87)](_0x3ac24b)[_0x2103c3(0x8d)];while(_0x5230d4['KsDOV'](_0x23aeca,this[_0x2103c3(0x9c)])&&_0x5230d4['QhZxK'](_0x3ac24b['length'],0x0)){const _0x4a901c=_0x3ac24b['pop']();delete this[_0x2103c3(0xbc)][_0x4a901c['id']],_0x23aeca=JSON[_0x2103c3(0x87)](Object[_0x2103c3(0xa9)](this[_0x2103c3(0xbc)]))[_0x2103c3(0x8d)];}Logger[_0x2103c3(0xc3)](_0x5230d4[_0x2103c3(0x82)]);}[_0x3a12eb(0x94)](_0x5eba28=_0x3a12eb(0x97)){const _0x1d66c4=_0x3a12eb,_0xeae452=Date[_0x1d66c4(0x91)]()[_0x1d66c4(0xb2)]();return this[_0x1d66c4(0xbc)][_0xeae452]=new Conversation(_0xeae452,_0x5eba28),this[_0x1d66c4(0xad)]=_0xeae452,this[_0x1d66c4(0xb3)](),this[_0x1d66c4(0x88)](),_0xeae452;}[_0x3a12eb(0x8f)](_0x18462c){const _0x2642a2=_0x3a12eb,_0x1bf4b6={'KLmdw':function(_0x2e4574,_0x4eadb9){return _0x2e4574===_0x4eadb9;}};this['conversations'][_0x18462c]&&(delete this[_0x2642a2(0xbc)][_0x18462c],_0x1bf4b6[_0x2642a2(0xa0)](this[_0x2642a2(0xad)],_0x18462c)&&(this['currentConversationId']=null,this[_0x2642a2(0x94)]()),this[_0x2642a2(0xb3)]());}['switchConversation'](_0x43f1d8){const _0x5a2def=_0x3a12eb;if(this[_0x5a2def(0xbc)][_0x43f1d8])return this[_0x5a2def(0xad)]=_0x43f1d8,this[_0x5a2def(0x88)](),!![];return![];}[_0x3a12eb(0x80)](){const _0x1f948d=_0x3a12eb;return this[_0x1f948d(0xbc)][this[_0x1f948d(0xad)]]||null;}[_0x3a12eb(0xb6)](_0x3fe786,_0x314e32){const _0x2946a3=_0x3a12eb,_0x975bb3={'ibArg':function(_0x10b3c2,_0x43f53d){return _0x10b3c2===_0x43f53d;},'ENrde':function(_0x27bc88,_0x311632){return _0x27bc88===_0x311632;},'YeusR':function(_0x361159,_0x4f6def){return _0x361159+_0x4f6def;}},_0x32dc0a=this[_0x2946a3(0x80)]();if(!_0x32dc0a)return![];return _0x32dc0a[_0x2946a3(0xaf)]['push']({'role':_0x314e32,'content':_0x3fe786,'timestamp':new Date()[_0x2946a3(0xb4)]()}),_0x32dc0a['updatedAt']=new Date()[_0x2946a3(0xb4)](),_0x975bb3['ibArg'](_0x314e32,_0x2946a3(0xa8))&&_0x975bb3[_0x2946a3(0x93)](_0x32dc0a[_0x2946a3(0xaf)][_0x2946a3(0x8d)],0x1)&&(_0x32dc0a[_0x2946a3(0xb9)]=_0x975bb3['YeusR'](_0x3fe786[_0x2946a3(0xac)](0x0,0x1e),_0x3fe786['length']>0x1e?'...':'')),this[_0x2946a3(0xb3)](),!![];}['notifyConversationUpdate'](){const _0x109a43=_0x3a12eb;this[_0x109a43(0x8a)][_0x109a43(0xae)]['forEach'](_0x1901df=>_0x1901df(this[_0x109a43(0xbc)]));}['notifyCurrentConversationChange'](){const _0x3dd7de=_0x3a12eb;this[_0x3dd7de(0x8a)][_0x3dd7de(0x9b)]['forEach'](_0x39c38a=>_0x39c38a(this[_0x3dd7de(0x80)]()));}[_0x3a12eb(0x81)](_0x2315c7,_0x5abe70){const _0x527479=_0x3a12eb;this[_0x527479(0x8a)][_0x2315c7]&&this[_0x527479(0x8a)][_0x2315c7]['push'](_0x5abe70);}[_0x3a12eb(0x9a)](_0x5b200b,_0x5b308e){const _0x2dd3f0=_0x3a12eb;this[_0x2dd3f0(0x8a)][_0x5b200b]&&(this[_0x2dd3f0(0x8a)][_0x5b200b]=this[_0x2dd3f0(0x8a)][_0x5b200b][_0x2dd3f0(0xc0)](_0x37d41a=>_0x37d41a!==_0x5b308e));}}export{BaseConversationManager};