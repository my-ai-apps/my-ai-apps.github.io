
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x1f899f=_0x54b1;(function(_0x479972,_0x213347){const _0xa77a2=_0x54b1,_0x5b98bf=_0x479972();while(!![]){try{const _0x22e339=-parseInt(_0xa77a2(0xf7))/0x1*(parseInt(_0xa77a2(0xc5))/0x2)+parseInt(_0xa77a2(0xf5))/0x3*(-parseInt(_0xa77a2(0xcf))/0x4)+-parseInt(_0xa77a2(0xde))/0x5+parseInt(_0xa77a2(0xe8))/0x6*(parseInt(_0xa77a2(0xbe))/0x7)+-parseInt(_0xa77a2(0xcd))/0x8+-parseInt(_0xa77a2(0x109))/0x9+-parseInt(_0xa77a2(0x10e))/0xa*(-parseInt(_0xa77a2(0xe3))/0xb);if(_0x22e339===_0x213347)break;else _0x5b98bf['push'](_0x5b98bf['shift']());}catch(_0x4a3aa8){_0x5b98bf['push'](_0x5b98bf['shift']());}}}(_0x17e7,0xaf90e));import{Logger}from'./common.js';function _0x54b1(_0x362f23,_0x4d75b9){const _0x17e763=_0x17e7();return _0x54b1=function(_0x54b121,_0x1444fa){_0x54b121=_0x54b121-0xbe;let _0xbb44f0=_0x17e763[_0x54b121];return _0xbb44f0;},_0x54b1(_0x362f23,_0x4d75b9);}class Conversation{constructor(_0x2e2cc6,_0x4a3e18){const _0x3e4df7=_0x54b1,_0x7e2612={'wNcmR':_0x3e4df7(0x100),'zHQhJ':function(_0x574a85,_0xd750c){return _0x574a85||_0xd750c;},'YbDzd':_0x3e4df7(0xe9)},_0x3582fc=_0x7e2612[_0x3e4df7(0x107)]['split']('|');let _0x451ba7=0x0;while(!![]){switch(_0x3582fc[_0x451ba7++]){case'0':this['updatedAt']=new Date()[_0x3e4df7(0x108)]();continue;case'1':this[_0x3e4df7(0xe5)]=new Date()[_0x3e4df7(0x108)]();continue;case'2':this['title']=_0x7e2612[_0x3e4df7(0x10c)](_0x4a3e18,_0x7e2612[_0x3e4df7(0xf2)]);continue;case'3':this['id']=_0x2e2cc6;continue;case'4':this[_0x3e4df7(0xcc)]=[];continue;}break;}}}class BaseConversationManager{constructor(){const _0x57905c=_0x54b1,_0x3e6b6b={'Ztngs':'6|1|4|3|0|2|5','kkztG':function(_0x2ac547,_0x2e2fc6){return _0x2ac547*_0x2e2fc6;}},_0x398e90=_0x3e6b6b[_0x57905c(0x101)][_0x57905c(0xd8)]('|');let _0x1ae61f=0x0;while(!![]){switch(_0x398e90[_0x1ae61f++]){case'0':this['MAX_CONVERSATIONS']=0x32;continue;case'1':this[_0x57905c(0xd4)]=null;continue;case'2':this[_0x57905c(0xc2)]();continue;case'3':this['MAX_STORAGE_SIZE']=_0x3e6b6b[_0x57905c(0xec)](_0x3e6b6b[_0x57905c(0xec)](4.5,0x400),0x400);continue;case'4':this[_0x57905c(0xeb)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'5':(!this['currentConversationId']||!this[_0x57905c(0xdb)][this['currentConversationId']])&&this[_0x57905c(0xe7)]();continue;case'6':this['conversations']={};continue;}break;}}['loadConversations'](){const _0x41303a=_0x54b1,_0x2b8184={'llKCf':_0x41303a(0xdb),'TbETT':'Failed\x20to\x20load\x20conversations'};try{const _0x234c2f=JSON[_0x41303a(0xbf)](localStorage[_0x41303a(0xe6)](_0x2b8184[_0x41303a(0xdf)]))||[];Array['isArray'](_0x234c2f)&&(this['conversations']=Object[_0x41303a(0xdc)](_0x234c2f['map'](_0x137a3b=>[_0x137a3b['id'],new Conversation(_0x137a3b['id'],_0x137a3b['title'])]))),Logger[_0x41303a(0xfc)](_0x41303a(0x106)+Object[_0x41303a(0xff)](this[_0x41303a(0xdb)])[_0x41303a(0xd9)]+_0x41303a(0xed));}catch(_0x4fa854){Logger[_0x41303a(0xd5)](_0x2b8184[_0x41303a(0xe1)],_0x4fa854),this[_0x41303a(0xdb)]={};}}[_0x1f899f(0xf9)](){const _0x132cb9=_0x1f899f,_0x78045d={'RPOtP':function(_0xbb6dd4,_0x11db23){return _0xbb6dd4>_0x11db23;},'cVlqy':_0x132cb9(0xdb),'dPfFN':_0x132cb9(0xf3),'nDqko':_0x132cb9(0xce)};try{let _0x447e33=JSON[_0x132cb9(0xf0)](Object['values'](this[_0x132cb9(0xdb)]));_0x78045d[_0x132cb9(0x10b)](_0x447e33['length'],this['MAX_STORAGE_SIZE'])&&this[_0x132cb9(0xf4)](),localStorage[_0x132cb9(0xd7)](_0x78045d[_0x132cb9(0x104)],_0x447e33),this[_0x132cb9(0xc1)](),Logger[_0x132cb9(0xfc)](_0x78045d[_0x132cb9(0xe4)]);}catch(_0x56199d){Logger[_0x132cb9(0xd5)](_0x78045d['nDqko'],_0x56199d);}}[_0x1f899f(0xf4)](){const _0x5ea19a=_0x1f899f,_0x4c1537={'OVKvh':function(_0x2e1385,_0x57037a){return _0x2e1385>_0x57037a;},'nTuyk':_0x5ea19a(0xf8)};Logger[_0x5ea19a(0xfd)](_0x5ea19a(0xda));let _0x403ffb=Object[_0x5ea19a(0x105)](this[_0x5ea19a(0xdb)])[_0x5ea19a(0xfa)]((_0x379496,_0x5eb3c4)=>new Date(_0x5eb3c4[_0x5ea19a(0xef)])-new Date(_0x379496[_0x5ea19a(0xef)]));_0x403ffb['length']>this['MAX_CONVERSATIONS']&&(_0x403ffb=_0x403ffb[_0x5ea19a(0xe0)](0x0,this[_0x5ea19a(0xca)]),this[_0x5ea19a(0xdb)]=Object[_0x5ea19a(0xdc)](_0x403ffb[_0x5ea19a(0xd3)](_0x3cccb9=>[_0x3cccb9['id'],_0x3cccb9])),Logger[_0x5ea19a(0xfc)](_0x5ea19a(0xea)+this[_0x5ea19a(0xca)]+_0x5ea19a(0xed)));let _0x358ce6=JSON['stringify'](_0x403ffb)[_0x5ea19a(0xd9)];while(_0x4c1537[_0x5ea19a(0xfb)](_0x358ce6,this[_0x5ea19a(0xfe)])&&_0x4c1537['OVKvh'](_0x403ffb[_0x5ea19a(0xd9)],0x0)){const _0x4aef94=_0x403ffb[_0x5ea19a(0xf6)]();delete this[_0x5ea19a(0xdb)][_0x4aef94['id']],_0x358ce6=JSON[_0x5ea19a(0xf0)](Object[_0x5ea19a(0x105)](this[_0x5ea19a(0xdb)]))[_0x5ea19a(0xd9)];}Logger['info'](_0x4c1537[_0x5ea19a(0xc6)]);}[_0x1f899f(0xe7)](_0x42eb87=_0x1f899f(0xe9)){const _0x5ddfbd=_0x1f899f,_0x4cfa19=Date['now']()['toString']();return this[_0x5ddfbd(0xdb)][_0x4cfa19]=new Conversation(_0x4cfa19,_0x42eb87),this[_0x5ddfbd(0xd4)]=_0x4cfa19,this[_0x5ddfbd(0xf9)](),this[_0x5ddfbd(0xc7)](),_0x4cfa19;}[_0x1f899f(0xc8)](_0x973750){const _0xcdc2a9=_0x1f899f,_0x1f78c5={'sIrtW':function(_0xc21b14,_0x3afdf2){return _0xc21b14===_0x3afdf2;}};this['conversations'][_0x973750]&&(delete this['conversations'][_0x973750],_0x1f78c5[_0xcdc2a9(0xd6)](this[_0xcdc2a9(0xd4)],_0x973750)&&(this[_0xcdc2a9(0xd4)]=null,this[_0xcdc2a9(0xe7)]()),this[_0xcdc2a9(0xf9)]());}[_0x1f899f(0xcb)](_0x42f4cd){const _0x2f97f8=_0x1f899f;if(this[_0x2f97f8(0xdb)][_0x42f4cd])return this[_0x2f97f8(0xd4)]=_0x42f4cd,this['notifyCurrentConversationChange'](),!![];return![];}[_0x1f899f(0x10d)](){const _0x1bb036=_0x1f899f;return this[_0x1bb036(0xdb)][this[_0x1bb036(0xd4)]]||null;}[_0x1f899f(0xc4)](_0x446e9c,_0x23e3cf){const _0x335e7f=_0x1f899f,_0x325fed={'KMCDg':function(_0x1a6018,_0x2ae523){return _0x1a6018===_0x2ae523;},'IJRVq':_0x335e7f(0x10a),'XGkgF':function(_0x185337,_0x3fd83a){return _0x185337+_0x3fd83a;},'KGYMB':function(_0x5db636,_0x5f2525){return _0x5db636>_0x5f2525;},'VYPhY':_0x335e7f(0xe2)},_0x392d9a=this[_0x335e7f(0x10d)]();if(!_0x392d9a)return![];return _0x392d9a[_0x335e7f(0xcc)][_0x335e7f(0xd1)]({'role':_0x23e3cf,'content':_0x446e9c,'timestamp':new Date()[_0x335e7f(0x108)]()}),_0x392d9a[_0x335e7f(0xef)]=new Date()[_0x335e7f(0x108)](),_0x325fed[_0x335e7f(0x103)](_0x23e3cf,_0x325fed['IJRVq'])&&_0x392d9a[_0x335e7f(0xcc)][_0x335e7f(0xd9)]===0x1&&(_0x392d9a[_0x335e7f(0xc0)]=_0x325fed['XGkgF'](_0x446e9c['slice'](0x0,0x1e),_0x325fed[_0x335e7f(0xee)](_0x446e9c[_0x335e7f(0xd9)],0x1e)?_0x325fed[_0x335e7f(0xd2)]:'')),this['saveConversations'](),!![];}[_0x1f899f(0xc1)](){const _0x322092=_0x1f899f;this['listeners'][_0x322092(0xdd)][_0x322092(0xf1)](_0x4eb194=>_0x4eb194(this[_0x322092(0xdb)]));}[_0x1f899f(0xc7)](){const _0x5091c5=_0x1f899f;this[_0x5091c5(0xeb)][_0x5091c5(0xd0)][_0x5091c5(0xf1)](_0x3553b2=>_0x3553b2(this['getCurrentConversation']()));}[_0x1f899f(0xc9)](_0x14813b,_0x8f4b21){const _0x56da21=_0x1f899f;this[_0x56da21(0xeb)][_0x14813b]&&this[_0x56da21(0xeb)][_0x14813b][_0x56da21(0xd1)](_0x8f4b21);}[_0x1f899f(0x102)](_0x224e50,_0x578c04){const _0x56712b=_0x1f899f;this['listeners'][_0x224e50]&&(this[_0x56712b(0xeb)][_0x224e50]=this['listeners'][_0x224e50][_0x56712b(0xc3)](_0x351991=>_0x351991!==_0x578c04));}}function _0x17e7(){const _0x48f435=['3411717dthHMo','pop','3RYSrMd','Storage\x20cleanup\x20completed','saveConversations','sort','OVKvh','info','warn','MAX_STORAGE_SIZE','keys','3|2|4|1|0','Ztngs','removeEventListener','KMCDg','cVlqy','values','Loaded\x20','wNcmR','toISOString','8244regefq','user','RPOtP','zHQhJ','getCurrentConversation','70AAvnqC','26740bzxGnP','parse','title','notifyConversationUpdate','loadConversations','filter','addMessage','434526CweTBX','nTuyk','notifyCurrentConversationChange','deleteConversation','addEventListener','MAX_CONVERSATIONS','switchConversation','messages','3230096ylMmwH','Failed\x20to\x20save\x20conversations','4xdzmFo','onCurrentConversationChange','push','VYPhY','map','currentConversationId','error','sIrtW','setItem','split','length','Storage\x20cleanup\x20initiated','conversations','fromEntries','onConversationUpdate','4058555OUsIhB','llKCf','slice','TbETT','...','4370135dsmWIm','dPfFN','createdAt','getItem','createNewConversation','1482XpIYNJ','New\x20Chat','Trimmed\x20to\x20','listeners','kkztG','\x20conversations','KGYMB','updatedAt','stringify','forEach','YbDzd','Conversations\x20saved\x20successfully','cleanupStorage'];_0x17e7=function(){return _0x48f435;};return _0x17e7();}export{BaseConversationManager};