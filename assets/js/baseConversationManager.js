
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x1fe6f9=_0x4118;function _0x4118(_0x4116cb,_0x40d99b){const _0x2c2c6d=_0x2c2c();return _0x4118=function(_0x411832,_0x3e180a){_0x411832=_0x411832-0x149;let _0x314a5a=_0x2c2c6d[_0x411832];return _0x314a5a;},_0x4118(_0x4116cb,_0x40d99b);}function _0x2c2c(){const _0xe39a37=['info','onCurrentConversationChange','stringify','onConversationUpdate','14395670xCjltP','toString','length','2590118IUycFq','626789BKlUae','306232ACrbej','Zofno','toISOString','currentConversationId','15hzHNta','4|0|3|1|2','pop','3|4|5|2|6|1|0','\x20conversations','createNewConversation','setItem','13307YklTtq','getItem','map','sort','yCntX','values','addEventListener','deleteConversation','isArray','conversations','messages','MAX_CONVERSATIONS','MAX_STORAGE_SIZE','switchConversation','keys','getCurrentConversation','IDhTy','3930xOukRO','Conversations\x20saved\x20successfully','parse','notifyConversationUpdate','createdAt','ffbME','error','split','slice','1215212bpUcij','push','saveConversations','removeEventListener','2864166pqyQCU','zQice','notifyCurrentConversationChange','updatedAt','243lLstCa','Storage\x20cleanup\x20initiated','...','forEach','loadConversations','user','title','New\x20Chat','xUvqd','cleanupStorage','Trimmed\x20to\x20','Storage\x20cleanup\x20completed','yUBCk','listeners','HqrIh','filter','fromEntries'];_0x2c2c=function(){return _0xe39a37;};return _0x2c2c();}(function(_0x911afe,_0x154105){const _0x2b7cf5=_0x4118,_0x1fafa6=_0x911afe();while(!![]){try{const _0x4768d4=parseInt(_0x2b7cf5(0x167))/0x1+parseInt(_0x2b7cf5(0x166))/0x2+-parseInt(_0x2b7cf5(0x14a))/0x3+parseInt(_0x2b7cf5(0x18d))/0x4*(parseInt(_0x2b7cf5(0x16c))/0x5)+-parseInt(_0x2b7cf5(0x184))/0x6*(-parseInt(_0x2b7cf5(0x173))/0x7)+parseInt(_0x2b7cf5(0x168))/0x8*(-parseInt(_0x2b7cf5(0x14e))/0x9)+-parseInt(_0x2b7cf5(0x163))/0xa;if(_0x4768d4===_0x154105)break;else _0x1fafa6['push'](_0x1fafa6['shift']());}catch(_0x483abc){_0x1fafa6['push'](_0x1fafa6['shift']());}}}(_0x2c2c,0x9ed5e));import{Logger}from'./common.js';class Conversation{constructor(_0x2240bf,_0x7220fe){const _0x55ef63=_0x4118,_0x1265f6={'IDhTy':_0x55ef63(0x16d),'ffbME':function(_0x111076,_0x47f0d2){return _0x111076||_0x47f0d2;},'Imhym':_0x55ef63(0x155)},_0x59c49e=_0x1265f6[_0x55ef63(0x183)][_0x55ef63(0x18b)]('|');let _0x1a8d1c=0x0;while(!![]){switch(_0x59c49e[_0x1a8d1c++]){case'0':this['title']=_0x1265f6[_0x55ef63(0x189)](_0x7220fe,_0x1265f6['Imhym']);continue;case'1':this[_0x55ef63(0x188)]=new Date()[_0x55ef63(0x16a)]();continue;case'2':this[_0x55ef63(0x14d)]=new Date()[_0x55ef63(0x16a)]();continue;case'3':this['messages']=[];continue;case'4':this['id']=_0x2240bf;continue;}break;}}}class BaseConversationManager{constructor(){const _0x57cd8d=_0x4118,_0x4870e4={'Zofno':_0x57cd8d(0x16f),'zkwez':function(_0x5836ae,_0x253da0){return _0x5836ae*_0x253da0;}},_0x226d43=_0x4870e4[_0x57cd8d(0x169)][_0x57cd8d(0x18b)]('|');let _0x4b33c6=0x0;while(!![]){switch(_0x226d43[_0x4b33c6++]){case'0':(!this[_0x57cd8d(0x16b)]||!this[_0x57cd8d(0x17c)][this['currentConversationId']])&&this[_0x57cd8d(0x171)]();continue;case'1':this[_0x57cd8d(0x152)]();continue;case'2':this[_0x57cd8d(0x17f)]=_0x4870e4['zkwez'](_0x4870e4['zkwez'](4.5,0x400),0x400);continue;case'3':this[_0x57cd8d(0x17c)]={};continue;case'4':this['currentConversationId']=null;continue;case'5':this[_0x57cd8d(0x15b)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'6':this[_0x57cd8d(0x17e)]=0x32;continue;}break;}}[_0x1fe6f9(0x152)](){const _0x48beef=_0x1fe6f9,_0x2926c2={'xUvqd':_0x48beef(0x17c),'jlVKT':'Failed\x20to\x20load\x20conversations'};try{const _0x43d25d=JSON[_0x48beef(0x186)](localStorage[_0x48beef(0x174)](_0x2926c2[_0x48beef(0x156)]))||[];Array[_0x48beef(0x17b)](_0x43d25d)&&(this[_0x48beef(0x17c)]=Object[_0x48beef(0x15e)](_0x43d25d['map'](_0x435bfa=>[_0x435bfa['id'],new Conversation(_0x435bfa['id'],_0x435bfa[_0x48beef(0x154)])]))),Logger[_0x48beef(0x15f)]('Loaded\x20'+Object[_0x48beef(0x181)](this[_0x48beef(0x17c)])[_0x48beef(0x165)]+'\x20conversations');}catch(_0x2f8892){Logger[_0x48beef(0x18a)](_0x2926c2['jlVKT'],_0x2f8892),this[_0x48beef(0x17c)]={};}}[_0x1fe6f9(0x18f)](){const _0x3c2e0b=_0x1fe6f9,_0x45bbf={'zQice':'conversations'};try{let _0x3bffbc=JSON[_0x3c2e0b(0x161)](Object[_0x3c2e0b(0x178)](this['conversations']));_0x3bffbc[_0x3c2e0b(0x165)]>this['MAX_STORAGE_SIZE']&&this[_0x3c2e0b(0x157)](),localStorage[_0x3c2e0b(0x172)](_0x45bbf[_0x3c2e0b(0x14b)],_0x3bffbc),this[_0x3c2e0b(0x187)](),Logger['info'](_0x3c2e0b(0x185));}catch(_0x15c043){Logger[_0x3c2e0b(0x18a)]('Failed\x20to\x20save\x20conversations',_0x15c043);}}['cleanupStorage'](){const _0x550ea7=_0x1fe6f9,_0x438520={'yCntX':_0x550ea7(0x14f),'dRhOE':function(_0x3f8b56,_0x3b2d7a){return _0x3f8b56>_0x3b2d7a;}};Logger['warn'](_0x438520[_0x550ea7(0x177)]);let _0x31fadf=Object[_0x550ea7(0x178)](this[_0x550ea7(0x17c)])[_0x550ea7(0x176)]((_0xf2a20b,_0x205ee4)=>new Date(_0x205ee4[_0x550ea7(0x14d)])-new Date(_0xf2a20b[_0x550ea7(0x14d)]));_0x31fadf['length']>this[_0x550ea7(0x17e)]&&(_0x31fadf=_0x31fadf[_0x550ea7(0x18c)](0x0,this[_0x550ea7(0x17e)]),this[_0x550ea7(0x17c)]=Object[_0x550ea7(0x15e)](_0x31fadf[_0x550ea7(0x175)](_0x47d6d3=>[_0x47d6d3['id'],_0x47d6d3])),Logger[_0x550ea7(0x15f)](_0x550ea7(0x158)+this[_0x550ea7(0x17e)]+_0x550ea7(0x170)));let _0x247f4d=JSON[_0x550ea7(0x161)](_0x31fadf)['length'];while(_0x247f4d>this['MAX_STORAGE_SIZE']&&_0x438520['dRhOE'](_0x31fadf[_0x550ea7(0x165)],0x0)){const _0x275715=_0x31fadf[_0x550ea7(0x16e)]();delete this[_0x550ea7(0x17c)][_0x275715['id']],_0x247f4d=JSON[_0x550ea7(0x161)](Object['values'](this[_0x550ea7(0x17c)]))[_0x550ea7(0x165)];}Logger[_0x550ea7(0x15f)](_0x550ea7(0x159));}[_0x1fe6f9(0x171)](_0x4d7c10='New\x20Chat'){const _0x3aec3d=_0x1fe6f9,_0x219411=Date['now']()[_0x3aec3d(0x164)]();return this[_0x3aec3d(0x17c)][_0x219411]=new Conversation(_0x219411,_0x4d7c10),this[_0x3aec3d(0x16b)]=_0x219411,this[_0x3aec3d(0x18f)](),this[_0x3aec3d(0x14c)](),_0x219411;}[_0x1fe6f9(0x17a)](_0x24f338){const _0x890d24=_0x1fe6f9,_0x3a8eb3={'HqrIh':function(_0x5e634f,_0x5adb47){return _0x5e634f===_0x5adb47;}};this[_0x890d24(0x17c)][_0x24f338]&&(delete this[_0x890d24(0x17c)][_0x24f338],_0x3a8eb3[_0x890d24(0x15c)](this[_0x890d24(0x16b)],_0x24f338)&&(this['currentConversationId']=null,this[_0x890d24(0x171)]()),this['saveConversations']());}[_0x1fe6f9(0x180)](_0x91e1d5){const _0x17ffcb=_0x1fe6f9;if(this['conversations'][_0x91e1d5])return this[_0x17ffcb(0x16b)]=_0x91e1d5,this[_0x17ffcb(0x14c)](),!![];return![];}[_0x1fe6f9(0x182)](){const _0x29e640=_0x1fe6f9;return this[_0x29e640(0x17c)][this[_0x29e640(0x16b)]]||null;}['addMessage'](_0x1896ad,_0x4fe3c7){const _0x1bae54=_0x1fe6f9,_0x210587={'Xakrg':_0x1bae54(0x153),'yUBCk':function(_0x53e302,_0x39352c){return _0x53e302>_0x39352c;}},_0x46ce93=this[_0x1bae54(0x182)]();if(!_0x46ce93)return![];return _0x46ce93[_0x1bae54(0x17d)][_0x1bae54(0x18e)]({'role':_0x4fe3c7,'content':_0x1896ad,'timestamp':new Date()['toISOString']()}),_0x46ce93[_0x1bae54(0x14d)]=new Date()[_0x1bae54(0x16a)](),_0x4fe3c7===_0x210587['Xakrg']&&_0x46ce93[_0x1bae54(0x17d)]['length']===0x1&&(_0x46ce93[_0x1bae54(0x154)]=_0x1896ad[_0x1bae54(0x18c)](0x0,0x1e)+(_0x210587[_0x1bae54(0x15a)](_0x1896ad[_0x1bae54(0x165)],0x1e)?_0x1bae54(0x150):'')),this['saveConversations'](),!![];}[_0x1fe6f9(0x187)](){const _0x54f699=_0x1fe6f9;this['listeners'][_0x54f699(0x162)][_0x54f699(0x151)](_0xf45c9d=>_0xf45c9d(this[_0x54f699(0x17c)]));}[_0x1fe6f9(0x14c)](){const _0x1d0014=_0x1fe6f9;this['listeners'][_0x1d0014(0x160)][_0x1d0014(0x151)](_0x5a3279=>_0x5a3279(this[_0x1d0014(0x182)]()));}[_0x1fe6f9(0x179)](_0xbc7488,_0xd94e97){const _0x5235ba=_0x1fe6f9;this['listeners'][_0xbc7488]&&this[_0x5235ba(0x15b)][_0xbc7488][_0x5235ba(0x18e)](_0xd94e97);}[_0x1fe6f9(0x149)](_0x44d875,_0x32b4ba){const _0x1bff0c=_0x1fe6f9;this[_0x1bff0c(0x15b)][_0x44d875]&&(this[_0x1bff0c(0x15b)][_0x44d875]=this['listeners'][_0x44d875][_0x1bff0c(0x15d)](_0x5b7153=>_0x5b7153!==_0x32b4ba));}}export{BaseConversationManager};