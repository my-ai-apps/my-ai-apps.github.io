
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0xb625d0=_0x3188;(function(_0x3ef246,_0x1c3020){const _0x1a071c=_0x3188,_0x20b00a=_0x3ef246();while(!![]){try{const _0x29f200=parseInt(_0x1a071c(0xfa))/0x1+parseInt(_0x1a071c(0xdc))/0x2+-parseInt(_0x1a071c(0xda))/0x3*(parseInt(_0x1a071c(0xc8))/0x4)+parseInt(_0x1a071c(0xc3))/0x5*(-parseInt(_0x1a071c(0xd8))/0x6)+parseInt(_0x1a071c(0xd9))/0x7+parseInt(_0x1a071c(0xde))/0x8*(-parseInt(_0x1a071c(0xf9))/0x9)+parseInt(_0x1a071c(0xc5))/0xa*(parseInt(_0x1a071c(0xca))/0xb);if(_0x29f200===_0x1c3020)break;else _0x20b00a['push'](_0x20b00a['shift']());}catch(_0xb6e5b5){_0x20b00a['push'](_0x20b00a['shift']());}}}(_0x2ccf,0xb980e));import{Logger}from'./common.js';function _0x3188(_0x3d38b7,_0x3c6171){const _0x2ccf11=_0x2ccf();return _0x3188=function(_0x318858,_0x2d83de){_0x318858=_0x318858-0xbf;let _0x92ac28=_0x2ccf11[_0x318858];return _0x92ac28;},_0x3188(_0x3d38b7,_0x3c6171);}function _0x2ccf(){const _0x40d43c=['1|2|5|4|0|3','messages','2541580BxghII','Failed\x20to\x20load\x20conversations','498333wvuOiz','VtVNg','values','Storage\x20cleanup\x20initiated','addEventListener','ViQMH','Loaded\x20','map','ERVrJ','getItem','lAAVk','length','lCptm','onConversationUpdate','6rwHSef','8359071buHDQv','3piQYOH','ZLVAv','2343494rVAmse','removeEventListener','11345328CudJCK','user','listeners','updatedAt','toISOString','fWluK','push','pop','forEach','MAX_CONVERSATIONS','stringify','Storage\x20cleanup\x20completed','New\x20Chat','warn','yxAai','error','getCurrentConversation','info','sort','conversations','hXkxU','ekgVS','toString','onCurrentConversationChange','fromEntries','oFguD','notifyCurrentConversationChange','9YdxMfD','13527qndTIh','saveConversations','deleteConversation','addMessage','cleanupStorage','Trimmed\x20to\x20','split','notifyConversationUpdate','currentConversationId','keys','...','title','MAX_STORAGE_SIZE','setItem','now','slice','loadConversations','WHUpe','Failed\x20to\x20save\x20conversations','createNewConversation','6211275tdHHbQ','bkJEK','370liULNs'];_0x2ccf=function(){return _0x40d43c;};return _0x2ccf();}class Conversation{constructor(_0x402642,_0x26a0de){const _0x564675=_0x3188,_0x344058={'fWluK':_0x564675(0xea)},_0x13c38c='0|4|2|3|1'[_0x564675(0x100)]('|');let _0x519738=0x0;while(!![]){switch(_0x13c38c[_0x519738++]){case'0':this['id']=_0x402642;continue;case'1':this['updatedAt']=new Date()[_0x564675(0xe2)]();continue;case'2':this[_0x564675(0xc7)]=[];continue;case'3':this['createdAt']=new Date()[_0x564675(0xe2)]();continue;case'4':this['title']=_0x26a0de||_0x344058[_0x564675(0xe3)];continue;}break;}}}class BaseConversationManager{constructor(){const _0x3e07ab=_0x3188,_0x459c85={'yxAai':_0x3e07ab(0xc6),'oFguD':function(_0xc10f8d,_0x113b6a){return _0xc10f8d*_0x113b6a;}},_0x29da2e=_0x459c85[_0x3e07ab(0xec)][_0x3e07ab(0x100)]('|');let _0x4d2b0b=0x0;while(!![]){switch(_0x29da2e[_0x4d2b0b++]){case'0':this[_0x3e07ab(0xe7)]=0x32;continue;case'1':this['conversations']={};continue;case'2':this[_0x3e07ab(0x102)]=null;continue;case'3':this[_0x3e07ab(0xbf)]();continue;case'4':this[_0x3e07ab(0x106)]=_0x459c85[_0x3e07ab(0xf7)](_0x459c85[_0x3e07ab(0xf7)](4.5,0x400),0x400);continue;case'5':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;}break;}}[_0xb625d0(0xbf)](){const _0x3b18b1=_0xb625d0,_0x1b2fe4={'lCptm':_0x3b18b1(0xf1),'tGaVL':_0x3b18b1(0xc9)};try{const _0x5ca161=JSON['parse'](localStorage[_0x3b18b1(0xd3)](_0x1b2fe4[_0x3b18b1(0xd6)]))||[];Array['isArray'](_0x5ca161)&&(this[_0x3b18b1(0xf1)]=Object['fromEntries'](_0x5ca161['map'](_0x45e729=>[_0x45e729['id'],new Conversation(_0x45e729['id'],_0x45e729[_0x3b18b1(0x105)])]))),Logger['info'](_0x3b18b1(0xd0)+Object[_0x3b18b1(0x103)](this['conversations'])[_0x3b18b1(0xd5)]+'\x20conversations');}catch(_0x22f507){Logger['error'](_0x1b2fe4['tGaVL'],_0x22f507),this['conversations']={};}}[_0xb625d0(0xfb)](){const _0x4f5ee3=_0xb625d0,_0x29e16d={'YxsCZ':function(_0x352b10,_0x14040){return _0x352b10>_0x14040;},'oJAIe':_0x4f5ee3(0xf1),'KuJqA':'Conversations\x20saved\x20successfully','hXkxU':_0x4f5ee3(0xc1)};try{let _0x8ad09f=JSON[_0x4f5ee3(0xe8)](Object[_0x4f5ee3(0xcc)](this['conversations']));_0x29e16d['YxsCZ'](_0x8ad09f[_0x4f5ee3(0xd5)],this[_0x4f5ee3(0x106)])&&this[_0x4f5ee3(0xfe)](),localStorage[_0x4f5ee3(0x107)](_0x29e16d['oJAIe'],_0x8ad09f),this[_0x4f5ee3(0x101)](),Logger['info'](_0x29e16d['KuJqA']);}catch(_0xd586fb){Logger[_0x4f5ee3(0xed)](_0x29e16d[_0x4f5ee3(0xf2)],_0xd586fb);}}['cleanupStorage'](){const _0x4cd468=_0xb625d0,_0x87391a={'ViQMH':_0x4cd468(0xcd),'ekgVS':function(_0x1ca04f,_0x3b9d04){return _0x1ca04f>_0x3b9d04;},'ERVrJ':function(_0x484655,_0x175b5c){return _0x484655>_0x175b5c;},'lAAVk':_0x4cd468(0xe9)};Logger[_0x4cd468(0xeb)](_0x87391a[_0x4cd468(0xcf)]);let _0x19e24e=Object[_0x4cd468(0xcc)](this[_0x4cd468(0xf1)])[_0x4cd468(0xf0)]((_0x542e75,_0x6e90cd)=>new Date(_0x6e90cd[_0x4cd468(0xe1)])-new Date(_0x542e75[_0x4cd468(0xe1)]));_0x87391a[_0x4cd468(0xf3)](_0x19e24e['length'],this[_0x4cd468(0xe7)])&&(_0x19e24e=_0x19e24e[_0x4cd468(0x109)](0x0,this[_0x4cd468(0xe7)]),this['conversations']=Object[_0x4cd468(0xf6)](_0x19e24e[_0x4cd468(0xd1)](_0x4aabac=>[_0x4aabac['id'],_0x4aabac])),Logger[_0x4cd468(0xef)](_0x4cd468(0xff)+this[_0x4cd468(0xe7)]+'\x20conversations'));let _0x4ff3ee=JSON[_0x4cd468(0xe8)](_0x19e24e)[_0x4cd468(0xd5)];while(_0x87391a[_0x4cd468(0xd2)](_0x4ff3ee,this[_0x4cd468(0x106)])&&_0x19e24e[_0x4cd468(0xd5)]>0x0){const _0x19ba07=_0x19e24e[_0x4cd468(0xe5)]();delete this[_0x4cd468(0xf1)][_0x19ba07['id']],_0x4ff3ee=JSON[_0x4cd468(0xe8)](Object['values'](this[_0x4cd468(0xf1)]))['length'];}Logger[_0x4cd468(0xef)](_0x87391a[_0x4cd468(0xd4)]);}[_0xb625d0(0xc2)](_0x27a5c6=_0xb625d0(0xea)){const _0x21168d=_0xb625d0,_0x5183a7=Date[_0x21168d(0x108)]()[_0x21168d(0xf4)]();return this['conversations'][_0x5183a7]=new Conversation(_0x5183a7,_0x27a5c6),this[_0x21168d(0x102)]=_0x5183a7,this[_0x21168d(0xfb)](),this[_0x21168d(0xf8)](),_0x5183a7;}[_0xb625d0(0xfc)](_0x2bfbc3){const _0x44cebc=_0xb625d0,_0x4dbeaf={'WHUpe':function(_0x29c972,_0x127782){return _0x29c972===_0x127782;}};this[_0x44cebc(0xf1)][_0x2bfbc3]&&(delete this[_0x44cebc(0xf1)][_0x2bfbc3],_0x4dbeaf[_0x44cebc(0xc0)](this[_0x44cebc(0x102)],_0x2bfbc3)&&(this[_0x44cebc(0x102)]=null,this[_0x44cebc(0xc2)]()),this[_0x44cebc(0xfb)]());}['switchConversation'](_0x33807c){const _0x403bb1=_0xb625d0;if(this['conversations'][_0x33807c])return this[_0x403bb1(0x102)]=_0x33807c,this[_0x403bb1(0xf8)](),!![];return![];}[_0xb625d0(0xee)](){const _0x1545fc=_0xb625d0;return this['conversations'][this[_0x1545fc(0x102)]]||null;}[_0xb625d0(0xfd)](_0x246c27,_0x31c0fc){const _0x378baa=_0xb625d0,_0xad61b2={'BhhmV':_0x378baa(0xdf),'ZLVAv':function(_0x4decfc,_0x3f9cad){return _0x4decfc===_0x3f9cad;},'bkJEK':function(_0x42e0e3,_0xf2195b){return _0x42e0e3>_0xf2195b;},'VtVNg':_0x378baa(0x104)},_0x5f3522=this[_0x378baa(0xee)]();if(!_0x5f3522)return![];return _0x5f3522[_0x378baa(0xc7)][_0x378baa(0xe4)]({'role':_0x31c0fc,'content':_0x246c27,'timestamp':new Date()[_0x378baa(0xe2)]()}),_0x5f3522[_0x378baa(0xe1)]=new Date()['toISOString'](),_0x31c0fc===_0xad61b2['BhhmV']&&_0xad61b2[_0x378baa(0xdb)](_0x5f3522[_0x378baa(0xc7)][_0x378baa(0xd5)],0x1)&&(_0x5f3522['title']=_0x246c27['slice'](0x0,0x1e)+(_0xad61b2[_0x378baa(0xc4)](_0x246c27[_0x378baa(0xd5)],0x1e)?_0xad61b2[_0x378baa(0xcb)]:'')),this[_0x378baa(0xfb)](),!![];}[_0xb625d0(0x101)](){const _0x2795ec=_0xb625d0;this['listeners'][_0x2795ec(0xd7)][_0x2795ec(0xe6)](_0x1d7fd4=>_0x1d7fd4(this['conversations']));}['notifyCurrentConversationChange'](){const _0x983927=_0xb625d0;this[_0x983927(0xe0)][_0x983927(0xf5)][_0x983927(0xe6)](_0x33c6cd=>_0x33c6cd(this[_0x983927(0xee)]()));}[_0xb625d0(0xce)](_0x2300ef,_0x3cb16e){const _0x3124f5=_0xb625d0;this[_0x3124f5(0xe0)][_0x2300ef]&&this['listeners'][_0x2300ef]['push'](_0x3cb16e);}[_0xb625d0(0xdd)](_0xe45d18,_0x53b98a){const _0x5d1046=_0xb625d0;this[_0x5d1046(0xe0)][_0xe45d18]&&(this[_0x5d1046(0xe0)][_0xe45d18]=this[_0x5d1046(0xe0)][_0xe45d18]['filter'](_0x4c44fc=>_0x4c44fc!==_0x53b98a));}}export{BaseConversationManager};