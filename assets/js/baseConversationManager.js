
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x4bf3c0=_0xfa9a;function _0x5c20(){const _0x5b5506=['\x20conversations','fGJSD','New\x20Chat','warn','toString','values','Trimmed\x20to\x20','currentConversationId','conversations','253TQszAZ','updatedAt','485349ixJyck','ODDDf','TSWZV','rpHzu','parse','split','getCurrentConversation','onCurrentConversationChange','fromEntries','7Lqtkap','onConversationUpdate','bBOab','addMessage','createNewConversation','notifyCurrentConversationChange','error','Failed\x20to\x20load\x20conversations','removeEventListener','push','setItem','3|1|4|0|2','120664dFooXD','sort','addEventListener','MAX_STORAGE_SIZE','Loaded\x20','saveConversations','forEach','map','2941778kLaTlE','cleanupStorage','MAX_CONVERSATIONS','getItem','vCIjY','63ubTWXL','Storage\x20cleanup\x20initiated','mXdIM','messages','llQiI','pWPtH','EdakY','length','5|6|1|3|0|2|4','Failed\x20to\x20save\x20conversations','6HXRCEd','info','6236361bKkngY','stringify','Storage\x20cleanup\x20completed','vXyhC','Conversations\x20saved\x20successfully','now','toISOString','isArray','slice','createdAt','deleteConversation','83290heJUBi','14327536RRYDhq','kSFrX','ZpxVM','8240630ToIiDj','notifyConversationUpdate','listeners'];_0x5c20=function(){return _0x5b5506;};return _0x5c20();}(function(_0x9cf577,_0x33db85){const _0x5252ab=_0xfa9a,_0x3a6258=_0x9cf577();while(!![]){try{const _0x5e000e=-parseInt(_0x5252ab(0x161))/0x1+parseInt(_0x5252ab(0x17e))/0x2+parseInt(_0x5252ab(0x183))/0x3*(parseInt(_0x5252ab(0x176))/0x4)+parseInt(_0x5252ab(0x153))/0x5*(parseInt(_0x5252ab(0x18d))/0x6)+parseInt(_0x5252ab(0x16a))/0x7*(-parseInt(_0x5252ab(0x150))/0x8)+-parseInt(_0x5252ab(0x18f))/0x9+parseInt(_0x5252ab(0x19a))/0xa*(parseInt(_0x5252ab(0x15f))/0xb);if(_0x5e000e===_0x33db85)break;else _0x3a6258['push'](_0x3a6258['shift']());}catch(_0x5596de){_0x3a6258['push'](_0x3a6258['shift']());}}}(_0x5c20,0xee000));import{Logger}from'./common.js';class Conversation{constructor(_0xa959db,_0x49264a){const _0x10b029=_0xfa9a,_0x5b70f2={'vXyhC':_0x10b029(0x175)},_0x33bbe0=_0x5b70f2[_0x10b029(0x192)][_0x10b029(0x166)]('|');let _0x17f562=0x0;while(!![]){switch(_0x33bbe0[_0x17f562++]){case'0':this[_0x10b029(0x198)]=new Date()['toISOString']();continue;case'1':this['title']=_0x49264a||'New\x20Chat';continue;case'2':this[_0x10b029(0x160)]=new Date()[_0x10b029(0x195)]();continue;case'3':this['id']=_0xa959db;continue;case'4':this['messages']=[];continue;}break;}}}function _0xfa9a(_0x33d589,_0x291813){const _0x5c2006=_0x5c20();return _0xfa9a=function(_0xfa9a0f,_0x5ed406){_0xfa9a0f=_0xfa9a0f-0x150;let _0x3e83fc=_0x5c2006[_0xfa9a0f];return _0x3e83fc;},_0xfa9a(_0x33d589,_0x291813);}class BaseConversationManager{constructor(){const _0x4e846a=_0xfa9a,_0x35152={'bBOab':_0x4e846a(0x18b),'ZpxVM':function(_0x55a392,_0xb777ed){return _0x55a392*_0xb777ed;}},_0x2b1f1a=_0x35152[_0x4e846a(0x16c)][_0x4e846a(0x166)]('|');let _0x505025=0x0;while(!![]){switch(_0x2b1f1a[_0x505025++]){case'0':this[_0x4e846a(0x180)]=0x32;continue;case'1':this[_0x4e846a(0x155)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'2':this['loadConversations']();continue;case'3':this[_0x4e846a(0x179)]=_0x35152[_0x4e846a(0x152)](4.5,0x400)*0x400;continue;case'4':(!this['currentConversationId']||!this[_0x4e846a(0x15e)][this[_0x4e846a(0x15d)]])&&this['createNewConversation']();continue;case'5':this[_0x4e846a(0x15e)]={};continue;case'6':this[_0x4e846a(0x15d)]=null;continue;}break;}}['loadConversations'](){const _0xfdd35b=_0xfa9a,_0x2f3b7d={'KrWpd':_0xfdd35b(0x15e),'vAYgO':_0xfdd35b(0x171)};try{const _0x17678c=JSON[_0xfdd35b(0x165)](localStorage[_0xfdd35b(0x181)](_0x2f3b7d['KrWpd']))||[];Array[_0xfdd35b(0x196)](_0x17678c)&&(this[_0xfdd35b(0x15e)]=Object[_0xfdd35b(0x169)](_0x17678c[_0xfdd35b(0x17d)](_0x465def=>[_0x465def['id'],new Conversation(_0x465def['id'],_0x465def['title'])]))),Logger['info'](_0xfdd35b(0x17a)+Object['keys'](this[_0xfdd35b(0x15e)])[_0xfdd35b(0x18a)]+_0xfdd35b(0x156));}catch(_0x487986){Logger[_0xfdd35b(0x170)](_0x2f3b7d['vAYgO'],_0x487986),this[_0xfdd35b(0x15e)]={};}}[_0x4bf3c0(0x17b)](){const _0x2a1ee6=_0x4bf3c0,_0x66828a={'fGJSD':function(_0x5b01b1,_0x46f138){return _0x5b01b1>_0x46f138;},'TSWZV':'conversations','llQiI':_0x2a1ee6(0x193),'rpHzu':_0x2a1ee6(0x18c)};try{let _0x23acf9=JSON[_0x2a1ee6(0x190)](Object[_0x2a1ee6(0x15b)](this[_0x2a1ee6(0x15e)]));_0x66828a[_0x2a1ee6(0x157)](_0x23acf9[_0x2a1ee6(0x18a)],this[_0x2a1ee6(0x179)])&&this['cleanupStorage'](),localStorage[_0x2a1ee6(0x174)](_0x66828a[_0x2a1ee6(0x163)],_0x23acf9),this[_0x2a1ee6(0x154)](),Logger[_0x2a1ee6(0x18e)](_0x66828a[_0x2a1ee6(0x187)]);}catch(_0x2657bf){Logger['error'](_0x66828a[_0x2a1ee6(0x164)],_0x2657bf);}}[_0x4bf3c0(0x17f)](){const _0x4c91d9=_0x4bf3c0,_0x3e0c87={'vCIjY':_0x4c91d9(0x184),'kSFrX':function(_0x343beb,_0xaf4917){return _0x343beb>_0xaf4917;}};Logger[_0x4c91d9(0x159)](_0x3e0c87[_0x4c91d9(0x182)]);let _0x21abec=Object['values'](this[_0x4c91d9(0x15e)])[_0x4c91d9(0x177)]((_0x47a337,_0x182301)=>new Date(_0x182301[_0x4c91d9(0x160)])-new Date(_0x47a337[_0x4c91d9(0x160)]));_0x3e0c87[_0x4c91d9(0x151)](_0x21abec[_0x4c91d9(0x18a)],this[_0x4c91d9(0x180)])&&(_0x21abec=_0x21abec[_0x4c91d9(0x197)](0x0,this[_0x4c91d9(0x180)]),this[_0x4c91d9(0x15e)]=Object[_0x4c91d9(0x169)](_0x21abec['map'](_0x2f54b6=>[_0x2f54b6['id'],_0x2f54b6])),Logger[_0x4c91d9(0x18e)](_0x4c91d9(0x15c)+this['MAX_CONVERSATIONS']+_0x4c91d9(0x156)));let _0x5abbff=JSON[_0x4c91d9(0x190)](_0x21abec)['length'];while(_0x3e0c87['kSFrX'](_0x5abbff,this['MAX_STORAGE_SIZE'])&&_0x3e0c87[_0x4c91d9(0x151)](_0x21abec[_0x4c91d9(0x18a)],0x0)){const _0x441b29=_0x21abec['pop']();delete this['conversations'][_0x441b29['id']],_0x5abbff=JSON[_0x4c91d9(0x190)](Object[_0x4c91d9(0x15b)](this['conversations']))[_0x4c91d9(0x18a)];}Logger[_0x4c91d9(0x18e)](_0x4c91d9(0x191));}[_0x4bf3c0(0x16e)](_0x4f342a=_0x4bf3c0(0x158)){const _0x467251=_0x4bf3c0,_0xd9e192=Date[_0x467251(0x194)]()[_0x467251(0x15a)]();return this[_0x467251(0x15e)][_0xd9e192]=new Conversation(_0xd9e192,_0x4f342a),this[_0x467251(0x15d)]=_0xd9e192,this['saveConversations'](),this[_0x467251(0x16f)](),_0xd9e192;}[_0x4bf3c0(0x199)](_0x1d3f31){const _0x658d10=_0x4bf3c0,_0x403a0c={'pcrnx':function(_0x5512e3,_0x1b531f){return _0x5512e3===_0x1b531f;}};this['conversations'][_0x1d3f31]&&(delete this[_0x658d10(0x15e)][_0x1d3f31],_0x403a0c['pcrnx'](this['currentConversationId'],_0x1d3f31)&&(this['currentConversationId']=null,this[_0x658d10(0x16e)]()),this['saveConversations']());}['switchConversation'](_0x58e929){const _0x7beac1=_0x4bf3c0;if(this[_0x7beac1(0x15e)][_0x58e929])return this[_0x7beac1(0x15d)]=_0x58e929,this[_0x7beac1(0x16f)](),!![];return![];}['getCurrentConversation'](){const _0x10f7d8=_0x4bf3c0;return this[_0x10f7d8(0x15e)][this[_0x10f7d8(0x15d)]]||null;}[_0x4bf3c0(0x16d)](_0x1e655d,_0x12f46c){const _0x2f59f8=_0x4bf3c0,_0x1a2e3c={'ODDDf':function(_0x5cba0b,_0x176725){return _0x5cba0b===_0x176725;},'JNjwU':'user','mXdIM':function(_0x3f4120,_0x348390){return _0x3f4120===_0x348390;},'pWPtH':function(_0x7fe9b9,_0x264443){return _0x7fe9b9>_0x264443;},'EdakY':'...'},_0x2a5302=this[_0x2f59f8(0x167)]();if(!_0x2a5302)return![];return _0x2a5302[_0x2f59f8(0x186)][_0x2f59f8(0x173)]({'role':_0x12f46c,'content':_0x1e655d,'timestamp':new Date()[_0x2f59f8(0x195)]()}),_0x2a5302['updatedAt']=new Date()['toISOString'](),_0x1a2e3c[_0x2f59f8(0x162)](_0x12f46c,_0x1a2e3c['JNjwU'])&&_0x1a2e3c[_0x2f59f8(0x185)](_0x2a5302[_0x2f59f8(0x186)]['length'],0x1)&&(_0x2a5302['title']=_0x1e655d['slice'](0x0,0x1e)+(_0x1a2e3c[_0x2f59f8(0x188)](_0x1e655d[_0x2f59f8(0x18a)],0x1e)?_0x1a2e3c[_0x2f59f8(0x189)]:'')),this[_0x2f59f8(0x17b)](),!![];}[_0x4bf3c0(0x154)](){const _0x112d9c=_0x4bf3c0;this[_0x112d9c(0x155)][_0x112d9c(0x16b)][_0x112d9c(0x17c)](_0x9c5a30=>_0x9c5a30(this[_0x112d9c(0x15e)]));}['notifyCurrentConversationChange'](){const _0x5327bf=_0x4bf3c0;this[_0x5327bf(0x155)][_0x5327bf(0x168)][_0x5327bf(0x17c)](_0x88b98a=>_0x88b98a(this[_0x5327bf(0x167)]()));}[_0x4bf3c0(0x178)](_0x752314,_0x33dbef){const _0x43a774=_0x4bf3c0;this[_0x43a774(0x155)][_0x752314]&&this[_0x43a774(0x155)][_0x752314]['push'](_0x33dbef);}[_0x4bf3c0(0x172)](_0x311b36,_0xbb7de6){const _0xfbb19f=_0x4bf3c0;this[_0xfbb19f(0x155)][_0x311b36]&&(this[_0xfbb19f(0x155)][_0x311b36]=this[_0xfbb19f(0x155)][_0x311b36]['filter'](_0xfd60fe=>_0xfd60fe!==_0xbb7de6));}}export{BaseConversationManager};