
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x45336e=_0x3c17;function _0x3c17(_0x3f8dd3,_0x1d8f60){const _0x3d7739=_0x3d77();return _0x3c17=function(_0x3c17b7,_0x36beb8){_0x3c17b7=_0x3c17b7-0x18a;let _0x45f1ec=_0x3d7739[_0x3c17b7];return _0x45f1ec;},_0x3c17(_0x3f8dd3,_0x1d8f60);}(function(_0x3444e1,_0x5a54a0){const _0x37ade8=_0x3c17,_0x565790=_0x3444e1();while(!![]){try{const _0x4baa77=-parseInt(_0x37ade8(0x1d7))/0x1+-parseInt(_0x37ade8(0x19a))/0x2+-parseInt(_0x37ade8(0x1a6))/0x3*(-parseInt(_0x37ade8(0x1b6))/0x4)+parseInt(_0x37ade8(0x1a1))/0x5*(-parseInt(_0x37ade8(0x1c6))/0x6)+parseInt(_0x37ade8(0x18c))/0x7+-parseInt(_0x37ade8(0x1d0))/0x8*(parseInt(_0x37ade8(0x1a4))/0x9)+parseInt(_0x37ade8(0x192))/0xa;if(_0x4baa77===_0x5a54a0)break;else _0x565790['push'](_0x565790['shift']());}catch(_0x2e137a){_0x565790['push'](_0x565790['shift']());}}}(_0x3d77,0x2ee30));function _0x3d77(){const _0x596543=['10mmIphG','map','length','1570563XmiwdG','cleanupStorage','345117eyAhVM','info','warn','addMessage','notifyConversationUpdate','onCurrentConversationChange','addEventListener','MAX_STORAGE_SIZE','LTrEK','New\x20Chat','fromEntries','...','XtiWG','switchConversation','loadConversations','ohxJX','4wepBRt','push','UbrTZ','filter','iAeiT','notifyCurrentConversationChange','title','slice','wdjAL','pop','now','ExRyo','\x20conversations','listeners','IXJpZ','currentConversationId','29442uSsduD','parse','Failed\x20to\x20load\x20conversations','Trimmed\x20to\x20','isArray','toISOString','keys','Storage\x20cleanup\x20completed','sort','forEach','8rbLtiP','updatedAt','oRcJk','createdAt','dgMUJ','MAX_CONVERSATIONS','user','67525houaph','saveConversations','oXySx','1279782qopCjY','conversations','Conversations\x20saved\x20successfully','KExtI','getItem','glDcb','5071930YmkHPH','messages','split','createNewConversation','lYmTN','pFDyL','error','getCurrentConversation','722328mBFDoa','stringify','values','xxunJ','4|2|3|1|0','onConversationUpdate','deleteConversation'];_0x3d77=function(){return _0x596543;};return _0x3d77();}import{Logger}from'./common.js';class Conversation{constructor(_0x1f5ff6,_0x14ea93){const _0x359b30=_0x3c17,_0x536950={'iAeiT':function(_0x40f02a,_0x2a65da){return _0x40f02a||_0x2a65da;},'LTrEK':_0x359b30(0x1af)},_0x2c11b0=_0x359b30(0x19e)[_0x359b30(0x194)]('|');let _0x1b6c97=0x0;while(!![]){switch(_0x2c11b0[_0x1b6c97++]){case'0':this['updatedAt']=new Date()[_0x359b30(0x1cb)]();continue;case'1':this[_0x359b30(0x1d3)]=new Date()[_0x359b30(0x1cb)]();continue;case'2':this[_0x359b30(0x1bc)]=_0x536950[_0x359b30(0x1ba)](_0x14ea93,_0x536950[_0x359b30(0x1ae)]);continue;case'3':this['messages']=[];continue;case'4':this['id']=_0x1f5ff6;continue;}break;}}}class BaseConversationManager{constructor(){const _0x3323f5=_0x3c17,_0x5279b2={'XvZqP':'6|4|0|1|5|2|3','xxunJ':function(_0x8e5190,_0x245db1){return _0x8e5190*_0x245db1;}},_0x577df9=_0x5279b2['XvZqP'][_0x3323f5(0x194)]('|');let _0x451ce4=0x0;while(!![]){switch(_0x577df9[_0x451ce4++]){case'0':this[_0x3323f5(0x1c3)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'1':this['MAX_STORAGE_SIZE']=_0x5279b2[_0x3323f5(0x19d)](_0x5279b2[_0x3323f5(0x19d)](4.5,0x400),0x400);continue;case'2':this['loadConversations']();continue;case'3':(!this[_0x3323f5(0x1c5)]||!this['conversations'][this['currentConversationId']])&&this[_0x3323f5(0x195)]();continue;case'4':this[_0x3323f5(0x1c5)]=null;continue;case'5':this[_0x3323f5(0x1d5)]=0x32;continue;case'6':this[_0x3323f5(0x18d)]={};continue;}break;}}[_0x45336e(0x1b4)](){const _0x58477d=_0x45336e,_0x4cc23f={'glDcb':'conversations','fGrQx':_0x58477d(0x1c8)};try{const _0x1207fc=JSON[_0x58477d(0x1c7)](localStorage[_0x58477d(0x190)](_0x4cc23f[_0x58477d(0x191)]))||[];Array[_0x58477d(0x1ca)](_0x1207fc)&&(this[_0x58477d(0x18d)]=Object[_0x58477d(0x1b0)](_0x1207fc[_0x58477d(0x1a2)](_0x4b0717=>[_0x4b0717['id'],new Conversation(_0x4b0717['id'],_0x4b0717[_0x58477d(0x1bc)])]))),Logger[_0x58477d(0x1a7)]('Loaded\x20'+Object[_0x58477d(0x1cc)](this[_0x58477d(0x18d)])['length']+_0x58477d(0x1c2));}catch(_0x114892){Logger[_0x58477d(0x198)](_0x4cc23f['fGrQx'],_0x114892),this[_0x58477d(0x18d)]={};}}[_0x45336e(0x18a)](){const _0x187ce8=_0x45336e,_0x27efe9={'PYfLL':function(_0x137711,_0x5ebe94){return _0x137711>_0x5ebe94;},'dgMUJ':_0x187ce8(0x18d),'UbrTZ':_0x187ce8(0x18e),'ExRyo':'Failed\x20to\x20save\x20conversations'};try{let _0x4e4ee9=JSON[_0x187ce8(0x19b)](Object['values'](this[_0x187ce8(0x18d)]));_0x27efe9['PYfLL'](_0x4e4ee9['length'],this[_0x187ce8(0x1ad)])&&this['cleanupStorage'](),localStorage['setItem'](_0x27efe9[_0x187ce8(0x1d4)],_0x4e4ee9),this['notifyConversationUpdate'](),Logger[_0x187ce8(0x1a7)](_0x27efe9[_0x187ce8(0x1b8)]);}catch(_0x208e9d){Logger[_0x187ce8(0x198)](_0x27efe9[_0x187ce8(0x1c1)],_0x208e9d);}}[_0x45336e(0x1a5)](){const _0x5aebe0=_0x45336e,_0x481193={'oRcJk':'Storage\x20cleanup\x20initiated','XtiWG':function(_0x130a46,_0x30767e){return _0x130a46>_0x30767e;},'KExtI':_0x5aebe0(0x1cd)};Logger[_0x5aebe0(0x1a8)](_0x481193[_0x5aebe0(0x1d2)]);let _0x241fd7=Object[_0x5aebe0(0x19c)](this[_0x5aebe0(0x18d)])[_0x5aebe0(0x1ce)]((_0x168fa6,_0x344103)=>new Date(_0x344103[_0x5aebe0(0x1d1)])-new Date(_0x168fa6['updatedAt']));_0x241fd7[_0x5aebe0(0x1a3)]>this['MAX_CONVERSATIONS']&&(_0x241fd7=_0x241fd7[_0x5aebe0(0x1bd)](0x0,this[_0x5aebe0(0x1d5)]),this[_0x5aebe0(0x18d)]=Object[_0x5aebe0(0x1b0)](_0x241fd7[_0x5aebe0(0x1a2)](_0x52e551=>[_0x52e551['id'],_0x52e551])),Logger[_0x5aebe0(0x1a7)](_0x5aebe0(0x1c9)+this[_0x5aebe0(0x1d5)]+'\x20conversations'));let _0x2ecb99=JSON[_0x5aebe0(0x19b)](_0x241fd7)[_0x5aebe0(0x1a3)];while(_0x481193[_0x5aebe0(0x1b2)](_0x2ecb99,this[_0x5aebe0(0x1ad)])&&_0x481193[_0x5aebe0(0x1b2)](_0x241fd7[_0x5aebe0(0x1a3)],0x0)){const _0x593a1a=_0x241fd7[_0x5aebe0(0x1bf)]();delete this['conversations'][_0x593a1a['id']],_0x2ecb99=JSON[_0x5aebe0(0x19b)](Object['values'](this[_0x5aebe0(0x18d)]))[_0x5aebe0(0x1a3)];}Logger[_0x5aebe0(0x1a7)](_0x481193[_0x5aebe0(0x18f)]);}[_0x45336e(0x195)](_0x52400f=_0x45336e(0x1af)){const _0x69b39a=_0x45336e,_0x243ca8=Date[_0x69b39a(0x1c0)]()['toString']();return this[_0x69b39a(0x18d)][_0x243ca8]=new Conversation(_0x243ca8,_0x52400f),this[_0x69b39a(0x1c5)]=_0x243ca8,this[_0x69b39a(0x18a)](),this[_0x69b39a(0x1bb)](),_0x243ca8;}[_0x45336e(0x1a0)](_0x1cc6c3){const _0x1c884b=_0x45336e,_0xc21cf1={'oXySx':function(_0x3a3aed,_0x565416){return _0x3a3aed===_0x565416;}};this[_0x1c884b(0x18d)][_0x1cc6c3]&&(delete this['conversations'][_0x1cc6c3],_0xc21cf1[_0x1c884b(0x18b)](this[_0x1c884b(0x1c5)],_0x1cc6c3)&&(this[_0x1c884b(0x1c5)]=null,this[_0x1c884b(0x195)]()),this[_0x1c884b(0x18a)]());}[_0x45336e(0x1b3)](_0x2b388d){const _0x96fffe=_0x45336e;if(this[_0x96fffe(0x18d)][_0x2b388d])return this['currentConversationId']=_0x2b388d,this[_0x96fffe(0x1bb)](),!![];return![];}[_0x45336e(0x199)](){const _0xdd1bb8=_0x45336e;return this['conversations'][this[_0xdd1bb8(0x1c5)]]||null;}[_0x45336e(0x1a9)](_0x3bf16b,_0x55bb9f){const _0x35831b=_0x45336e,_0x12cfe8={'lYmTN':function(_0x291d51,_0xfe929f){return _0x291d51===_0xfe929f;},'IXJpZ':_0x35831b(0x1d6),'wdjAL':function(_0x308483,_0x85498d){return _0x308483===_0x85498d;},'ohxJX':function(_0x77414e,_0x46b543){return _0x77414e+_0x46b543;},'nXOmE':function(_0x290841,_0x4d570a){return _0x290841>_0x4d570a;},'pFDyL':_0x35831b(0x1b1)},_0x5e851d=this['getCurrentConversation']();if(!_0x5e851d)return![];return _0x5e851d[_0x35831b(0x193)][_0x35831b(0x1b7)]({'role':_0x55bb9f,'content':_0x3bf16b,'timestamp':new Date()[_0x35831b(0x1cb)]()}),_0x5e851d[_0x35831b(0x1d1)]=new Date()['toISOString'](),_0x12cfe8[_0x35831b(0x196)](_0x55bb9f,_0x12cfe8[_0x35831b(0x1c4)])&&_0x12cfe8[_0x35831b(0x1be)](_0x5e851d['messages']['length'],0x1)&&(_0x5e851d[_0x35831b(0x1bc)]=_0x12cfe8[_0x35831b(0x1b5)](_0x3bf16b[_0x35831b(0x1bd)](0x0,0x1e),_0x12cfe8['nXOmE'](_0x3bf16b[_0x35831b(0x1a3)],0x1e)?_0x12cfe8[_0x35831b(0x197)]:'')),this['saveConversations'](),!![];}[_0x45336e(0x1aa)](){const _0x1897a5=_0x45336e;this[_0x1897a5(0x1c3)][_0x1897a5(0x19f)][_0x1897a5(0x1cf)](_0x4f707c=>_0x4f707c(this[_0x1897a5(0x18d)]));}[_0x45336e(0x1bb)](){const _0x1c0120=_0x45336e;this[_0x1c0120(0x1c3)][_0x1c0120(0x1ab)][_0x1c0120(0x1cf)](_0x399e89=>_0x399e89(this[_0x1c0120(0x199)]()));}[_0x45336e(0x1ac)](_0x2b30c8,_0x146247){const _0x2f5e55=_0x45336e;this[_0x2f5e55(0x1c3)][_0x2b30c8]&&this['listeners'][_0x2b30c8][_0x2f5e55(0x1b7)](_0x146247);}['removeEventListener'](_0x4214ac,_0x499ef6){const _0x43bfaf=_0x45336e;this['listeners'][_0x4214ac]&&(this[_0x43bfaf(0x1c3)][_0x4214ac]=this[_0x43bfaf(0x1c3)][_0x4214ac][_0x43bfaf(0x1b9)](_0x1e2e53=>_0x1e2e53!==_0x499ef6));}}export{BaseConversationManager};