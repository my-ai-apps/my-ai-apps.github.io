
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x144c42=_0x14fb;function _0x14fb(_0x8cb6d4,_0x3ae632){const _0x4fe23a=_0x4fe2();return _0x14fb=function(_0x14fba5,_0x57629b){_0x14fba5=_0x14fba5-0x176;let _0xc6ceb7=_0x4fe23a[_0x14fba5];return _0xc6ceb7;},_0x14fb(_0x8cb6d4,_0x3ae632);}(function(_0x107185,_0x395f9d){const _0x30975e=_0x14fb,_0x106f13=_0x107185();while(!![]){try{const _0x400e1b=-parseInt(_0x30975e(0x177))/0x1*(-parseInt(_0x30975e(0x18b))/0x2)+parseInt(_0x30975e(0x1a2))/0x3+-parseInt(_0x30975e(0x1b8))/0x4*(-parseInt(_0x30975e(0x1b0))/0x5)+-parseInt(_0x30975e(0x1a1))/0x6+parseInt(_0x30975e(0x19b))/0x7*(-parseInt(_0x30975e(0x19f))/0x8)+parseInt(_0x30975e(0x1b5))/0x9+parseInt(_0x30975e(0x186))/0xa;if(_0x400e1b===_0x395f9d)break;else _0x106f13['push'](_0x106f13['shift']());}catch(_0x540b7f){_0x106f13['push'](_0x106f13['shift']());}}}(_0x4fe2,0x40efb));import{Logger}from'./common.js';class Conversation{constructor(_0xfaae11,_0x1250e8){const _0x282045=_0x14fb,_0x47a30c={'sIDXM':_0x282045(0x17b),'thjwr':_0x282045(0x17a)},_0x507948=_0x47a30c[_0x282045(0x18c)][_0x282045(0x1b7)]('|');let _0x2e149a=0x0;while(!![]){switch(_0x507948[_0x2e149a++]){case'0':this[_0x282045(0x18d)]=new Date()[_0x282045(0x1ba)]();continue;case'1':this[_0x282045(0x1be)]=[];continue;case'2':this['id']=_0xfaae11;continue;case'3':this[_0x282045(0x1b1)]=new Date()[_0x282045(0x1ba)]();continue;case'4':this[_0x282045(0x1a8)]=_0x1250e8||_0x47a30c[_0x282045(0x195)];continue;}break;}}}class BaseConversationManager{constructor(){const _0x26db59=_0x14fb,_0x1320ca={'TZuOM':function(_0x545324,_0x4f4e3a){return _0x545324*_0x4f4e3a;},'XpxzN':function(_0x486982,_0x2dc5c5){return _0x486982*_0x2dc5c5;}};this['conversations']={},this['currentConversationId']=null,this[_0x26db59(0x193)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]},this[_0x26db59(0x180)]=_0x1320ca[_0x26db59(0x181)](_0x1320ca[_0x26db59(0x1ac)](4.5,0x400),0x400),this[_0x26db59(0x1aa)]=0x32,this[_0x26db59(0x1a7)](),(!this[_0x26db59(0x189)]||!this[_0x26db59(0x1bc)][this[_0x26db59(0x189)]])&&this['createNewConversation']();}[_0x144c42(0x1a7)](){const _0x2079e5=_0x144c42,_0xf5a090={'LpEsq':_0x2079e5(0x19e)};try{const _0x1a504d=JSON[_0x2079e5(0x1b3)](localStorage[_0x2079e5(0x1b9)](_0x2079e5(0x1bc)))||[];Array[_0x2079e5(0x185)](_0x1a504d)&&(this[_0x2079e5(0x1bc)]=Object[_0x2079e5(0x17d)](_0x1a504d[_0x2079e5(0x1a5)](_0xbb11a0=>[_0xbb11a0['id'],new Conversation(_0xbb11a0['id'],_0xbb11a0[_0x2079e5(0x1a8)])]))),Logger[_0x2079e5(0x19a)](_0x2079e5(0x1b4)+Object['keys'](this[_0x2079e5(0x1bc)])[_0x2079e5(0x18a)]+'\x20conversations');}catch(_0x3235db){Logger[_0x2079e5(0x184)](_0xf5a090[_0x2079e5(0x17e)],_0x3235db),this['conversations']={};}}['saveConversations'](){const _0x317be0=_0x144c42,_0x126d80={'PIkpU':function(_0x5691e5,_0x5134f9){return _0x5691e5>_0x5134f9;},'BYMHu':_0x317be0(0x1bc),'BtJjK':'Conversations\x20saved\x20successfully'};try{let _0x5c4b9f=JSON[_0x317be0(0x18f)](Object[_0x317be0(0x1a9)](this[_0x317be0(0x1bc)]));_0x126d80[_0x317be0(0x182)](_0x5c4b9f['length'],this['MAX_STORAGE_SIZE'])&&this['cleanupStorage'](),localStorage['setItem'](_0x126d80[_0x317be0(0x187)],_0x5c4b9f),this[_0x317be0(0x196)](),Logger['info'](_0x126d80[_0x317be0(0x188)]);}catch(_0x3de868){Logger[_0x317be0(0x184)](_0x317be0(0x1a3),_0x3de868);}}[_0x144c42(0x1a0)](){const _0x1bf763=_0x144c42,_0x442b83={'bOAsh':_0x1bf763(0x192),'mVnuG':function(_0x499156,_0x48a85d){return _0x499156>_0x48a85d;}};Logger[_0x1bf763(0x18e)](_0x442b83[_0x1bf763(0x183)]);let _0x116a7b=Object['values'](this['conversations'])[_0x1bf763(0x1a4)]((_0x404cb6,_0x26da6f)=>new Date(_0x26da6f['updatedAt'])-new Date(_0x404cb6[_0x1bf763(0x1b1)]));_0x116a7b['length']>this[_0x1bf763(0x1aa)]&&(_0x116a7b=_0x116a7b[_0x1bf763(0x179)](0x0,this[_0x1bf763(0x1aa)]),this[_0x1bf763(0x1bc)]=Object[_0x1bf763(0x17d)](_0x116a7b[_0x1bf763(0x1a5)](_0x4dcd16=>[_0x4dcd16['id'],_0x4dcd16])),Logger['info'](_0x1bf763(0x191)+this[_0x1bf763(0x1aa)]+_0x1bf763(0x1b2)));let _0x3d16fe=JSON[_0x1bf763(0x18f)](_0x116a7b)['length'];while(_0x442b83[_0x1bf763(0x1ad)](_0x3d16fe,this['MAX_STORAGE_SIZE'])&&_0x442b83['mVnuG'](_0x116a7b['length'],0x0)){const _0x491f62=_0x116a7b[_0x1bf763(0x1bf)]();delete this[_0x1bf763(0x1bc)][_0x491f62['id']],_0x3d16fe=JSON[_0x1bf763(0x18f)](Object[_0x1bf763(0x1a9)](this[_0x1bf763(0x1bc)]))[_0x1bf763(0x18a)];}Logger[_0x1bf763(0x19a)]('Storage\x20cleanup\x20completed');}[_0x144c42(0x178)](_0x40b83d=_0x144c42(0x17a)){const _0x3e8847=_0x144c42,_0x269f9f=Date[_0x3e8847(0x199)]()[_0x3e8847(0x17c)]();return this[_0x3e8847(0x1bc)][_0x269f9f]=new Conversation(_0x269f9f,_0x40b83d),this['currentConversationId']=_0x269f9f,this[_0x3e8847(0x176)](),this[_0x3e8847(0x1bb)](),_0x269f9f;}[_0x144c42(0x197)](_0x3ffb11){const _0x3047e6=_0x144c42,_0x36e46d={'DHGWd':function(_0x1e3732,_0x54209b){return _0x1e3732===_0x54209b;}};this['conversations'][_0x3ffb11]&&(delete this['conversations'][_0x3ffb11],_0x36e46d[_0x3047e6(0x1a6)](this['currentConversationId'],_0x3ffb11)&&(this[_0x3047e6(0x189)]=null,this[_0x3047e6(0x178)]()),this[_0x3047e6(0x176)]());}[_0x144c42(0x1af)](_0x44dd6e){const _0x2bfe91=_0x144c42;if(this['conversations'][_0x44dd6e])return this[_0x2bfe91(0x189)]=_0x44dd6e,this[_0x2bfe91(0x1bb)](),!![];return![];}[_0x144c42(0x198)](){return this['conversations'][this['currentConversationId']]||null;}[_0x144c42(0x1bd)](_0x5c5d6b,_0x44729f){const _0xccef00=_0x144c42,_0x47befe={'YRonh':function(_0x2409cd,_0x40f24b){return _0x2409cd===_0x40f24b;},'uyMhM':_0xccef00(0x19d),'kfwcf':function(_0x344038,_0x1bdd38){return _0x344038===_0x1bdd38;},'HjxbB':function(_0x2e0e78,_0x3227ef){return _0x2e0e78>_0x3227ef;},'LEywM':_0xccef00(0x1ab)},_0x54d424=this[_0xccef00(0x198)]();if(!_0x54d424)return![];return _0x54d424['messages'][_0xccef00(0x194)]({'role':_0x44729f,'content':_0x5c5d6b,'timestamp':new Date()['toISOString']()}),_0x54d424['updatedAt']=new Date()[_0xccef00(0x1ba)](),_0x47befe['YRonh'](_0x44729f,_0x47befe[_0xccef00(0x17f)])&&_0x47befe['kfwcf'](_0x54d424[_0xccef00(0x1be)]['length'],0x1)&&(_0x54d424[_0xccef00(0x1a8)]=_0x5c5d6b[_0xccef00(0x179)](0x0,0x1e)+(_0x47befe[_0xccef00(0x1ae)](_0x5c5d6b[_0xccef00(0x18a)],0x1e)?_0x47befe['LEywM']:'')),this[_0xccef00(0x176)](),!![];}[_0x144c42(0x196)](){const _0x6a2915=_0x144c42;this[_0x6a2915(0x193)]['onConversationUpdate']['forEach'](_0x1b2311=>_0x1b2311(this[_0x6a2915(0x1bc)]));}['notifyCurrentConversationChange'](){const _0x85b20=_0x144c42;this[_0x85b20(0x193)]['onCurrentConversationChange'][_0x85b20(0x19c)](_0x553b3e=>_0x553b3e(this['getCurrentConversation']()));}[_0x144c42(0x190)](_0x1cf01c,_0x3de70f){const _0x3c5ff8=_0x144c42;this['listeners'][_0x1cf01c]&&this[_0x3c5ff8(0x193)][_0x1cf01c][_0x3c5ff8(0x194)](_0x3de70f);}[_0x144c42(0x1b6)](_0x40ce11,_0x3ab7d4){const _0x113a46=_0x144c42;this[_0x113a46(0x193)][_0x40ce11]&&(this[_0x113a46(0x193)][_0x40ce11]=this[_0x113a46(0x193)][_0x40ce11]['filter'](_0x1ff2b0=>_0x1ff2b0!==_0x3ab7d4));}}export{BaseConversationManager};function _0x4fe2(){const _0x510ef9=['saveConversations','81201aTpkjV','createNewConversation','slice','New\x20Chat','2|4|1|0|3','toString','fromEntries','LpEsq','uyMhM','MAX_STORAGE_SIZE','TZuOM','PIkpU','bOAsh','error','isArray','562950EWmIKA','BYMHu','BtJjK','currentConversationId','length','8NEjaCn','sIDXM','createdAt','warn','stringify','addEventListener','Trimmed\x20to\x20','Storage\x20cleanup\x20initiated','listeners','push','thjwr','notifyConversationUpdate','deleteConversation','getCurrentConversation','now','info','1901606JERdeS','forEach','user','Failed\x20to\x20load\x20conversations','8ltgPYX','cleanupStorage','2459724sFUXSs','120795qeDXqX','Failed\x20to\x20save\x20conversations','sort','map','DHGWd','loadConversations','title','values','MAX_CONVERSATIONS','...','XpxzN','mVnuG','HjxbB','switchConversation','540340Smmfgk','updatedAt','\x20conversations','parse','Loaded\x20','3763431lInKaV','removeEventListener','split','4fxwZgK','getItem','toISOString','notifyCurrentConversationChange','conversations','addMessage','messages','pop'];_0x4fe2=function(){return _0x510ef9;};return _0x4fe2();}