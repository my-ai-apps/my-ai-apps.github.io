
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x189c19=_0x34ab;(function(_0x319deb,_0x226874){const _0x1679e6=_0x34ab,_0x30d1b8=_0x319deb();while(!![]){try{const _0x3ffd80=parseInt(_0x1679e6(0x147))/0x1*(parseInt(_0x1679e6(0x15d))/0x2)+-parseInt(_0x1679e6(0x121))/0x3*(-parseInt(_0x1679e6(0x154))/0x4)+-parseInt(_0x1679e6(0x129))/0x5+-parseInt(_0x1679e6(0x153))/0x6+parseInt(_0x1679e6(0x13a))/0x7*(-parseInt(_0x1679e6(0x132))/0x8)+parseInt(_0x1679e6(0x142))/0x9*(-parseInt(_0x1679e6(0x11a))/0xa)+parseInt(_0x1679e6(0x143))/0xb;if(_0x3ffd80===_0x226874)break;else _0x30d1b8['push'](_0x30d1b8['shift']());}catch(_0x2d0faf){_0x30d1b8['push'](_0x30d1b8['shift']());}}}(_0x5908,0x9bb62));function _0x34ab(_0x251368,_0x13b2f9){const _0x590830=_0x5908();return _0x34ab=function(_0x34ab9c,_0x2f6d57){_0x34ab9c=_0x34ab9c-0x119;let _0x328651=_0x590830[_0x34ab9c];return _0x328651;},_0x34ab(_0x251368,_0x13b2f9);}import{Logger}from'./common.js';function _0x5908(){const _0x339ec0=['2308JMvvsO','RDkBX','sort','values','Conversations\x20saved\x20successfully','...','length','fromEntries','currentConversationId','57866paqrfb','ycrMe','parse','7967540cDXkmj','Storage\x20cleanup\x20completed','vsvSv','createNewConversation','eZDpa','map','1|2|0|6|5|3|4','504OTHhyF','listeners','title','BKLUR','conversations','slice','Ceywk','xqyfB','1054435oTXxTo','split','Failed\x20to\x20save\x20conversations','Loaded\x20','messages','toString','keys','stringify','now','8otkhXI','MAX_CONVERSATIONS','warn','getCurrentConversation','addMessage','push','toISOString','Trimmed\x20to\x20','7200389XmXjng','\x20conversations','onConversationUpdate','nRzGB','loadConversations','MAX_STORAGE_SIZE','pop','uGlcP','9LBKpDx','28571268fPNMhH','cleanupStorage','updatedAt','switchConversation','15QEkRHK','saveConversations','notifyConversationUpdate','2|0|1|4|3','isArray','removeEventListener','info','Storage\x20cleanup\x20initiated','WbAxc','deleteConversation','Failed\x20to\x20load\x20conversations','notifyCurrentConversationChange','2725542BlBJzE'];_0x5908=function(){return _0x339ec0;};return _0x5908();}class Conversation{constructor(_0x35dff9,_0x52af03){const _0x2bb73e=_0x34ab,_0x2a0ef2={'ycrMe':'New\x20Chat'},_0x54856a=_0x2bb73e(0x14a)[_0x2bb73e(0x12a)]('|');let _0x3704f6=0x0;while(!![]){switch(_0x54856a[_0x3704f6++]){case'0':this[_0x2bb73e(0x123)]=_0x52af03||_0x2a0ef2[_0x2bb73e(0x15e)];continue;case'1':this[_0x2bb73e(0x12d)]=[];continue;case'2':this['id']=_0x35dff9;continue;case'3':this['updatedAt']=new Date()[_0x2bb73e(0x138)]();continue;case'4':this['createdAt']=new Date()[_0x2bb73e(0x138)]();continue;}break;}}}class BaseConversationManager{constructor(){const _0x209650=_0x34ab,_0x389c40={'xqyfB':_0x209650(0x120),'BKLUR':function(_0x176d8e,_0x5a41ab){return _0x176d8e*_0x5a41ab;}},_0x43e6f3=_0x389c40[_0x209650(0x128)][_0x209650(0x12a)]('|');let _0x14b72d=0x0;while(!![]){switch(_0x43e6f3[_0x14b72d++]){case'0':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'1':this[_0x209650(0x125)]={};continue;case'2':this[_0x209650(0x15c)]=null;continue;case'3':this[_0x209650(0x13e)]();continue;case'4':(!this['currentConversationId']||!this['conversations'][this[_0x209650(0x15c)]])&&this[_0x209650(0x11d)]();continue;case'5':this[_0x209650(0x133)]=0x32;continue;case'6':this[_0x209650(0x13f)]=_0x389c40[_0x209650(0x124)](_0x389c40[_0x209650(0x124)](4.5,0x400),0x400);continue;}break;}}[_0x189c19(0x13e)](){const _0x1ad8e2=_0x189c19,_0x478c0d={'Ceywk':_0x1ad8e2(0x125)};try{const _0x45af63=JSON[_0x1ad8e2(0x119)](localStorage['getItem'](_0x478c0d[_0x1ad8e2(0x127)]))||[];Array[_0x1ad8e2(0x14b)](_0x45af63)&&(this[_0x1ad8e2(0x125)]=Object[_0x1ad8e2(0x15b)](_0x45af63[_0x1ad8e2(0x11f)](_0x2b7ae1=>[_0x2b7ae1['id'],new Conversation(_0x2b7ae1['id'],_0x2b7ae1[_0x1ad8e2(0x123)])]))),Logger[_0x1ad8e2(0x14d)](_0x1ad8e2(0x12c)+Object[_0x1ad8e2(0x12f)](this[_0x1ad8e2(0x125)])[_0x1ad8e2(0x15a)]+_0x1ad8e2(0x13b));}catch(_0x3a44a4){Logger['error'](_0x1ad8e2(0x151),_0x3a44a4),this[_0x1ad8e2(0x125)]={};}}[_0x189c19(0x148)](){const _0x4bbafc=_0x189c19,_0x3ae9cb={'eZDpa':function(_0x2c3d77,_0x354734){return _0x2c3d77>_0x354734;},'rVOyt':_0x4bbafc(0x125),'RDkBX':_0x4bbafc(0x12b)};try{let _0x2e0f50=JSON[_0x4bbafc(0x130)](Object[_0x4bbafc(0x157)](this['conversations']));_0x3ae9cb[_0x4bbafc(0x11e)](_0x2e0f50[_0x4bbafc(0x15a)],this[_0x4bbafc(0x13f)])&&this[_0x4bbafc(0x144)](),localStorage['setItem'](_0x3ae9cb['rVOyt'],_0x2e0f50),this[_0x4bbafc(0x149)](),Logger[_0x4bbafc(0x14d)](_0x4bbafc(0x158));}catch(_0x37af00){Logger['error'](_0x3ae9cb[_0x4bbafc(0x155)],_0x37af00);}}[_0x189c19(0x144)](){const _0x1f7275=_0x189c19,_0x22c0d5={'WbAxc':function(_0xaa00a5,_0x54d328){return _0xaa00a5>_0x54d328;},'uGlcP':_0x1f7275(0x11b)};Logger[_0x1f7275(0x134)](_0x1f7275(0x14e));let _0x2edda4=Object[_0x1f7275(0x157)](this[_0x1f7275(0x125)])[_0x1f7275(0x156)]((_0x37eaac,_0x245952)=>new Date(_0x245952[_0x1f7275(0x145)])-new Date(_0x37eaac[_0x1f7275(0x145)]));_0x2edda4[_0x1f7275(0x15a)]>this[_0x1f7275(0x133)]&&(_0x2edda4=_0x2edda4[_0x1f7275(0x126)](0x0,this[_0x1f7275(0x133)]),this[_0x1f7275(0x125)]=Object[_0x1f7275(0x15b)](_0x2edda4[_0x1f7275(0x11f)](_0x166abc=>[_0x166abc['id'],_0x166abc])),Logger[_0x1f7275(0x14d)](_0x1f7275(0x139)+this['MAX_CONVERSATIONS']+_0x1f7275(0x13b)));let _0x4102df=JSON[_0x1f7275(0x130)](_0x2edda4)[_0x1f7275(0x15a)];while(_0x4102df>this[_0x1f7275(0x13f)]&&_0x22c0d5[_0x1f7275(0x14f)](_0x2edda4[_0x1f7275(0x15a)],0x0)){const _0x99f613=_0x2edda4[_0x1f7275(0x140)]();delete this[_0x1f7275(0x125)][_0x99f613['id']],_0x4102df=JSON[_0x1f7275(0x130)](Object[_0x1f7275(0x157)](this[_0x1f7275(0x125)]))[_0x1f7275(0x15a)];}Logger['info'](_0x22c0d5[_0x1f7275(0x141)]);}[_0x189c19(0x11d)](_0x3a4618='New\x20Chat'){const _0x172a77=_0x189c19,_0x36caf3=Date[_0x172a77(0x131)]()[_0x172a77(0x12e)]();return this[_0x172a77(0x125)][_0x36caf3]=new Conversation(_0x36caf3,_0x3a4618),this['currentConversationId']=_0x36caf3,this[_0x172a77(0x148)](),this['notifyCurrentConversationChange'](),_0x36caf3;}[_0x189c19(0x150)](_0x46f6ad){const _0x247041=_0x189c19,_0x3e7abf={'nRzGB':function(_0x5105d8,_0x9fc040){return _0x5105d8===_0x9fc040;}};this[_0x247041(0x125)][_0x46f6ad]&&(delete this['conversations'][_0x46f6ad],_0x3e7abf[_0x247041(0x13d)](this['currentConversationId'],_0x46f6ad)&&(this[_0x247041(0x15c)]=null,this[_0x247041(0x11d)]()),this['saveConversations']());}[_0x189c19(0x146)](_0x1a1d4a){const _0x28caef=_0x189c19;if(this[_0x28caef(0x125)][_0x1a1d4a])return this[_0x28caef(0x15c)]=_0x1a1d4a,this[_0x28caef(0x152)](),!![];return![];}[_0x189c19(0x135)](){const _0x24a5ca=_0x189c19;return this[_0x24a5ca(0x125)][this[_0x24a5ca(0x15c)]]||null;}[_0x189c19(0x136)](_0x5845f5,_0x5033ac){const _0x4d7c25=_0x189c19,_0x301c68={'vsvSv':function(_0x31b1e5,_0xda075d){return _0x31b1e5+_0xda075d;},'yjzeS':_0x4d7c25(0x159)},_0x2beedd=this[_0x4d7c25(0x135)]();if(!_0x2beedd)return![];return _0x2beedd[_0x4d7c25(0x12d)]['push']({'role':_0x5033ac,'content':_0x5845f5,'timestamp':new Date()[_0x4d7c25(0x138)]()}),_0x2beedd['updatedAt']=new Date()['toISOString'](),_0x5033ac==='user'&&_0x2beedd[_0x4d7c25(0x12d)][_0x4d7c25(0x15a)]===0x1&&(_0x2beedd[_0x4d7c25(0x123)]=_0x301c68[_0x4d7c25(0x11c)](_0x5845f5[_0x4d7c25(0x126)](0x0,0x1e),_0x5845f5['length']>0x1e?_0x301c68['yjzeS']:'')),this[_0x4d7c25(0x148)](),!![];}['notifyConversationUpdate'](){const _0x1e083a=_0x189c19;this[_0x1e083a(0x122)][_0x1e083a(0x13c)]['forEach'](_0x4277cf=>_0x4277cf(this[_0x1e083a(0x125)]));}['notifyCurrentConversationChange'](){const _0x2e67c1=_0x189c19;this[_0x2e67c1(0x122)]['onCurrentConversationChange']['forEach'](_0x830e7a=>_0x830e7a(this['getCurrentConversation']()));}['addEventListener'](_0x5d00a4,_0x5963b7){const _0x171c41=_0x189c19;this[_0x171c41(0x122)][_0x5d00a4]&&this[_0x171c41(0x122)][_0x5d00a4][_0x171c41(0x137)](_0x5963b7);}[_0x189c19(0x14c)](_0x731c6f,_0x2ba29d){const _0x2e4791=_0x189c19;this[_0x2e4791(0x122)][_0x731c6f]&&(this[_0x2e4791(0x122)][_0x731c6f]=this[_0x2e4791(0x122)][_0x731c6f]['filter'](_0x5c19d3=>_0x5c19d3!==_0x2ba29d));}}export{BaseConversationManager};