
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x50fdd0=_0x1785;(function(_0x2c44b2,_0x4a61da){const _0x1929d8=_0x1785,_0x5e888f=_0x2c44b2();while(!![]){try{const _0x3f9090=parseInt(_0x1929d8(0x1f0))/0x1+parseInt(_0x1929d8(0x1d2))/0x2+-parseInt(_0x1929d8(0x1c3))/0x3+-parseInt(_0x1929d8(0x1e1))/0x4+parseInt(_0x1929d8(0x1e6))/0x5+-parseInt(_0x1929d8(0x1ce))/0x6*(-parseInt(_0x1929d8(0x1bc))/0x7)+parseInt(_0x1929d8(0x1e4))/0x8*(parseInt(_0x1929d8(0x1f9))/0x9);if(_0x3f9090===_0x4a61da)break;else _0x5e888f['push'](_0x5e888f['shift']());}catch(_0x2b9093){_0x5e888f['push'](_0x5e888f['shift']());}}}(_0x3afb,0x72f0c));import{Logger}from'./common.js';function _0x1785(_0x506edb,_0x5e7c1f){const _0x3afb3a=_0x3afb();return _0x1785=function(_0x178562,_0x21cbe4){_0x178562=_0x178562-0x1b5;let _0x53a826=_0x3afb3a[_0x178562];return _0x53a826;},_0x1785(_0x506edb,_0x5e7c1f);}class Conversation{constructor(_0x36fc63,_0xf7a88f){const _0x2d593d=_0x1785,_0x2faa7e={'TSTMI':_0x2d593d(0x1c4),'RGUWY':function(_0x6d5956,_0x2821f6){return _0x6d5956||_0x2821f6;}},_0x27128f=_0x2faa7e[_0x2d593d(0x1d4)][_0x2d593d(0x1de)]('|');let _0x146725=0x0;while(!![]){switch(_0x27128f[_0x146725++]){case'0':this[_0x2d593d(0x1d8)]=new Date()[_0x2d593d(0x1db)]();continue;case'1':this[_0x2d593d(0x1c0)]=new Date()['toISOString']();continue;case'2':this['id']=_0x36fc63;continue;case'3':this[_0x2d593d(0x1c2)]=[];continue;case'4':this[_0x2d593d(0x1f7)]=_0x2faa7e[_0x2d593d(0x1bd)](_0xf7a88f,_0x2d593d(0x1e8));continue;}break;}}}class BaseConversationManager{constructor(){const _0x22a1a2=_0x1785,_0xd2de05={'AWIyE':_0x22a1a2(0x1c6),'FnyWx':function(_0x4c6c7a,_0x4e7fc0){return _0x4c6c7a*_0x4e7fc0;}},_0x436e9b=_0xd2de05[_0x22a1a2(0x1d5)]['split']('|');let _0x2eae9e=0x0;while(!![]){switch(_0x436e9b[_0x2eae9e++]){case'0':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'1':(!this[_0x22a1a2(0x1f3)]||!this[_0x22a1a2(0x1b5)][this['currentConversationId']])&&this[_0x22a1a2(0x1ea)]();continue;case'2':this['currentConversationId']=null;continue;case'3':this['loadConversations']();continue;case'4':this[_0x22a1a2(0x1e9)]=0x32;continue;case'5':this[_0x22a1a2(0x1f2)]=_0xd2de05[_0x22a1a2(0x1d9)](_0xd2de05[_0x22a1a2(0x1d9)](4.5,0x400),0x400);continue;case'6':this[_0x22a1a2(0x1b5)]={};continue;}break;}}[_0x50fdd0(0x1fa)](){const _0x2d3ebc=_0x50fdd0,_0x31721e={'FjpgD':_0x2d3ebc(0x1b5),'mMIPV':_0x2d3ebc(0x1ba)};try{const _0x5ec554=JSON[_0x2d3ebc(0x1f1)](localStorage['getItem'](_0x31721e[_0x2d3ebc(0x1e0)]))||[];Array[_0x2d3ebc(0x1f4)](_0x5ec554)&&(this[_0x2d3ebc(0x1b5)]=Object[_0x2d3ebc(0x1dc)](_0x5ec554['map'](_0x10289e=>[_0x10289e['id'],new Conversation(_0x10289e['id'],_0x10289e[_0x2d3ebc(0x1f7)])]))),Logger[_0x2d3ebc(0x1fb)](_0x2d3ebc(0x1c8)+Object['keys'](this['conversations'])[_0x2d3ebc(0x1d7)]+_0x2d3ebc(0x1f6));}catch(_0x4cdc7b){Logger['error'](_0x31721e[_0x2d3ebc(0x1cb)],_0x4cdc7b),this[_0x2d3ebc(0x1b5)]={};}}[_0x50fdd0(0x1ee)](){const _0x51cb11=_0x50fdd0,_0x41f822={'EYkJh':'Conversations\x20saved\x20successfully','RahES':'Failed\x20to\x20save\x20conversations'};try{let _0x360cfd=JSON[_0x51cb11(0x1d0)](Object['values'](this[_0x51cb11(0x1b5)]));_0x360cfd[_0x51cb11(0x1d7)]>this[_0x51cb11(0x1f2)]&&this[_0x51cb11(0x1c7)](),localStorage['setItem'](_0x51cb11(0x1b5),_0x360cfd),this['notifyConversationUpdate'](),Logger[_0x51cb11(0x1fb)](_0x41f822['EYkJh']);}catch(_0x1bd39e){Logger['error'](_0x41f822[_0x51cb11(0x1e3)],_0x1bd39e);}}['cleanupStorage'](){const _0x578957=_0x50fdd0,_0x4f95fa={'RttZi':_0x578957(0x1ed),'LPUIa':function(_0xb8bf6b,_0x2d8980){return _0xb8bf6b>_0x2d8980;},'GLYuu':_0x578957(0x1e2)};Logger['warn'](_0x4f95fa[_0x578957(0x1da)]);let _0x169aa1=Object[_0x578957(0x1cf)](this[_0x578957(0x1b5)])['sort']((_0x258958,_0x5eaf04)=>new Date(_0x5eaf04[_0x578957(0x1d8)])-new Date(_0x258958[_0x578957(0x1d8)]));_0x4f95fa['LPUIa'](_0x169aa1[_0x578957(0x1d7)],this[_0x578957(0x1e9)])&&(_0x169aa1=_0x169aa1[_0x578957(0x1be)](0x0,this[_0x578957(0x1e9)]),this['conversations']=Object[_0x578957(0x1dc)](_0x169aa1[_0x578957(0x1dd)](_0x4976b2=>[_0x4976b2['id'],_0x4976b2])),Logger[_0x578957(0x1fb)]('Trimmed\x20to\x20'+this['MAX_CONVERSATIONS']+_0x578957(0x1f6)));let _0x7a2c2a=JSON['stringify'](_0x169aa1)['length'];while(_0x4f95fa[_0x578957(0x1cd)](_0x7a2c2a,this[_0x578957(0x1f2)])&&_0x4f95fa[_0x578957(0x1cd)](_0x169aa1[_0x578957(0x1d7)],0x0)){const _0x32e97e=_0x169aa1[_0x578957(0x1b9)]();delete this[_0x578957(0x1b5)][_0x32e97e['id']],_0x7a2c2a=JSON[_0x578957(0x1d0)](Object[_0x578957(0x1cf)](this[_0x578957(0x1b5)]))['length'];}Logger[_0x578957(0x1fb)](_0x4f95fa[_0x578957(0x1d3)]);}[_0x50fdd0(0x1ea)](_0x1fe41b='New\x20Chat'){const _0x2eaea6=_0x50fdd0,_0x6ef693=Date[_0x2eaea6(0x1ca)]()[_0x2eaea6(0x1ec)]();return this[_0x2eaea6(0x1b5)][_0x6ef693]=new Conversation(_0x6ef693,_0x1fe41b),this[_0x2eaea6(0x1f3)]=_0x6ef693,this[_0x2eaea6(0x1ee)](),this[_0x2eaea6(0x1eb)](),_0x6ef693;}['deleteConversation'](_0x4c0aae){const _0x57486a=_0x50fdd0,_0x28dda2={'YsRJU':function(_0x383350,_0x12555d){return _0x383350===_0x12555d;}};this[_0x57486a(0x1b5)][_0x4c0aae]&&(delete this[_0x57486a(0x1b5)][_0x4c0aae],_0x28dda2[_0x57486a(0x1d1)](this[_0x57486a(0x1f3)],_0x4c0aae)&&(this[_0x57486a(0x1f3)]=null,this[_0x57486a(0x1ea)]()),this['saveConversations']());}['switchConversation'](_0x1fc289){const _0x309cdc=_0x50fdd0;if(this[_0x309cdc(0x1b5)][_0x1fc289])return this[_0x309cdc(0x1f3)]=_0x1fc289,this[_0x309cdc(0x1eb)](),!![];return![];}[_0x50fdd0(0x1e5)](){const _0x4553d3=_0x50fdd0;return this[_0x4553d3(0x1b5)][this[_0x4553d3(0x1f3)]]||null;}[_0x50fdd0(0x1b8)](_0x3a0ace,_0x2146c2){const _0x5885be=_0x50fdd0,_0x122edf={'qMHVv':function(_0x5f4e68,_0x4107f9){return _0x5f4e68===_0x4107f9;},'AkFFt':function(_0x461ea6,_0x40531d){return _0x461ea6+_0x40531d;},'IeJfR':function(_0x24eab5,_0x229240){return _0x24eab5>_0x229240;}},_0xe2a1f5=this['getCurrentConversation']();if(!_0xe2a1f5)return![];return _0xe2a1f5['messages'][_0x5885be(0x1b6)]({'role':_0x2146c2,'content':_0x3a0ace,'timestamp':new Date()['toISOString']()}),_0xe2a1f5['updatedAt']=new Date()['toISOString'](),_0x122edf[_0x5885be(0x1bf)](_0x2146c2,_0x5885be(0x1cc))&&_0x122edf[_0x5885be(0x1bf)](_0xe2a1f5['messages'][_0x5885be(0x1d7)],0x1)&&(_0xe2a1f5['title']=_0x122edf[_0x5885be(0x1c5)](_0x3a0ace[_0x5885be(0x1be)](0x0,0x1e),_0x122edf[_0x5885be(0x1c1)](_0x3a0ace[_0x5885be(0x1d7)],0x1e)?_0x5885be(0x1c9):'')),this[_0x5885be(0x1ee)](),!![];}[_0x50fdd0(0x1b7)](){const _0x4a06bc=_0x50fdd0;this[_0x4a06bc(0x1df)][_0x4a06bc(0x1ef)]['forEach'](_0x81329a=>_0x81329a(this[_0x4a06bc(0x1b5)]));}[_0x50fdd0(0x1eb)](){const _0x1ef8e4=_0x50fdd0;this[_0x1ef8e4(0x1df)][_0x1ef8e4(0x1d6)][_0x1ef8e4(0x1f8)](_0x51fe45=>_0x51fe45(this[_0x1ef8e4(0x1e5)]()));}[_0x50fdd0(0x1bb)](_0x443641,_0x20fcaf){const _0x27631a=_0x50fdd0;this[_0x27631a(0x1df)][_0x443641]&&this[_0x27631a(0x1df)][_0x443641]['push'](_0x20fcaf);}[_0x50fdd0(0x1f5)](_0x1d12ca,_0xdba57f){const _0xdb0af3=_0x50fdd0;this['listeners'][_0x1d12ca]&&(this[_0xdb0af3(0x1df)][_0x1d12ca]=this[_0xdb0af3(0x1df)][_0x1d12ca][_0xdb0af3(0x1e7)](_0x97fe0b=>_0x97fe0b!==_0xdba57f));}}export{BaseConversationManager};function _0x3afb(){const _0x39b815=['IeJfR','messages','1946385mwcTKJ','2|4|3|1|0','AkFFt','6|2|0|5|4|3|1','cleanupStorage','Loaded\x20','...','now','mMIPV','user','LPUIa','1776378hHUhZk','values','stringify','YsRJU','1488854oGRRKO','GLYuu','TSTMI','AWIyE','onCurrentConversationChange','length','updatedAt','FnyWx','RttZi','toISOString','fromEntries','map','split','listeners','FjpgD','2482428GKiVtR','Storage\x20cleanup\x20completed','RahES','16vaPctV','getCurrentConversation','368925kAZuRz','filter','New\x20Chat','MAX_CONVERSATIONS','createNewConversation','notifyCurrentConversationChange','toString','Storage\x20cleanup\x20initiated','saveConversations','onConversationUpdate','279631lzxuRK','parse','MAX_STORAGE_SIZE','currentConversationId','isArray','removeEventListener','\x20conversations','title','forEach','1558314vFjoUv','loadConversations','info','conversations','push','notifyConversationUpdate','addMessage','pop','Failed\x20to\x20load\x20conversations','addEventListener','7CxCqsm','RGUWY','slice','qMHVv','createdAt'];_0x3afb=function(){return _0x39b815;};return _0x3afb();}