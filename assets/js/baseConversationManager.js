
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x5da11d=_0x51b1;function _0x2f11(){const _0x2f17b8=['loadConversations','split','Loaded\x20','forEach','ooQoG','map','createNewConversation','152lPuOCJ','notifyConversationUpdate','CGMun','user','1942077CKJjRP','notifyCurrentConversationChange','8gYzPAU','MAX_STORAGE_SIZE','push','MYfHI','\x20conversations','33710dRbjnD','22600lLLnNR','yTEjJ','OLlMY','864fMQfqA','error','switchConversation','cleanupStorage','updatedAt','keys','onConversationUpdate','slice','MAX_CONVERSATIONS','title','664937LqXvpK','New\x20Chat','...','now','filter','getItem','messages','info','cwrIS','Failed\x20to\x20load\x20conversations','addEventListener','stringify','494500jCqmKH','listeners','Conversations\x20saved\x20successfully','VnCYQ','EbOKa','getCurrentConversation','addMessage','length','deleteConversation','boYyF','Failed\x20to\x20save\x20conversations','mPzEP','values','fromEntries','conversations','saveConversations','1589094UCGfZv','pop','currentConversationId','OlKfl','toString','nlcsD','toISOString','removeEventListener','186QyJfNk','1111wfRqIp','jZxBq','umBuB','createdAt'];_0x2f11=function(){return _0x2f17b8;};return _0x2f11();}function _0x51b1(_0x2c3154,_0x2f07b1){const _0x2f1138=_0x2f11();return _0x51b1=function(_0x51b1a5,_0x2279e3){_0x51b1a5=_0x51b1a5-0xfa;let _0x5a86ac=_0x2f1138[_0x51b1a5];return _0x5a86ac;},_0x51b1(_0x2c3154,_0x2f07b1);}(function(_0x2bbe66,_0x2dbe79){const _0x3c1720=_0x51b1,_0x2c5957=_0x2bbe66();while(!![]){try{const _0x521089=parseInt(_0x3c1720(0x10b))/0x1*(-parseInt(_0x3c1720(0x117))/0x2)+-parseInt(_0x3c1720(0x11b))/0x3*(-parseInt(_0x3c1720(0x11d))/0x4)+-parseInt(_0x3c1720(0x13c))/0x5+-parseInt(_0x3c1720(0x103))/0x6+-parseInt(_0x3c1720(0x130))/0x7+-parseInt(_0x3c1720(0x123))/0x8*(-parseInt(_0x3c1720(0x126))/0x9)+parseInt(_0x3c1720(0x122))/0xa*(-parseInt(_0x3c1720(0x10c))/0xb);if(_0x521089===_0x2dbe79)break;else _0x2c5957['push'](_0x2c5957['shift']());}catch(_0x50f77b){_0x2c5957['push'](_0x2c5957['shift']());}}}(_0x2f11,0xb7bbb));import{Logger}from'./common.js';class Conversation{constructor(_0x52608c,_0x20ed1e){const _0x278106=_0x51b1;this['id']=_0x52608c,this[_0x278106(0x12f)]=_0x20ed1e||_0x278106(0x131),this['messages']=[],this[_0x278106(0x10f)]=new Date()[_0x278106(0x109)](),this[_0x278106(0x12a)]=new Date()[_0x278106(0x109)]();}}class BaseConversationManager{constructor(){const _0xe0f283=_0x51b1,_0x29b3a1={'ooQoG':'6|1|3|5|4|0|2','jZxBq':function(_0x778d94,_0x486401){return _0x778d94*_0x486401;}},_0x20be73=_0x29b3a1[_0xe0f283(0x114)][_0xe0f283(0x111)]('|');let _0x35604b=0x0;while(!![]){switch(_0x20be73[_0x35604b++]){case'0':this[_0xe0f283(0x110)]();continue;case'1':this['currentConversationId']=null;continue;case'2':(!this[_0xe0f283(0x105)]||!this['conversations'][this[_0xe0f283(0x105)]])&&this[_0xe0f283(0x116)]();continue;case'3':this[_0xe0f283(0x13d)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'4':this[_0xe0f283(0x12e)]=0x32;continue;case'5':this[_0xe0f283(0x11e)]=_0x29b3a1[_0xe0f283(0x10d)](4.5*0x400,0x400);continue;case'6':this['conversations']={};continue;}break;}}[_0x5da11d(0x110)](){const _0x5d32a1=_0x5da11d,_0x334502={'yTEjJ':_0x5d32a1(0x139)};try{const _0x3c7418=JSON['parse'](localStorage[_0x5d32a1(0x135)]('conversations'))||[];Array['isArray'](_0x3c7418)&&(this[_0x5d32a1(0x101)]=Object['fromEntries'](_0x3c7418[_0x5d32a1(0x115)](_0x556dde=>[_0x556dde['id'],new Conversation(_0x556dde['id'],_0x556dde[_0x5d32a1(0x12f)])]))),Logger[_0x5d32a1(0x137)](_0x5d32a1(0x112)+Object[_0x5d32a1(0x12b)](this[_0x5d32a1(0x101)])[_0x5d32a1(0xfa)]+_0x5d32a1(0x121));}catch(_0xa39d29){Logger[_0x5d32a1(0x127)](_0x334502[_0x5d32a1(0x124)],_0xa39d29),this[_0x5d32a1(0x101)]={};}}[_0x5da11d(0x102)](){const _0x909801=_0x5da11d,_0x54815e={'VnCYQ':_0x909801(0x101),'OlKfl':_0x909801(0x13e),'MYfHI':_0x909801(0xfd)};try{let _0x4b960a=JSON['stringify'](Object[_0x909801(0xff)](this[_0x909801(0x101)]));_0x4b960a[_0x909801(0xfa)]>this[_0x909801(0x11e)]&&this['cleanupStorage'](),localStorage['setItem'](_0x54815e[_0x909801(0x13f)],_0x4b960a),this['notifyConversationUpdate'](),Logger[_0x909801(0x137)](_0x54815e[_0x909801(0x106)]);}catch(_0x46ed26){Logger['error'](_0x54815e[_0x909801(0x120)],_0x46ed26);}}[_0x5da11d(0x129)](){const _0x5ee8bd=_0x5da11d,_0x54b27c={'mPzEP':'Storage\x20cleanup\x20initiated','cwrIS':function(_0x24a4f9,_0x3607b0){return _0x24a4f9>_0x3607b0;},'CGMun':'Storage\x20cleanup\x20completed'};Logger['warn'](_0x54b27c[_0x5ee8bd(0xfe)]);let _0x347c98=Object[_0x5ee8bd(0xff)](this[_0x5ee8bd(0x101)])['sort']((_0xef2def,_0x49646c)=>new Date(_0x49646c[_0x5ee8bd(0x12a)])-new Date(_0xef2def[_0x5ee8bd(0x12a)]));_0x54b27c['cwrIS'](_0x347c98[_0x5ee8bd(0xfa)],this[_0x5ee8bd(0x12e)])&&(_0x347c98=_0x347c98[_0x5ee8bd(0x12d)](0x0,this[_0x5ee8bd(0x12e)]),this[_0x5ee8bd(0x101)]=Object[_0x5ee8bd(0x100)](_0x347c98[_0x5ee8bd(0x115)](_0x9dafbe=>[_0x9dafbe['id'],_0x9dafbe])),Logger[_0x5ee8bd(0x137)]('Trimmed\x20to\x20'+this['MAX_CONVERSATIONS']+_0x5ee8bd(0x121)));let _0x2b4089=JSON['stringify'](_0x347c98)[_0x5ee8bd(0xfa)];while(_0x2b4089>this['MAX_STORAGE_SIZE']&&_0x54b27c[_0x5ee8bd(0x138)](_0x347c98[_0x5ee8bd(0xfa)],0x0)){const _0x47e89c=_0x347c98[_0x5ee8bd(0x104)]();delete this[_0x5ee8bd(0x101)][_0x47e89c['id']],_0x2b4089=JSON[_0x5ee8bd(0x13b)](Object[_0x5ee8bd(0xff)](this[_0x5ee8bd(0x101)]))[_0x5ee8bd(0xfa)];}Logger[_0x5ee8bd(0x137)](_0x54b27c[_0x5ee8bd(0x119)]);}[_0x5da11d(0x116)](_0x35729f=_0x5da11d(0x131)){const _0x2796d5=_0x5da11d,_0x44c89b=Date[_0x2796d5(0x133)]()[_0x2796d5(0x107)]();return this[_0x2796d5(0x101)][_0x44c89b]=new Conversation(_0x44c89b,_0x35729f),this[_0x2796d5(0x105)]=_0x44c89b,this[_0x2796d5(0x102)](),this[_0x2796d5(0x11c)](),_0x44c89b;}[_0x5da11d(0xfb)](_0x2fa072){const _0x53d093=_0x5da11d;this[_0x53d093(0x101)][_0x2fa072]&&(delete this[_0x53d093(0x101)][_0x2fa072],this[_0x53d093(0x105)]===_0x2fa072&&(this[_0x53d093(0x105)]=null,this[_0x53d093(0x116)]()),this[_0x53d093(0x102)]());}[_0x5da11d(0x128)](_0x228ce3){const _0x8870ef=_0x5da11d;if(this[_0x8870ef(0x101)][_0x228ce3])return this['currentConversationId']=_0x228ce3,this['notifyCurrentConversationChange'](),!![];return![];}['getCurrentConversation'](){return this['conversations'][this['currentConversationId']]||null;}[_0x5da11d(0x142)](_0x1fd202,_0x4faba5){const _0x1a6771=_0x5da11d,_0xee34a2={'OLlMY':_0x1a6771(0x11a),'EbOKa':function(_0x26bb56,_0x1d3afb){return _0x26bb56===_0x1d3afb;},'boYyF':function(_0x2e287a,_0x279c24){return _0x2e287a+_0x279c24;},'umBuB':function(_0x10f843,_0x53b30d){return _0x10f843>_0x53b30d;},'nlcsD':_0x1a6771(0x132)},_0x432ccc=this['getCurrentConversation']();if(!_0x432ccc)return![];return _0x432ccc[_0x1a6771(0x136)]['push']({'role':_0x4faba5,'content':_0x1fd202,'timestamp':new Date()[_0x1a6771(0x109)]()}),_0x432ccc['updatedAt']=new Date()[_0x1a6771(0x109)](),_0x4faba5===_0xee34a2[_0x1a6771(0x125)]&&_0xee34a2[_0x1a6771(0x140)](_0x432ccc[_0x1a6771(0x136)][_0x1a6771(0xfa)],0x1)&&(_0x432ccc[_0x1a6771(0x12f)]=_0xee34a2[_0x1a6771(0xfc)](_0x1fd202[_0x1a6771(0x12d)](0x0,0x1e),_0xee34a2[_0x1a6771(0x10e)](_0x1fd202['length'],0x1e)?_0xee34a2[_0x1a6771(0x108)]:'')),this[_0x1a6771(0x102)](),!![];}[_0x5da11d(0x118)](){const _0x34abc9=_0x5da11d;this[_0x34abc9(0x13d)][_0x34abc9(0x12c)][_0x34abc9(0x113)](_0x480a44=>_0x480a44(this[_0x34abc9(0x101)]));}[_0x5da11d(0x11c)](){const _0x2acabb=_0x5da11d;this[_0x2acabb(0x13d)]['onCurrentConversationChange']['forEach'](_0x1a3415=>_0x1a3415(this[_0x2acabb(0x141)]()));}[_0x5da11d(0x13a)](_0x40bbc2,_0x96d2be){const _0x1d0fa5=_0x5da11d;this[_0x1d0fa5(0x13d)][_0x40bbc2]&&this[_0x1d0fa5(0x13d)][_0x40bbc2][_0x1d0fa5(0x11f)](_0x96d2be);}[_0x5da11d(0x10a)](_0x9be722,_0x4cb868){const _0x4dfd08=_0x5da11d;this[_0x4dfd08(0x13d)][_0x9be722]&&(this[_0x4dfd08(0x13d)][_0x9be722]=this[_0x4dfd08(0x13d)][_0x9be722][_0x4dfd08(0x134)](_0x4e91b6=>_0x4e91b6!==_0x4cb868));}}export{BaseConversationManager};