
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x294757=_0x363d;(function(_0x44599b,_0x212354){const _0x171f50=_0x363d,_0x1dbc4e=_0x44599b();while(!![]){try{const _0x315b4f=-parseInt(_0x171f50(0x12e))/0x1*(-parseInt(_0x171f50(0x10f))/0x2)+parseInt(_0x171f50(0x127))/0x3+parseInt(_0x171f50(0x10e))/0x4*(-parseInt(_0x171f50(0x12f))/0x5)+parseInt(_0x171f50(0x148))/0x6+-parseInt(_0x171f50(0x126))/0x7+parseInt(_0x171f50(0x114))/0x8+-parseInt(_0x171f50(0x123))/0x9*(parseInt(_0x171f50(0x128))/0xa);if(_0x315b4f===_0x212354)break;else _0x1dbc4e['push'](_0x1dbc4e['shift']());}catch(_0x224835){_0x1dbc4e['push'](_0x1dbc4e['shift']());}}}(_0x3844,0x9fe54));function _0x363d(_0x2567f3,_0x47edcd){const _0x3844eb=_0x3844();return _0x363d=function(_0x363dfa,_0x4b9c41){_0x363dfa=_0x363dfa-0x108;let _0x9f0c21=_0x3844eb[_0x363dfa];return _0x9f0c21;},_0x363d(_0x2567f3,_0x47edcd);}import{Logger}from'./common.js';class Conversation{constructor(_0x4a372a,_0x3c536f){const _0xe26057=_0x363d,_0x1f5f2b={'HNjBk':function(_0x430dbd,_0x5f295a){return _0x430dbd||_0x5f295a;}};this['id']=_0x4a372a,this['title']=_0x1f5f2b[_0xe26057(0x119)](_0x3c536f,_0xe26057(0x115)),this['messages']=[],this[_0xe26057(0x11d)]=new Date()[_0xe26057(0x151)](),this[_0xe26057(0x121)]=new Date()['toISOString']();}}class BaseConversationManager{constructor(){const _0x2ac4df=_0x363d,_0x11e7ef={'BJSOY':_0x2ac4df(0x10c),'DHFEc':function(_0x27e83d,_0x1c60ba){return _0x27e83d*_0x1c60ba;},'YLWnQ':function(_0x585fd3,_0x3e1cf0){return _0x585fd3*_0x3e1cf0;}},_0x7e6907=_0x11e7ef['BJSOY'][_0x2ac4df(0x13c)]('|');let _0x13fe33=0x0;while(!![]){switch(_0x7e6907[_0x13fe33++]){case'0':this[_0x2ac4df(0x10a)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'1':(!this[_0x2ac4df(0x12d)]||!this[_0x2ac4df(0x141)][this[_0x2ac4df(0x12d)]])&&this['createNewConversation']();continue;case'2':this['currentConversationId']=null;continue;case'3':this[_0x2ac4df(0x147)]=0x32;continue;case'4':this[_0x2ac4df(0x117)]=_0x11e7ef[_0x2ac4df(0x139)](_0x11e7ef['YLWnQ'](4.5,0x400),0x400);continue;case'5':this[_0x2ac4df(0x138)]();continue;case'6':this[_0x2ac4df(0x141)]={};continue;}break;}}[_0x294757(0x138)](){const _0x37833a=_0x294757,_0x5b2fad={'skuNa':_0x37833a(0x141)};try{const _0x246a34=JSON[_0x37833a(0x13e)](localStorage[_0x37833a(0x116)](_0x5b2fad[_0x37833a(0x149)]))||[];Array[_0x37833a(0x11a)](_0x246a34)&&(this[_0x37833a(0x141)]=Object[_0x37833a(0x14a)](_0x246a34[_0x37833a(0x132)](_0x54779c=>[_0x54779c['id'],new Conversation(_0x54779c['id'],_0x54779c[_0x37833a(0x11e)])]))),Logger[_0x37833a(0x118)](_0x37833a(0x146)+Object[_0x37833a(0x112)](this['conversations'])[_0x37833a(0x142)]+_0x37833a(0x130));}catch(_0x101987){Logger['error'](_0x37833a(0x150),_0x101987),this[_0x37833a(0x141)]={};}}['saveConversations'](){const _0x21c9ef=_0x294757,_0x56c6ea={'kLsEr':function(_0x2bf132,_0x4bdf6e){return _0x2bf132>_0x4bdf6e;},'JEllc':_0x21c9ef(0x141),'wUVZc':_0x21c9ef(0x136)};try{let _0x1acb66=JSON[_0x21c9ef(0x13a)](Object['values'](this[_0x21c9ef(0x141)]));_0x56c6ea[_0x21c9ef(0x145)](_0x1acb66[_0x21c9ef(0x142)],this['MAX_STORAGE_SIZE'])&&this[_0x21c9ef(0x10b)](),localStorage[_0x21c9ef(0x135)](_0x56c6ea[_0x21c9ef(0x143)],_0x1acb66),this['notifyConversationUpdate'](),Logger[_0x21c9ef(0x118)](_0x21c9ef(0x133));}catch(_0x17dd67){Logger['error'](_0x56c6ea[_0x21c9ef(0x109)],_0x17dd67);}}[_0x294757(0x10b)](){const _0x5e3e0b=_0x294757,_0x14fce8={'DENpG':_0x5e3e0b(0x131),'qfWnH':function(_0xc63c22,_0x2fd9d){return _0xc63c22>_0x2fd9d;},'kFHTB':_0x5e3e0b(0x137)};Logger['warn'](_0x14fce8[_0x5e3e0b(0x140)]);let _0x2346b0=Object[_0x5e3e0b(0x10d)](this[_0x5e3e0b(0x141)])[_0x5e3e0b(0x12b)]((_0x41f81f,_0x41f6bb)=>new Date(_0x41f6bb[_0x5e3e0b(0x121)])-new Date(_0x41f81f[_0x5e3e0b(0x121)]));_0x14fce8['qfWnH'](_0x2346b0[_0x5e3e0b(0x142)],this['MAX_CONVERSATIONS'])&&(_0x2346b0=_0x2346b0[_0x5e3e0b(0x13b)](0x0,this[_0x5e3e0b(0x147)]),this[_0x5e3e0b(0x141)]=Object[_0x5e3e0b(0x14a)](_0x2346b0['map'](_0x494316=>[_0x494316['id'],_0x494316])),Logger['info'](_0x5e3e0b(0x13d)+this[_0x5e3e0b(0x147)]+_0x5e3e0b(0x130)));let _0x4ead2=JSON['stringify'](_0x2346b0)[_0x5e3e0b(0x142)];while(_0x14fce8[_0x5e3e0b(0x12a)](_0x4ead2,this[_0x5e3e0b(0x117)])&&_0x2346b0[_0x5e3e0b(0x142)]>0x0){const _0x274e67=_0x2346b0[_0x5e3e0b(0x124)]();delete this[_0x5e3e0b(0x141)][_0x274e67['id']],_0x4ead2=JSON[_0x5e3e0b(0x13a)](Object[_0x5e3e0b(0x10d)](this[_0x5e3e0b(0x141)]))['length'];}Logger[_0x5e3e0b(0x118)](_0x14fce8['kFHTB']);}[_0x294757(0x129)](_0x49b66d=_0x294757(0x115)){const _0x4ddd22=_0x294757,_0x384736=Date[_0x4ddd22(0x13f)]()[_0x4ddd22(0x14d)]();return this[_0x4ddd22(0x141)][_0x384736]=new Conversation(_0x384736,_0x49b66d),this[_0x4ddd22(0x12d)]=_0x384736,this[_0x4ddd22(0x14b)](),this[_0x4ddd22(0x11b)](),_0x384736;}['deleteConversation'](_0x2f23ab){const _0x311abc=_0x294757,_0x5b3ac7={'IRvbP':function(_0x569cf6,_0x377733){return _0x569cf6===_0x377733;}};this['conversations'][_0x2f23ab]&&(delete this['conversations'][_0x2f23ab],_0x5b3ac7[_0x311abc(0x11c)](this['currentConversationId'],_0x2f23ab)&&(this[_0x311abc(0x12d)]=null,this['createNewConversation']()),this[_0x311abc(0x14b)]());}['switchConversation'](_0x57835b){const _0x28975b=_0x294757;if(this[_0x28975b(0x141)][_0x57835b])return this['currentConversationId']=_0x57835b,this[_0x28975b(0x11b)](),!![];return![];}[_0x294757(0x111)](){return this['conversations'][this['currentConversationId']]||null;}[_0x294757(0x120)](_0x9706ff,_0x5e7dc1){const _0x157fbe=_0x294757,_0x362dba={'vcCPZ':function(_0x3239a0,_0x17d0c6){return _0x3239a0===_0x17d0c6;},'corHQ':_0x157fbe(0x134),'XFBgK':function(_0x5e8e54,_0x39ee32){return _0x5e8e54+_0x39ee32;},'ObFby':function(_0x5db09d,_0x322670){return _0x5db09d>_0x322670;},'VENwN':_0x157fbe(0x152)},_0x48c459=this[_0x157fbe(0x111)]();if(!_0x48c459)return![];return _0x48c459['messages'][_0x157fbe(0x14c)]({'role':_0x5e7dc1,'content':_0x9706ff,'timestamp':new Date()[_0x157fbe(0x151)]()}),_0x48c459['updatedAt']=new Date()[_0x157fbe(0x151)](),_0x362dba[_0x157fbe(0x113)](_0x5e7dc1,_0x362dba[_0x157fbe(0x122)])&&_0x362dba[_0x157fbe(0x113)](_0x48c459[_0x157fbe(0x14e)]['length'],0x1)&&(_0x48c459[_0x157fbe(0x11e)]=_0x362dba['XFBgK'](_0x9706ff[_0x157fbe(0x13b)](0x0,0x1e),_0x362dba[_0x157fbe(0x12c)](_0x9706ff[_0x157fbe(0x142)],0x1e)?_0x362dba[_0x157fbe(0x11f)]:'')),this[_0x157fbe(0x14b)](),!![];}[_0x294757(0x125)](){const _0x1d8d45=_0x294757;this[_0x1d8d45(0x10a)]['onConversationUpdate']['forEach'](_0x5b8f29=>_0x5b8f29(this[_0x1d8d45(0x141)]));}['notifyCurrentConversationChange'](){const _0x4e14af=_0x294757;this['listeners'][_0x4e14af(0x108)][_0x4e14af(0x14f)](_0x377f66=>_0x377f66(this[_0x4e14af(0x111)]()));}[_0x294757(0x110)](_0x581ce0,_0x58f772){const _0x4c3591=_0x294757;this[_0x4c3591(0x10a)][_0x581ce0]&&this[_0x4c3591(0x10a)][_0x581ce0][_0x4c3591(0x14c)](_0x58f772);}['removeEventListener'](_0x1decab,_0x3b0b7f){const _0x790eed=_0x294757;this['listeners'][_0x1decab]&&(this['listeners'][_0x1decab]=this[_0x790eed(0x10a)][_0x1decab][_0x790eed(0x144)](_0x5363c9=>_0x5363c9!==_0x3b0b7f));}}function _0x3844(){const _0x34e1e8=['parse','now','DENpG','conversations','length','JEllc','filter','kLsEr','Loaded\x20','MAX_CONVERSATIONS','4956876rbUHat','skuNa','fromEntries','saveConversations','push','toString','messages','forEach','Failed\x20to\x20load\x20conversations','toISOString','...','onCurrentConversationChange','wUVZc','listeners','cleanupStorage','6|2|0|4|3|5|1','values','258928nQzgQb','188400grphwQ','addEventListener','getCurrentConversation','keys','vcCPZ','2834936qQOBlr','New\x20Chat','getItem','MAX_STORAGE_SIZE','info','HNjBk','isArray','notifyCurrentConversationChange','IRvbP','createdAt','title','VENwN','addMessage','updatedAt','corHQ','577053PZZWiW','pop','notifyConversationUpdate','6045599TNvpar','2154738xAbMUg','220KCBekA','createNewConversation','qfWnH','sort','ObFby','currentConversationId','13eQHxVP','15UKjklO','\x20conversations','Storage\x20cleanup\x20initiated','map','Conversations\x20saved\x20successfully','user','setItem','Failed\x20to\x20save\x20conversations','Storage\x20cleanup\x20completed','loadConversations','DHFEc','stringify','slice','split','Trimmed\x20to\x20'];_0x3844=function(){return _0x34e1e8;};return _0x3844();}export{BaseConversationManager};