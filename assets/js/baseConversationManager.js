
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x50ee52=_0x1d20;(function(_0x4cb4eb,_0x5979da){const _0x124fdf=_0x1d20,_0x44c2d5=_0x4cb4eb();while(!![]){try{const _0x2ee8de=-parseInt(_0x124fdf(0x125))/0x1+parseInt(_0x124fdf(0x124))/0x2+-parseInt(_0x124fdf(0x10a))/0x3+-parseInt(_0x124fdf(0xff))/0x4*(parseInt(_0x124fdf(0x11e))/0x5)+-parseInt(_0x124fdf(0x118))/0x6+-parseInt(_0x124fdf(0x113))/0x7+parseInt(_0x124fdf(0x129))/0x8;if(_0x2ee8de===_0x5979da)break;else _0x44c2d5['push'](_0x44c2d5['shift']());}catch(_0xa09168){_0x44c2d5['push'](_0x44c2d5['shift']());}}}(_0x4a65,0x4e429));import{Logger}from'./common.js';class Conversation{constructor(_0x22d8cc,_0x39f1fe){const _0x49b4ce=_0x1d20,_0x26f6a1={'FMdMl':function(_0x1c2a5c,_0x918d5){return _0x1c2a5c||_0x918d5;},'iKert':_0x49b4ce(0x12b)};this['id']=_0x22d8cc,this[_0x49b4ce(0x10c)]=_0x26f6a1[_0x49b4ce(0xfe)](_0x39f1fe,_0x26f6a1[_0x49b4ce(0x12e)]),this[_0x49b4ce(0xec)]=[],this[_0x49b4ce(0x107)]=new Date()[_0x49b4ce(0x120)](),this[_0x49b4ce(0xed)]=new Date()['toISOString']();}}class BaseConversationManager{constructor(){const _0x3132fb=_0x1d20,_0x599a={'Zmfcp':_0x3132fb(0x109),'dwZQI':function(_0x5873b2,_0x28b1cc){return _0x5873b2*_0x28b1cc;}},_0x1333fa=_0x599a[_0x3132fb(0x116)][_0x3132fb(0xee)]('|');let _0x17aebc=0x0;while(!![]){switch(_0x1333fa[_0x17aebc++]){case'0':this[_0x3132fb(0x103)]=_0x599a['dwZQI'](4.5,0x400)*0x400;continue;case'1':this['conversations']={};continue;case'2':this[_0x3132fb(0xf2)]();continue;case'3':this[_0x3132fb(0x108)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'4':this['currentConversationId']=null;continue;case'5':this[_0x3132fb(0x114)]=0x32;continue;}break;}}[_0x50ee52(0xf2)](){const _0x2e337d=_0x50ee52,_0x48bfa5={'HgySL':_0x2e337d(0xf3),'vUTQp':_0x2e337d(0xf9)};try{const _0x4765d3=JSON[_0x2e337d(0x12f)](localStorage[_0x2e337d(0x106)](_0x48bfa5[_0x2e337d(0x127)]))||[];Array['isArray'](_0x4765d3)&&(this[_0x2e337d(0xf3)]=Object[_0x2e337d(0x10e)](_0x4765d3[_0x2e337d(0xf4)](_0x2ea8c1=>[_0x2ea8c1['id'],new Conversation(_0x2ea8c1['id'],_0x2ea8c1[_0x2e337d(0x10c)])]))),Logger['info']('Loaded\x20'+Object[_0x2e337d(0xf6)](this[_0x2e337d(0xf3)])[_0x2e337d(0x130)]+'\x20conversations');}catch(_0x138eb2){Logger['error'](_0x48bfa5[_0x2e337d(0x12a)],_0x138eb2),this[_0x2e337d(0xf3)]={};}}[_0x50ee52(0x111)](){const _0x20f4bb=_0x50ee52,_0x5c916f={'nYcsJ':function(_0x1a74ae,_0xfca18d){return _0x1a74ae>_0xfca18d;},'APAFs':_0x20f4bb(0xf3),'aMCYZ':'Conversations\x20saved\x20successfully'};try{let _0x2a33c0=JSON[_0x20f4bb(0x11a)](Object['values'](this[_0x20f4bb(0xf3)]));_0x5c916f['nYcsJ'](_0x2a33c0[_0x20f4bb(0x130)],this[_0x20f4bb(0x103)])&&this[_0x20f4bb(0x115)](),localStorage[_0x20f4bb(0x100)](_0x5c916f[_0x20f4bb(0xfa)],_0x2a33c0),this[_0x20f4bb(0x131)](),Logger[_0x20f4bb(0x128)](_0x5c916f[_0x20f4bb(0xfd)]);}catch(_0x4ca1bf){Logger[_0x20f4bb(0xf1)](_0x20f4bb(0x11b),_0x4ca1bf);}}[_0x50ee52(0x115)](){const _0x477a77=_0x50ee52,_0x4cd6df={'WBFRR':_0x477a77(0x11c),'xATWc':function(_0x12d835,_0x5c3fff){return _0x12d835>_0x5c3fff;}};Logger[_0x477a77(0x110)](_0x4cd6df[_0x477a77(0x117)]);let _0xa8fd4=Object[_0x477a77(0x104)](this['conversations'])[_0x477a77(0x119)]((_0x3f4610,_0xb43551)=>new Date(_0xb43551[_0x477a77(0xed)])-new Date(_0x3f4610[_0x477a77(0xed)]));_0x4cd6df[_0x477a77(0x12c)](_0xa8fd4[_0x477a77(0x130)],this[_0x477a77(0x114)])&&(_0xa8fd4=_0xa8fd4['slice'](0x0,this[_0x477a77(0x114)]),this['conversations']=Object[_0x477a77(0x10e)](_0xa8fd4[_0x477a77(0xf4)](_0x3c7b26=>[_0x3c7b26['id'],_0x3c7b26])),Logger[_0x477a77(0x128)]('Trimmed\x20to\x20'+this['MAX_CONVERSATIONS']+'\x20conversations'));let _0x35c4a9=JSON[_0x477a77(0x11a)](_0xa8fd4)[_0x477a77(0x130)];while(_0x4cd6df[_0x477a77(0x12c)](_0x35c4a9,this['MAX_STORAGE_SIZE'])&&_0x4cd6df[_0x477a77(0x12c)](_0xa8fd4[_0x477a77(0x130)],0x0)){const _0x1e4b23=_0xa8fd4[_0x477a77(0x101)]();delete this['conversations'][_0x1e4b23['id']],_0x35c4a9=JSON['stringify'](Object[_0x477a77(0x104)](this[_0x477a77(0xf3)]))['length'];}Logger[_0x477a77(0x128)]('Storage\x20cleanup\x20completed');}[_0x50ee52(0x105)](_0xc43fc6='New\x20Chat'){const _0x406afa=_0x50ee52,_0x23c1d5=Date['now']()[_0x406afa(0x102)]();return this[_0x406afa(0xf3)][_0x23c1d5]=new Conversation(_0x23c1d5,_0xc43fc6),this[_0x406afa(0x112)]=_0x23c1d5,this[_0x406afa(0x111)](),this[_0x406afa(0x133)](),_0x23c1d5;}['deleteConversation'](_0x101217){const _0x42b8e2=_0x50ee52,_0x443e8a={'UQgcE':function(_0x3269fd,_0x353a99){return _0x3269fd===_0x353a99;}};this['conversations'][_0x101217]&&(delete this[_0x42b8e2(0xf3)][_0x101217],_0x443e8a[_0x42b8e2(0x11f)](this['currentConversationId'],_0x101217)&&(this['currentConversationId']=null,this[_0x42b8e2(0x105)]()),this['saveConversations']());}[_0x50ee52(0x121)](_0xbdb2e1){const _0x1408d9=_0x50ee52;if(this['conversations'][_0xbdb2e1])return this[_0x1408d9(0x112)]=_0xbdb2e1,this[_0x1408d9(0x133)](),!![];return![];}[_0x50ee52(0x126)](){const _0x5bba86=_0x50ee52;return this[_0x5bba86(0xf3)][this[_0x5bba86(0x112)]]||null;}['addMessage'](_0x3fb0f9,_0xb8cf65){const _0x392dad=_0x50ee52,_0x4d47f1={'EtZgc':function(_0x26de24,_0x302f69){return _0x26de24===_0x302f69;},'jMcRu':_0x392dad(0xf8),'uKCbU':function(_0x2165e0,_0x2cce12){return _0x2165e0===_0x2cce12;},'CjlPS':function(_0x35dc06,_0x160a12){return _0x35dc06+_0x160a12;},'eHRpU':function(_0x2b2dd0,_0x232afe){return _0x2b2dd0>_0x232afe;},'HQilh':_0x392dad(0xf5)},_0x12bc80=this['getCurrentConversation']();if(!_0x12bc80)return![];return _0x12bc80['messages'][_0x392dad(0xf7)]({'role':_0xb8cf65,'content':_0x3fb0f9,'timestamp':new Date()[_0x392dad(0x120)]()}),_0x12bc80[_0x392dad(0xed)]=new Date()[_0x392dad(0x120)](),_0x4d47f1[_0x392dad(0xf0)](_0xb8cf65,_0x4d47f1[_0x392dad(0x123)])&&_0x4d47f1['uKCbU'](_0x12bc80[_0x392dad(0xec)][_0x392dad(0x130)],0x1)&&(_0x12bc80['title']=_0x4d47f1[_0x392dad(0x122)](_0x3fb0f9[_0x392dad(0x10d)](0x0,0x1e),_0x4d47f1[_0x392dad(0xfb)](_0x3fb0f9[_0x392dad(0x130)],0x1e)?_0x4d47f1[_0x392dad(0xef)]:'')),this['saveConversations'](),!![];}[_0x50ee52(0x131)](){const _0x29775c=_0x50ee52;this[_0x29775c(0x108)][_0x29775c(0xfc)][_0x29775c(0x11d)](_0xe9ff00=>_0xe9ff00(this[_0x29775c(0xf3)]));}[_0x50ee52(0x133)](){const _0x4e6b00=_0x50ee52;this[_0x4e6b00(0x108)][_0x4e6b00(0x132)][_0x4e6b00(0x11d)](_0x2ada92=>_0x2ada92(this[_0x4e6b00(0x126)]()));}[_0x50ee52(0x12d)](_0x494c82,_0x2912f8){const _0x2192a3=_0x50ee52;this[_0x2192a3(0x108)][_0x494c82]&&this[_0x2192a3(0x108)][_0x494c82][_0x2192a3(0xf7)](_0x2912f8);}[_0x50ee52(0x10b)](_0x11ac15,_0x2d1a00){const _0x387895=_0x50ee52;this[_0x387895(0x108)][_0x11ac15]&&(this[_0x387895(0x108)][_0x11ac15]=this[_0x387895(0x108)][_0x11ac15][_0x387895(0x10f)](_0x3ac8cb=>_0x3ac8cb!==_0x2d1a00));}}function _0x1d20(_0x4d9e9f,_0x2cc1cb){const _0x4a653c=_0x4a65();return _0x1d20=function(_0x1d20fd,_0x1c430d){_0x1d20fd=_0x1d20fd-0xec;let _0x547583=_0x4a653c[_0x1d20fd];return _0x547583;},_0x1d20(_0x4d9e9f,_0x2cc1cb);}function _0x4a65(){const _0x2f05a6=['1|4|3|0|5|2','249759QybCpz','removeEventListener','title','slice','fromEntries','filter','warn','saveConversations','currentConversationId','4208974Stxsnu','MAX_CONVERSATIONS','cleanupStorage','Zmfcp','WBFRR','732786IKimkx','sort','stringify','Failed\x20to\x20save\x20conversations','Storage\x20cleanup\x20initiated','forEach','3070975GtBILT','UQgcE','toISOString','switchConversation','CjlPS','jMcRu','768336rLaqbO','626858jhgCiB','getCurrentConversation','HgySL','info','15872832PHeNNK','vUTQp','New\x20Chat','xATWc','addEventListener','iKert','parse','length','notifyConversationUpdate','onCurrentConversationChange','notifyCurrentConversationChange','messages','updatedAt','split','HQilh','EtZgc','error','loadConversations','conversations','map','...','keys','push','user','Failed\x20to\x20load\x20conversations','APAFs','eHRpU','onConversationUpdate','aMCYZ','FMdMl','4ppWTLp','setItem','pop','toString','MAX_STORAGE_SIZE','values','createNewConversation','getItem','createdAt','listeners'];_0x4a65=function(){return _0x2f05a6;};return _0x4a65();}export{BaseConversationManager};