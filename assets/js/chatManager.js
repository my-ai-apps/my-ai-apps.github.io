
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x50126f=_0x5172;function _0x36c7(){const _0x56adef=['Storage\x20cleanup\x20completed','eCnVf','4|2|0|3|1','onConversationUpdate','9966006DenfaB','4128177LLtOcg','currentConversationId','10cmxHHI','updatedAt','MAX_CONVERSATIONS','Uxnas','onCurrentConversationChange','cleanupStorage','onError','\x20most\x20recent\x20conversations','Failed\x20to\x20load\x20conversations','5568965pwtqlP','info','notifyError','title','4zBwMIA','forEach','length','warn','7303568RwLNTK','jaUAl','KlZEG','listeners','slice','loadConversations','push','messages','Storage\x20cleanup\x20initiated','saveConversations','638861NSnsOy','toISOString','stringify','jiHJH','notifyConversationUpdate','reduce','aEwLB','getCurrentConversation','notifyCurrentConversationChange','Loaded\x20','New\x20Conversation','LUhSk','MAX_STORAGE_SIZE','\x20conversations','error','values','createNewConversation','7207569jENaWn','switchConversation','addEventListener','WOCjy','parse','getItem','NzbHn','keys','conversations','gqPXg','yHAWg','5995766BfATCR','getSortedConversations','removeEventListener','createdAt','split','2|5|4|1|3|0','filter','...','4qwYNoE','now','ilStz','Auzer','pop','user'];_0x36c7=function(){return _0x56adef;};return _0x36c7();}(function(_0x597bf6,_0x5b58e4){const _0x5909d6=_0x5172,_0xf3f2a3=_0x597bf6();while(!![]){try{const _0x40b245=parseInt(_0x5909d6(0x213))/0x1*(parseInt(_0x5909d6(0x205))/0x2)+-parseInt(_0x5909d6(0x1f6))/0x3*(-parseInt(_0x5909d6(0x1eb))/0x4)+-parseInt(_0x5909d6(0x201))/0x5+-parseInt(_0x5909d6(0x1f5))/0x6+parseInt(_0x5909d6(0x1e3))/0x7+parseInt(_0x5909d6(0x209))/0x8+-parseInt(_0x5909d6(0x1d8))/0x9*(parseInt(_0x5909d6(0x1f8))/0xa);if(_0x40b245===_0x5b58e4)break;else _0xf3f2a3['push'](_0xf3f2a3['shift']());}catch(_0x329538){_0xf3f2a3['push'](_0xf3f2a3['shift']());}}}(_0x36c7,0xcef0e));import{Logger}from'./common.js';class Conversation{constructor(_0x50b0d2,_0x1092f3){const _0x1628fa=_0x5172;this['id']=_0x50b0d2,this[_0x1628fa(0x204)]=_0x1092f3,this[_0x1628fa(0x210)]=[],this[_0x1628fa(0x1e6)]=new Date()[_0x1628fa(0x214)](),this['updatedAt']=new Date()[_0x1628fa(0x214)]();}}class ChatManager{constructor(){const _0x1e7cfc=_0x5172,_0x550e8e={'LUhSk':_0x1e7cfc(0x1e8),'LifLA':function(_0x8b8a78,_0x1de585){return _0x8b8a78*_0x1de585;}},_0x1e2d38=_0x550e8e[_0x1e7cfc(0x1d2)][_0x1e7cfc(0x1e7)]('|');let _0x2bb180=0x0;while(!![]){switch(_0x1e2d38[_0x2bb180++]){case'0':this[_0x1e7cfc(0x20e)]();continue;case'1':this[_0x1e7cfc(0x1d3)]=_0x550e8e['LifLA'](4.5*0x400,0x400);continue;case'2':this[_0x1e7cfc(0x1e0)]={};continue;case'3':this[_0x1e7cfc(0x1fa)]=0x32;continue;case'4':this[_0x1e7cfc(0x20c)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'5':this[_0x1e7cfc(0x1f7)]=null;continue;}break;}}async[_0x50126f(0x20e)](){const _0x529102=_0x50126f,_0x4a3a67={'gqPXg':'conversations','jaUAl':function(_0xd5b72f,_0x4ff408){return _0xd5b72f>_0x4ff408;},'tgLST':_0x529102(0x200)};try{const _0x137117=localStorage[_0x529102(0x1dd)](_0x4a3a67[_0x529102(0x1e1)]);if(_0x137117){const _0x5eb934=JSON[_0x529102(0x1dc)](_0x137117)||[];this['conversations']=_0x5eb934[_0x529102(0x1cc)]((_0x4762b8,_0x367a68)=>{const _0x4dc6c8=_0x529102,_0x15ffeb=_0x4dc6c8(0x1f3)[_0x4dc6c8(0x1e7)]('|');let _0xceab41=0x0;while(!![]){switch(_0x15ffeb[_0xceab41++]){case'0':_0x4762b8[_0x367a68['id']][_0x4dc6c8(0x1e6)]=_0x367a68['createdAt'];continue;case'1':return _0x4762b8;case'2':_0x4762b8[_0x367a68['id']][_0x4dc6c8(0x210)]=_0x367a68[_0x4dc6c8(0x210)]||[];continue;case'3':_0x4762b8[_0x367a68['id']][_0x4dc6c8(0x1f9)]=_0x367a68['updatedAt'];continue;case'4':_0x4762b8[_0x367a68['id']]=new Conversation(_0x367a68['id'],_0x367a68[_0x4dc6c8(0x204)]);continue;}break;}},{}),_0x4a3a67[_0x529102(0x20a)](Object[_0x529102(0x1df)](this[_0x529102(0x1e0)])['length'],0x0)&&(this[_0x529102(0x1f7)]=Object['keys'](this[_0x529102(0x1e0)])[0x0]),Logger[_0x529102(0x202)](_0x529102(0x1d0)+Object[_0x529102(0x1df)](this[_0x529102(0x1e0)])[_0x529102(0x207)]+_0x529102(0x1d4));}}catch(_0x59d0b8){const _0x404035=Logger['error'](_0x4a3a67['tgLST'],_0x59d0b8);this[_0x529102(0x203)](_0x404035),this[_0x529102(0x1e0)]={};}}async[_0x50126f(0x212)](){const _0x5548c9=_0x50126f,_0x54c403={'Uxnas':function(_0x3357cb,_0x557fa7){return _0x3357cb>_0x557fa7;},'KlZEG':'Conversations\x20saved\x20successfully','jiHJH':'Failed\x20to\x20save\x20conversations'};try{const _0x111d56=JSON[_0x5548c9(0x215)](Object[_0x5548c9(0x1d6)](this[_0x5548c9(0x1e0)]));_0x54c403[_0x5548c9(0x1fb)](_0x111d56['length'],this[_0x5548c9(0x1d3)])&&await this['cleanupStorage'](),localStorage['setItem'](_0x5548c9(0x1e0),_0x111d56),this[_0x5548c9(0x217)](),Logger[_0x5548c9(0x202)](_0x54c403[_0x5548c9(0x20b)]);}catch(_0x52a97e){const _0x19cd32=Logger[_0x5548c9(0x1d5)](_0x54c403[_0x5548c9(0x216)],_0x52a97e);this[_0x5548c9(0x203)](_0x19cd32);}}async[_0x50126f(0x1fd)](){const _0xf27435=_0x50126f,_0x6953dc={'Auzer':_0xf27435(0x211),'NzbHn':function(_0x3ad79c,_0x175be2){return _0x3ad79c>_0x175be2;},'yHAWg':_0xf27435(0x1f1)};Logger[_0xf27435(0x208)](_0x6953dc[_0xf27435(0x1ee)]);const _0x24f01e=this[_0xf27435(0x1e4)]();_0x6953dc[_0xf27435(0x1de)](_0x24f01e[_0xf27435(0x207)],this[_0xf27435(0x1fa)])&&(this['conversations']=_0x24f01e['slice'](0x0,this['MAX_CONVERSATIONS'])[_0xf27435(0x1cc)]((_0x5db65e,_0x2f3564)=>{return _0x5db65e[_0x2f3564['id']]=_0x2f3564,_0x5db65e;},{}),Logger[_0xf27435(0x202)]('Trimmed\x20to\x20'+this[_0xf27435(0x1fa)]+_0xf27435(0x1ff)));let _0x52a1bf=JSON['stringify'](Object['values'](this[_0xf27435(0x1e0)]))[_0xf27435(0x207)];while(_0x6953dc[_0xf27435(0x1de)](_0x52a1bf,this[_0xf27435(0x1d3)])&&Object['keys'](this['conversations'])[_0xf27435(0x207)]>0x0){const _0xb4657d=_0x24f01e[_0xf27435(0x1ef)]();_0xb4657d[_0xf27435(0x210)]['length']>0xa?_0xb4657d[_0xf27435(0x210)]=_0xb4657d[_0xf27435(0x210)]['slice'](-0xa):delete this['conversations'][_0xb4657d['id']],_0x52a1bf=JSON['stringify'](Object[_0xf27435(0x1d6)](this[_0xf27435(0x1e0)]))[_0xf27435(0x207)];}Logger[_0xf27435(0x202)](_0x6953dc[_0xf27435(0x1e2)]);}async[_0x50126f(0x1d7)](_0x10c010=_0x50126f(0x1d1)){const _0x3bdde8=_0x50126f,_0xcda687='conv_'+Date[_0x3bdde8(0x1ec)](),_0x272203=new Conversation(_0xcda687,_0x10c010);return this[_0x3bdde8(0x1e0)][_0xcda687]=_0x272203,this[_0x3bdde8(0x1f7)]=_0xcda687,await this[_0x3bdde8(0x212)](),this[_0x3bdde8(0x1cf)](),_0xcda687;}[_0x50126f(0x1ce)](){return this['conversations'][this['currentConversationId']]||null;}async['addMessage'](_0x451ddb,_0x103573){const _0x56ba32=_0x50126f,_0x4ce093={'WOCjy':function(_0x3eec23,_0x10ce4a){return _0x3eec23===_0x10ce4a;},'eCnVf':_0x56ba32(0x1f0),'ilStz':function(_0x2eaa73,_0x2aaf47){return _0x2eaa73===_0x2aaf47;},'aEwLB':function(_0x2841ff,_0x36ad7e){return _0x2841ff+_0x36ad7e;}},_0x16a1d2=this[_0x56ba32(0x1ce)]();if(!_0x16a1d2)return![];const _0x4f6387={'role':_0x103573,'content':_0x451ddb,'timestamp':new Date()[_0x56ba32(0x214)]()};return _0x16a1d2[_0x56ba32(0x210)][_0x56ba32(0x20f)](_0x4f6387),_0x16a1d2[_0x56ba32(0x1f9)]=new Date()['toISOString'](),_0x4ce093[_0x56ba32(0x1db)](_0x103573,_0x4ce093[_0x56ba32(0x1f2)])&&_0x4ce093[_0x56ba32(0x1db)](_0x16a1d2['title'],_0x56ba32(0x1d1))&&_0x4ce093[_0x56ba32(0x1ed)](_0x16a1d2[_0x56ba32(0x210)][_0x56ba32(0x207)],0x1)&&(_0x16a1d2['title']=_0x4ce093[_0x56ba32(0x1cd)](_0x451ddb[_0x56ba32(0x1e7)]('\x20')[_0x56ba32(0x20d)](0x0,0x4)['join']('\x20'),_0x56ba32(0x1ea))),await this[_0x56ba32(0x212)](),!![];}async['deleteConversation'](_0x2f8e59){const _0x39aa6a=_0x50126f;this[_0x39aa6a(0x1e0)][_0x2f8e59]&&(delete this['conversations'][_0x2f8e59],this[_0x39aa6a(0x1f7)]===_0x2f8e59&&(this['currentConversationId']=Object[_0x39aa6a(0x1df)](this[_0x39aa6a(0x1e0)])[0x0]||null),await this['saveConversations']());}[_0x50126f(0x1d9)](_0x4857d7){const _0x441b9a=_0x50126f;if(this[_0x441b9a(0x1e0)][_0x4857d7])return this['currentConversationId']=_0x4857d7,this[_0x441b9a(0x1cf)](),!![];return![];}[_0x50126f(0x1e4)](){const _0x5396b2=_0x50126f;return Object['values'](this['conversations'])['sort']((_0x3422ab,_0x41f546)=>new Date(_0x41f546[_0x5396b2(0x1f9)])-new Date(_0x3422ab['updatedAt']));}[_0x50126f(0x217)](){const _0x1fb238=_0x50126f;this[_0x1fb238(0x20c)][_0x1fb238(0x1f4)]['forEach'](_0xef2a86=>_0xef2a86(Object[_0x1fb238(0x1d6)](this[_0x1fb238(0x1e0)])));}['notifyCurrentConversationChange'](){const _0x5d09af=_0x50126f;this['listeners'][_0x5d09af(0x1fc)]['forEach'](_0x5af4d8=>_0x5af4d8(this[_0x5d09af(0x1ce)]()));}[_0x50126f(0x203)](_0x1bf8f2){const _0xba1e16=_0x50126f;this[_0xba1e16(0x20c)][_0xba1e16(0x1fe)][_0xba1e16(0x206)](_0x4db566=>_0x4db566(_0x1bf8f2));}[_0x50126f(0x1da)](_0x5d649d,_0xda9477){const _0x479e30=_0x50126f;this[_0x479e30(0x20c)][_0x5d649d]&&this[_0x479e30(0x20c)][_0x5d649d][_0x479e30(0x20f)](_0xda9477);}[_0x50126f(0x1e5)](_0x52ef87,_0x2bc8c7){const _0x3fef68=_0x50126f;this[_0x3fef68(0x20c)][_0x52ef87]&&(this['listeners'][_0x52ef87]=this[_0x3fef68(0x20c)][_0x52ef87][_0x3fef68(0x1e9)](_0x2f0252=>_0x2f0252!==_0x2bc8c7));}}function _0x5172(_0x3c70f8,_0x86871f){const _0x36c75a=_0x36c7();return _0x5172=function(_0x5172fa,_0x12f2d3){_0x5172fa=_0x5172fa-0x1cc;let _0x589686=_0x36c75a[_0x5172fa];return _0x589686;},_0x5172(_0x3c70f8,_0x86871f);}export{ChatManager};