
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x213812=_0x3dd1;function _0x3dd1(_0x56aad0,_0x6a2e5a){const _0x36064a=_0x3606();return _0x3dd1=function(_0x3dd148,_0x3312f9){_0x3dd148=_0x3dd148-0x72;let _0x47f4e5=_0x36064a[_0x3dd148];return _0x47f4e5;},_0x3dd1(_0x56aad0,_0x6a2e5a);}(function(_0x4f9c97,_0x2a448d){const _0x55fb02=_0x3dd1,_0x55509f=_0x4f9c97();while(!![]){try{const _0x8f4173=parseInt(_0x55fb02(0x84))/0x1+parseInt(_0x55fb02(0x83))/0x2+-parseInt(_0x55fb02(0xab))/0x3+parseInt(_0x55fb02(0x7a))/0x4+-parseInt(_0x55fb02(0x7e))/0x5*(parseInt(_0x55fb02(0xad))/0x6)+parseInt(_0x55fb02(0x75))/0x7+parseInt(_0x55fb02(0xbb))/0x8*(-parseInt(_0x55fb02(0x94))/0x9);if(_0x8f4173===_0x2a448d)break;else _0x55509f['push'](_0x55509f['shift']());}catch(_0x2cb56a){_0x55509f['push'](_0x55509f['shift']());}}}(_0x3606,0xd6958));import{Logger}from'./common.js';class Conversation{constructor(_0x2be16a,_0x5523c4){const _0x1370b4=_0x3dd1,_0x49e27d={'fboXY':_0x1370b4(0x77)},_0x512917=_0x49e27d[_0x1370b4(0x8d)]['split']('|');let _0x9934e1=0x0;while(!![]){switch(_0x512917[_0x9934e1++]){case'0':this['updatedAt']=new Date()[_0x1370b4(0x9c)]();continue;case'1':this[_0x1370b4(0xa4)]=_0x5523c4;continue;case'2':this['createdAt']=new Date()['toISOString']();continue;case'3':this[_0x1370b4(0xb6)]=[];continue;case'4':this['id']=_0x2be16a;continue;}break;}}}class ChatManager{constructor(){const _0x3d4a63=_0x3dd1,_0x1c30e2={'zzjXU':function(_0x59172c,_0x47dcc1){return _0x59172c*_0x47dcc1;},'jywaR':function(_0x9d43b3,_0x4bbd23){return _0x9d43b3*_0x4bbd23;}};this[_0x3d4a63(0x9a)]={},this['currentConversationId']=null,this[_0x3d4a63(0xb0)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]},this['MAX_STORAGE_SIZE']=_0x1c30e2['zzjXU'](_0x1c30e2[_0x3d4a63(0xaa)](4.5,0x400),0x400),this[_0x3d4a63(0xb9)]=0x32,this[_0x3d4a63(0x93)]();}async['loadConversations'](){const _0x233dc9=_0x3dd1,_0x1432d2={'zyyYu':_0x233dc9(0x8c),'PNFSK':_0x233dc9(0x9a),'AnkEL':function(_0x57b0d7,_0x5bac27){return _0x57b0d7>_0x5bac27;},'sOwhw':_0x233dc9(0x8b)};try{const _0x5c2d1e=localStorage[_0x233dc9(0xba)](_0x1432d2['PNFSK']);if(_0x5c2d1e){const _0x4c822b=JSON[_0x233dc9(0xb1)](_0x5c2d1e)||[];this['conversations']=_0x4c822b[_0x233dc9(0x79)]((_0x580358,_0x1d5a8c)=>{const _0xaa1b7a=_0x233dc9,_0x214534=_0x1432d2[_0xaa1b7a(0x73)][_0xaa1b7a(0x80)]('|');let _0x45068c=0x0;while(!![]){switch(_0x214534[_0x45068c++]){case'0':return _0x580358;case'1':_0x580358[_0x1d5a8c['id']][_0xaa1b7a(0xb6)]=_0x1d5a8c[_0xaa1b7a(0xb6)]||[];continue;case'2':_0x580358[_0x1d5a8c['id']]=new Conversation(_0x1d5a8c['id'],_0x1d5a8c[_0xaa1b7a(0xa4)]);continue;case'3':_0x580358[_0x1d5a8c['id']][_0xaa1b7a(0x88)]=_0x1d5a8c[_0xaa1b7a(0x88)];continue;case'4':_0x580358[_0x1d5a8c['id']]['updatedAt']=_0x1d5a8c[_0xaa1b7a(0x7c)];continue;}break;}},{}),_0x1432d2[_0x233dc9(0x95)](Object['keys'](this['conversations'])[_0x233dc9(0x91)],0x0)&&(this['currentConversationId']=Object[_0x233dc9(0x87)](this['conversations'])[0x0]),Logger['info']('Loaded\x20'+Object['keys'](this[_0x233dc9(0x9a)])[_0x233dc9(0x91)]+_0x233dc9(0xa9));}}catch(_0x21dae3){const _0x29785a=Logger['error'](_0x1432d2[_0x233dc9(0x90)],_0x21dae3);this[_0x233dc9(0x9e)](_0x29785a),this[_0x233dc9(0x9a)]={};}}async['saveConversations'](){const _0x153c8c=_0x3dd1,_0x268d57={'CZolG':function(_0x1648dc,_0x4a95cc){return _0x1648dc>_0x4a95cc;},'RwtWb':'Conversations\x20saved\x20successfully','DVFkL':'Failed\x20to\x20save\x20conversations'};try{const _0x3ee55b=JSON[_0x153c8c(0x98)](Object[_0x153c8c(0xa2)](this[_0x153c8c(0x9a)]));_0x268d57[_0x153c8c(0x86)](_0x3ee55b[_0x153c8c(0x91)],this[_0x153c8c(0x9f)])&&await this[_0x153c8c(0x74)](),localStorage[_0x153c8c(0x96)](_0x153c8c(0x9a),_0x3ee55b),this[_0x153c8c(0xac)](),Logger[_0x153c8c(0x78)](_0x268d57[_0x153c8c(0xa5)]);}catch(_0x148e94){const _0x5dc0d6=Logger['error'](_0x268d57[_0x153c8c(0xb4)],_0x148e94);this[_0x153c8c(0x9e)](_0x5dc0d6);}}async[_0x213812(0x74)](){const _0x80111=_0x213812,_0x476240={'BiCDT':function(_0x265ca6,_0x455bc5){return _0x265ca6>_0x455bc5;}};Logger[_0x80111(0xb8)]('Storage\x20cleanup\x20initiated');const _0x4ffd97=this[_0x80111(0x7d)]();_0x476240[_0x80111(0xb7)](_0x4ffd97[_0x80111(0x91)],this[_0x80111(0xb9)])&&(this[_0x80111(0x9a)]=_0x4ffd97['slice'](0x0,this[_0x80111(0xb9)])['reduce']((_0x4e9e69,_0x2d5ae7)=>{return _0x4e9e69[_0x2d5ae7['id']]=_0x2d5ae7,_0x4e9e69;},{}),Logger[_0x80111(0x78)](_0x80111(0xae)+this[_0x80111(0xb9)]+'\x20most\x20recent\x20conversations'));let _0x168e75=JSON[_0x80111(0x98)](Object[_0x80111(0xa2)](this[_0x80111(0x9a)]))[_0x80111(0x91)];while(_0x476240[_0x80111(0xb7)](_0x168e75,this[_0x80111(0x9f)])&&_0x476240[_0x80111(0xb7)](Object[_0x80111(0x87)](this[_0x80111(0x9a)])[_0x80111(0x91)],0x0)){const _0xe4865a=_0x4ffd97[_0x80111(0x8e)]();_0xe4865a[_0x80111(0xb6)]['length']>0xa?_0xe4865a[_0x80111(0xb6)]=_0xe4865a[_0x80111(0xb6)][_0x80111(0x92)](-0xa):delete this[_0x80111(0x9a)][_0xe4865a['id']],_0x168e75=JSON['stringify'](Object[_0x80111(0xa2)](this[_0x80111(0x9a)]))[_0x80111(0x91)];}Logger[_0x80111(0x78)]('Storage\x20cleanup\x20completed');}async['createNewConversation'](_0x3dd17f=_0x213812(0x97)){const _0x3126ca=_0x213812,_0x26120b=_0x3126ca(0x9b)+Date[_0x3126ca(0xa1)](),_0x40ef7a=new Conversation(_0x26120b,_0x3dd17f);return this[_0x3126ca(0x9a)][_0x26120b]=_0x40ef7a,this[_0x3126ca(0xa6)]=_0x26120b,await this[_0x3126ca(0xa3)](),this[_0x3126ca(0x7f)](),_0x26120b;}['getCurrentConversation'](){const _0x24b8ed=_0x213812;return this['conversations'][this[_0x24b8ed(0xa6)]]||null;}async[_0x213812(0xa7)](_0x241cce,_0x12d581){const _0x37b5c4=_0x213812,_0x4faba4={'GodZO':function(_0x1d58fd,_0xf33841){return _0x1d58fd===_0xf33841;},'aOoUf':_0x37b5c4(0x97),'ohRZD':function(_0x9c9adc,_0x4897d9){return _0x9c9adc+_0x4897d9;},'dkdDc':_0x37b5c4(0x85)},_0xc5b8a4=this[_0x37b5c4(0x82)]();if(!_0xc5b8a4)return![];const _0x56bbcd={'role':_0x12d581,'content':_0x241cce,'timestamp':new Date()['toISOString']()};return _0xc5b8a4[_0x37b5c4(0xb6)]['push'](_0x56bbcd),_0xc5b8a4[_0x37b5c4(0x7c)]=new Date()[_0x37b5c4(0x9c)](),_0x4faba4[_0x37b5c4(0x72)](_0x12d581,_0x37b5c4(0x7b))&&_0x4faba4[_0x37b5c4(0x72)](_0xc5b8a4['title'],_0x4faba4['aOoUf'])&&_0x4faba4[_0x37b5c4(0x72)](_0xc5b8a4[_0x37b5c4(0xb6)]['length'],0x1)&&(_0xc5b8a4[_0x37b5c4(0xa4)]=_0x4faba4[_0x37b5c4(0xa0)](_0x241cce[_0x37b5c4(0x80)]('\x20')['slice'](0x0,0x4)[_0x37b5c4(0x99)]('\x20'),_0x4faba4[_0x37b5c4(0x9d)])),await this[_0x37b5c4(0xa3)](),!![];}async[_0x213812(0x76)](_0x1b647f){const _0x153545=_0x213812,_0x9915b2={'sFJlP':function(_0x5a694c,_0x46bc2d){return _0x5a694c===_0x46bc2d;}};this[_0x153545(0x9a)][_0x1b647f]&&(delete this[_0x153545(0x9a)][_0x1b647f],_0x9915b2[_0x153545(0x89)](this['currentConversationId'],_0x1b647f)&&(this[_0x153545(0xa6)]=Object[_0x153545(0x87)](this['conversations'])[0x0]||null),await this['saveConversations']());}[_0x213812(0xb5)](_0xc260db){const _0x4cee7a=_0x213812;if(this[_0x4cee7a(0x9a)][_0xc260db])return this['currentConversationId']=_0xc260db,this['notifyCurrentConversationChange'](),!![];return![];}[_0x213812(0x7d)](){const _0x4e0524=_0x213812;return Object[_0x4e0524(0xa2)](this[_0x4e0524(0x9a)])[_0x4e0524(0x8f)]((_0x1d541e,_0x3935b7)=>new Date(_0x3935b7[_0x4e0524(0x7c)])-new Date(_0x1d541e[_0x4e0524(0x7c)]));}[_0x213812(0xac)](){const _0xfd0868=_0x213812;this[_0xfd0868(0xb0)][_0xfd0868(0x81)][_0xfd0868(0xb3)](_0xdf5a53=>_0xdf5a53(Object[_0xfd0868(0xa2)](this['conversations'])));}[_0x213812(0x7f)](){const _0x3a270d=_0x213812;this[_0x3a270d(0xb0)]['onCurrentConversationChange'][_0x3a270d(0xb3)](_0x4c648a=>_0x4c648a(this[_0x3a270d(0x82)]()));}['notifyError'](_0x4f3ce4){const _0x2d6c2c=_0x213812;this[_0x2d6c2c(0xb0)][_0x2d6c2c(0xb2)][_0x2d6c2c(0xb3)](_0x5a0e1f=>_0x5a0e1f(_0x4f3ce4));}[_0x213812(0xaf)](_0xd0f964,_0x29d101){const _0x5120a2=_0x213812;this['listeners'][_0xd0f964]&&this[_0x5120a2(0xb0)][_0xd0f964][_0x5120a2(0xa8)](_0x29d101);}['removeEventListener'](_0x39ffee,_0x3e79ba){const _0x8c71ce=_0x213812;this[_0x8c71ce(0xb0)][_0x39ffee]&&(this[_0x8c71ce(0xb0)][_0x39ffee]=this[_0x8c71ce(0xb0)][_0x39ffee][_0x8c71ce(0x8a)](_0x36c181=>_0x36c181!==_0x3e79ba));}}export{ChatManager};function _0x3606(){const _0x1fdbdc=['512248eAOfnK','GodZO','zyyYu','cleanupStorage','7659582REthoQ','deleteConversation','4|1|3|2|0','info','reduce','6480388EXFltm','user','updatedAt','getSortedConversations','268865AuftJM','notifyCurrentConversationChange','split','onConversationUpdate','getCurrentConversation','3274628SfjRqy','967995JAqWEQ','...','CZolG','keys','createdAt','sFJlP','filter','Failed\x20to\x20load\x20conversations','2|1|3|4|0','fboXY','pop','sort','sOwhw','length','slice','loadConversations','378cSkwpI','AnkEL','setItem','New\x20Conversation','stringify','join','conversations','conv_','toISOString','dkdDc','notifyError','MAX_STORAGE_SIZE','ohRZD','now','values','saveConversations','title','RwtWb','currentConversationId','addMessage','push','\x20conversations','jywaR','3640992xKnRaK','notifyConversationUpdate','60kVTSwa','Trimmed\x20to\x20','addEventListener','listeners','parse','onError','forEach','DVFkL','switchConversation','messages','BiCDT','warn','MAX_CONVERSATIONS','getItem'];_0x3606=function(){return _0x1fdbdc;};return _0x3606();}