
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x5c2e(_0x4043a5,_0x367c4a){const _0x179517=_0x1795();return _0x5c2e=function(_0x5c2e23,_0x42d5c5){_0x5c2e23=_0x5c2e23-0xdb;let _0x5e1b7d=_0x179517[_0x5c2e23];return _0x5e1b7d;},_0x5c2e(_0x4043a5,_0x367c4a);}const _0x58eb20=_0x5c2e;(function(_0x42a1d8,_0x4b0740){const _0x4b8b0c=_0x5c2e,_0x1e416a=_0x42a1d8();while(!![]){try{const _0x21e393=-parseInt(_0x4b8b0c(0x115))/0x1+-parseInt(_0x4b8b0c(0x124))/0x2*(parseInt(_0x4b8b0c(0xec))/0x3)+-parseInt(_0x4b8b0c(0x11f))/0x4+-parseInt(_0x4b8b0c(0x11b))/0x5*(parseInt(_0x4b8b0c(0xe9))/0x6)+parseInt(_0x4b8b0c(0xe0))/0x7*(-parseInt(_0x4b8b0c(0xfc))/0x8)+parseInt(_0x4b8b0c(0x125))/0x9+-parseInt(_0x4b8b0c(0xe8))/0xa*(-parseInt(_0x4b8b0c(0xfb))/0xb);if(_0x21e393===_0x4b0740)break;else _0x1e416a['push'](_0x1e416a['shift']());}catch(_0x111e0e){_0x1e416a['push'](_0x1e416a['shift']());}}}(_0x1795,0xe2b62));import{Logger}from'./common.js';class Conversation{constructor(_0x224b9a,_0x4d8f29){const _0x39e663=_0x5c2e,_0x32d178={'tAnfF':_0x39e663(0xf7)},_0x2b87b4=_0x32d178[_0x39e663(0x103)][_0x39e663(0x108)]('|');let _0x150bad=0x0;while(!![]){switch(_0x2b87b4[_0x150bad++]){case'0':this[_0x39e663(0x106)]=new Date()[_0x39e663(0xf8)]();continue;case'1':this[_0x39e663(0x11a)]=_0x4d8f29;continue;case'2':this['id']=_0x224b9a;continue;case'3':this['messages']=[];continue;case'4':this[_0x39e663(0xdc)]=new Date()['toISOString']();continue;}break;}}}class ChatManager{constructor(){const _0x3712d0=_0x5c2e,_0xf08a7a={'IRsSx':function(_0x58a5f1,_0x320b8a){return _0x58a5f1*_0x320b8a;}};this['conversations']={},this[_0x3712d0(0x10f)]=null,this[_0x3712d0(0x102)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]},this[_0x3712d0(0xe2)]=_0xf08a7a[_0x3712d0(0xe7)](4.5*0x400,0x400),this['MAX_CONVERSATIONS']=0x32,this['loadConversations']();}async['loadConversations'](){const _0x482c59=_0x5c2e,_0x4dec1d={'YYlvH':'conversations','uWPxe':function(_0x4ce9e6,_0x1eb6fd){return _0x4ce9e6>_0x1eb6fd;},'szTqe':_0x482c59(0x10e)};try{const _0x4b6f11=localStorage['getItem'](_0x4dec1d[_0x482c59(0x104)]);if(_0x4b6f11){const _0x10e700=JSON['parse'](_0x4b6f11)||[];this[_0x482c59(0xed)]=_0x10e700[_0x482c59(0xef)]((_0x178292,_0x517f40)=>{const _0x53eb54=_0x482c59;return _0x178292[_0x517f40['id']]=new Conversation(_0x517f40['id'],_0x517f40[_0x53eb54(0x11a)]),_0x178292[_0x517f40['id']][_0x53eb54(0x100)]=_0x517f40[_0x53eb54(0x100)]||[],_0x178292[_0x517f40['id']][_0x53eb54(0xdc)]=_0x517f40[_0x53eb54(0xdc)],_0x178292[_0x517f40['id']][_0x53eb54(0x106)]=_0x517f40[_0x53eb54(0x106)],_0x178292;},{}),_0x4dec1d[_0x482c59(0x117)](Object[_0x482c59(0x123)](this['conversations'])[_0x482c59(0xf2)],0x0)&&(this[_0x482c59(0x10f)]=Object[_0x482c59(0x123)](this[_0x482c59(0xed)])[0x0]),Logger[_0x482c59(0xe6)](_0x482c59(0x127)+Object[_0x482c59(0x123)](this[_0x482c59(0xed)])[_0x482c59(0xf2)]+_0x482c59(0x10b));}}catch(_0x442281){const _0x450675=Logger[_0x482c59(0x11e)](_0x4dec1d[_0x482c59(0x109)],_0x442281);this['notifyError'](_0x450675),this['conversations']={};}}async[_0x58eb20(0xde)](){const _0xdbc508=_0x58eb20,_0x2de111={'OGSDe':function(_0x1e5644,_0x45c586){return _0x1e5644>_0x45c586;},'qZUBe':_0xdbc508(0xed),'iLRpH':'Conversations\x20saved\x20successfully','DYvFC':_0xdbc508(0xfd)};try{const _0x174c19=JSON[_0xdbc508(0x120)](Object[_0xdbc508(0x107)](this[_0xdbc508(0xed)]));_0x2de111['OGSDe'](_0x174c19[_0xdbc508(0xf2)],this[_0xdbc508(0xe2)])&&await this[_0xdbc508(0xe3)](),localStorage['setItem'](_0x2de111[_0xdbc508(0x110)],_0x174c19),this[_0xdbc508(0x11c)](),Logger[_0xdbc508(0xe6)](_0x2de111[_0xdbc508(0x112)]);}catch(_0x5a36dc){const _0x251101=Logger[_0xdbc508(0x11e)](_0x2de111[_0xdbc508(0x118)],_0x5a36dc);this['notifyError'](_0x251101);}}async[_0x58eb20(0xe3)](){const _0x4f4f8f=_0x58eb20,_0xed704f={'PzcYJ':_0x4f4f8f(0xf3),'lbhip':function(_0x106de7,_0x513246){return _0x106de7>_0x513246;},'ORVGI':function(_0x1b99f1,_0x47db68){return _0x1b99f1>_0x47db68;},'tJeGi':function(_0xe1d578,_0x3a6dfe){return _0xe1d578>_0x3a6dfe;},'xrhLR':_0x4f4f8f(0xe5)};Logger[_0x4f4f8f(0x10d)](_0xed704f[_0x4f4f8f(0xf6)]);const _0x3b5c98=this[_0x4f4f8f(0x122)]();_0xed704f[_0x4f4f8f(0x101)](_0x3b5c98[_0x4f4f8f(0xf2)],this[_0x4f4f8f(0x121)])&&(this['conversations']=_0x3b5c98['slice'](0x0,this[_0x4f4f8f(0x121)])['reduce']((_0x5a1b7a,_0x4f88b0)=>{return _0x5a1b7a[_0x4f88b0['id']]=_0x4f88b0,_0x5a1b7a;},{}),Logger['info'](_0x4f4f8f(0x11d)+this[_0x4f4f8f(0x121)]+_0x4f4f8f(0x111)));let _0x540d1d=JSON[_0x4f4f8f(0x120)](Object[_0x4f4f8f(0x107)](this[_0x4f4f8f(0xed)]))[_0x4f4f8f(0xf2)];while(_0xed704f['ORVGI'](_0x540d1d,this['MAX_STORAGE_SIZE'])&&_0xed704f[_0x4f4f8f(0x128)](Object['keys'](this[_0x4f4f8f(0xed)])[_0x4f4f8f(0xf2)],0x0)){const _0x1451c2=_0x3b5c98['pop']();_0xed704f[_0x4f4f8f(0xee)](_0x1451c2[_0x4f4f8f(0x100)][_0x4f4f8f(0xf2)],0xa)?_0x1451c2[_0x4f4f8f(0x100)]=_0x1451c2[_0x4f4f8f(0x100)][_0x4f4f8f(0x116)](-0xa):delete this[_0x4f4f8f(0xed)][_0x1451c2['id']],_0x540d1d=JSON[_0x4f4f8f(0x120)](Object[_0x4f4f8f(0x107)](this[_0x4f4f8f(0xed)]))[_0x4f4f8f(0xf2)];}Logger[_0x4f4f8f(0xe6)](_0xed704f[_0x4f4f8f(0xf1)]);}async[_0x58eb20(0x126)](_0x353b53=_0x58eb20(0xf5)){const _0x46d77b=_0x58eb20,_0x475815='conv_'+Date[_0x46d77b(0x10a)](),_0x52d88e=new Conversation(_0x475815,_0x353b53);return this[_0x46d77b(0xed)][_0x475815]=_0x52d88e,this[_0x46d77b(0x10f)]=_0x475815,await this[_0x46d77b(0xde)](),this[_0x46d77b(0xff)](),_0x475815;}[_0x58eb20(0x119)](){const _0x316ed7=_0x58eb20;return this[_0x316ed7(0xed)][this[_0x316ed7(0x10f)]]||null;}async[_0x58eb20(0xeb)](_0x424747,_0x35e317){const _0x373b48=_0x58eb20,_0x5f0a8a={'wrcRa':_0x373b48(0xdf),'dMigy':function(_0x120e7a,_0xc8a965){return _0x120e7a===_0xc8a965;},'JiwsD':_0x373b48(0xf5),'iynyQ':function(_0x3881ff,_0x19065e){return _0x3881ff===_0x19065e;}},_0x5498d9=this['getCurrentConversation']();if(!_0x5498d9)return![];const _0x224b4b={'role':_0x35e317,'content':_0x424747,'timestamp':new Date()['toISOString']()};return _0x5498d9['messages'][_0x373b48(0xf0)](_0x224b4b),_0x5498d9[_0x373b48(0x106)]=new Date()[_0x373b48(0xf8)](),_0x35e317===_0x5f0a8a[_0x373b48(0x105)]&&_0x5f0a8a[_0x373b48(0xe1)](_0x5498d9[_0x373b48(0x11a)],_0x5f0a8a[_0x373b48(0xdb)])&&_0x5f0a8a['iynyQ'](_0x5498d9[_0x373b48(0x100)][_0x373b48(0xf2)],0x1)&&(_0x5498d9[_0x373b48(0x11a)]=_0x424747[_0x373b48(0x108)]('\x20')[_0x373b48(0x116)](0x0,0x4)[_0x373b48(0xfa)]('\x20')+'...'),await this[_0x373b48(0xde)](),!![];}async[_0x58eb20(0xf4)](_0x1d74dd){const _0x25e074=_0x58eb20,_0x26a17f={'nYzBY':function(_0x2480cc,_0x39829e){return _0x2480cc===_0x39829e;}};this[_0x25e074(0xed)][_0x1d74dd]&&(delete this[_0x25e074(0xed)][_0x1d74dd],_0x26a17f[_0x25e074(0x114)](this[_0x25e074(0x10f)],_0x1d74dd)&&(this['currentConversationId']=Object['keys'](this[_0x25e074(0xed)])[0x0]||null),await this['saveConversations']());}['switchConversation'](_0x4d6741){const _0x950a04=_0x58eb20;if(this['conversations'][_0x4d6741])return this[_0x950a04(0x10f)]=_0x4d6741,this[_0x950a04(0xff)](),!![];return![];}[_0x58eb20(0x122)](){const _0x2b6c9c=_0x58eb20;return Object[_0x2b6c9c(0x107)](this[_0x2b6c9c(0xed)])[_0x2b6c9c(0x10c)]((_0x241814,_0xe34b8a)=>new Date(_0xe34b8a['updatedAt'])-new Date(_0x241814[_0x2b6c9c(0x106)]));}[_0x58eb20(0x11c)](){const _0x4baa49=_0x58eb20;this[_0x4baa49(0x102)][_0x4baa49(0xfe)][_0x4baa49(0xdd)](_0x2a0731=>_0x2a0731(Object[_0x4baa49(0x107)](this[_0x4baa49(0xed)])));}[_0x58eb20(0xff)](){const _0x3f780b=_0x58eb20;this[_0x3f780b(0x102)][_0x3f780b(0xe4)][_0x3f780b(0xdd)](_0x270732=>_0x270732(this['getCurrentConversation']()));}['notifyError'](_0x2f6d9a){const _0x14b764=_0x58eb20;this[_0x14b764(0x102)][_0x14b764(0xf9)][_0x14b764(0xdd)](_0x86c792=>_0x86c792(_0x2f6d9a));}[_0x58eb20(0xea)](_0x47e994,_0x25bd57){const _0x38885d=_0x58eb20;this[_0x38885d(0x102)][_0x47e994]&&this[_0x38885d(0x102)][_0x47e994][_0x38885d(0xf0)](_0x25bd57);}[_0x58eb20(0x113)](_0xb02dda,_0x44a347){const _0x4394af=_0x58eb20;this[_0x4394af(0x102)][_0xb02dda]&&(this[_0x4394af(0x102)][_0xb02dda]=this[_0x4394af(0x102)][_0xb02dda]['filter'](_0x160e74=>_0x160e74!==_0x44a347));}}function _0x1795(){const _0x1ec8c9=['saveConversations','user','653450gWmEls','dMigy','MAX_STORAGE_SIZE','cleanupStorage','onCurrentConversationChange','Storage\x20cleanup\x20completed','info','IRsSx','1430rXpyug','292896iysMla','addEventListener','addMessage','3YlQxHy','conversations','tJeGi','reduce','push','xrhLR','length','Storage\x20cleanup\x20initiated','deleteConversation','New\x20Conversation','PzcYJ','2|1|3|4|0','toISOString','onError','join','153703BhmdWe','120JnMiyf','Failed\x20to\x20save\x20conversations','onConversationUpdate','notifyCurrentConversationChange','messages','lbhip','listeners','tAnfF','YYlvH','wrcRa','updatedAt','values','split','szTqe','now','\x20conversations','sort','warn','Failed\x20to\x20load\x20conversations','currentConversationId','qZUBe','\x20most\x20recent\x20conversations','iLRpH','removeEventListener','nYzBY','184685gLljgc','slice','uWPxe','DYvFC','getCurrentConversation','title','5YJGTMg','notifyConversationUpdate','Trimmed\x20to\x20','error','3147500wSQopu','stringify','MAX_CONVERSATIONS','getSortedConversations','keys','654cvsVoh','12162816vWoTto','createNewConversation','Loaded\x20','ORVGI','JiwsD','createdAt','forEach'];_0x1795=function(){return _0x1ec8c9;};return _0x1795();}export{ChatManager};