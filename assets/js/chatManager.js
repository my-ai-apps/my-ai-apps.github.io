
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x1d254c=_0x367a;(function(_0x901cb6,_0x163a5f){const _0x15d8f3=_0x367a,_0x34636a=_0x901cb6();while(!![]){try{const _0x471c0c=parseInt(_0x15d8f3(0xbb))/0x1*(parseInt(_0x15d8f3(0xa5))/0x2)+parseInt(_0x15d8f3(0xf0))/0x3*(parseInt(_0x15d8f3(0xd7))/0x4)+-parseInt(_0x15d8f3(0xbd))/0x5+-parseInt(_0x15d8f3(0xb8))/0x6*(parseInt(_0x15d8f3(0x9c))/0x7)+parseInt(_0x15d8f3(0xd1))/0x8+-parseInt(_0x15d8f3(0xd2))/0x9+parseInt(_0x15d8f3(0xc3))/0xa*(-parseInt(_0x15d8f3(0xae))/0xb);if(_0x471c0c===_0x163a5f)break;else _0x34636a['push'](_0x34636a['shift']());}catch(_0x4b5227){_0x34636a['push'](_0x34636a['shift']());}}}(_0x3e24,0xbcd1f));import{Logger}from'./common.js';function _0x367a(_0x490345,_0x253fe2){const _0x3e24eb=_0x3e24();return _0x367a=function(_0x367ab3,_0x4a19f3){_0x367ab3=_0x367ab3-0x9b;let _0x479086=_0x3e24eb[_0x367ab3];return _0x479086;},_0x367a(_0x490345,_0x253fe2);}class Conversation{constructor(_0x329f37,_0x11c1ad){const _0x59a4fc=_0x367a,_0x3ebf60={'iWVHQ':'2|0|4|3|1'},_0x1f9455=_0x3ebf60[_0x59a4fc(0xc0)][_0x59a4fc(0xa3)]('|');let _0x4ab0e2=0x0;while(!![]){switch(_0x1f9455[_0x4ab0e2++]){case'0':this[_0x59a4fc(0xcb)]=_0x11c1ad;continue;case'1':this[_0x59a4fc(0xce)]=new Date()['toISOString']();continue;case'2':this['id']=_0x329f37;continue;case'3':this[_0x59a4fc(0xa8)]=new Date()[_0x59a4fc(0xc9)]();continue;case'4':this['messages']=[];continue;}break;}}}class ChatManager{constructor(){const _0x21dddf=_0x367a,_0x2c9ebe={'yStBV':_0x21dddf(0xe5),'bERpM':function(_0x267bfd,_0x4fbd21){return _0x267bfd*_0x4fbd21;}},_0x2216b3=_0x2c9ebe[_0x21dddf(0xd0)]['split']('|');let _0x193b70=0x0;while(!![]){switch(_0x2216b3[_0x193b70++]){case'0':this[_0x21dddf(0xbc)]();continue;case'1':this[_0x21dddf(0xcc)]=0x32;continue;case'2':this[_0x21dddf(0xe3)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'3':this[_0x21dddf(0xd9)]={};continue;case'4':this[_0x21dddf(0xa4)]=_0x2c9ebe['bERpM'](_0x2c9ebe[_0x21dddf(0xe2)](4.5,0x400),0x400);continue;case'5':this[_0x21dddf(0xcd)]=null;continue;}break;}}async[_0x1d254c(0xbc)](){const _0x3621c5=_0x1d254c,_0x5d0abf={'MPpOZ':_0x3621c5(0xb5),'NmTRP':_0x3621c5(0xd9),'GeVbG':function(_0x46caba,_0x26a016){return _0x46caba>_0x26a016;},'xRHMh':_0x3621c5(0xe9)};try{const _0xf3d123=localStorage[_0x3621c5(0xc4)](_0x5d0abf[_0x3621c5(0xb1)]);if(_0xf3d123){const _0x4e8448=JSON[_0x3621c5(0x9d)](_0xf3d123)||[];this[_0x3621c5(0xd9)]=_0x4e8448[_0x3621c5(0xe7)]((_0x435c7e,_0x19cc88)=>{const _0x232e31=_0x3621c5,_0x6d2172=_0x5d0abf[_0x232e31(0xb4)][_0x232e31(0xa3)]('|');let _0x6a9b0b=0x0;while(!![]){switch(_0x6d2172[_0x6a9b0b++]){case'0':return _0x435c7e;case'1':_0x435c7e[_0x19cc88['id']][_0x232e31(0xc8)]=_0x19cc88[_0x232e31(0xc8)]||[];continue;case'2':_0x435c7e[_0x19cc88['id']][_0x232e31(0xa8)]=_0x19cc88[_0x232e31(0xa8)];continue;case'3':_0x435c7e[_0x19cc88['id']]=new Conversation(_0x19cc88['id'],_0x19cc88[_0x232e31(0xcb)]);continue;case'4':_0x435c7e[_0x19cc88['id']][_0x232e31(0xce)]=_0x19cc88['updatedAt'];continue;}break;}},{}),_0x5d0abf[_0x3621c5(0xb3)](Object[_0x3621c5(0xdf)](this[_0x3621c5(0xd9)])[_0x3621c5(0xb0)],0x0)&&(this[_0x3621c5(0xcd)]=Object[_0x3621c5(0xdf)](this['conversations'])[0x0]),Logger[_0x3621c5(0xd5)](_0x3621c5(0xa7)+Object['keys'](this[_0x3621c5(0xd9)])[_0x3621c5(0xb0)]+_0x3621c5(0x9f));}}catch(_0x440d1e){const _0x1604c7=Logger[_0x3621c5(0xa6)](_0x5d0abf[_0x3621c5(0xa0)],_0x440d1e);this[_0x3621c5(0xac)](_0x1604c7),this[_0x3621c5(0xd9)]={};}}async[_0x1d254c(0xcf)](){const _0x92c991=_0x1d254c,_0x5f6718={'KsLGq':function(_0x5363df,_0x498cd3){return _0x5363df>_0x498cd3;},'fZKyZ':_0x92c991(0xd9),'QVJdr':_0x92c991(0xbf),'gVqKi':_0x92c991(0xbe)};try{const _0x12c062=JSON['stringify'](Object[_0x92c991(0xdb)](this[_0x92c991(0xd9)]));_0x5f6718[_0x92c991(0xde)](_0x12c062[_0x92c991(0xb0)],this['MAX_STORAGE_SIZE'])&&await this[_0x92c991(0xf2)](),localStorage[_0x92c991(0xda)](_0x5f6718[_0x92c991(0xb6)],_0x12c062),this['notifyConversationUpdate'](),Logger['info'](_0x5f6718[_0x92c991(0xa1)]);}catch(_0x383286){const _0xd94938=Logger[_0x92c991(0xa6)](_0x5f6718[_0x92c991(0xc7)],_0x383286);this[_0x92c991(0xac)](_0xd94938);}}async[_0x1d254c(0xf2)](){const _0x4057e5=_0x1d254c,_0x222950={'ULSWZ':_0x4057e5(0xad),'GdWdK':function(_0x4e4f51,_0x5f1231){return _0x4e4f51>_0x5f1231;},'xmktq':_0x4057e5(0xf1)};Logger[_0x4057e5(0xed)](_0x222950[_0x4057e5(0xba)]);const _0x45e09b=this[_0x4057e5(0xca)]();_0x222950[_0x4057e5(0xd6)](_0x45e09b[_0x4057e5(0xb0)],this[_0x4057e5(0xcc)])&&(this[_0x4057e5(0xd9)]=_0x45e09b['slice'](0x0,this[_0x4057e5(0xcc)])['reduce']((_0x2fdd82,_0x513eeb)=>{return _0x2fdd82[_0x513eeb['id']]=_0x513eeb,_0x2fdd82;},{}),Logger['info'](_0x4057e5(0xe6)+this[_0x4057e5(0xcc)]+'\x20most\x20recent\x20conversations'));let _0x408869=JSON['stringify'](Object['values'](this['conversations']))[_0x4057e5(0xb0)];while(_0x222950[_0x4057e5(0xd6)](_0x408869,this[_0x4057e5(0xa4)])&&Object[_0x4057e5(0xdf)](this[_0x4057e5(0xd9)])['length']>0x0){const _0x51a17a=_0x45e09b[_0x4057e5(0xb9)]();_0x222950[_0x4057e5(0xd6)](_0x51a17a[_0x4057e5(0xc8)][_0x4057e5(0xb0)],0xa)?_0x51a17a[_0x4057e5(0xc8)]=_0x51a17a[_0x4057e5(0xc8)][_0x4057e5(0xe4)](-0xa):delete this[_0x4057e5(0xd9)][_0x51a17a['id']],_0x408869=JSON[_0x4057e5(0xc1)](Object[_0x4057e5(0xdb)](this[_0x4057e5(0xd9)]))['length'];}Logger[_0x4057e5(0xd5)](_0x222950[_0x4057e5(0xe0)]);}async[_0x1d254c(0xf3)](_0x17b411='New\x20Conversation'){const _0x15160f=_0x1d254c,_0x38d3a6='conv_'+Date[_0x15160f(0xaa)](),_0x4ee83b=new Conversation(_0x38d3a6,_0x17b411);return this[_0x15160f(0xd9)][_0x38d3a6]=_0x4ee83b,this[_0x15160f(0xcd)]=_0x38d3a6,await this[_0x15160f(0xcf)](),this[_0x15160f(0xd4)](),_0x38d3a6;}['getCurrentConversation'](){const _0x81bb0f=_0x1d254c;return this[_0x81bb0f(0xd9)][this[_0x81bb0f(0xcd)]]||null;}async[_0x1d254c(0xeb)](_0x3e6267,_0x2aebfb){const _0x420b13=_0x1d254c,_0x4f4af7={'KwPaC':function(_0x55a284,_0x33218c){return _0x55a284===_0x33218c;},'hXyiW':_0x420b13(0xa9),'CypCh':function(_0x452b36,_0x4a9a7b){return _0x452b36+_0x4a9a7b;},'ZQHjp':_0x420b13(0xb2)},_0x3745fd=this[_0x420b13(0x9b)]();if(!_0x3745fd)return![];const _0x4a186d={'role':_0x2aebfb,'content':_0x3e6267,'timestamp':new Date()[_0x420b13(0xc9)]()};return _0x3745fd[_0x420b13(0xc8)][_0x420b13(0xd8)](_0x4a186d),_0x3745fd[_0x420b13(0xce)]=new Date()['toISOString'](),_0x2aebfb===_0x420b13(0xdd)&&_0x4f4af7[_0x420b13(0xaf)](_0x3745fd[_0x420b13(0xcb)],_0x4f4af7[_0x420b13(0xc2)])&&_0x4f4af7[_0x420b13(0xaf)](_0x3745fd[_0x420b13(0xc8)][_0x420b13(0xb0)],0x1)&&(_0x3745fd[_0x420b13(0xcb)]=_0x4f4af7[_0x420b13(0xe8)](_0x3e6267[_0x420b13(0xa3)]('\x20')[_0x420b13(0xe4)](0x0,0x4)[_0x420b13(0xef)]('\x20'),_0x4f4af7[_0x420b13(0xb7)])),await this[_0x420b13(0xcf)](),!![];}async[_0x1d254c(0xee)](_0xaa5f3a){const _0x5372f1=_0x1d254c;this[_0x5372f1(0xd9)][_0xaa5f3a]&&(delete this[_0x5372f1(0xd9)][_0xaa5f3a],this['currentConversationId']===_0xaa5f3a&&(this['currentConversationId']=Object[_0x5372f1(0xdf)](this[_0x5372f1(0xd9)])[0x0]||null),await this[_0x5372f1(0xcf)]());}[_0x1d254c(0xea)](_0x2b9a3f){const _0x423216=_0x1d254c;if(this[_0x423216(0xd9)][_0x2b9a3f])return this[_0x423216(0xcd)]=_0x2b9a3f,this[_0x423216(0xd4)](),!![];return![];}[_0x1d254c(0xca)](){const _0x215eee=_0x1d254c;return Object[_0x215eee(0xdb)](this[_0x215eee(0xd9)])[_0x215eee(0xab)]((_0x515f03,_0x1e77b1)=>new Date(_0x1e77b1['updatedAt'])-new Date(_0x515f03[_0x215eee(0xce)]));}[_0x1d254c(0xdc)](){const _0x3cd9e8=_0x1d254c;this['listeners'][_0x3cd9e8(0xc6)][_0x3cd9e8(0xa2)](_0x5d4f96=>_0x5d4f96(Object['values'](this[_0x3cd9e8(0xd9)])));}['notifyCurrentConversationChange'](){const _0x230d4d=_0x1d254c;this[_0x230d4d(0xe3)][_0x230d4d(0xec)][_0x230d4d(0xa2)](_0x286edf=>_0x286edf(this[_0x230d4d(0x9b)]()));}[_0x1d254c(0xac)](_0x55ac3d){const _0x17ea50=_0x1d254c;this['listeners'][_0x17ea50(0xe1)][_0x17ea50(0xa2)](_0x5d6ae8=>_0x5d6ae8(_0x55ac3d));}[_0x1d254c(0xc5)](_0x5cdf44,_0x21bd0b){const _0x31816a=_0x1d254c;this['listeners'][_0x5cdf44]&&this['listeners'][_0x5cdf44][_0x31816a(0xd8)](_0x21bd0b);}[_0x1d254c(0x9e)](_0x2dd4aa,_0x53a9ef){const _0x27f257=_0x1d254c;this[_0x27f257(0xe3)][_0x2dd4aa]&&(this['listeners'][_0x2dd4aa]=this['listeners'][_0x2dd4aa][_0x27f257(0xd3)](_0x3dd4fd=>_0x3dd4fd!==_0x53a9ef));}}export{ChatManager};function _0x3e24(){const _0x292e60=['parse','removeEventListener','\x20conversations','xRHMh','QVJdr','forEach','split','MAX_STORAGE_SIZE','14116hoxnyh','error','Loaded\x20','createdAt','New\x20Conversation','now','sort','notifyError','Storage\x20cleanup\x20initiated','1155nVNSAQ','KwPaC','length','NmTRP','...','GeVbG','MPpOZ','3|1|2|4|0','fZKyZ','ZQHjp','6igqRcX','pop','ULSWZ','181RAazgr','loadConversations','3186410MbASso','Failed\x20to\x20save\x20conversations','Conversations\x20saved\x20successfully','iWVHQ','stringify','hXyiW','12890vbPuvp','getItem','addEventListener','onConversationUpdate','gVqKi','messages','toISOString','getSortedConversations','title','MAX_CONVERSATIONS','currentConversationId','updatedAt','saveConversations','yStBV','3692592mpKPxR','5577669MCFedT','filter','notifyCurrentConversationChange','info','GdWdK','4sulFcH','push','conversations','setItem','values','notifyConversationUpdate','user','KsLGq','keys','xmktq','onError','bERpM','listeners','slice','3|5|2|4|1|0','Trimmed\x20to\x20','reduce','CypCh','Failed\x20to\x20load\x20conversations','switchConversation','addMessage','onCurrentConversationChange','warn','deleteConversation','join','2967507fQLJkv','Storage\x20cleanup\x20completed','cleanupStorage','createNewConversation','getCurrentConversation','3937262PtlGrI'];_0x3e24=function(){return _0x292e60;};return _0x3e24();}