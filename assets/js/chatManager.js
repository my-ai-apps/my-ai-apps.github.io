
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x26ee(_0x10e7c2,_0x578391){const _0xe94391=_0xe943();return _0x26ee=function(_0x26ee01,_0x41d27a){_0x26ee01=_0x26ee01-0xbf;let _0x374732=_0xe94391[_0x26ee01];return _0x374732;},_0x26ee(_0x10e7c2,_0x578391);}const _0x9fc1d4=_0x26ee;(function(_0x35987a,_0x4cacb7){const _0xbfb553=_0x26ee,_0x524d16=_0x35987a();while(!![]){try{const _0x285bcc=-parseInt(_0xbfb553(0xfa))/0x1+-parseInt(_0xbfb553(0xdd))/0x2*(parseInt(_0xbfb553(0xc2))/0x3)+-parseInt(_0xbfb553(0xc8))/0x4*(-parseInt(_0xbfb553(0xc7))/0x5)+-parseInt(_0xbfb553(0xe4))/0x6+parseInt(_0xbfb553(0x100))/0x7*(parseInt(_0xbfb553(0xcf))/0x8)+-parseInt(_0xbfb553(0xda))/0x9*(parseInt(_0xbfb553(0xe5))/0xa)+parseInt(_0xbfb553(0xf1))/0xb;if(_0x285bcc===_0x4cacb7)break;else _0x524d16['push'](_0x524d16['shift']());}catch(_0x467231){_0x524d16['push'](_0x524d16['shift']());}}}(_0xe943,0x96e68));function _0xe943(){const _0x3fb13b=['New\x20Conversation','error','MAX_CONVERSATIONS','getCurrentConversation','tyYyC','20187RVAOJO','sort','user','MEFKn','now','5lNteka','1130572MEZCNb','addMessage','notifyError','saveConversations','pop','aAttg','messages','7549048mheZqW','cleanupStorage','slice','fmoJo','warn','MAX_STORAGE_SIZE','Loaded\x20','aeKMY','keys','UpJpg','Failed\x20to\x20load\x20conversations','192573XxkfwV','length','onError','174PXBJMc','PGKaK','Storage\x20cleanup\x20initiated','ycqOO','wXDyM','onCurrentConversationChange','parse','2573676GUAgCq','530nqtYXO','updatedAt','currentConversationId','push','zwZMV','createNewConversation','Conversations\x20saved\x20successfully','listeners','removeEventListener','createdAt','switchConversation','title','26772361vxXMrp','UsFgF','info','loadConversations','gFFzn','notifyCurrentConversationChange','split','\x20conversations','deleteConversation','893627dpnrhp','\x20most\x20recent\x20conversations','reduce','forEach','bZNzt','values','7gWmdmq','conv_','getSortedConversations','toISOString','stringify','Storage\x20cleanup\x20completed','notifyConversationUpdate','conversations'];_0xe943=function(){return _0x3fb13b;};return _0xe943();}import{Logger}from'./common.js';class Conversation{constructor(_0x3c2eb1,_0x5d00b2){const _0x47e83e=_0x26ee;this['id']=_0x3c2eb1,this[_0x47e83e(0xf0)]=_0x5d00b2,this[_0x47e83e(0xce)]=[],this[_0x47e83e(0xee)]=new Date()[_0x47e83e(0x103)](),this[_0x47e83e(0xe6)]=new Date()['toISOString']();}}class ChatManager{constructor(){const _0x2e399b=_0x26ee,_0x495030={'wXDyM':function(_0x121f69,_0x7b38ba){return _0x121f69*_0x7b38ba;}},_0x5783d2='5|4|2|0|1|3'[_0x2e399b(0xf7)]('|');let _0x1320e4=0x0;while(!![]){switch(_0x5783d2[_0x1320e4++]){case'0':this[_0x2e399b(0xd4)]=_0x495030[_0x2e399b(0xe1)](_0x495030[_0x2e399b(0xe1)](4.5,0x400),0x400);continue;case'1':this[_0x2e399b(0xbf)]=0x32;continue;case'2':this[_0x2e399b(0xec)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'3':this[_0x2e399b(0xf4)]();continue;case'4':this[_0x2e399b(0xe7)]=null;continue;case'5':this[_0x2e399b(0x107)]={};continue;}break;}}async[_0x9fc1d4(0xf4)](){const _0x5ea294=_0x9fc1d4,_0x34eb5c={'MdPjx':'0|2|3|1|4','ycqOO':_0x5ea294(0x107),'gFFzn':function(_0x33094b,_0x3f3901){return _0x33094b>_0x3f3901;}};try{const _0x56bc95=localStorage['getItem'](_0x34eb5c[_0x5ea294(0xe0)]);if(_0x56bc95){const _0x9e205c=JSON[_0x5ea294(0xe3)](_0x56bc95)||[];this[_0x5ea294(0x107)]=_0x9e205c[_0x5ea294(0xfc)]((_0x272b5c,_0x14f256)=>{const _0x6cabc=_0x5ea294,_0x4b37fd=_0x34eb5c['MdPjx'][_0x6cabc(0xf7)]('|');let _0x35a7ea=0x0;while(!![]){switch(_0x4b37fd[_0x35a7ea++]){case'0':_0x272b5c[_0x14f256['id']]=new Conversation(_0x14f256['id'],_0x14f256[_0x6cabc(0xf0)]);continue;case'1':_0x272b5c[_0x14f256['id']][_0x6cabc(0xe6)]=_0x14f256[_0x6cabc(0xe6)];continue;case'2':_0x272b5c[_0x14f256['id']][_0x6cabc(0xce)]=_0x14f256[_0x6cabc(0xce)]||[];continue;case'3':_0x272b5c[_0x14f256['id']][_0x6cabc(0xee)]=_0x14f256[_0x6cabc(0xee)];continue;case'4':return _0x272b5c;}break;}},{}),_0x34eb5c[_0x5ea294(0xf5)](Object[_0x5ea294(0xd7)](this[_0x5ea294(0x107)])[_0x5ea294(0xdb)],0x0)&&(this['currentConversationId']=Object['keys'](this['conversations'])[0x0]),Logger['info'](_0x5ea294(0xd5)+Object[_0x5ea294(0xd7)](this[_0x5ea294(0x107)])[_0x5ea294(0xdb)]+_0x5ea294(0xf8));}}catch(_0x11fca1){const _0x451a22=Logger[_0x5ea294(0x109)](_0x5ea294(0xd9),_0x11fca1);this[_0x5ea294(0xca)](_0x451a22),this[_0x5ea294(0x107)]={};}}async['saveConversations'](){const _0x275f17=_0x9fc1d4,_0x280f62={'MEFKn':function(_0x1d1464,_0x325301){return _0x1d1464>_0x325301;},'IGEqe':_0x275f17(0x107),'PGKaK':'Failed\x20to\x20save\x20conversations'};try{const _0x9fdb25=JSON['stringify'](Object[_0x275f17(0xff)](this[_0x275f17(0x107)]));_0x280f62[_0x275f17(0xc5)](_0x9fdb25['length'],this['MAX_STORAGE_SIZE'])&&await this[_0x275f17(0xd0)](),localStorage['setItem'](_0x280f62['IGEqe'],_0x9fdb25),this[_0x275f17(0x106)](),Logger[_0x275f17(0xf3)](_0x275f17(0xeb));}catch(_0x4bb88e){const _0x129eec=Logger[_0x275f17(0x109)](_0x280f62[_0x275f17(0xde)],_0x4bb88e);this[_0x275f17(0xca)](_0x129eec);}}async[_0x9fc1d4(0xd0)](){const _0x3576b9=_0x9fc1d4,_0x161325={'aAttg':function(_0x527f45,_0x28bab7){return _0x527f45>_0x28bab7;},'fmoJo':function(_0xcfb171,_0x348ac4){return _0xcfb171>_0x348ac4;},'bZNzt':function(_0x4d4880,_0x1de5a8){return _0x4d4880>_0x1de5a8;},'UpJpg':_0x3576b9(0x105)};Logger[_0x3576b9(0xd3)](_0x3576b9(0xdf));const _0x4657aa=this['getSortedConversations']();_0x161325[_0x3576b9(0xcd)](_0x4657aa['length'],this['MAX_CONVERSATIONS'])&&(this[_0x3576b9(0x107)]=_0x4657aa[_0x3576b9(0xd1)](0x0,this['MAX_CONVERSATIONS'])[_0x3576b9(0xfc)]((_0x49b06c,_0x4e9a6f)=>{return _0x49b06c[_0x4e9a6f['id']]=_0x4e9a6f,_0x49b06c;},{}),Logger['info']('Trimmed\x20to\x20'+this[_0x3576b9(0xbf)]+_0x3576b9(0xfb)));let _0x2ec5b3=JSON[_0x3576b9(0x104)](Object[_0x3576b9(0xff)](this[_0x3576b9(0x107)]))[_0x3576b9(0xdb)];while(_0x161325[_0x3576b9(0xd2)](_0x2ec5b3,this[_0x3576b9(0xd4)])&&Object[_0x3576b9(0xd7)](this[_0x3576b9(0x107)])[_0x3576b9(0xdb)]>0x0){const _0x453137=_0x4657aa[_0x3576b9(0xcc)]();_0x161325[_0x3576b9(0xfe)](_0x453137[_0x3576b9(0xce)]['length'],0xa)?_0x453137['messages']=_0x453137[_0x3576b9(0xce)]['slice'](-0xa):delete this[_0x3576b9(0x107)][_0x453137['id']],_0x2ec5b3=JSON[_0x3576b9(0x104)](Object[_0x3576b9(0xff)](this[_0x3576b9(0x107)]))[_0x3576b9(0xdb)];}Logger[_0x3576b9(0xf3)](_0x161325[_0x3576b9(0xd8)]);}async[_0x9fc1d4(0xea)](_0x4832ee=_0x9fc1d4(0x108)){const _0x96cc88=_0x9fc1d4,_0xe14884=_0x96cc88(0x101)+Date[_0x96cc88(0xc6)](),_0x1b4ad8=new Conversation(_0xe14884,_0x4832ee);return this[_0x96cc88(0x107)][_0xe14884]=_0x1b4ad8,this[_0x96cc88(0xe7)]=_0xe14884,await this['saveConversations'](),this['notifyCurrentConversationChange'](),_0xe14884;}[_0x9fc1d4(0xc0)](){const _0x472982=_0x9fc1d4;return this[_0x472982(0x107)][this['currentConversationId']]||null;}async[_0x9fc1d4(0xc9)](_0xfbfb7a,_0xe3864){const _0x2f1dbe=_0x9fc1d4,_0x4fa2ed={'aeKMY':function(_0xcdf5d9,_0x121d27){return _0xcdf5d9===_0x121d27;},'aIbty':_0x2f1dbe(0xc4),'UsFgF':'New\x20Conversation','tyYyC':function(_0x1b20cc,_0x591add){return _0x1b20cc+_0x591add;},'zwZMV':'...'},_0x4c480=this[_0x2f1dbe(0xc0)]();if(!_0x4c480)return![];const _0x113765={'role':_0xe3864,'content':_0xfbfb7a,'timestamp':new Date()[_0x2f1dbe(0x103)]()};return _0x4c480['messages'][_0x2f1dbe(0xe8)](_0x113765),_0x4c480[_0x2f1dbe(0xe6)]=new Date()[_0x2f1dbe(0x103)](),_0x4fa2ed[_0x2f1dbe(0xd6)](_0xe3864,_0x4fa2ed['aIbty'])&&_0x4fa2ed[_0x2f1dbe(0xd6)](_0x4c480[_0x2f1dbe(0xf0)],_0x4fa2ed[_0x2f1dbe(0xf2)])&&_0x4fa2ed[_0x2f1dbe(0xd6)](_0x4c480[_0x2f1dbe(0xce)][_0x2f1dbe(0xdb)],0x1)&&(_0x4c480[_0x2f1dbe(0xf0)]=_0x4fa2ed[_0x2f1dbe(0xc1)](_0xfbfb7a[_0x2f1dbe(0xf7)]('\x20')['slice'](0x0,0x4)['join']('\x20'),_0x4fa2ed[_0x2f1dbe(0xe9)])),await this['saveConversations'](),!![];}async[_0x9fc1d4(0xf9)](_0xd635bf){const _0x378d93=_0x9fc1d4;this[_0x378d93(0x107)][_0xd635bf]&&(delete this[_0x378d93(0x107)][_0xd635bf],this[_0x378d93(0xe7)]===_0xd635bf&&(this[_0x378d93(0xe7)]=Object[_0x378d93(0xd7)](this[_0x378d93(0x107)])[0x0]||null),await this[_0x378d93(0xcb)]());}[_0x9fc1d4(0xef)](_0xac8908){const _0x27c324=_0x9fc1d4;if(this[_0x27c324(0x107)][_0xac8908])return this['currentConversationId']=_0xac8908,this[_0x27c324(0xf6)](),!![];return![];}[_0x9fc1d4(0x102)](){const _0x5989b8=_0x9fc1d4;return Object[_0x5989b8(0xff)](this[_0x5989b8(0x107)])[_0x5989b8(0xc3)]((_0x38e42c,_0x174e5e)=>new Date(_0x174e5e[_0x5989b8(0xe6)])-new Date(_0x38e42c[_0x5989b8(0xe6)]));}[_0x9fc1d4(0x106)](){const _0x25966e=_0x9fc1d4;this[_0x25966e(0xec)]['onConversationUpdate'][_0x25966e(0xfd)](_0x234415=>_0x234415(Object[_0x25966e(0xff)](this['conversations'])));}[_0x9fc1d4(0xf6)](){const _0x5cf29b=_0x9fc1d4;this[_0x5cf29b(0xec)][_0x5cf29b(0xe2)]['forEach'](_0xd2e6aa=>_0xd2e6aa(this[_0x5cf29b(0xc0)]()));}['notifyError'](_0x4d7330){const _0x1733c9=_0x9fc1d4;this[_0x1733c9(0xec)][_0x1733c9(0xdc)][_0x1733c9(0xfd)](_0x597b83=>_0x597b83(_0x4d7330));}['addEventListener'](_0xdfb3b0,_0x2af9c6){const _0x5c4b24=_0x9fc1d4;this[_0x5c4b24(0xec)][_0xdfb3b0]&&this[_0x5c4b24(0xec)][_0xdfb3b0][_0x5c4b24(0xe8)](_0x2af9c6);}[_0x9fc1d4(0xed)](_0x300140,_0xf288a4){const _0x216597=_0x9fc1d4;this[_0x216597(0xec)][_0x300140]&&(this['listeners'][_0x300140]=this['listeners'][_0x300140]['filter'](_0x3bab72=>_0x3bab72!==_0xf288a4));}}export{ChatManager};