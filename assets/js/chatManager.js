
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x5ee1(_0x340cb4,_0x5ed7cf){const _0x4dde2c=_0x4dde();return _0x5ee1=function(_0x5ee13b,_0x353e88){_0x5ee13b=_0x5ee13b-0xc6;let _0x4c41f3=_0x4dde2c[_0x5ee13b];return _0x4c41f3;},_0x5ee1(_0x340cb4,_0x5ed7cf);}const _0x66d2d=_0x5ee1;(function(_0x4a8c9b,_0x1941ce){const _0x57c3df=_0x5ee1,_0x4a52f6=_0x4a8c9b();while(!![]){try{const _0x1ddca0=parseInt(_0x57c3df(0xe0))/0x1+parseInt(_0x57c3df(0x10c))/0x2*(-parseInt(_0x57c3df(0xd1))/0x3)+-parseInt(_0x57c3df(0x106))/0x4*(-parseInt(_0x57c3df(0x108))/0x5)+parseInt(_0x57c3df(0xe8))/0x6*(-parseInt(_0x57c3df(0xeb))/0x7)+-parseInt(_0x57c3df(0xdf))/0x8*(-parseInt(_0x57c3df(0xe6))/0x9)+-parseInt(_0x57c3df(0xc9))/0xa+parseInt(_0x57c3df(0xf4))/0xb;if(_0x1ddca0===_0x1941ce)break;else _0x4a52f6['push'](_0x4a52f6['shift']());}catch(_0x477742){_0x4a52f6['push'](_0x4a52f6['shift']());}}}(_0x4dde,0xd711c));function _0x4dde(){const _0x2c5772=['listeners','4|2|3|1|0','Failed\x20to\x20load\x20conversations','setItem','69NOwCBm','MAX_CONVERSATIONS','saveConversations','AJVsq','QjOBw','IkzuX','addMessage','messages','BQUEk','Conversations\x20saved\x20successfully','values','createNewConversation','getItem','push','7544uiycxD','405979iQJBfl','RlCqx','notifyError','JtyyQ','Storage\x20cleanup\x20initiated','onCurrentConversationChange','4311SHGdaF','updatedAt','452952SfrOWD','reduce','QgUfu','35LLDyzJ','createdAt','Failed\x20to\x20save\x20conversations','getSortedConversations','slice','forEach','sort','notifyCurrentConversationChange','XqpRS','7810869OJYdQg','New\x20Conversation','addEventListener','zdBgi','split','YDtDA','HRjiW','cleanupStorage','Trimmed\x20to\x20','getCurrentConversation','title','toISOString','conversations','TVFgU','MAX_STORAGE_SIZE','CrDwl','0|5|1|3|2|4','FZGeZ','4169548smFaZw','length','5srktIv','user','onConversationUpdate','keys','3058ObFBbA','2|0|1|3|4','notifyConversationUpdate','\x20conversations','pop','onError','...','stringify','currentConversationId','parse','\x20most\x20recent\x20conversations','loadConversations','13165910tWXPgw','info','now','removeEventListener'];_0x4dde=function(){return _0x2c5772;};return _0x4dde();}import{Logger}from'./common.js';class Conversation{constructor(_0x1f41ea,_0x295de4){const _0x26cc2a=_0x5ee1,_0x6f9746={'JtyyQ':_0x26cc2a(0x10d)},_0x3440c4=_0x6f9746[_0x26cc2a(0xe3)][_0x26cc2a(0xf8)]('|');let _0x3c0108=0x0;while(!![]){switch(_0x3440c4[_0x3c0108++]){case'0':this[_0x26cc2a(0xfe)]=_0x295de4;continue;case'1':this[_0x26cc2a(0xd8)]=[];continue;case'2':this['id']=_0x1f41ea;continue;case'3':this['createdAt']=new Date()[_0x26cc2a(0xff)]();continue;case'4':this[_0x26cc2a(0xe7)]=new Date()['toISOString']();continue;}break;}}}class ChatManager{constructor(){const _0x17bfa7=_0x5ee1,_0x4a581e={'WpqSA':_0x17bfa7(0x104),'HIKQc':function(_0x592fd6,_0x1c45d3){return _0x592fd6*_0x1c45d3;},'rcSPO':function(_0x164a8e,_0x1d426d){return _0x164a8e*_0x1d426d;}},_0x4a2d6c=_0x4a581e['WpqSA']['split']('|');let _0x42f6e0=0x0;while(!![]){switch(_0x4a2d6c[_0x42f6e0++]){case'0':this[_0x17bfa7(0x100)]={};continue;case'1':this[_0x17bfa7(0xcd)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'2':this['MAX_CONVERSATIONS']=0x32;continue;case'3':this['MAX_STORAGE_SIZE']=_0x4a581e['HIKQc'](_0x4a581e['rcSPO'](4.5,0x400),0x400);continue;case'4':this[_0x17bfa7(0xc8)]();continue;case'5':this[_0x17bfa7(0x114)]=null;continue;}break;}}async[_0x66d2d(0xc8)](){const _0x40e21a=_0x66d2d,_0x93b182={'CrDwl':_0x40e21a(0x100),'FZGeZ':function(_0xe0c848,_0x2f0495){return _0xe0c848>_0x2f0495;},'QgUfu':_0x40e21a(0xcf)};try{const _0x492560=localStorage[_0x40e21a(0xdd)](_0x93b182[_0x40e21a(0x103)]);if(_0x492560){const _0x1af389=JSON[_0x40e21a(0xc6)](_0x492560)||[];this[_0x40e21a(0x100)]=_0x1af389[_0x40e21a(0xe9)]((_0x2e64e9,_0x6fd618)=>{const _0x9ef3c9=_0x40e21a,_0x2675f3=_0x9ef3c9(0xce)['split']('|');let _0x16c480=0x0;while(!![]){switch(_0x2675f3[_0x16c480++]){case'0':return _0x2e64e9;case'1':_0x2e64e9[_0x6fd618['id']][_0x9ef3c9(0xe7)]=_0x6fd618[_0x9ef3c9(0xe7)];continue;case'2':_0x2e64e9[_0x6fd618['id']]['messages']=_0x6fd618[_0x9ef3c9(0xd8)]||[];continue;case'3':_0x2e64e9[_0x6fd618['id']][_0x9ef3c9(0xec)]=_0x6fd618[_0x9ef3c9(0xec)];continue;case'4':_0x2e64e9[_0x6fd618['id']]=new Conversation(_0x6fd618['id'],_0x6fd618['title']);continue;}break;}},{}),_0x93b182[_0x40e21a(0x105)](Object[_0x40e21a(0x10b)](this[_0x40e21a(0x100)])[_0x40e21a(0x107)],0x0)&&(this[_0x40e21a(0x114)]=Object['keys'](this[_0x40e21a(0x100)])[0x0]),Logger[_0x40e21a(0xca)]('Loaded\x20'+Object[_0x40e21a(0x10b)](this[_0x40e21a(0x100)])[_0x40e21a(0x107)]+_0x40e21a(0x10f));}}catch(_0xbeb3da){const _0x1029e6=Logger['error'](_0x93b182[_0x40e21a(0xea)],_0xbeb3da);this['notifyError'](_0x1029e6),this[_0x40e21a(0x100)]={};}}async['saveConversations'](){const _0x3f2b0f=_0x66d2d,_0x2b59c5={'TVFgU':function(_0x3bbef3,_0x11ebc5){return _0x3bbef3>_0x11ebc5;},'zdBgi':'conversations'};try{const _0x19beef=JSON['stringify'](Object['values'](this[_0x3f2b0f(0x100)]));_0x2b59c5[_0x3f2b0f(0x101)](_0x19beef[_0x3f2b0f(0x107)],this['MAX_STORAGE_SIZE'])&&await this['cleanupStorage'](),localStorage[_0x3f2b0f(0xd0)](_0x2b59c5[_0x3f2b0f(0xf7)],_0x19beef),this[_0x3f2b0f(0x10e)](),Logger['info'](_0x3f2b0f(0xda));}catch(_0x55a1b2){const _0x4b6c00=Logger['error'](_0x3f2b0f(0xed),_0x55a1b2);this[_0x3f2b0f(0xe2)](_0x4b6c00);}}async[_0x66d2d(0xfb)](){const _0x3ca91f=_0x66d2d,_0x5814cd={'IkzuX':function(_0x4d119d,_0x2ff3c1){return _0x4d119d>_0x2ff3c1;},'AJVsq':function(_0x204d1e,_0x2e17b1){return _0x204d1e>_0x2e17b1;},'XqpRS':'Storage\x20cleanup\x20completed'};Logger['warn'](_0x3ca91f(0xe4));const _0xe28851=this['getSortedConversations']();_0x5814cd[_0x3ca91f(0xd6)](_0xe28851[_0x3ca91f(0x107)],this[_0x3ca91f(0xd2)])&&(this[_0x3ca91f(0x100)]=_0xe28851['slice'](0x0,this[_0x3ca91f(0xd2)])['reduce']((_0x252e0f,_0x189c54)=>{return _0x252e0f[_0x189c54['id']]=_0x189c54,_0x252e0f;},{}),Logger[_0x3ca91f(0xca)](_0x3ca91f(0xfc)+this['MAX_CONVERSATIONS']+_0x3ca91f(0xc7)));let _0x4efddf=JSON[_0x3ca91f(0x113)](Object[_0x3ca91f(0xdb)](this[_0x3ca91f(0x100)]))[_0x3ca91f(0x107)];while(_0x5814cd[_0x3ca91f(0xd6)](_0x4efddf,this[_0x3ca91f(0x102)])&&Object['keys'](this['conversations'])[_0x3ca91f(0x107)]>0x0){const _0x33ad47=_0xe28851[_0x3ca91f(0x110)]();_0x5814cd[_0x3ca91f(0xd4)](_0x33ad47['messages'][_0x3ca91f(0x107)],0xa)?_0x33ad47[_0x3ca91f(0xd8)]=_0x33ad47[_0x3ca91f(0xd8)][_0x3ca91f(0xef)](-0xa):delete this['conversations'][_0x33ad47['id']],_0x4efddf=JSON[_0x3ca91f(0x113)](Object['values'](this['conversations']))['length'];}Logger[_0x3ca91f(0xca)](_0x5814cd[_0x3ca91f(0xf3)]);}async[_0x66d2d(0xdc)](_0x5a0eb6='New\x20Conversation'){const _0x164f05=_0x66d2d,_0xe6f80c='conv_'+Date[_0x164f05(0xcb)](),_0x321d0a=new Conversation(_0xe6f80c,_0x5a0eb6);return this[_0x164f05(0x100)][_0xe6f80c]=_0x321d0a,this[_0x164f05(0x114)]=_0xe6f80c,await this[_0x164f05(0xd3)](),this[_0x164f05(0xf2)](),_0xe6f80c;}[_0x66d2d(0xfd)](){const _0x2cc340=_0x66d2d;return this[_0x2cc340(0x100)][this[_0x2cc340(0x114)]]||null;}async[_0x66d2d(0xd7)](_0x3ba211,_0x3e9f4a){const _0x141f59=_0x66d2d,_0x2dc594={'YDtDA':function(_0x480f7d,_0x422a44){return _0x480f7d===_0x422a44;},'HRjiW':_0x141f59(0x109),'QjOBw':function(_0x24e309,_0x39de6f){return _0x24e309===_0x39de6f;},'AhoWn':_0x141f59(0xf5),'BQUEk':function(_0x29f75f,_0xc7de04){return _0x29f75f+_0xc7de04;},'HfyLi':_0x141f59(0x112)},_0x2b800b=this[_0x141f59(0xfd)]();if(!_0x2b800b)return![];const _0x2bdf4a={'role':_0x3e9f4a,'content':_0x3ba211,'timestamp':new Date()[_0x141f59(0xff)]()};return _0x2b800b['messages']['push'](_0x2bdf4a),_0x2b800b['updatedAt']=new Date()[_0x141f59(0xff)](),_0x2dc594[_0x141f59(0xf9)](_0x3e9f4a,_0x2dc594[_0x141f59(0xfa)])&&_0x2dc594[_0x141f59(0xd5)](_0x2b800b[_0x141f59(0xfe)],_0x2dc594['AhoWn'])&&_0x2dc594[_0x141f59(0xd5)](_0x2b800b[_0x141f59(0xd8)][_0x141f59(0x107)],0x1)&&(_0x2b800b[_0x141f59(0xfe)]=_0x2dc594[_0x141f59(0xd9)](_0x3ba211[_0x141f59(0xf8)]('\x20')[_0x141f59(0xef)](0x0,0x4)['join']('\x20'),_0x2dc594['HfyLi'])),await this['saveConversations'](),!![];}async['deleteConversation'](_0x2b1870){const _0x18e9c0=_0x66d2d,_0x1ee01b={'RlCqx':function(_0x508d88,_0x1c1179){return _0x508d88===_0x1c1179;}};this[_0x18e9c0(0x100)][_0x2b1870]&&(delete this['conversations'][_0x2b1870],_0x1ee01b[_0x18e9c0(0xe1)](this['currentConversationId'],_0x2b1870)&&(this['currentConversationId']=Object[_0x18e9c0(0x10b)](this['conversations'])[0x0]||null),await this[_0x18e9c0(0xd3)]());}['switchConversation'](_0x31307e){const _0x168430=_0x66d2d;if(this['conversations'][_0x31307e])return this[_0x168430(0x114)]=_0x31307e,this[_0x168430(0xf2)](),!![];return![];}[_0x66d2d(0xee)](){const _0x3ae124=_0x66d2d;return Object[_0x3ae124(0xdb)](this[_0x3ae124(0x100)])[_0x3ae124(0xf1)]((_0x25d499,_0x2980e8)=>new Date(_0x2980e8[_0x3ae124(0xe7)])-new Date(_0x25d499[_0x3ae124(0xe7)]));}[_0x66d2d(0x10e)](){const _0x2e2639=_0x66d2d;this['listeners'][_0x2e2639(0x10a)][_0x2e2639(0xf0)](_0x973dac=>_0x973dac(Object[_0x2e2639(0xdb)](this[_0x2e2639(0x100)])));}[_0x66d2d(0xf2)](){const _0x27ccdc=_0x66d2d;this[_0x27ccdc(0xcd)][_0x27ccdc(0xe5)][_0x27ccdc(0xf0)](_0x377956=>_0x377956(this[_0x27ccdc(0xfd)]()));}[_0x66d2d(0xe2)](_0x184a8a){const _0x3ef378=_0x66d2d;this[_0x3ef378(0xcd)][_0x3ef378(0x111)][_0x3ef378(0xf0)](_0x1a77a6=>_0x1a77a6(_0x184a8a));}[_0x66d2d(0xf6)](_0x5c13e2,_0x540bbf){const _0x57ca96=_0x66d2d;this[_0x57ca96(0xcd)][_0x5c13e2]&&this[_0x57ca96(0xcd)][_0x5c13e2][_0x57ca96(0xde)](_0x540bbf);}[_0x66d2d(0xcc)](_0x1dc084,_0x2d6dd2){const _0x35487e=_0x66d2d;this[_0x35487e(0xcd)][_0x1dc084]&&(this[_0x35487e(0xcd)][_0x1dc084]=this[_0x35487e(0xcd)][_0x1dc084]['filter'](_0x25468c=>_0x25468c!==_0x2d6dd2));}}export{ChatManager};