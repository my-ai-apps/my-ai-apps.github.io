
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x550ad8=_0x1e7f;function _0xa750(){const _0x4dd156=['14602EoQkal','onConversationUpdate','MJnAE','createNewConversation','\x20conversations','New\x20Conversation','stringify','reduce','keys','conversations','setItem','getSortedConversations','MAX_STORAGE_SIZE','user','1731894vnwaum','5FQBTXv','toISOString','values','forEach','TUHLB','error','info','push','filter','getCurrentConversation','notifyCurrentConversationChange','2928BQVsuy','createdAt','EmCWf','17NWZMro','listeners','...','UHwXD','updatedAt','onCurrentConversationChange','Conversations\x20saved\x20successfully','messages','warn','conv_','length','MAX_CONVERSATIONS','XaieL','3105552rMqbSW','Failed\x20to\x20save\x20conversations','parse','Storage\x20cleanup\x20initiated','getItem','559575uTOuCi','notifyError','5|0|3|4|1|2','slice','deleteConversation','40SVYopk','now','LVNpN','removeEventListener','currentConversationId','weJXS','split','Trimmed\x20to\x20','title','15976125dORWCF','poDaS','Failed\x20to\x20load\x20conversations','Loaded\x20','loadConversations','xRNsF','onError','cleanupStorage','78472jOhiCM','saveConversations','1891611AYGBco'];_0xa750=function(){return _0x4dd156;};return _0xa750();}(function(_0x324acf,_0x55e295){const _0x2ea349=_0x1e7f,_0x279767=_0x324acf();while(!![]){try{const _0x55a1b6=parseInt(_0x2ea349(0x1c8))/0x1*(parseInt(_0x2ea349(0x1a8))/0x2)+parseInt(_0x2ea349(0x1aa))/0x3+parseInt(_0x2ea349(0x1d5))/0x4+-parseInt(_0x2ea349(0x1ba))/0x5*(-parseInt(_0x2ea349(0x1b9))/0x6)+parseInt(_0x2ea349(0x1ab))/0x7*(-parseInt(_0x2ea349(0x1c5))/0x8)+parseInt(_0x2ea349(0x1da))/0x9*(parseInt(_0x2ea349(0x1df))/0xa)+-parseInt(_0x2ea349(0x1e8))/0xb;if(_0x55a1b6===_0x55e295)break;else _0x279767['push'](_0x279767['shift']());}catch(_0x13e2bb){_0x279767['push'](_0x279767['shift']());}}}(_0xa750,0x608ab));import{Logger}from'./common.js';class Conversation{constructor(_0x2f0633,_0x2342c1){const _0x2f8782=_0x1e7f,_0x360e3e={'FJsFQ':'1|0|4|2|3'},_0x3b1aac=_0x360e3e['FJsFQ'][_0x2f8782(0x1e5)]('|');let _0x1f4558=0x0;while(!![]){switch(_0x3b1aac[_0x1f4558++]){case'0':this[_0x2f8782(0x1e7)]=_0x2342c1;continue;case'1':this['id']=_0x2f0633;continue;case'2':this[_0x2f8782(0x1c6)]=new Date()[_0x2f8782(0x1bb)]();continue;case'3':this[_0x2f8782(0x1cc)]=new Date()[_0x2f8782(0x1bb)]();continue;case'4':this[_0x2f8782(0x1cf)]=[];continue;}break;}}}class ChatManager{constructor(){const _0xbd2e69=_0x1e7f,_0x2acd92={'DUEdq':_0xbd2e69(0x1dc),'TUHLB':function(_0x4785c0,_0xc18a96){return _0x4785c0*_0xc18a96;}},_0x13fa0d=_0x2acd92['DUEdq'][_0xbd2e69(0x1e5)]('|');let _0x55ee54=0x0;while(!![]){switch(_0x13fa0d[_0x55ee54++]){case'0':this[_0xbd2e69(0x1e3)]=null;continue;case'1':this[_0xbd2e69(0x1d3)]=0x32;continue;case'2':this[_0xbd2e69(0x1a4)]();continue;case'3':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'4':this['MAX_STORAGE_SIZE']=_0x2acd92[_0xbd2e69(0x1be)](4.5,0x400)*0x400;continue;case'5':this['conversations']={};continue;}break;}}async['loadConversations'](){const _0x5bf664=_0x1e7f,_0x3a2674={'OFsCB':_0x5bf664(0x1a2)};try{const _0x5c52d2=localStorage[_0x5bf664(0x1d9)](_0x5bf664(0x1b4));if(_0x5c52d2){const _0x509615=JSON[_0x5bf664(0x1d7)](_0x5c52d2)||[];this[_0x5bf664(0x1b4)]=_0x509615[_0x5bf664(0x1b2)]((_0x19836e,_0xee7cb5)=>{const _0x53fc13=_0x5bf664,_0x2b0044='4|0|1|3|2'[_0x53fc13(0x1e5)]('|');let _0x41cd6d=0x0;while(!![]){switch(_0x2b0044[_0x41cd6d++]){case'0':_0x19836e[_0xee7cb5['id']]['messages']=_0xee7cb5['messages']||[];continue;case'1':_0x19836e[_0xee7cb5['id']][_0x53fc13(0x1c6)]=_0xee7cb5['createdAt'];continue;case'2':return _0x19836e;case'3':_0x19836e[_0xee7cb5['id']]['updatedAt']=_0xee7cb5[_0x53fc13(0x1cc)];continue;case'4':_0x19836e[_0xee7cb5['id']]=new Conversation(_0xee7cb5['id'],_0xee7cb5[_0x53fc13(0x1e7)]);continue;}break;}},{}),Object[_0x5bf664(0x1b3)](this[_0x5bf664(0x1b4)])['length']>0x0&&(this[_0x5bf664(0x1e3)]=Object['keys'](this[_0x5bf664(0x1b4)])[0x0]),Logger['info'](_0x5bf664(0x1a3)+Object[_0x5bf664(0x1b3)](this[_0x5bf664(0x1b4)])[_0x5bf664(0x1d2)]+_0x5bf664(0x1af));}}catch(_0x57a98d){const _0x343114=Logger[_0x5bf664(0x1bf)](_0x3a2674['OFsCB'],_0x57a98d);this[_0x5bf664(0x1db)](_0x343114),this['conversations']={};}}async[_0x550ad8(0x1a9)](){const _0x2deaf0=_0x550ad8,_0xe6af2b={'RMGvg':function(_0x3cfe43,_0x53fa5e){return _0x3cfe43>_0x53fa5e;},'kMGvg':_0x2deaf0(0x1b4),'UHwXD':_0x2deaf0(0x1ce),'JKOHv':_0x2deaf0(0x1d6)};try{const _0x59b471=JSON['stringify'](Object['values'](this[_0x2deaf0(0x1b4)]));_0xe6af2b['RMGvg'](_0x59b471[_0x2deaf0(0x1d2)],this[_0x2deaf0(0x1b7)])&&await this[_0x2deaf0(0x1a7)](),localStorage[_0x2deaf0(0x1b5)](_0xe6af2b['kMGvg'],_0x59b471),this['notifyConversationUpdate'](),Logger[_0x2deaf0(0x1c0)](_0xe6af2b[_0x2deaf0(0x1cb)]);}catch(_0x2d551f){const _0x5845ba=Logger[_0x2deaf0(0x1bf)](_0xe6af2b['JKOHv'],_0x2d551f);this['notifyError'](_0x5845ba);}}async[_0x550ad8(0x1a7)](){const _0x24a9a1=_0x550ad8,_0x133ddf={'MJnAE':_0x24a9a1(0x1d8),'poDaS':function(_0x2bb96d,_0x3cf27e){return _0x2bb96d>_0x3cf27e;},'xRNsF':'Storage\x20cleanup\x20completed'};Logger[_0x24a9a1(0x1d0)](_0x133ddf[_0x24a9a1(0x1ad)]);const _0x5e4342=this[_0x24a9a1(0x1b6)]();_0x133ddf[_0x24a9a1(0x1a1)](_0x5e4342[_0x24a9a1(0x1d2)],this[_0x24a9a1(0x1d3)])&&(this[_0x24a9a1(0x1b4)]=_0x5e4342[_0x24a9a1(0x1dd)](0x0,this['MAX_CONVERSATIONS'])[_0x24a9a1(0x1b2)]((_0x30207c,_0x3a478d)=>{return _0x30207c[_0x3a478d['id']]=_0x3a478d,_0x30207c;},{}),Logger[_0x24a9a1(0x1c0)](_0x24a9a1(0x1e6)+this[_0x24a9a1(0x1d3)]+'\x20most\x20recent\x20conversations'));let _0xe8894b=JSON[_0x24a9a1(0x1b1)](Object[_0x24a9a1(0x1bc)](this['conversations']))[_0x24a9a1(0x1d2)];while(_0xe8894b>this['MAX_STORAGE_SIZE']&&Object[_0x24a9a1(0x1b3)](this[_0x24a9a1(0x1b4)])[_0x24a9a1(0x1d2)]>0x0){const _0x3c7f4b=_0x5e4342['pop']();_0x133ddf[_0x24a9a1(0x1a1)](_0x3c7f4b['messages'][_0x24a9a1(0x1d2)],0xa)?_0x3c7f4b['messages']=_0x3c7f4b[_0x24a9a1(0x1cf)][_0x24a9a1(0x1dd)](-0xa):delete this[_0x24a9a1(0x1b4)][_0x3c7f4b['id']],_0xe8894b=JSON[_0x24a9a1(0x1b1)](Object[_0x24a9a1(0x1bc)](this[_0x24a9a1(0x1b4)]))[_0x24a9a1(0x1d2)];}Logger[_0x24a9a1(0x1c0)](_0x133ddf[_0x24a9a1(0x1a5)]);}async[_0x550ad8(0x1ae)](_0xbd1b3b='New\x20Conversation'){const _0x3f1f8d=_0x550ad8,_0x384e2d=_0x3f1f8d(0x1d1)+Date[_0x3f1f8d(0x1e0)](),_0x51e55e=new Conversation(_0x384e2d,_0xbd1b3b);return this['conversations'][_0x384e2d]=_0x51e55e,this[_0x3f1f8d(0x1e3)]=_0x384e2d,await this[_0x3f1f8d(0x1a9)](),this[_0x3f1f8d(0x1c4)](),_0x384e2d;}['getCurrentConversation'](){const _0xb5d061=_0x550ad8;return this[_0xb5d061(0x1b4)][this[_0xb5d061(0x1e3)]]||null;}async['addMessage'](_0x252b05,_0x7a1601){const _0x81f877=_0x550ad8,_0x46b1d7={'LVNpN':function(_0x2326f5,_0x14022d){return _0x2326f5===_0x14022d;},'EmCWf':_0x81f877(0x1b8),'weJXS':function(_0x153753,_0x48dd7b){return _0x153753===_0x48dd7b;},'XaieL':_0x81f877(0x1b0)},_0x49f5b5=this[_0x81f877(0x1c3)]();if(!_0x49f5b5)return![];const _0x5918b2={'role':_0x7a1601,'content':_0x252b05,'timestamp':new Date()[_0x81f877(0x1bb)]()};return _0x49f5b5[_0x81f877(0x1cf)][_0x81f877(0x1c1)](_0x5918b2),_0x49f5b5[_0x81f877(0x1cc)]=new Date()[_0x81f877(0x1bb)](),_0x46b1d7[_0x81f877(0x1e1)](_0x7a1601,_0x46b1d7[_0x81f877(0x1c7)])&&_0x46b1d7[_0x81f877(0x1e4)](_0x49f5b5[_0x81f877(0x1e7)],_0x46b1d7[_0x81f877(0x1d4)])&&_0x49f5b5[_0x81f877(0x1cf)][_0x81f877(0x1d2)]===0x1&&(_0x49f5b5[_0x81f877(0x1e7)]=_0x252b05[_0x81f877(0x1e5)]('\x20')['slice'](0x0,0x4)['join']('\x20')+_0x81f877(0x1ca)),await this['saveConversations'](),!![];}async[_0x550ad8(0x1de)](_0x2264a0){const _0x4593b2=_0x550ad8;this[_0x4593b2(0x1b4)][_0x2264a0]&&(delete this[_0x4593b2(0x1b4)][_0x2264a0],this[_0x4593b2(0x1e3)]===_0x2264a0&&(this[_0x4593b2(0x1e3)]=Object['keys'](this[_0x4593b2(0x1b4)])[0x0]||null),await this[_0x4593b2(0x1a9)]());}['switchConversation'](_0xdb6213){const _0x11fe49=_0x550ad8;if(this['conversations'][_0xdb6213])return this[_0x11fe49(0x1e3)]=_0xdb6213,this[_0x11fe49(0x1c4)](),!![];return![];}[_0x550ad8(0x1b6)](){const _0x4b7314=_0x550ad8;return Object[_0x4b7314(0x1bc)](this[_0x4b7314(0x1b4)])['sort']((_0x3ae94b,_0x2fd8f9)=>new Date(_0x2fd8f9[_0x4b7314(0x1cc)])-new Date(_0x3ae94b[_0x4b7314(0x1cc)]));}['notifyConversationUpdate'](){const _0x203d2f=_0x550ad8;this['listeners'][_0x203d2f(0x1ac)][_0x203d2f(0x1bd)](_0x2c2715=>_0x2c2715(Object['values'](this[_0x203d2f(0x1b4)])));}['notifyCurrentConversationChange'](){const _0x3b2be1=_0x550ad8;this[_0x3b2be1(0x1c9)][_0x3b2be1(0x1cd)][_0x3b2be1(0x1bd)](_0x3c0201=>_0x3c0201(this[_0x3b2be1(0x1c3)]()));}[_0x550ad8(0x1db)](_0x2f935c){const _0x3fd389=_0x550ad8;this[_0x3fd389(0x1c9)][_0x3fd389(0x1a6)]['forEach'](_0x3b0db4=>_0x3b0db4(_0x2f935c));}['addEventListener'](_0xcbc561,_0xd9ab6e){const _0x10d968=_0x550ad8;this['listeners'][_0xcbc561]&&this[_0x10d968(0x1c9)][_0xcbc561][_0x10d968(0x1c1)](_0xd9ab6e);}[_0x550ad8(0x1e2)](_0x15ca78,_0x14142e){const _0x456800=_0x550ad8;this[_0x456800(0x1c9)][_0x15ca78]&&(this[_0x456800(0x1c9)][_0x15ca78]=this['listeners'][_0x15ca78][_0x456800(0x1c2)](_0x39148a=>_0x39148a!==_0x14142e));}}function _0x1e7f(_0x5547e6,_0x43100b){const _0xa750c2=_0xa750();return _0x1e7f=function(_0x1e7fc6,_0x51c538){_0x1e7fc6=_0x1e7fc6-0x1a1;let _0x392bea=_0xa750c2[_0x1e7fc6];return _0x392bea;},_0x1e7f(_0x5547e6,_0x43100b);}export{ChatManager};