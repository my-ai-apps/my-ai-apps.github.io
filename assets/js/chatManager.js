
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x239407=_0xb897;(function(_0x1bb179,_0x1067df){const _0x39963b=_0xb897,_0x285d2=_0x1bb179();while(!![]){try{const _0x64b283=-parseInt(_0x39963b(0x15a))/0x1*(parseInt(_0x39963b(0x138))/0x2)+-parseInt(_0x39963b(0x146))/0x3+parseInt(_0x39963b(0x14d))/0x4+parseInt(_0x39963b(0x14a))/0x5*(-parseInt(_0x39963b(0x17a))/0x6)+-parseInt(_0x39963b(0x130))/0x7*(parseInt(_0x39963b(0x178))/0x8)+-parseInt(_0x39963b(0x173))/0x9+-parseInt(_0x39963b(0x16c))/0xa*(-parseInt(_0x39963b(0x175))/0xb);if(_0x64b283===_0x1067df)break;else _0x285d2['push'](_0x285d2['shift']());}catch(_0x1e4746){_0x285d2['push'](_0x285d2['shift']());}}}(_0x2e00,0x5881c));function _0x2e00(){const _0x4ecbc8=['\x20conversations','addEventListener','notifyCurrentConversationChange','MAX_CONVERSATIONS','5|2|3|1|0|4','sort','stringify','13600sJOQyU','sjUVJ','Geryq','notifyError','createNewConversation','lLiDl','updatedAt','495486eZNYjx','listeners','9482BNSYXv','keys','Conversations\x20saved\x20successfully','16uZuAnw','now','42uHCftb','Trimmed\x20to\x20','fnUrD','RjQYx','3|2|4|0|1','2005115DLZlRi','Failed\x20to\x20save\x20conversations','getItem','conversations','New\x20Conversation','values','qrfwp','onError','6VehJwN','saveConversations','title','xVYon','warn','pop','pEosG','kHqes','messages','conv_','PiOPi','filter','LZKLO','getSortedConversations','762273lwnGvS','FUJbe','toISOString','length','151180WqgzGL','error','Storage\x20cleanup\x20initiated','1783864OsCfFu','createdAt','join','split','addMessage','info','getCurrentConversation','push','forEach','onConversationUpdate','fEFHp','notifyConversationUpdate','NRavN','54025uWfkrV','cleanupStorage','slice','hArMX','4|0|2|1|3','onCurrentConversationChange','currentConversationId','...','deleteConversation','reduce','MAX_STORAGE_SIZE'];_0x2e00=function(){return _0x4ecbc8;};return _0x2e00();}import{Logger}from'./common.js';class Conversation{constructor(_0x88faa1,_0x4233f1){const _0x45040c=_0xb897,_0x5b197b={'xVYon':_0x45040c(0x12f)},_0x2f8478=_0x5b197b[_0x45040c(0x13b)]['split']('|');let _0x2ba16f=0x0;while(!![]){switch(_0x2f8478[_0x2ba16f++]){case'0':this[_0x45040c(0x14e)]=new Date()[_0x45040c(0x148)]();continue;case'1':this[_0x45040c(0x172)]=new Date()[_0x45040c(0x148)]();continue;case'2':this[_0x45040c(0x13a)]=_0x4233f1;continue;case'3':this['id']=_0x88faa1;continue;case'4':this[_0x45040c(0x140)]=[];continue;}break;}}}function _0xb897(_0x40a17b,_0x32d7af){const _0x2e0039=_0x2e00();return _0xb897=function(_0xb897b,_0x4fe946){_0xb897b=_0xb897b-0x12c;let _0x36ad47=_0x2e0039[_0xb897b];return _0x36ad47;},_0xb897(_0x40a17b,_0x32d7af);}class ChatManager{constructor(){const _0x450ea3=_0xb897,_0xa09ac8={'FUJbe':_0x450ea3(0x169),'YvtAi':function(_0x4487ea,_0x4e1789){return _0x4487ea*_0x4e1789;}},_0x8cd624=_0xa09ac8[_0x450ea3(0x147)][_0x450ea3(0x150)]('|');let _0x7488df=0x0;while(!![]){switch(_0x8cd624[_0x7488df++]){case'0':this[_0x450ea3(0x168)]=0x32;continue;case'1':this[_0x450ea3(0x164)]=_0xa09ac8['YvtAi'](4.5*0x400,0x400);continue;case'2':this[_0x450ea3(0x160)]=null;continue;case'3':this[_0x450ea3(0x174)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'4':this['loadConversations']();continue;case'5':this[_0x450ea3(0x133)]={};continue;}break;}}async['loadConversations'](){const _0x2aec44=_0xb897,_0x5d7d07={'LZKLO':_0x2aec44(0x15e)};try{const _0x4e2526=localStorage[_0x2aec44(0x132)]('conversations');if(_0x4e2526){const _0xbd5073=JSON['parse'](_0x4e2526)||[];this[_0x2aec44(0x133)]=_0xbd5073[_0x2aec44(0x163)]((_0x4677cf,_0x561366)=>{const _0x2e1126=_0x2aec44,_0x36e5cc=_0x5d7d07[_0x2e1126(0x144)][_0x2e1126(0x150)]('|');let _0x331887=0x0;while(!![]){switch(_0x36e5cc[_0x331887++]){case'0':_0x4677cf[_0x561366['id']][_0x2e1126(0x140)]=_0x561366[_0x2e1126(0x140)]||[];continue;case'1':_0x4677cf[_0x561366['id']][_0x2e1126(0x172)]=_0x561366[_0x2e1126(0x172)];continue;case'2':_0x4677cf[_0x561366['id']][_0x2e1126(0x14e)]=_0x561366[_0x2e1126(0x14e)];continue;case'3':return _0x4677cf;case'4':_0x4677cf[_0x561366['id']]=new Conversation(_0x561366['id'],_0x561366['title']);continue;}break;}},{}),Object['keys'](this[_0x2aec44(0x133)])['length']>0x0&&(this[_0x2aec44(0x160)]=Object[_0x2aec44(0x176)](this['conversations'])[0x0]),Logger[_0x2aec44(0x152)]('Loaded\x20'+Object['keys'](this[_0x2aec44(0x133)])['length']+_0x2aec44(0x165));}}catch(_0x4914bc){const _0x2ce932=Logger[_0x2aec44(0x14b)]('Failed\x20to\x20load\x20conversations',_0x4914bc);this[_0x2aec44(0x16f)](_0x2ce932),this[_0x2aec44(0x133)]={};}}async[_0x239407(0x139)](){const _0x754562=_0x239407,_0x35d2e1={'sXCgK':function(_0xaadcc1,_0x4c60bd){return _0xaadcc1>_0x4c60bd;},'pEosG':_0x754562(0x133),'fEFHp':_0x754562(0x177),'sjUVJ':_0x754562(0x131)};try{const _0x59654e=JSON[_0x754562(0x16b)](Object[_0x754562(0x135)](this[_0x754562(0x133)]));_0x35d2e1['sXCgK'](_0x59654e['length'],this[_0x754562(0x164)])&&await this['cleanupStorage'](),localStorage['setItem'](_0x35d2e1[_0x754562(0x13e)],_0x59654e),this[_0x754562(0x158)](),Logger[_0x754562(0x152)](_0x35d2e1[_0x754562(0x157)]);}catch(_0x15e673){const _0x41531c=Logger[_0x754562(0x14b)](_0x35d2e1[_0x754562(0x16d)],_0x15e673);this[_0x754562(0x16f)](_0x41531c);}}async[_0x239407(0x15b)](){const _0x49c041=_0x239407,_0x472999={'NRavN':_0x49c041(0x14c),'RjQYx':function(_0x3c37b2,_0x39db38){return _0x3c37b2>_0x39db38;},'lLiDl':'Storage\x20cleanup\x20completed'};Logger[_0x49c041(0x13c)](_0x472999[_0x49c041(0x159)]);const _0x27c15b=this[_0x49c041(0x145)]();_0x472999['RjQYx'](_0x27c15b[_0x49c041(0x149)],this[_0x49c041(0x168)])&&(this[_0x49c041(0x133)]=_0x27c15b[_0x49c041(0x15c)](0x0,this[_0x49c041(0x168)])['reduce']((_0x56db6a,_0x3cc388)=>{return _0x56db6a[_0x3cc388['id']]=_0x3cc388,_0x56db6a;},{}),Logger[_0x49c041(0x152)](_0x49c041(0x12c)+this[_0x49c041(0x168)]+'\x20most\x20recent\x20conversations'));let _0x206cf7=JSON['stringify'](Object['values'](this[_0x49c041(0x133)]))[_0x49c041(0x149)];while(_0x472999['RjQYx'](_0x206cf7,this['MAX_STORAGE_SIZE'])&&Object[_0x49c041(0x176)](this[_0x49c041(0x133)])[_0x49c041(0x149)]>0x0){const _0x5e64ad=_0x27c15b[_0x49c041(0x13d)]();_0x472999[_0x49c041(0x12e)](_0x5e64ad[_0x49c041(0x140)][_0x49c041(0x149)],0xa)?_0x5e64ad[_0x49c041(0x140)]=_0x5e64ad[_0x49c041(0x140)]['slice'](-0xa):delete this[_0x49c041(0x133)][_0x5e64ad['id']],_0x206cf7=JSON['stringify'](Object[_0x49c041(0x135)](this[_0x49c041(0x133)]))[_0x49c041(0x149)];}Logger[_0x49c041(0x152)](_0x472999[_0x49c041(0x171)]);}async[_0x239407(0x170)](_0x401370=_0x239407(0x134)){const _0xd1478=_0x239407,_0xa0ab5=_0xd1478(0x141)+Date[_0xd1478(0x179)](),_0x5d28d7=new Conversation(_0xa0ab5,_0x401370);return this['conversations'][_0xa0ab5]=_0x5d28d7,this['currentConversationId']=_0xa0ab5,await this[_0xd1478(0x139)](),this[_0xd1478(0x167)](),_0xa0ab5;}[_0x239407(0x153)](){const _0x53b7ed=_0x239407;return this[_0x53b7ed(0x133)][this['currentConversationId']]||null;}async[_0x239407(0x151)](_0x40ad79,_0x3a6a9f){const _0xb6e964=_0x239407,_0x53b48b={'hArMX':'user','hrPNw':function(_0x2922c6,_0x11ff54){return _0x2922c6===_0x11ff54;},'fnUrD':'New\x20Conversation','PiOPi':function(_0x12b809,_0x168b95){return _0x12b809===_0x168b95;},'kHqes':function(_0x4e2c83,_0x54f80d){return _0x4e2c83+_0x54f80d;},'qrfwp':_0xb6e964(0x161)},_0x5dfbab=this[_0xb6e964(0x153)]();if(!_0x5dfbab)return![];const _0x1d469c={'role':_0x3a6a9f,'content':_0x40ad79,'timestamp':new Date()['toISOString']()};return _0x5dfbab[_0xb6e964(0x140)][_0xb6e964(0x154)](_0x1d469c),_0x5dfbab[_0xb6e964(0x172)]=new Date()[_0xb6e964(0x148)](),_0x3a6a9f===_0x53b48b[_0xb6e964(0x15d)]&&_0x53b48b['hrPNw'](_0x5dfbab['title'],_0x53b48b[_0xb6e964(0x12d)])&&_0x53b48b[_0xb6e964(0x142)](_0x5dfbab[_0xb6e964(0x140)][_0xb6e964(0x149)],0x1)&&(_0x5dfbab[_0xb6e964(0x13a)]=_0x53b48b[_0xb6e964(0x13f)](_0x40ad79[_0xb6e964(0x150)]('\x20')[_0xb6e964(0x15c)](0x0,0x4)[_0xb6e964(0x14f)]('\x20'),_0x53b48b[_0xb6e964(0x136)])),await this[_0xb6e964(0x139)](),!![];}async[_0x239407(0x162)](_0x59f30a){const _0x2f2d2a=_0x239407,_0xc9d662={'Geryq':function(_0x17076e,_0x13ff20){return _0x17076e===_0x13ff20;}};this[_0x2f2d2a(0x133)][_0x59f30a]&&(delete this[_0x2f2d2a(0x133)][_0x59f30a],_0xc9d662[_0x2f2d2a(0x16e)](this[_0x2f2d2a(0x160)],_0x59f30a)&&(this['currentConversationId']=Object[_0x2f2d2a(0x176)](this[_0x2f2d2a(0x133)])[0x0]||null),await this['saveConversations']());}['switchConversation'](_0x2dfc41){const _0x31aea6=_0x239407;if(this['conversations'][_0x2dfc41])return this[_0x31aea6(0x160)]=_0x2dfc41,this[_0x31aea6(0x167)](),!![];return![];}[_0x239407(0x145)](){const _0x5eb82c=_0x239407;return Object[_0x5eb82c(0x135)](this[_0x5eb82c(0x133)])[_0x5eb82c(0x16a)]((_0x18d1bd,_0x29dddf)=>new Date(_0x29dddf['updatedAt'])-new Date(_0x18d1bd[_0x5eb82c(0x172)]));}['notifyConversationUpdate'](){const _0x52108f=_0x239407;this[_0x52108f(0x174)][_0x52108f(0x156)]['forEach'](_0x10de6d=>_0x10de6d(Object['values'](this['conversations'])));}[_0x239407(0x167)](){const _0x33203a=_0x239407;this[_0x33203a(0x174)][_0x33203a(0x15f)]['forEach'](_0x1d2d9d=>_0x1d2d9d(this[_0x33203a(0x153)]()));}['notifyError'](_0x579e2a){const _0x380385=_0x239407;this['listeners'][_0x380385(0x137)][_0x380385(0x155)](_0x3d048b=>_0x3d048b(_0x579e2a));}[_0x239407(0x166)](_0x177882,_0x1797f2){const _0xef96a1=_0x239407;this[_0xef96a1(0x174)][_0x177882]&&this['listeners'][_0x177882][_0xef96a1(0x154)](_0x1797f2);}['removeEventListener'](_0x722f41,_0x33d7bb){const _0x40716d=_0x239407;this[_0x40716d(0x174)][_0x722f41]&&(this[_0x40716d(0x174)][_0x722f41]=this[_0x40716d(0x174)][_0x722f41][_0x40716d(0x143)](_0x18835e=>_0x18835e!==_0x33d7bb));}}export{ChatManager};