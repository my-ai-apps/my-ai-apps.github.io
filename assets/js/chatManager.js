
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x2c97(_0x19843f,_0x362761){const _0x511783=_0x5117();return _0x2c97=function(_0x2c97b3,_0x392bf9){_0x2c97b3=_0x2c97b3-0xdb;let _0x1d8eb7=_0x511783[_0x2c97b3];return _0x1d8eb7;},_0x2c97(_0x19843f,_0x362761);}function _0x5117(){const _0x5292d4=['ihuGW','703695IBeTLF','messages','reduce','lceOS','conversations','pucki','4410OEcMZP','stringify','\x20most\x20recent\x20conversations','onError','filter','conv_','onCurrentConversationChange','title','YVNWf','now','keys','length','MAX_CONVERSATIONS','783iepXYn','17782vatzxl','4NifmKI','user','setItem','New\x20Conversation','peryu','notifyCurrentConversationChange','values','split','push','addEventListener','loadConversations','currentConversationId','20uMVnjs','Trimmed\x20to\x20','toISOString','warn','4|2|3|1|0','iLkas','8jsJlbQ','cleanupStorage','notifyConversationUpdate','slice','getSortedConversations','createdAt','getCurrentConversation','sort','Failed\x20to\x20save\x20conversations','parse','saveConversations','notifyError','forEach','...','removeEventListener','Bzzug','join','updatedAt','13WlishI','error','IaLvr','249666SOwBhn','MAX_STORAGE_SIZE','jiUBS','FZjZq','getItem','48LJFmQo','Failed\x20to\x20load\x20conversations','407429RtQAHw','HEUva','info','140938yoxlVt','listeners','CpxGv','1427062ZbFEZZ'];_0x5117=function(){return _0x5292d4;};return _0x5117();}const _0x515bd5=_0x2c97;(function(_0xd8ff9d,_0x221f15){const _0x3a6bf7=_0x2c97,_0x1bae4d=_0xd8ff9d();while(!![]){try{const _0x3d0eb2=-parseInt(_0x3a6bf7(0xdb))/0x1*(-parseInt(_0x3a6bf7(0x101))/0x2)+-parseInt(_0x3a6bf7(0xed))/0x3*(parseInt(_0x3a6bf7(0x102))/0x4)+-parseInt(_0x3a6bf7(0x10e))/0x5*(parseInt(_0x3a6bf7(0xde))/0x6)+-parseInt(_0x3a6bf7(0xe8))/0x7*(-parseInt(_0x3a6bf7(0x114))/0x8)+-parseInt(_0x3a6bf7(0x100))/0x9*(parseInt(_0x3a6bf7(0xf3))/0xa)+parseInt(_0x3a6bf7(0xe5))/0xb+parseInt(_0x3a6bf7(0xe3))/0xc*(parseInt(_0x3a6bf7(0xeb))/0xd);if(_0x3d0eb2===_0x221f15)break;else _0x1bae4d['push'](_0x1bae4d['shift']());}catch(_0x295eb9){_0x1bae4d['push'](_0x1bae4d['shift']());}}}(_0x5117,0x2a1bc));import{Logger}from'./common.js';class Conversation{constructor(_0x2e9176,_0x614586){const _0x5d7143=_0x2c97;this['id']=_0x2e9176,this[_0x5d7143(0xfa)]=_0x614586,this[_0x5d7143(0xee)]=[],this[_0x5d7143(0x119)]=new Date()[_0x5d7143(0x110)](),this[_0x5d7143(0x125)]=new Date()['toISOString']();}}class ChatManager{constructor(){const _0xbfea20=_0x2c97,_0x39e7c9={'YVNWf':function(_0x347999,_0x430f02){return _0x347999*_0x430f02;}};this['conversations']={},this[_0xbfea20(0x10d)]=null,this[_0xbfea20(0xe9)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]},this[_0xbfea20(0xdf)]=_0x39e7c9[_0xbfea20(0xfb)](4.5*0x400,0x400),this[_0xbfea20(0xff)]=0x32,this[_0xbfea20(0x10c)]();}async['loadConversations'](){const _0x363796=_0x2c97,_0x99d019={'ackbf':_0x363796(0x112),'iLkas':_0x363796(0xf1),'jiUBS':function(_0x1e4c58,_0x3928b6){return _0x1e4c58>_0x3928b6;},'IaLvr':_0x363796(0xe4)};try{const _0x50e636=localStorage[_0x363796(0xe2)](_0x99d019[_0x363796(0x113)]);if(_0x50e636){const _0x1acce5=JSON[_0x363796(0x11d)](_0x50e636)||[];this['conversations']=_0x1acce5['reduce']((_0x325396,_0x10ae6a)=>{const _0x30fe65=_0x363796,_0x29e395=_0x99d019['ackbf'][_0x30fe65(0x109)]('|');let _0x288f7c=0x0;while(!![]){switch(_0x29e395[_0x288f7c++]){case'0':return _0x325396;case'1':_0x325396[_0x10ae6a['id']][_0x30fe65(0x125)]=_0x10ae6a[_0x30fe65(0x125)];continue;case'2':_0x325396[_0x10ae6a['id']][_0x30fe65(0xee)]=_0x10ae6a[_0x30fe65(0xee)]||[];continue;case'3':_0x325396[_0x10ae6a['id']][_0x30fe65(0x119)]=_0x10ae6a['createdAt'];continue;case'4':_0x325396[_0x10ae6a['id']]=new Conversation(_0x10ae6a['id'],_0x10ae6a[_0x30fe65(0xfa)]);continue;}break;}},{}),_0x99d019[_0x363796(0xe0)](Object[_0x363796(0xfd)](this[_0x363796(0xf1)])[_0x363796(0xfe)],0x0)&&(this['currentConversationId']=Object[_0x363796(0xfd)](this[_0x363796(0xf1)])[0x0]),Logger['info']('Loaded\x20'+Object['keys'](this[_0x363796(0xf1)])[_0x363796(0xfe)]+'\x20conversations');}}catch(_0x14f53b){const _0x51dd68=Logger[_0x363796(0xdc)](_0x99d019[_0x363796(0xdd)],_0x14f53b);this[_0x363796(0x11f)](_0x51dd68),this[_0x363796(0xf1)]={};}}async[_0x515bd5(0x11e)](){const _0x2b9ee8=_0x515bd5,_0x32c0f5={'HEUva':function(_0x533cab,_0x3738da){return _0x533cab>_0x3738da;},'FZjZq':'conversations'};try{const _0x20604c=JSON['stringify'](Object['values'](this[_0x2b9ee8(0xf1)]));_0x32c0f5[_0x2b9ee8(0xe6)](_0x20604c[_0x2b9ee8(0xfe)],this[_0x2b9ee8(0xdf)])&&await this[_0x2b9ee8(0x115)](),localStorage[_0x2b9ee8(0x104)](_0x32c0f5[_0x2b9ee8(0xe1)],_0x20604c),this['notifyConversationUpdate'](),Logger[_0x2b9ee8(0xe7)]('Conversations\x20saved\x20successfully');}catch(_0x571bf3){const _0x29ec3a=Logger['error'](_0x2b9ee8(0x11c),_0x571bf3);this[_0x2b9ee8(0x11f)](_0x29ec3a);}}async['cleanupStorage'](){const _0xa2133c=_0x515bd5,_0x581335={'UJaUm':function(_0x1aa89f,_0x4df59e){return _0x1aa89f>_0x4df59e;},'pucki':function(_0x5d0469,_0xf56402){return _0x5d0469>_0xf56402;},'yrwaA':function(_0x4e8477,_0x54e20d){return _0x4e8477>_0x54e20d;},'FznsL':'Storage\x20cleanup\x20completed'};Logger[_0xa2133c(0x111)]('Storage\x20cleanup\x20initiated');const _0xb38d77=this[_0xa2133c(0x118)]();_0x581335['UJaUm'](_0xb38d77[_0xa2133c(0xfe)],this[_0xa2133c(0xff)])&&(this[_0xa2133c(0xf1)]=_0xb38d77[_0xa2133c(0x117)](0x0,this['MAX_CONVERSATIONS'])[_0xa2133c(0xef)]((_0x5a534a,_0x30cad8)=>{return _0x5a534a[_0x30cad8['id']]=_0x30cad8,_0x5a534a;},{}),Logger[_0xa2133c(0xe7)](_0xa2133c(0x10f)+this[_0xa2133c(0xff)]+_0xa2133c(0xf5)));let _0x2bccc7=JSON[_0xa2133c(0xf4)](Object[_0xa2133c(0x108)](this['conversations']))[_0xa2133c(0xfe)];while(_0x581335['UJaUm'](_0x2bccc7,this[_0xa2133c(0xdf)])&&_0x581335[_0xa2133c(0xf2)](Object[_0xa2133c(0xfd)](this[_0xa2133c(0xf1)])['length'],0x0)){const _0x5eff54=_0xb38d77['pop']();_0x581335['yrwaA'](_0x5eff54[_0xa2133c(0xee)][_0xa2133c(0xfe)],0xa)?_0x5eff54['messages']=_0x5eff54[_0xa2133c(0xee)][_0xa2133c(0x117)](-0xa):delete this[_0xa2133c(0xf1)][_0x5eff54['id']],_0x2bccc7=JSON[_0xa2133c(0xf4)](Object[_0xa2133c(0x108)](this[_0xa2133c(0xf1)]))['length'];}Logger[_0xa2133c(0xe7)](_0x581335['FznsL']);}async['createNewConversation'](_0x30d7c1='New\x20Conversation'){const _0x1b11e2=_0x515bd5,_0x52368f=_0x1b11e2(0xf8)+Date[_0x1b11e2(0xfc)](),_0x3dcf02=new Conversation(_0x52368f,_0x30d7c1);return this[_0x1b11e2(0xf1)][_0x52368f]=_0x3dcf02,this[_0x1b11e2(0x10d)]=_0x52368f,await this[_0x1b11e2(0x11e)](),this[_0x1b11e2(0x107)](),_0x52368f;}['getCurrentConversation'](){const _0x1a1f64=_0x515bd5;return this[_0x1a1f64(0xf1)][this[_0x1a1f64(0x10d)]]||null;}async['addMessage'](_0x279d3f,_0x9c1249){const _0x2a512c=_0x515bd5,_0x1d0e31={'ihuGW':function(_0x35129b,_0x11b164){return _0x35129b===_0x11b164;},'CpxGv':_0x2a512c(0x105),'peryu':function(_0x8c5b92,_0x71ac44){return _0x8c5b92===_0x71ac44;},'Bzzug':function(_0x45fabd,_0x3b2e02){return _0x45fabd+_0x3b2e02;}},_0x1ea1fd=this[_0x2a512c(0x11a)]();if(!_0x1ea1fd)return![];const _0x193f2c={'role':_0x9c1249,'content':_0x279d3f,'timestamp':new Date()[_0x2a512c(0x110)]()};return _0x1ea1fd[_0x2a512c(0xee)][_0x2a512c(0x10a)](_0x193f2c),_0x1ea1fd[_0x2a512c(0x125)]=new Date()[_0x2a512c(0x110)](),_0x1d0e31[_0x2a512c(0xec)](_0x9c1249,_0x2a512c(0x103))&&_0x1d0e31[_0x2a512c(0xec)](_0x1ea1fd[_0x2a512c(0xfa)],_0x1d0e31[_0x2a512c(0xea)])&&_0x1d0e31[_0x2a512c(0x106)](_0x1ea1fd['messages']['length'],0x1)&&(_0x1ea1fd['title']=_0x1d0e31[_0x2a512c(0x123)](_0x279d3f[_0x2a512c(0x109)]('\x20')[_0x2a512c(0x117)](0x0,0x4)[_0x2a512c(0x124)]('\x20'),_0x2a512c(0x121))),await this[_0x2a512c(0x11e)](),!![];}async['deleteConversation'](_0x3f608c){const _0x227c23=_0x515bd5,_0x5bfec9={'lceOS':function(_0x47791e,_0x4d41f8){return _0x47791e===_0x4d41f8;}};this[_0x227c23(0xf1)][_0x3f608c]&&(delete this['conversations'][_0x3f608c],_0x5bfec9[_0x227c23(0xf0)](this[_0x227c23(0x10d)],_0x3f608c)&&(this[_0x227c23(0x10d)]=Object[_0x227c23(0xfd)](this['conversations'])[0x0]||null),await this[_0x227c23(0x11e)]());}['switchConversation'](_0x106860){const _0x5093ea=_0x515bd5;if(this[_0x5093ea(0xf1)][_0x106860])return this[_0x5093ea(0x10d)]=_0x106860,this['notifyCurrentConversationChange'](),!![];return![];}['getSortedConversations'](){const _0x56e480=_0x515bd5;return Object[_0x56e480(0x108)](this[_0x56e480(0xf1)])[_0x56e480(0x11b)]((_0x1c6104,_0x1a2206)=>new Date(_0x1a2206['updatedAt'])-new Date(_0x1c6104[_0x56e480(0x125)]));}[_0x515bd5(0x116)](){const _0x559cfa=_0x515bd5;this[_0x559cfa(0xe9)]['onConversationUpdate'][_0x559cfa(0x120)](_0x54ab92=>_0x54ab92(Object[_0x559cfa(0x108)](this['conversations'])));}[_0x515bd5(0x107)](){const _0x664698=_0x515bd5;this[_0x664698(0xe9)][_0x664698(0xf9)][_0x664698(0x120)](_0x28914e=>_0x28914e(this[_0x664698(0x11a)]()));}['notifyError'](_0x488e9e){const _0x1d50a7=_0x515bd5;this[_0x1d50a7(0xe9)][_0x1d50a7(0xf6)][_0x1d50a7(0x120)](_0x5012ad=>_0x5012ad(_0x488e9e));}[_0x515bd5(0x10b)](_0x365c51,_0x29a37d){const _0x313d35=_0x515bd5;this[_0x313d35(0xe9)][_0x365c51]&&this['listeners'][_0x365c51]['push'](_0x29a37d);}[_0x515bd5(0x122)](_0x4bf72c,_0xaa3ae6){const _0x43ec61=_0x515bd5;this[_0x43ec61(0xe9)][_0x4bf72c]&&(this[_0x43ec61(0xe9)][_0x4bf72c]=this[_0x43ec61(0xe9)][_0x4bf72c][_0x43ec61(0xf7)](_0x2d30c1=>_0x2d30c1!==_0xaa3ae6));}}export{ChatManager};