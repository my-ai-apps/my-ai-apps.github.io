
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x2364c7=_0x21ce;function _0x21ce(_0x5a80b6,_0x34b10d){const _0x4c4228=_0x4c42();return _0x21ce=function(_0x21ce57,_0x2a2edc){_0x21ce57=_0x21ce57-0xe9;let _0x3cc021=_0x4c4228[_0x21ce57];return _0x3cc021;},_0x21ce(_0x5a80b6,_0x34b10d);}(function(_0x3d3488,_0x1f91a1){const _0x2ea4eb=_0x21ce,_0x504ea6=_0x3d3488();while(!![]){try{const _0x2f43cb=-parseInt(_0x2ea4eb(0x123))/0x1*(-parseInt(_0x2ea4eb(0x11e))/0x2)+-parseInt(_0x2ea4eb(0x119))/0x3+-parseInt(_0x2ea4eb(0x10c))/0x4*(parseInt(_0x2ea4eb(0x10f))/0x5)+parseInt(_0x2ea4eb(0xfd))/0x6+-parseInt(_0x2ea4eb(0x117))/0x7+parseInt(_0x2ea4eb(0x109))/0x8+parseInt(_0x2ea4eb(0xf8))/0x9*(parseInt(_0x2ea4eb(0x103))/0xa);if(_0x2f43cb===_0x1f91a1)break;else _0x504ea6['push'](_0x504ea6['shift']());}catch(_0x2e4860){_0x504ea6['push'](_0x504ea6['shift']());}}}(_0x4c42,0x3d9b5));import{Logger}from'./common.js';class Conversation{constructor(_0x596915,_0x7f57f){const _0x409fcd=_0x21ce;this['id']=_0x596915,this['title']=_0x7f57f,this[_0x409fcd(0x12b)]=[],this['createdAt']=new Date()[_0x409fcd(0x11b)](),this[_0x409fcd(0xee)]=new Date()[_0x409fcd(0x11b)]();}}class ChatManager{constructor(){const _0x285c87=_0x21ce,_0x2fe7fa={'XZigY':'3|5|4|1|2|0','JzkJd':function(_0x11b730,_0x216edf){return _0x11b730*_0x216edf;}},_0x3d9569=_0x2fe7fa[_0x285c87(0x124)][_0x285c87(0x110)]('|');let _0x534fea=0x0;while(!![]){switch(_0x3d9569[_0x534fea++]){case'0':this[_0x285c87(0xea)]();continue;case'1':this[_0x285c87(0xf7)]=_0x2fe7fa[_0x285c87(0x129)](_0x2fe7fa['JzkJd'](4.5,0x400),0x400);continue;case'2':this[_0x285c87(0x122)]=0x32;continue;case'3':this[_0x285c87(0x10d)]={};continue;case'4':this[_0x285c87(0x12d)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'5':this[_0x285c87(0x115)]=null;continue;}break;}}async['loadConversations'](){const _0x53dd7e=_0x21ce,_0xd2f65c={'KQLZX':_0x53dd7e(0xf1),'FQPSg':'conversations','Kidfd':function(_0x206858,_0x401d0d){return _0x206858>_0x401d0d;},'vepDV':_0x53dd7e(0xff)};try{const _0x26777b=localStorage[_0x53dd7e(0x11a)](_0xd2f65c['FQPSg']);if(_0x26777b){const _0x307cb4=JSON['parse'](_0x26777b)||[];this['conversations']=_0x307cb4[_0x53dd7e(0x105)]((_0x23f0c6,_0xc8c96a)=>{const _0x3af02b=_0x53dd7e,_0x2ed162=_0xd2f65c[_0x3af02b(0xfb)]['split']('|');let _0x1a67ee=0x0;while(!![]){switch(_0x2ed162[_0x1a67ee++]){case'0':_0x23f0c6[_0xc8c96a['id']][_0x3af02b(0xf4)]=_0xc8c96a[_0x3af02b(0xf4)];continue;case'1':return _0x23f0c6;case'2':_0x23f0c6[_0xc8c96a['id']]['updatedAt']=_0xc8c96a[_0x3af02b(0xee)];continue;case'3':_0x23f0c6[_0xc8c96a['id']][_0x3af02b(0x12b)]=_0xc8c96a[_0x3af02b(0x12b)]||[];continue;case'4':_0x23f0c6[_0xc8c96a['id']]=new Conversation(_0xc8c96a['id'],_0xc8c96a[_0x3af02b(0x12c)]);continue;}break;}},{}),_0xd2f65c[_0x53dd7e(0x112)](Object[_0x53dd7e(0xf9)](this[_0x53dd7e(0x10d)])[_0x53dd7e(0x10b)],0x0)&&(this[_0x53dd7e(0x115)]=Object[_0x53dd7e(0xf9)](this[_0x53dd7e(0x10d)])[0x0]),Logger[_0x53dd7e(0x104)]('Loaded\x20'+Object['keys'](this['conversations'])['length']+_0x53dd7e(0xe9));}}catch(_0x58aa85){const _0x2b8763=Logger[_0x53dd7e(0x102)](_0xd2f65c[_0x53dd7e(0xf0)],_0x58aa85);this['notifyError'](_0x2b8763),this[_0x53dd7e(0x10d)]={};}}async['saveConversations'](){const _0x2bc801=_0x21ce,_0x1dd98b={'qjNni':'conversations'};try{const _0x200f43=JSON[_0x2bc801(0xed)](Object[_0x2bc801(0xeb)](this[_0x2bc801(0x10d)]));_0x200f43[_0x2bc801(0x10b)]>this['MAX_STORAGE_SIZE']&&await this[_0x2bc801(0xef)](),localStorage['setItem'](_0x1dd98b[_0x2bc801(0xfc)],_0x200f43),this[_0x2bc801(0x116)](),Logger[_0x2bc801(0x104)](_0x2bc801(0x120));}catch(_0x1bfc18){const _0x59df64=Logger[_0x2bc801(0x102)](_0x2bc801(0x114),_0x1bfc18);this[_0x2bc801(0x11f)](_0x59df64);}}async[_0x2364c7(0xef)](){const _0x15f11b=_0x2364c7,_0xf7330={'cnOvi':'Storage\x20cleanup\x20initiated','Weucp':function(_0x4f52cb,_0x1cb060){return _0x4f52cb>_0x1cb060;},'uKfdi':function(_0x19f7f7,_0x3098b5){return _0x19f7f7>_0x3098b5;},'XqrHi':_0x15f11b(0x126)};Logger['warn'](_0xf7330[_0x15f11b(0x118)]);const _0x1941a8=this[_0x15f11b(0xf6)]();_0xf7330[_0x15f11b(0x101)](_0x1941a8[_0x15f11b(0x10b)],this[_0x15f11b(0x122)])&&(this[_0x15f11b(0x10d)]=_0x1941a8[_0x15f11b(0x12a)](0x0,this[_0x15f11b(0x122)])['reduce']((_0x4168d1,_0xcf1609)=>{return _0x4168d1[_0xcf1609['id']]=_0xcf1609,_0x4168d1;},{}),Logger[_0x15f11b(0x104)]('Trimmed\x20to\x20'+this[_0x15f11b(0x122)]+_0x15f11b(0xfa)));let _0x4e37ad=JSON[_0x15f11b(0xed)](Object[_0x15f11b(0xeb)](this[_0x15f11b(0x10d)]))[_0x15f11b(0x10b)];while(_0xf7330[_0x15f11b(0x11c)](_0x4e37ad,this[_0x15f11b(0xf7)])&&_0xf7330['uKfdi'](Object[_0x15f11b(0xf9)](this[_0x15f11b(0x10d)])[_0x15f11b(0x10b)],0x0)){const _0x17dda3=_0x1941a8[_0x15f11b(0xf2)]();_0xf7330[_0x15f11b(0x101)](_0x17dda3[_0x15f11b(0x12b)][_0x15f11b(0x10b)],0xa)?_0x17dda3['messages']=_0x17dda3['messages'][_0x15f11b(0x12a)](-0xa):delete this[_0x15f11b(0x10d)][_0x17dda3['id']],_0x4e37ad=JSON[_0x15f11b(0xed)](Object['values'](this[_0x15f11b(0x10d)]))[_0x15f11b(0x10b)];}Logger[_0x15f11b(0x104)](_0xf7330['XqrHi']);}async[_0x2364c7(0x127)](_0x11a45b='New\x20Conversation'){const _0x50e340=_0x2364c7,_0x245072='conv_'+Date[_0x50e340(0x125)](),_0x370572=new Conversation(_0x245072,_0x11a45b);return this[_0x50e340(0x10d)][_0x245072]=_0x370572,this[_0x50e340(0x115)]=_0x245072,await this['saveConversations'](),this[_0x50e340(0x100)](),_0x245072;}[_0x2364c7(0xf5)](){const _0x2333d2=_0x2364c7;return this[_0x2333d2(0x10d)][this[_0x2333d2(0x115)]]||null;}async['addMessage'](_0x23771e,_0x141cdc){const _0x47ba90=_0x2364c7,_0x34d28a={'vsDxk':function(_0x35beba,_0x3f1992){return _0x35beba===_0x3f1992;},'JwsxT':'user','POJxc':function(_0x48e03a,_0x4763b8){return _0x48e03a===_0x4763b8;},'Fpmjk':'New\x20Conversation','wefLm':function(_0x5bc1a6,_0x5646c5){return _0x5bc1a6+_0x5646c5;},'IKxDx':_0x47ba90(0xec)},_0x2c3eb7=this[_0x47ba90(0xf5)]();if(!_0x2c3eb7)return![];const _0x2fc0bb={'role':_0x141cdc,'content':_0x23771e,'timestamp':new Date()[_0x47ba90(0x11b)]()};return _0x2c3eb7[_0x47ba90(0x12b)]['push'](_0x2fc0bb),_0x2c3eb7['updatedAt']=new Date()[_0x47ba90(0x11b)](),_0x34d28a[_0x47ba90(0x106)](_0x141cdc,_0x34d28a[_0x47ba90(0x111)])&&_0x34d28a['POJxc'](_0x2c3eb7['title'],_0x34d28a[_0x47ba90(0x121)])&&_0x2c3eb7[_0x47ba90(0x12b)][_0x47ba90(0x10b)]===0x1&&(_0x2c3eb7[_0x47ba90(0x12c)]=_0x34d28a[_0x47ba90(0x108)](_0x23771e['split']('\x20')[_0x47ba90(0x12a)](0x0,0x4)[_0x47ba90(0x107)]('\x20'),_0x34d28a['IKxDx'])),await this[_0x47ba90(0x113)](),!![];}async[_0x2364c7(0x128)](_0x241b3c){const _0x245abe=_0x2364c7,_0x10445d={'nDCjL':function(_0x2f98e8,_0xf3c86e){return _0x2f98e8===_0xf3c86e;}};this[_0x245abe(0x10d)][_0x241b3c]&&(delete this[_0x245abe(0x10d)][_0x241b3c],_0x10445d[_0x245abe(0xf3)](this[_0x245abe(0x115)],_0x241b3c)&&(this[_0x245abe(0x115)]=Object[_0x245abe(0xf9)](this['conversations'])[0x0]||null),await this[_0x245abe(0x113)]());}['switchConversation'](_0x1d54b6){const _0x5686e3=_0x2364c7;if(this[_0x5686e3(0x10d)][_0x1d54b6])return this[_0x5686e3(0x115)]=_0x1d54b6,this[_0x5686e3(0x100)](),!![];return![];}[_0x2364c7(0xf6)](){const _0x5ae976=_0x2364c7;return Object[_0x5ae976(0xeb)](this[_0x5ae976(0x10d)])[_0x5ae976(0x10a)]((_0x3ae319,_0xefe529)=>new Date(_0xefe529[_0x5ae976(0xee)])-new Date(_0x3ae319['updatedAt']));}[_0x2364c7(0x116)](){const _0x520ad0=_0x2364c7;this[_0x520ad0(0x12d)]['onConversationUpdate'][_0x520ad0(0x11d)](_0x6f4db9=>_0x6f4db9(Object['values'](this[_0x520ad0(0x10d)])));}[_0x2364c7(0x100)](){const _0x37973b=_0x2364c7;this[_0x37973b(0x12d)][_0x37973b(0x10e)][_0x37973b(0x11d)](_0x2751cc=>_0x2751cc(this[_0x37973b(0xf5)]()));}[_0x2364c7(0x11f)](_0x405bf2){const _0x2584a4=_0x2364c7;this[_0x2584a4(0x12d)]['onError'][_0x2584a4(0x11d)](_0x144c80=>_0x144c80(_0x405bf2));}[_0x2364c7(0xfe)](_0x557332,_0x5207f5){const _0x568dcb=_0x2364c7;this['listeners'][_0x557332]&&this[_0x568dcb(0x12d)][_0x557332]['push'](_0x5207f5);}['removeEventListener'](_0x3db5f8,_0x4abb36){const _0x541ec9=_0x2364c7;this[_0x541ec9(0x12d)][_0x3db5f8]&&(this['listeners'][_0x3db5f8]=this[_0x541ec9(0x12d)][_0x3db5f8]['filter'](_0x9b570c=>_0x9b570c!==_0x4abb36));}}export{ChatManager};function _0x4c42(){const _0x3394d8=['error','2890yBhYYv','info','reduce','vsDxk','join','wefLm','1294280EpYzAZ','sort','length','4PQRlea','conversations','onCurrentConversationChange','2219655kGHPTl','split','JwsxT','Kidfd','saveConversations','Failed\x20to\x20save\x20conversations','currentConversationId','notifyConversationUpdate','3511424pKeMSw','cnOvi','751833Lochcg','getItem','toISOString','uKfdi','forEach','356DbvxTi','notifyError','Conversations\x20saved\x20successfully','Fpmjk','MAX_CONVERSATIONS','136WIbeqg','XZigY','now','Storage\x20cleanup\x20completed','createNewConversation','deleteConversation','JzkJd','slice','messages','title','listeners','\x20conversations','loadConversations','values','...','stringify','updatedAt','cleanupStorage','vepDV','4|3|0|2|1','pop','nDCjL','createdAt','getCurrentConversation','getSortedConversations','MAX_STORAGE_SIZE','31869EGSkjk','keys','\x20most\x20recent\x20conversations','KQLZX','qjNni','1435038WvXLZa','addEventListener','Failed\x20to\x20load\x20conversations','notifyCurrentConversationChange','Weucp'];_0x4c42=function(){return _0x3394d8;};return _0x4c42();}