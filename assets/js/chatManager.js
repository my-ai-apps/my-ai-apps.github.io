
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x5850e8=_0x2553;(function(_0x5bd571,_0x43da2d){const _0x355588=_0x2553,_0x18c41e=_0x5bd571();while(!![]){try{const _0x1aceac=parseInt(_0x355588(0x1ef))/0x1*(-parseInt(_0x355588(0x1c9))/0x2)+-parseInt(_0x355588(0x1d9))/0x3*(parseInt(_0x355588(0x1f4))/0x4)+parseInt(_0x355588(0x1d4))/0x5+-parseInt(_0x355588(0x1fb))/0x6*(parseInt(_0x355588(0x1d7))/0x7)+parseInt(_0x355588(0x1c1))/0x8*(-parseInt(_0x355588(0x1e6))/0x9)+parseInt(_0x355588(0x1de))/0xa*(-parseInt(_0x355588(0x201))/0xb)+-parseInt(_0x355588(0x1db))/0xc*(-parseInt(_0x355588(0x204))/0xd);if(_0x1aceac===_0x43da2d)break;else _0x18c41e['push'](_0x18c41e['shift']());}catch(_0x2fc57e){_0x18c41e['push'](_0x18c41e['shift']());}}}(_0x3ed0,0xee0bf));import{Logger}from'./common.js';function _0x2553(_0x867db0,_0x4d0913){const _0x3ed067=_0x3ed0();return _0x2553=function(_0x25532f,_0x326c29){_0x25532f=_0x25532f-0x1bd;let _0x457303=_0x3ed067[_0x25532f];return _0x457303;},_0x2553(_0x867db0,_0x4d0913);}class Conversation{constructor(_0xbc18be,_0x400b5d){const _0x287730=_0x2553;this['id']=_0xbc18be,this[_0x287730(0x1d8)]=_0x400b5d,this[_0x287730(0x1df)]=[],this['createdAt']=new Date()[_0x287730(0x1da)](),this[_0x287730(0x1f2)]=new Date()['toISOString']();}}class ChatManager{constructor(){const _0x671d5c=_0x2553,_0x1bcff5={'IcKya':_0x671d5c(0x1f5),'YFXUt':function(_0x5515e6,_0xc20c8d){return _0x5515e6*_0xc20c8d;}},_0x311603=_0x1bcff5[_0x671d5c(0x1d6)][_0x671d5c(0x1e5)]('|');let _0x1dbc2d=0x0;while(!![]){switch(_0x311603[_0x1dbc2d++]){case'0':this['conversations']={};continue;case'1':this[_0x671d5c(0x1c0)]=null;continue;case'2':this[_0x671d5c(0x1be)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'3':this['MAX_CONVERSATIONS']=0x32;continue;case'4':this[_0x671d5c(0x1c5)]();continue;case'5':this[_0x671d5c(0x1d2)]=_0x1bcff5[_0x671d5c(0x1cc)](_0x1bcff5[_0x671d5c(0x1cc)](4.5,0x400),0x400);continue;}break;}}async[_0x5850e8(0x1c5)](){const _0x2dc31d=_0x5850e8,_0x3b2c29={'lZhGX':_0x2dc31d(0x1f9),'JMRfu':function(_0x50c1a0,_0x177b1e){return _0x50c1a0>_0x177b1e;}};try{const _0x4d360c=localStorage[_0x2dc31d(0x1f3)](_0x3b2c29['lZhGX']);if(_0x4d360c){const _0x546846=JSON[_0x2dc31d(0x1e3)](_0x4d360c)||[];this[_0x2dc31d(0x1f9)]=_0x546846[_0x2dc31d(0x1cd)]((_0x3f3421,_0x594403)=>{const _0x45f024=_0x2dc31d,_0x55030f=_0x45f024(0x1f6)[_0x45f024(0x1e5)]('|');let _0x25d07f=0x0;while(!![]){switch(_0x55030f[_0x25d07f++]){case'0':return _0x3f3421;case'1':_0x3f3421[_0x594403['id']][_0x45f024(0x1f2)]=_0x594403['updatedAt'];continue;case'2':_0x3f3421[_0x594403['id']][_0x45f024(0x206)]=_0x594403['createdAt'];continue;case'3':_0x3f3421[_0x594403['id']][_0x45f024(0x1df)]=_0x594403[_0x45f024(0x1df)]||[];continue;case'4':_0x3f3421[_0x594403['id']]=new Conversation(_0x594403['id'],_0x594403['title']);continue;}break;}},{}),_0x3b2c29[_0x2dc31d(0x1dd)](Object[_0x2dc31d(0x1bd)](this[_0x2dc31d(0x1f9)])[_0x2dc31d(0x208)],0x0)&&(this['currentConversationId']=Object[_0x2dc31d(0x1bd)](this[_0x2dc31d(0x1f9)])[0x0]),Logger[_0x2dc31d(0x1e4)](_0x2dc31d(0x207)+Object[_0x2dc31d(0x1bd)](this['conversations'])[_0x2dc31d(0x208)]+_0x2dc31d(0x1ea));}}catch(_0x177a3d){const _0x15e46c=Logger[_0x2dc31d(0x1e8)](_0x2dc31d(0x1f0),_0x177a3d);this[_0x2dc31d(0x1c4)](_0x15e46c),this[_0x2dc31d(0x1f9)]={};}}async['saveConversations'](){const _0xccf3f0=_0x5850e8,_0x4ed0dc={'AHhGn':function(_0x2da1e1,_0x118b8b){return _0x2da1e1>_0x118b8b;},'jXiMw':_0xccf3f0(0x1f9),'CEYcm':'Conversations\x20saved\x20successfully','YrfDm':'Failed\x20to\x20save\x20conversations'};try{const _0x2d231e=JSON['stringify'](Object['values'](this[_0xccf3f0(0x1f9)]));_0x4ed0dc[_0xccf3f0(0x1d5)](_0x2d231e[_0xccf3f0(0x208)],this[_0xccf3f0(0x1d2)])&&await this[_0xccf3f0(0x1c7)](),localStorage['setItem'](_0x4ed0dc['jXiMw'],_0x2d231e),this[_0xccf3f0(0x1fd)](),Logger[_0xccf3f0(0x1e4)](_0x4ed0dc['CEYcm']);}catch(_0x2ee29e){const _0x50aedd=Logger[_0xccf3f0(0x1e8)](_0x4ed0dc[_0xccf3f0(0x1eb)],_0x2ee29e);this[_0xccf3f0(0x1c4)](_0x50aedd);}}async['cleanupStorage'](){const _0x1f0b2e=_0x5850e8,_0x5d34f2={'qwCDS':_0x1f0b2e(0x1bf),'arcPv':function(_0x3d393d,_0x407ca8){return _0x3d393d>_0x407ca8;},'LRmKS':_0x1f0b2e(0x1c8)};Logger[_0x1f0b2e(0x1e7)](_0x5d34f2[_0x1f0b2e(0x205)]);const _0xe5813a=this[_0x1f0b2e(0x200)]();_0xe5813a['length']>this[_0x1f0b2e(0x1ee)]&&(this[_0x1f0b2e(0x1f9)]=_0xe5813a[_0x1f0b2e(0x1fa)](0x0,this[_0x1f0b2e(0x1ee)])['reduce']((_0x378bc4,_0x7587b4)=>{return _0x378bc4[_0x7587b4['id']]=_0x7587b4,_0x378bc4;},{}),Logger[_0x1f0b2e(0x1e4)]('Trimmed\x20to\x20'+this[_0x1f0b2e(0x1ee)]+'\x20most\x20recent\x20conversations'));let _0x207e3a=JSON[_0x1f0b2e(0x1ec)](Object['values'](this[_0x1f0b2e(0x1f9)]))[_0x1f0b2e(0x208)];while(_0x5d34f2[_0x1f0b2e(0x1f8)](_0x207e3a,this[_0x1f0b2e(0x1d2)])&&_0x5d34f2[_0x1f0b2e(0x1f8)](Object['keys'](this[_0x1f0b2e(0x1f9)])[_0x1f0b2e(0x208)],0x0)){const _0x310076=_0xe5813a[_0x1f0b2e(0x1fc)]();_0x5d34f2['arcPv'](_0x310076[_0x1f0b2e(0x1df)][_0x1f0b2e(0x208)],0xa)?_0x310076[_0x1f0b2e(0x1df)]=_0x310076[_0x1f0b2e(0x1df)][_0x1f0b2e(0x1fa)](-0xa):delete this['conversations'][_0x310076['id']],_0x207e3a=JSON[_0x1f0b2e(0x1ec)](Object[_0x1f0b2e(0x1cb)](this[_0x1f0b2e(0x1f9)]))[_0x1f0b2e(0x208)];}Logger[_0x1f0b2e(0x1e4)](_0x5d34f2[_0x1f0b2e(0x1c2)]);}async['createNewConversation'](_0x48500e='New\x20Conversation'){const _0xad8750=_0x5850e8,_0x29af60=_0xad8750(0x1ed)+Date[_0xad8750(0x203)](),_0x330b32=new Conversation(_0x29af60,_0x48500e);return this['conversations'][_0x29af60]=_0x330b32,this[_0xad8750(0x1c0)]=_0x29af60,await this[_0xad8750(0x1ca)](),this[_0xad8750(0x1fe)](),_0x29af60;}['getCurrentConversation'](){return this['conversations'][this['currentConversationId']]||null;}async['addMessage'](_0x56f817,_0x3c56a8){const _0x571201=_0x5850e8,_0x62258e={'kZbqz':function(_0x47f601,_0x4f8246){return _0x47f601===_0x4f8246;},'ujGcX':'New\x20Conversation','guxyh':function(_0x3a64f0,_0x557619){return _0x3a64f0===_0x557619;},'myQpQ':function(_0x36f253,_0x337813){return _0x36f253+_0x337813;},'vZypQ':_0x571201(0x1e9)},_0x5a5fa2=this[_0x571201(0x1f7)]();if(!_0x5a5fa2)return![];const _0x72e5a9={'role':_0x3c56a8,'content':_0x56f817,'timestamp':new Date()[_0x571201(0x1da)]()};return _0x5a5fa2[_0x571201(0x1df)][_0x571201(0x1cf)](_0x72e5a9),_0x5a5fa2[_0x571201(0x1f2)]=new Date()['toISOString'](),_0x3c56a8===_0x571201(0x1d1)&&_0x62258e['kZbqz'](_0x5a5fa2[_0x571201(0x1d8)],_0x62258e[_0x571201(0x1d0)])&&_0x62258e[_0x571201(0x1dc)](_0x5a5fa2['messages'][_0x571201(0x208)],0x1)&&(_0x5a5fa2[_0x571201(0x1d8)]=_0x62258e[_0x571201(0x1c6)](_0x56f817['split']('\x20')[_0x571201(0x1fa)](0x0,0x4)[_0x571201(0x1e1)]('\x20'),_0x62258e['vZypQ'])),await this[_0x571201(0x1ca)](),!![];}async['deleteConversation'](_0x33b0ed){const _0x378562=_0x5850e8,_0x48effa={'UTOdV':function(_0x190362,_0x105170){return _0x190362===_0x105170;}};this['conversations'][_0x33b0ed]&&(delete this[_0x378562(0x1f9)][_0x33b0ed],_0x48effa[_0x378562(0x1e0)](this[_0x378562(0x1c0)],_0x33b0ed)&&(this[_0x378562(0x1c0)]=Object[_0x378562(0x1bd)](this['conversations'])[0x0]||null),await this[_0x378562(0x1ca)]());}[_0x5850e8(0x1f1)](_0x1d6c58){const _0x32cca9=_0x5850e8;if(this[_0x32cca9(0x1f9)][_0x1d6c58])return this[_0x32cca9(0x1c0)]=_0x1d6c58,this[_0x32cca9(0x1fe)](),!![];return![];}['getSortedConversations'](){const _0x2c753c=_0x5850e8;return Object[_0x2c753c(0x1cb)](this[_0x2c753c(0x1f9)])[_0x2c753c(0x202)]((_0x5d738b,_0x33bde8)=>new Date(_0x33bde8[_0x2c753c(0x1f2)])-new Date(_0x5d738b[_0x2c753c(0x1f2)]));}[_0x5850e8(0x1fd)](){const _0x9b61ef=_0x5850e8;this[_0x9b61ef(0x1be)][_0x9b61ef(0x1e2)]['forEach'](_0x5c38e4=>_0x5c38e4(Object[_0x9b61ef(0x1cb)](this[_0x9b61ef(0x1f9)])));}[_0x5850e8(0x1fe)](){const _0x57868e=_0x5850e8;this[_0x57868e(0x1be)][_0x57868e(0x1c3)]['forEach'](_0x44608c=>_0x44608c(this[_0x57868e(0x1f7)]()));}[_0x5850e8(0x1c4)](_0x1c6a73){const _0x56ff64=_0x5850e8;this['listeners'][_0x56ff64(0x1ff)]['forEach'](_0x1f65ec=>_0x1f65ec(_0x1c6a73));}[_0x5850e8(0x1ce)](_0x24f95c,_0x354f4e){const _0x5cbdd1=_0x5850e8;this[_0x5cbdd1(0x1be)][_0x24f95c]&&this[_0x5cbdd1(0x1be)][_0x24f95c][_0x5cbdd1(0x1cf)](_0x354f4e);}[_0x5850e8(0x1d3)](_0x290c42,_0x10a478){const _0x15c48e=_0x5850e8;this['listeners'][_0x290c42]&&(this[_0x15c48e(0x1be)][_0x290c42]=this[_0x15c48e(0x1be)][_0x290c42]['filter'](_0x45e717=>_0x45e717!==_0x10a478));}}function _0x3ed0(){const _0x16490c=['addEventListener','push','ujGcX','user','MAX_STORAGE_SIZE','removeEventListener','2074995FjrBvu','AHhGn','IcKya','4080503dtGXyW','title','9WUAqOb','toISOString','53408244BHEqiw','guxyh','JMRfu','10BWSIVn','messages','UTOdV','join','onConversationUpdate','parse','info','split','603ugreBR','warn','error','...','\x20conversations','YrfDm','stringify','conv_','MAX_CONVERSATIONS','13221rHOFes','Failed\x20to\x20load\x20conversations','switchConversation','updatedAt','getItem','396292tWqwhA','0|1|2|5|3|4','4|3|2|1|0','getCurrentConversation','arcPv','conversations','slice','12jpbLEY','pop','notifyConversationUpdate','notifyCurrentConversationChange','onError','getSortedConversations','2039378YnSPZn','sort','now','13cEyuXB','qwCDS','createdAt','Loaded\x20','length','keys','listeners','Storage\x20cleanup\x20initiated','currentConversationId','136696TDtxvT','LRmKS','onCurrentConversationChange','notifyError','loadConversations','myQpQ','cleanupStorage','Storage\x20cleanup\x20completed','166JeqpWN','saveConversations','values','YFXUt','reduce'];_0x3ed0=function(){return _0x16490c;};return _0x3ed0();}export{ChatManager};