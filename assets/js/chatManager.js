
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x428e(_0x5044de,_0x22f7e0){const _0x2fe3aa=_0x2fe3();return _0x428e=function(_0x428e47,_0x59a622){_0x428e47=_0x428e47-0x12e;let _0x18d850=_0x2fe3aa[_0x428e47];return _0x18d850;},_0x428e(_0x5044de,_0x22f7e0);}function _0x2fe3(){const _0x12e63c=['onConversationUpdate','updatedAt','warn','MAX_STORAGE_SIZE','forEach','6GqgjmT','switchConversation','addMessage','getCurrentConversation','418850qZtxkg','2|0|3|5|4|1','slice','pop','reduce','values','Trimmed\x20to\x20','saveConversations','SbnEj','getSortedConversations','conversations','createdAt','gMNDC','messages','onError','notifyConversationUpdate','notifyError','YybQn','3827404MftSkj','New\x20Conversation','Failed\x20to\x20load\x20conversations','uSOlD','MAX_CONVERSATIONS','7989157hZubyv','lIVxh','\x20conversations','Storage\x20cleanup\x20completed','vaVLU','notifyCurrentConversationChange','YldUd','removeEventListener','2008Syhwbe','Storage\x20cleanup\x20initiated','Loaded\x20','cleanupStorage','NrrxI','now','Conversations\x20saved\x20successfully','keys','parse','RDXlc','BGyqa','stringify','currentConversationId','user','1509185LYQwYp','listeners','length','qHXDa','filter','sort','8LMtgzq','12735NBbTFi','241288vidpYf','addEventListener','...','deleteConversation','split','toISOString','1176504mtkNZq','error','conv_','4|0|2|3|1','title','wSvLn','info','10tpUKDt','Failed\x20to\x20save\x20conversations','setItem','push','\x20most\x20recent\x20conversations','loadConversations','iIlUj'];_0x2fe3=function(){return _0x12e63c;};return _0x2fe3();}const _0x1a48c6=_0x428e;(function(_0x3585fe,_0x5f0c7f){const _0x4845ae=_0x428e,_0x31d778=_0x3585fe();while(!![]){try{const _0x33d1bf=-parseInt(_0x4845ae(0x174))/0x1+-parseInt(_0x4845ae(0x157))/0x2*(-parseInt(_0x4845ae(0x170))/0x3)+parseInt(_0x4845ae(0x155))/0x4*(-parseInt(_0x4845ae(0x14f))/0x5)+parseInt(_0x4845ae(0x15d))/0x6+parseInt(_0x4845ae(0x134))/0x7+parseInt(_0x4845ae(0x141))/0x8*(-parseInt(_0x4845ae(0x156))/0x9)+-parseInt(_0x4845ae(0x164))/0xa*(-parseInt(_0x4845ae(0x139))/0xb);if(_0x33d1bf===_0x5f0c7f)break;else _0x31d778['push'](_0x31d778['shift']());}catch(_0xa0b41e){_0x31d778['push'](_0x31d778['shift']());}}}(_0x2fe3,0x513c6));import{Logger}from'./common.js';class Conversation{constructor(_0x1ac5ac,_0x509714){const _0x1a1cde=_0x428e,_0x3625ad={'yWNQS':_0x1a1cde(0x160)},_0x58f26b=_0x3625ad['yWNQS'][_0x1a1cde(0x15b)]('|');let _0x38e130=0x0;while(!![]){switch(_0x58f26b[_0x38e130++]){case'0':this[_0x1a1cde(0x161)]=_0x509714;continue;case'1':this[_0x1a1cde(0x16c)]=new Date()[_0x1a1cde(0x15c)]();continue;case'2':this['messages']=[];continue;case'3':this[_0x1a1cde(0x17f)]=new Date()[_0x1a1cde(0x15c)]();continue;case'4':this['id']=_0x1ac5ac;continue;}break;}}}class ChatManager{constructor(){const _0x283eed=_0x428e,_0x217aff={'qHXDa':function(_0xb7f6b6,_0x55818f){return _0xb7f6b6*_0x55818f;}},_0x13b4bd=_0x283eed(0x175)[_0x283eed(0x15b)]('|');let _0x2f101d=0x0;while(!![]){switch(_0x13b4bd[_0x2f101d++]){case'0':this[_0x283eed(0x14d)]=null;continue;case'1':this['loadConversations']();continue;case'2':this['conversations']={};continue;case'3':this[_0x283eed(0x150)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'4':this['MAX_CONVERSATIONS']=0x32;continue;case'5':this[_0x283eed(0x16e)]=_0x217aff[_0x283eed(0x152)](4.5,0x400)*0x400;continue;}break;}}async[_0x1a48c6(0x169)](){const _0xda532b=_0x1a48c6,_0x243221={'iIlUj':function(_0x572a23,_0x20749c){return _0x572a23>_0x20749c;},'BGyqa':_0xda532b(0x136)};try{const _0x47adab=localStorage['getItem'](_0xda532b(0x17e));if(_0x47adab){const _0x51c116=JSON[_0xda532b(0x149)](_0x47adab)||[];this[_0xda532b(0x17e)]=_0x51c116[_0xda532b(0x178)]((_0x3f248f,_0x218eac)=>{const _0x3d5284=_0xda532b;return _0x3f248f[_0x218eac['id']]=new Conversation(_0x218eac['id'],_0x218eac[_0x3d5284(0x161)]),_0x3f248f[_0x218eac['id']]['messages']=_0x218eac[_0x3d5284(0x12f)]||[],_0x3f248f[_0x218eac['id']][_0x3d5284(0x17f)]=_0x218eac['createdAt'],_0x3f248f[_0x218eac['id']][_0x3d5284(0x16c)]=_0x218eac[_0x3d5284(0x16c)],_0x3f248f;},{}),_0x243221[_0xda532b(0x16a)](Object[_0xda532b(0x148)](this[_0xda532b(0x17e)])[_0xda532b(0x151)],0x0)&&(this['currentConversationId']=Object[_0xda532b(0x148)](this['conversations'])[0x0]),Logger['info'](_0xda532b(0x143)+Object[_0xda532b(0x148)](this[_0xda532b(0x17e)])[_0xda532b(0x151)]+_0xda532b(0x13b));}}catch(_0x125c79){const _0x26395f=Logger[_0xda532b(0x15e)](_0x243221[_0xda532b(0x14b)],_0x125c79);this[_0xda532b(0x132)](_0x26395f),this[_0xda532b(0x17e)]={};}}async['saveConversations'](){const _0xf9401e=_0x1a48c6,_0x4e6a5a={'ibmcB':function(_0x316aaf,_0x2424b2){return _0x316aaf>_0x2424b2;},'RDXlc':_0xf9401e(0x17e),'GRqOd':_0xf9401e(0x147),'YybQn':_0xf9401e(0x165)};try{const _0x24e2af=JSON['stringify'](Object[_0xf9401e(0x179)](this[_0xf9401e(0x17e)]));_0x4e6a5a['ibmcB'](_0x24e2af[_0xf9401e(0x151)],this[_0xf9401e(0x16e)])&&await this[_0xf9401e(0x144)](),localStorage[_0xf9401e(0x166)](_0x4e6a5a[_0xf9401e(0x14a)],_0x24e2af),this[_0xf9401e(0x131)](),Logger['info'](_0x4e6a5a['GRqOd']);}catch(_0x2a529d){const _0x97aa74=Logger[_0xf9401e(0x15e)](_0x4e6a5a[_0xf9401e(0x133)],_0x2a529d);this['notifyError'](_0x97aa74);}}async['cleanupStorage'](){const _0x2a931e=_0x1a48c6,_0x41db2e={'uSOlD':_0x2a931e(0x142),'wSvLn':function(_0x5941a8,_0x1dfcc1){return _0x5941a8>_0x1dfcc1;},'gMNDC':function(_0x3a08bd,_0x1be91e){return _0x3a08bd>_0x1be91e;},'YldUd':_0x2a931e(0x13c)};Logger[_0x2a931e(0x16d)](_0x41db2e[_0x2a931e(0x137)]);const _0x27b709=this[_0x2a931e(0x17d)]();_0x27b709['length']>this[_0x2a931e(0x138)]&&(this[_0x2a931e(0x17e)]=_0x27b709[_0x2a931e(0x176)](0x0,this['MAX_CONVERSATIONS'])[_0x2a931e(0x178)]((_0x3fae45,_0x1adb4f)=>{return _0x3fae45[_0x1adb4f['id']]=_0x1adb4f,_0x3fae45;},{}),Logger[_0x2a931e(0x163)](_0x2a931e(0x17a)+this[_0x2a931e(0x138)]+_0x2a931e(0x168)));let _0x4c3124=JSON['stringify'](Object[_0x2a931e(0x179)](this[_0x2a931e(0x17e)]))[_0x2a931e(0x151)];while(_0x41db2e[_0x2a931e(0x162)](_0x4c3124,this[_0x2a931e(0x16e)])&&_0x41db2e[_0x2a931e(0x162)](Object[_0x2a931e(0x148)](this[_0x2a931e(0x17e)])['length'],0x0)){const _0x337606=_0x27b709[_0x2a931e(0x177)]();_0x41db2e[_0x2a931e(0x12e)](_0x337606[_0x2a931e(0x12f)][_0x2a931e(0x151)],0xa)?_0x337606[_0x2a931e(0x12f)]=_0x337606[_0x2a931e(0x12f)][_0x2a931e(0x176)](-0xa):delete this['conversations'][_0x337606['id']],_0x4c3124=JSON[_0x2a931e(0x14c)](Object[_0x2a931e(0x179)](this['conversations']))[_0x2a931e(0x151)];}Logger[_0x2a931e(0x163)](_0x41db2e[_0x2a931e(0x13f)]);}async['createNewConversation'](_0xab6da6=_0x1a48c6(0x135)){const _0x2b2b1e=_0x1a48c6,_0xe554d7=_0x2b2b1e(0x15f)+Date[_0x2b2b1e(0x146)](),_0x57a3d4=new Conversation(_0xe554d7,_0xab6da6);return this['conversations'][_0xe554d7]=_0x57a3d4,this['currentConversationId']=_0xe554d7,await this[_0x2b2b1e(0x17b)](),this[_0x2b2b1e(0x13e)](),_0xe554d7;}[_0x1a48c6(0x173)](){const _0x4d84bd=_0x1a48c6;return this[_0x4d84bd(0x17e)][this['currentConversationId']]||null;}async[_0x1a48c6(0x172)](_0xfc6e95,_0x429b56){const _0x54ff89=_0x1a48c6,_0x41e452={'Qzxok':function(_0xc9b3ab,_0xbe06ad){return _0xc9b3ab===_0xbe06ad;},'NrrxI':_0x54ff89(0x14e),'SbnEj':function(_0x10725f,_0xde0655){return _0x10725f===_0xde0655;},'vDUeK':_0x54ff89(0x135),'lIVxh':function(_0x25756c,_0x2ee058){return _0x25756c+_0x2ee058;},'YmPQs':_0x54ff89(0x159)},_0x54e289=this[_0x54ff89(0x173)]();if(!_0x54e289)return![];const _0x57e317={'role':_0x429b56,'content':_0xfc6e95,'timestamp':new Date()[_0x54ff89(0x15c)]()};return _0x54e289[_0x54ff89(0x12f)][_0x54ff89(0x167)](_0x57e317),_0x54e289['updatedAt']=new Date()[_0x54ff89(0x15c)](),_0x41e452['Qzxok'](_0x429b56,_0x41e452[_0x54ff89(0x145)])&&_0x41e452[_0x54ff89(0x17c)](_0x54e289[_0x54ff89(0x161)],_0x41e452['vDUeK'])&&_0x41e452[_0x54ff89(0x17c)](_0x54e289['messages']['length'],0x1)&&(_0x54e289['title']=_0x41e452[_0x54ff89(0x13a)](_0xfc6e95[_0x54ff89(0x15b)]('\x20')[_0x54ff89(0x176)](0x0,0x4)['join']('\x20'),_0x41e452['YmPQs'])),await this[_0x54ff89(0x17b)](),!![];}async[_0x1a48c6(0x15a)](_0x3d6728){const _0x184b6c=_0x1a48c6,_0xdaafd6={'vaVLU':function(_0x262c81,_0x34b7f5){return _0x262c81===_0x34b7f5;}};this['conversations'][_0x3d6728]&&(delete this[_0x184b6c(0x17e)][_0x3d6728],_0xdaafd6[_0x184b6c(0x13d)](this['currentConversationId'],_0x3d6728)&&(this[_0x184b6c(0x14d)]=Object[_0x184b6c(0x148)](this[_0x184b6c(0x17e)])[0x0]||null),await this[_0x184b6c(0x17b)]());}[_0x1a48c6(0x171)](_0x5cfa70){const _0xf43c3=_0x1a48c6;if(this[_0xf43c3(0x17e)][_0x5cfa70])return this['currentConversationId']=_0x5cfa70,this[_0xf43c3(0x13e)](),!![];return![];}[_0x1a48c6(0x17d)](){const _0x595623=_0x1a48c6;return Object[_0x595623(0x179)](this['conversations'])[_0x595623(0x154)]((_0x3ae63c,_0x5abafa)=>new Date(_0x5abafa[_0x595623(0x16c)])-new Date(_0x3ae63c[_0x595623(0x16c)]));}[_0x1a48c6(0x131)](){const _0x55e310=_0x1a48c6;this[_0x55e310(0x150)][_0x55e310(0x16b)]['forEach'](_0x2804ac=>_0x2804ac(Object['values'](this[_0x55e310(0x17e)])));}['notifyCurrentConversationChange'](){const _0x30045d=_0x1a48c6;this[_0x30045d(0x150)]['onCurrentConversationChange'][_0x30045d(0x16f)](_0xad7f89=>_0xad7f89(this[_0x30045d(0x173)]()));}['notifyError'](_0x5a85e3){const _0xe13484=_0x1a48c6;this[_0xe13484(0x150)][_0xe13484(0x130)][_0xe13484(0x16f)](_0x2acf1a=>_0x2acf1a(_0x5a85e3));}[_0x1a48c6(0x158)](_0x2d6759,_0x2f72a8){const _0xec3607=_0x1a48c6;this[_0xec3607(0x150)][_0x2d6759]&&this[_0xec3607(0x150)][_0x2d6759][_0xec3607(0x167)](_0x2f72a8);}[_0x1a48c6(0x140)](_0x483672,_0x1a273a){const _0x2c56d4=_0x1a48c6;this[_0x2c56d4(0x150)][_0x483672]&&(this[_0x2c56d4(0x150)][_0x483672]=this[_0x2c56d4(0x150)][_0x483672][_0x2c56d4(0x153)](_0x4b46d7=>_0x4b46d7!==_0x1a273a));}}export{ChatManager};