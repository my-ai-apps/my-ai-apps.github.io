
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x56ca4f=_0x5ecd;(function(_0x4bdc4e,_0x37230b){const _0x5f4979=_0x5ecd,_0x2e0469=_0x4bdc4e();while(!![]){try{const _0x451ca8=-parseInt(_0x5f4979(0x1e0))/0x1+parseInt(_0x5f4979(0x20d))/0x2+-parseInt(_0x5f4979(0x20c))/0x3*(-parseInt(_0x5f4979(0x1da))/0x4)+parseInt(_0x5f4979(0x1f0))/0x5*(parseInt(_0x5f4979(0x226))/0x6)+parseInt(_0x5f4979(0x1ea))/0x7+parseInt(_0x5f4979(0x209))/0x8*(parseInt(_0x5f4979(0x1fb))/0x9)+-parseInt(_0x5f4979(0x221))/0xa*(parseInt(_0x5f4979(0x1df))/0xb);if(_0x451ca8===_0x37230b)break;else _0x2e0469['push'](_0x2e0469['shift']());}catch(_0x25b6a2){_0x2e0469['push'](_0x2e0469['shift']());}}}(_0x2f13,0x836ef));function _0x2f13(){const _0x31a6bb=['info','onCurrentConversationChange','stringify','title','1449343nDJUmM','\x20most\x20recent\x20conversations','createdAt','Trimmed\x20to\x20','user','wdvsG','95UqBDKn','cleanupStorage','cwKJA','onError','getCurrentConversation','push','owfoS','messages','\x20conversations','forEach','values','9PbpTrw','setItem','toISOString','filter','updatedAt','saveConversations','error','conversations','rdBAw','loadConversations','RCAmq','listeners','Failed\x20to\x20save\x20conversations','Loaded\x20','4918904FLJaMO','bocCK','bPRht','18855GbBTxk','754672QwQlZf','addMessage','conv_','MAX_STORAGE_SIZE','getItem','split','Conversations\x20saved\x20successfully','...','Failed\x20to\x20load\x20conversations','getSortedConversations','removeEventListener','pop','currentConversationId','switchConversation','warn','slice','HwIFc','reduce','sort','length','396160TpOHYp','notifyConversationUpdate','notifyCurrentConversationChange','jzMCl','notifyError','145506GsNaau','JmJWp','388QuOIWd','New\x20Conversation','asmMO','Storage\x20cleanup\x20initiated','keys','275kWZKwJ','740911qXaUsg','onConversationUpdate','MAX_CONVERSATIONS','JQiQi','TNGck','fjORj'];_0x2f13=function(){return _0x31a6bb;};return _0x2f13();}import{Logger}from'./common.js';class Conversation{constructor(_0x34694d,_0x188c83){const _0x17ace5=_0x5ecd;this['id']=_0x34694d,this['title']=_0x188c83,this['messages']=[],this[_0x17ace5(0x1ec)]=new Date()[_0x17ace5(0x1fd)](),this[_0x17ace5(0x1ff)]=new Date()['toISOString']();}}class ChatManager{constructor(){const _0x7c6f3b=_0x5ecd,_0x2be856={'TNGck':function(_0x59ae01,_0x318038){return _0x59ae01*_0x318038;}};this[_0x7c6f3b(0x202)]={},this['currentConversationId']=null,this[_0x7c6f3b(0x206)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]},this['MAX_STORAGE_SIZE']=_0x2be856[_0x7c6f3b(0x1e4)](4.5,0x400)*0x400,this[_0x7c6f3b(0x1e2)]=0x32,this[_0x7c6f3b(0x204)]();}async[_0x56ca4f(0x204)](){const _0x244c13=_0x56ca4f,_0x5435db={'kUglU':_0x244c13(0x202),'bocCK':function(_0x1b7ac8,_0x50e25e){return _0x1b7ac8>_0x50e25e;},'owfoS':_0x244c13(0x215)};try{const _0x2d1fec=localStorage[_0x244c13(0x211)](_0x5435db['kUglU']);if(_0x2d1fec){const _0x44e95c=JSON['parse'](_0x2d1fec)||[];this[_0x244c13(0x202)]=_0x44e95c[_0x244c13(0x21e)]((_0x1a89bc,_0x472925)=>{const _0x254c6a=_0x244c13;return _0x1a89bc[_0x472925['id']]=new Conversation(_0x472925['id'],_0x472925[_0x254c6a(0x1e9)]),_0x1a89bc[_0x472925['id']][_0x254c6a(0x1f7)]=_0x472925['messages']||[],_0x1a89bc[_0x472925['id']][_0x254c6a(0x1ec)]=_0x472925['createdAt'],_0x1a89bc[_0x472925['id']][_0x254c6a(0x1ff)]=_0x472925[_0x254c6a(0x1ff)],_0x1a89bc;},{}),_0x5435db[_0x244c13(0x20a)](Object[_0x244c13(0x1de)](this[_0x244c13(0x202)])[_0x244c13(0x220)],0x0)&&(this[_0x244c13(0x219)]=Object[_0x244c13(0x1de)](this['conversations'])[0x0]),Logger[_0x244c13(0x1e6)](_0x244c13(0x208)+Object[_0x244c13(0x1de)](this[_0x244c13(0x202)])['length']+_0x244c13(0x1f8));}}catch(_0x507f8e){const _0x27e4d5=Logger[_0x244c13(0x201)](_0x5435db[_0x244c13(0x1f6)],_0x507f8e);this['notifyError'](_0x27e4d5),this[_0x244c13(0x202)]={};}}async[_0x56ca4f(0x200)](){const _0x45530e=_0x56ca4f,_0x432b0f={'JmJWp':'conversations','HwIFc':_0x45530e(0x213),'rHcVj':_0x45530e(0x207)};try{const _0x108368=JSON[_0x45530e(0x1e8)](Object[_0x45530e(0x1fa)](this['conversations']));_0x108368['length']>this[_0x45530e(0x210)]&&await this[_0x45530e(0x1f1)](),localStorage[_0x45530e(0x1fc)](_0x432b0f[_0x45530e(0x227)],_0x108368),this[_0x45530e(0x222)](),Logger['info'](_0x432b0f[_0x45530e(0x21d)]);}catch(_0xf3608d){const _0x4ba7fa=Logger[_0x45530e(0x201)](_0x432b0f['rHcVj'],_0xf3608d);this[_0x45530e(0x225)](_0x4ba7fa);}}async[_0x56ca4f(0x1f1)](){const _0x4ee1ed=_0x56ca4f,_0x518191={'JQiQi':_0x4ee1ed(0x1dd),'wdvsG':function(_0xbc761c,_0x1c5e20){return _0xbc761c>_0x1c5e20;},'rdBAw':function(_0x3dfade,_0x40e4cf){return _0x3dfade>_0x40e4cf;},'asmMO':'Storage\x20cleanup\x20completed'};Logger[_0x4ee1ed(0x21b)](_0x518191[_0x4ee1ed(0x1e3)]);const _0x5017c4=this[_0x4ee1ed(0x216)]();_0x518191[_0x4ee1ed(0x1ef)](_0x5017c4[_0x4ee1ed(0x220)],this[_0x4ee1ed(0x1e2)])&&(this[_0x4ee1ed(0x202)]=_0x5017c4[_0x4ee1ed(0x21c)](0x0,this[_0x4ee1ed(0x1e2)])[_0x4ee1ed(0x21e)]((_0x4f6314,_0x35b1ec)=>{return _0x4f6314[_0x35b1ec['id']]=_0x35b1ec,_0x4f6314;},{}),Logger[_0x4ee1ed(0x1e6)](_0x4ee1ed(0x1ed)+this[_0x4ee1ed(0x1e2)]+_0x4ee1ed(0x1eb)));let _0x5da0fc=JSON[_0x4ee1ed(0x1e8)](Object[_0x4ee1ed(0x1fa)](this[_0x4ee1ed(0x202)]))[_0x4ee1ed(0x220)];while(_0x5da0fc>this[_0x4ee1ed(0x210)]&&_0x518191[_0x4ee1ed(0x203)](Object[_0x4ee1ed(0x1de)](this[_0x4ee1ed(0x202)])[_0x4ee1ed(0x220)],0x0)){const _0x5c3f59=_0x5017c4[_0x4ee1ed(0x218)]();_0x5c3f59[_0x4ee1ed(0x1f7)][_0x4ee1ed(0x220)]>0xa?_0x5c3f59[_0x4ee1ed(0x1f7)]=_0x5c3f59['messages'][_0x4ee1ed(0x21c)](-0xa):delete this['conversations'][_0x5c3f59['id']],_0x5da0fc=JSON[_0x4ee1ed(0x1e8)](Object[_0x4ee1ed(0x1fa)](this['conversations']))[_0x4ee1ed(0x220)];}Logger['info'](_0x518191[_0x4ee1ed(0x1dc)]);}async['createNewConversation'](_0x419605=_0x56ca4f(0x1db)){const _0x49840a=_0x56ca4f,_0x1cc064=_0x49840a(0x20f)+Date['now'](),_0x1d3e96=new Conversation(_0x1cc064,_0x419605);return this['conversations'][_0x1cc064]=_0x1d3e96,this[_0x49840a(0x219)]=_0x1cc064,await this['saveConversations'](),this['notifyCurrentConversationChange'](),_0x1cc064;}[_0x56ca4f(0x1f4)](){const _0x267dc3=_0x56ca4f;return this[_0x267dc3(0x202)][this[_0x267dc3(0x219)]]||null;}async[_0x56ca4f(0x20e)](_0x387885,_0x4e4546){const _0x5295f2=_0x56ca4f,_0x166c45={'cwKJA':_0x5295f2(0x1ee),'jzMCl':function(_0xbc8a34,_0x3674b2){return _0xbc8a34===_0x3674b2;},'RCAmq':_0x5295f2(0x1db),'fjORj':function(_0x4f612a,_0x469245){return _0x4f612a+_0x469245;},'bPRht':_0x5295f2(0x214)},_0x4914b3=this['getCurrentConversation']();if(!_0x4914b3)return![];const _0x1efadc={'role':_0x4e4546,'content':_0x387885,'timestamp':new Date()['toISOString']()};return _0x4914b3[_0x5295f2(0x1f7)]['push'](_0x1efadc),_0x4914b3[_0x5295f2(0x1ff)]=new Date()[_0x5295f2(0x1fd)](),_0x4e4546===_0x166c45[_0x5295f2(0x1f2)]&&_0x166c45[_0x5295f2(0x224)](_0x4914b3[_0x5295f2(0x1e9)],_0x166c45[_0x5295f2(0x205)])&&_0x166c45[_0x5295f2(0x224)](_0x4914b3[_0x5295f2(0x1f7)][_0x5295f2(0x220)],0x1)&&(_0x4914b3[_0x5295f2(0x1e9)]=_0x166c45[_0x5295f2(0x1e5)](_0x387885[_0x5295f2(0x212)]('\x20')[_0x5295f2(0x21c)](0x0,0x4)['join']('\x20'),_0x166c45[_0x5295f2(0x20b)])),await this[_0x5295f2(0x200)](),!![];}async['deleteConversation'](_0x245a55){const _0x175913=_0x56ca4f;this[_0x175913(0x202)][_0x245a55]&&(delete this[_0x175913(0x202)][_0x245a55],this[_0x175913(0x219)]===_0x245a55&&(this[_0x175913(0x219)]=Object[_0x175913(0x1de)](this['conversations'])[0x0]||null),await this[_0x175913(0x200)]());}[_0x56ca4f(0x21a)](_0x30249b){const _0x7f93c=_0x56ca4f;if(this['conversations'][_0x30249b])return this[_0x7f93c(0x219)]=_0x30249b,this[_0x7f93c(0x223)](),!![];return![];}[_0x56ca4f(0x216)](){const _0x43b187=_0x56ca4f;return Object['values'](this[_0x43b187(0x202)])[_0x43b187(0x21f)]((_0xfcc23,_0x31e022)=>new Date(_0x31e022['updatedAt'])-new Date(_0xfcc23[_0x43b187(0x1ff)]));}['notifyConversationUpdate'](){const _0x5b14d3=_0x56ca4f;this[_0x5b14d3(0x206)][_0x5b14d3(0x1e1)][_0x5b14d3(0x1f9)](_0x446e36=>_0x446e36(Object[_0x5b14d3(0x1fa)](this[_0x5b14d3(0x202)])));}['notifyCurrentConversationChange'](){const _0x37ce82=_0x56ca4f;this[_0x37ce82(0x206)][_0x37ce82(0x1e7)][_0x37ce82(0x1f9)](_0x352c32=>_0x352c32(this[_0x37ce82(0x1f4)]()));}[_0x56ca4f(0x225)](_0x45d807){const _0xad9e3a=_0x56ca4f;this[_0xad9e3a(0x206)][_0xad9e3a(0x1f3)][_0xad9e3a(0x1f9)](_0x4cd7cb=>_0x4cd7cb(_0x45d807));}['addEventListener'](_0x9efce9,_0x263aa6){const _0xc4e2f0=_0x56ca4f;this[_0xc4e2f0(0x206)][_0x9efce9]&&this[_0xc4e2f0(0x206)][_0x9efce9][_0xc4e2f0(0x1f5)](_0x263aa6);}[_0x56ca4f(0x217)](_0x14342e,_0x34122c){const _0x34c7f0=_0x56ca4f;this[_0x34c7f0(0x206)][_0x14342e]&&(this[_0x34c7f0(0x206)][_0x14342e]=this[_0x34c7f0(0x206)][_0x14342e][_0x34c7f0(0x1fe)](_0x266c4c=>_0x266c4c!==_0x34122c));}}function _0x5ecd(_0x4ed2f4,_0x3a8a41){const _0x2f134a=_0x2f13();return _0x5ecd=function(_0x5ecdb4,_0x172e9b){_0x5ecdb4=_0x5ecdb4-0x1da;let _0x4234da=_0x2f134a[_0x5ecdb4];return _0x4234da;},_0x5ecd(_0x4ed2f4,_0x3a8a41);}export{ChatManager};