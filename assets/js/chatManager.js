
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x1b2c(_0x115d0e,_0x283504){const _0x44a995=_0x44a9();return _0x1b2c=function(_0x1b2cb3,_0x566512){_0x1b2cb3=_0x1b2cb3-0x1da;let _0x5b3da3=_0x44a995[_0x1b2cb3];return _0x5b3da3;},_0x1b2c(_0x115d0e,_0x283504);}const _0x15b02d=_0x1b2c;(function(_0x4954f3,_0x398f84){const _0x77b6c1=_0x1b2c,_0x5cf173=_0x4954f3();while(!![]){try{const _0x37c5ca=-parseInt(_0x77b6c1(0x225))/0x1*(parseInt(_0x77b6c1(0x1e7))/0x2)+parseInt(_0x77b6c1(0x1ea))/0x3*(parseInt(_0x77b6c1(0x21b))/0x4)+parseInt(_0x77b6c1(0x1f1))/0x5*(-parseInt(_0x77b6c1(0x218))/0x6)+parseInt(_0x77b6c1(0x1ed))/0x7+-parseInt(_0x77b6c1(0x206))/0x8+parseInt(_0x77b6c1(0x21a))/0x9*(-parseInt(_0x77b6c1(0x210))/0xa)+parseInt(_0x77b6c1(0x1e2))/0xb;if(_0x37c5ca===_0x398f84)break;else _0x5cf173['push'](_0x5cf173['shift']());}catch(_0x352a6c){_0x5cf173['push'](_0x5cf173['shift']());}}}(_0x44a9,0xf1dc1));import{Logger}from'./common.js';function _0x44a9(){const _0x367a7e=['JDvjd','9PIIKtU','4NtqkqJ','notifyCurrentConversationChange','...','notifyError','UtWLR','opgOd','Loaded\x20','sort','stringify','Failed\x20to\x20load\x20conversations','179pnDVGK','bsBzr','getCurrentConversation','notifyConversationUpdate','user','oYcak','currentConversationId','New\x20Conversation','SEQzR','keys','addEventListener','filter','36092859GzyjRt','vhDAZ','slice','MAX_STORAGE_SIZE','info','1468pOMzMx','conversations','\x20conversations','5267859pePxsC','switchConversation','length','47089gDqtlP','loadConversations','split','qsQZg','5jhtxBr','listeners','pop','Failed\x20to\x20save\x20conversations','updatedAt','removeEventListener','Storage\x20cleanup\x20completed','KPjDw','LePnJ','Conversations\x20saved\x20successfully','push','cleanupStorage','error','forEach','4|0|1|3|2','toISOString','GFqmz','messages','onConversationUpdate','onError','MAX_CONVERSATIONS','12676024BxNJKU','iqifm','saveConversations','createdAt','Storage\x20cleanup\x20initiated','Trimmed\x20to\x20','lerZO','title','values','join','6193090uBYJDc','warn','addMessage','getSortedConversations','getItem','WVTfl','reduce','conv_','10307964RqnFGp'];_0x44a9=function(){return _0x367a7e;};return _0x44a9();}class Conversation{constructor(_0x1c78fa,_0xab3df4){const _0x517b69=_0x1b2c,_0x39caf3={'opgOd':_0x517b69(0x1ff)},_0x519e7f=_0x39caf3[_0x517b69(0x220)]['split']('|');let _0x20ef64=0x0;while(!![]){switch(_0x519e7f[_0x20ef64++]){case'0':this[_0x517b69(0x20d)]=_0xab3df4;continue;case'1':this[_0x517b69(0x202)]=[];continue;case'2':this[_0x517b69(0x1f5)]=new Date()[_0x517b69(0x200)]();continue;case'3':this[_0x517b69(0x209)]=new Date()[_0x517b69(0x200)]();continue;case'4':this['id']=_0x1c78fa;continue;}break;}}}class ChatManager{constructor(){const _0x4b7753=_0x1b2c,_0x5a8988={'UtWLR':'1|0|4|3|5|2','KPjDw':function(_0x51bc69,_0x1b48db){return _0x51bc69*_0x1b48db;}},_0x36ae63=_0x5a8988[_0x4b7753(0x21f)][_0x4b7753(0x1ef)]('|');let _0xe3355b=0x0;while(!![]){switch(_0x36ae63[_0xe3355b++]){case'0':this[_0x4b7753(0x1dc)]=null;continue;case'1':this[_0x4b7753(0x1e8)]={};continue;case'2':this[_0x4b7753(0x1ee)]();continue;case'3':this[_0x4b7753(0x1e5)]=_0x5a8988[_0x4b7753(0x1f8)](_0x5a8988[_0x4b7753(0x1f8)](4.5,0x400),0x400);continue;case'4':this[_0x4b7753(0x1f2)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'5':this[_0x4b7753(0x205)]=0x32;continue;}break;}}async[_0x15b02d(0x1ee)](){const _0x33bc11=_0x15b02d,_0x296a82={'GFqmz':_0x33bc11(0x1e8),'McbbN':function(_0x58399c,_0x28eed0){return _0x58399c>_0x28eed0;},'wdTdE':_0x33bc11(0x224)};try{const _0x3db181=localStorage[_0x33bc11(0x214)](_0x296a82[_0x33bc11(0x201)]);if(_0x3db181){const _0x1090c5=JSON['parse'](_0x3db181)||[];this[_0x33bc11(0x1e8)]=_0x1090c5[_0x33bc11(0x216)]((_0xd55b6c,_0x28006e)=>{const _0x134b31=_0x33bc11;return _0xd55b6c[_0x28006e['id']]=new Conversation(_0x28006e['id'],_0x28006e['title']),_0xd55b6c[_0x28006e['id']][_0x134b31(0x202)]=_0x28006e[_0x134b31(0x202)]||[],_0xd55b6c[_0x28006e['id']][_0x134b31(0x209)]=_0x28006e[_0x134b31(0x209)],_0xd55b6c[_0x28006e['id']]['updatedAt']=_0x28006e[_0x134b31(0x1f5)],_0xd55b6c;},{}),_0x296a82['McbbN'](Object[_0x33bc11(0x1df)](this['conversations'])['length'],0x0)&&(this[_0x33bc11(0x1dc)]=Object[_0x33bc11(0x1df)](this[_0x33bc11(0x1e8)])[0x0]),Logger[_0x33bc11(0x1e6)](_0x33bc11(0x221)+Object[_0x33bc11(0x1df)](this['conversations'])[_0x33bc11(0x1ec)]+_0x33bc11(0x1e9));}}catch(_0x1c1ea8){const _0x5af05f=Logger[_0x33bc11(0x1fd)](_0x296a82['wdTdE'],_0x1c1ea8);this[_0x33bc11(0x21e)](_0x5af05f),this[_0x33bc11(0x1e8)]={};}}async[_0x15b02d(0x208)](){const _0x1897c6=_0x15b02d,_0x13d7ab={'LePnJ':function(_0x368559,_0x231924){return _0x368559>_0x231924;},'oYcak':_0x1897c6(0x1e8)};try{const _0x2781ca=JSON['stringify'](Object[_0x1897c6(0x20e)](this[_0x1897c6(0x1e8)]));_0x13d7ab[_0x1897c6(0x1f9)](_0x2781ca['length'],this['MAX_STORAGE_SIZE'])&&await this[_0x1897c6(0x1fc)](),localStorage['setItem'](_0x13d7ab[_0x1897c6(0x1db)],_0x2781ca),this[_0x1897c6(0x228)](),Logger['info'](_0x1897c6(0x1fa));}catch(_0x4afea9){const _0x2a2dda=Logger[_0x1897c6(0x1fd)](_0x1897c6(0x1f4),_0x4afea9);this[_0x1897c6(0x21e)](_0x2a2dda);}}async['cleanupStorage'](){const _0x531605=_0x15b02d,_0x24b544={'SEQzR':_0x531605(0x20a),'qsQZg':function(_0x2880be,_0x44fa5c){return _0x2880be>_0x44fa5c;},'iqifm':function(_0x49d1c6,_0x5983e1){return _0x49d1c6>_0x5983e1;}};Logger[_0x531605(0x211)](_0x24b544[_0x531605(0x1de)]);const _0x295342=this[_0x531605(0x213)]();_0x24b544[_0x531605(0x1f0)](_0x295342['length'],this['MAX_CONVERSATIONS'])&&(this['conversations']=_0x295342['slice'](0x0,this[_0x531605(0x205)])['reduce']((_0x58f330,_0x14a05d)=>{return _0x58f330[_0x14a05d['id']]=_0x14a05d,_0x58f330;},{}),Logger[_0x531605(0x1e6)](_0x531605(0x20b)+this[_0x531605(0x205)]+'\x20most\x20recent\x20conversations'));let _0x4d0469=JSON[_0x531605(0x223)](Object['values'](this[_0x531605(0x1e8)]))[_0x531605(0x1ec)];while(_0x4d0469>this[_0x531605(0x1e5)]&&_0x24b544[_0x531605(0x207)](Object[_0x531605(0x1df)](this['conversations'])['length'],0x0)){const _0x376b58=_0x295342[_0x531605(0x1f3)]();_0x24b544[_0x531605(0x1f0)](_0x376b58[_0x531605(0x202)][_0x531605(0x1ec)],0xa)?_0x376b58['messages']=_0x376b58[_0x531605(0x202)][_0x531605(0x1e4)](-0xa):delete this[_0x531605(0x1e8)][_0x376b58['id']],_0x4d0469=JSON[_0x531605(0x223)](Object[_0x531605(0x20e)](this[_0x531605(0x1e8)]))[_0x531605(0x1ec)];}Logger[_0x531605(0x1e6)](_0x531605(0x1f7));}async['createNewConversation'](_0x5baf18=_0x15b02d(0x1dd)){const _0x30df8d=_0x15b02d,_0x4fa3dc=_0x30df8d(0x217)+Date['now'](),_0x3e0a45=new Conversation(_0x4fa3dc,_0x5baf18);return this[_0x30df8d(0x1e8)][_0x4fa3dc]=_0x3e0a45,this[_0x30df8d(0x1dc)]=_0x4fa3dc,await this[_0x30df8d(0x208)](),this[_0x30df8d(0x21c)](),_0x4fa3dc;}[_0x15b02d(0x227)](){const _0x487b77=_0x15b02d;return this[_0x487b77(0x1e8)][this[_0x487b77(0x1dc)]]||null;}async[_0x15b02d(0x212)](_0x2420cd,_0x130d23){const _0x1c65c2=_0x15b02d,_0x5c3b11={'JDvjd':function(_0x22d435,_0x299d6f){return _0x22d435===_0x299d6f;},'bsBzr':_0x1c65c2(0x1da),'lerZO':function(_0x47b30e,_0x3bf402){return _0x47b30e===_0x3bf402;},'vhDAZ':'New\x20Conversation','WVTfl':function(_0x3d9d5b,_0x5b7733){return _0x3d9d5b+_0x5b7733;},'IxdnQ':_0x1c65c2(0x21d)},_0x2e3bbf=this[_0x1c65c2(0x227)]();if(!_0x2e3bbf)return![];const _0x1a5e28={'role':_0x130d23,'content':_0x2420cd,'timestamp':new Date()[_0x1c65c2(0x200)]()};return _0x2e3bbf[_0x1c65c2(0x202)][_0x1c65c2(0x1fb)](_0x1a5e28),_0x2e3bbf[_0x1c65c2(0x1f5)]=new Date()[_0x1c65c2(0x200)](),_0x5c3b11[_0x1c65c2(0x219)](_0x130d23,_0x5c3b11[_0x1c65c2(0x226)])&&_0x5c3b11[_0x1c65c2(0x20c)](_0x2e3bbf[_0x1c65c2(0x20d)],_0x5c3b11[_0x1c65c2(0x1e3)])&&_0x2e3bbf[_0x1c65c2(0x202)]['length']===0x1&&(_0x2e3bbf[_0x1c65c2(0x20d)]=_0x5c3b11[_0x1c65c2(0x215)](_0x2420cd[_0x1c65c2(0x1ef)]('\x20')[_0x1c65c2(0x1e4)](0x0,0x4)[_0x1c65c2(0x20f)]('\x20'),_0x5c3b11['IxdnQ'])),await this[_0x1c65c2(0x208)](),!![];}async['deleteConversation'](_0x95dd06){const _0x3cf780=_0x15b02d,_0x1194a9={'sNKrZ':function(_0x3ed082,_0x51f59f){return _0x3ed082===_0x51f59f;}};this[_0x3cf780(0x1e8)][_0x95dd06]&&(delete this[_0x3cf780(0x1e8)][_0x95dd06],_0x1194a9['sNKrZ'](this['currentConversationId'],_0x95dd06)&&(this[_0x3cf780(0x1dc)]=Object[_0x3cf780(0x1df)](this[_0x3cf780(0x1e8)])[0x0]||null),await this['saveConversations']());}[_0x15b02d(0x1eb)](_0xc76a7f){const _0xc18fa=_0x15b02d;if(this[_0xc18fa(0x1e8)][_0xc76a7f])return this['currentConversationId']=_0xc76a7f,this[_0xc18fa(0x21c)](),!![];return![];}[_0x15b02d(0x213)](){const _0x34dace=_0x15b02d;return Object[_0x34dace(0x20e)](this[_0x34dace(0x1e8)])[_0x34dace(0x222)]((_0x43f300,_0x12802c)=>new Date(_0x12802c[_0x34dace(0x1f5)])-new Date(_0x43f300[_0x34dace(0x1f5)]));}[_0x15b02d(0x228)](){const _0x45af0e=_0x15b02d;this[_0x45af0e(0x1f2)][_0x45af0e(0x203)][_0x45af0e(0x1fe)](_0xbe769b=>_0xbe769b(Object[_0x45af0e(0x20e)](this[_0x45af0e(0x1e8)])));}[_0x15b02d(0x21c)](){const _0x33f375=_0x15b02d;this[_0x33f375(0x1f2)]['onCurrentConversationChange'][_0x33f375(0x1fe)](_0x61c104=>_0x61c104(this['getCurrentConversation']()));}[_0x15b02d(0x21e)](_0x49232a){const _0x2bfc14=_0x15b02d;this[_0x2bfc14(0x1f2)][_0x2bfc14(0x204)]['forEach'](_0x99cbd7=>_0x99cbd7(_0x49232a));}[_0x15b02d(0x1e0)](_0xc90c13,_0x55b220){const _0x4b3e91=_0x15b02d;this[_0x4b3e91(0x1f2)][_0xc90c13]&&this[_0x4b3e91(0x1f2)][_0xc90c13][_0x4b3e91(0x1fb)](_0x55b220);}[_0x15b02d(0x1f6)](_0x507ba8,_0x3ddad4){const _0x3766b1=_0x15b02d;this[_0x3766b1(0x1f2)][_0x507ba8]&&(this[_0x3766b1(0x1f2)][_0x507ba8]=this[_0x3766b1(0x1f2)][_0x507ba8][_0x3766b1(0x1e1)](_0x1d5886=>_0x1d5886!==_0x3ddad4));}}export{ChatManager};