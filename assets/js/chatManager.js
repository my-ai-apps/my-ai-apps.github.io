
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x3bf3b6=_0x348d;function _0x348d(_0x521f3c,_0x19ac02){const _0x4d7b2c=_0x4d7b();return _0x348d=function(_0x348d08,_0x251589){_0x348d08=_0x348d08-0x17a;let _0x14f2d2=_0x4d7b2c[_0x348d08];return _0x14f2d2;},_0x348d(_0x521f3c,_0x19ac02);}(function(_0x5da34b,_0x45ea84){const _0x2e2258=_0x348d,_0xf5c6cf=_0x5da34b();while(!![]){try{const _0x29fb5d=parseInt(_0x2e2258(0x1a7))/0x1+parseInt(_0x2e2258(0x1b5))/0x2+-parseInt(_0x2e2258(0x1bf))/0x3+parseInt(_0x2e2258(0x1ae))/0x4+parseInt(_0x2e2258(0x19c))/0x5*(-parseInt(_0x2e2258(0x199))/0x6)+parseInt(_0x2e2258(0x1ad))/0x7*(-parseInt(_0x2e2258(0x1b1))/0x8)+parseInt(_0x2e2258(0x19b))/0x9*(-parseInt(_0x2e2258(0x17c))/0xa);if(_0x29fb5d===_0x45ea84)break;else _0xf5c6cf['push'](_0xf5c6cf['shift']());}catch(_0x5f1058){_0xf5c6cf['push'](_0xf5c6cf['shift']());}}}(_0x4d7b,0x87679));import{Logger}from'./common.js';class Conversation{constructor(_0x371f74,_0x2f4c1b){const _0x311261=_0x348d,_0x411c70={'qEuua':_0x311261(0x18d)},_0x325a87=_0x411c70['qEuua'][_0x311261(0x188)]('|');let _0x17f810=0x0;while(!![]){switch(_0x325a87[_0x17f810++]){case'0':this[_0x311261(0x1b4)]=new Date()['toISOString']();continue;case'1':this[_0x311261(0x1bb)]=new Date()[_0x311261(0x185)]();continue;case'2':this[_0x311261(0x19f)]=_0x2f4c1b;continue;case'3':this[_0x311261(0x18c)]=[];continue;case'4':this['id']=_0x371f74;continue;}break;}}}class ChatManager{constructor(){const _0x2e583a=_0x348d,_0x59e862={'LNPPZ':'4|1|3|0|5|2','vtrtP':function(_0x287488,_0x2f19f4){return _0x287488*_0x2f19f4;},'vOhct':function(_0x49fdbd,_0x2da733){return _0x49fdbd*_0x2da733;}},_0x1f1239=_0x59e862[_0x2e583a(0x19e)][_0x2e583a(0x188)]('|');let _0x22baef=0x0;while(!![]){switch(_0x1f1239[_0x22baef++]){case'0':this[_0x2e583a(0x18a)]=_0x59e862[_0x2e583a(0x1b6)](_0x59e862[_0x2e583a(0x1bc)](4.5,0x400),0x400);continue;case'1':this['currentConversationId']=null;continue;case'2':this[_0x2e583a(0x17f)]();continue;case'3':this[_0x2e583a(0x186)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'4':this[_0x2e583a(0x18e)]={};continue;case'5':this[_0x2e583a(0x17a)]=0x32;continue;}break;}}async['loadConversations'](){const _0x20fd05=_0x348d,_0x5996a4={'oBxiP':'3|2|4|0|1','ngqju':'conversations','eSTuG':function(_0x32a7b5,_0x308311){return _0x32a7b5>_0x308311;},'jKKpp':_0x20fd05(0x19a)};try{const _0x3a7d77=localStorage['getItem'](_0x5996a4['ngqju']);if(_0x3a7d77){const _0x26e43d=JSON[_0x20fd05(0x195)](_0x3a7d77)||[];this[_0x20fd05(0x18e)]=_0x26e43d[_0x20fd05(0x1c2)]((_0x39df3b,_0x37629c)=>{const _0x1ef409=_0x20fd05,_0x550598=_0x5996a4[_0x1ef409(0x18f)]['split']('|');let _0x1f156f=0x0;while(!![]){switch(_0x550598[_0x1f156f++]){case'0':_0x39df3b[_0x37629c['id']]['updatedAt']=_0x37629c[_0x1ef409(0x1bb)];continue;case'1':return _0x39df3b;case'2':_0x39df3b[_0x37629c['id']][_0x1ef409(0x18c)]=_0x37629c[_0x1ef409(0x18c)]||[];continue;case'3':_0x39df3b[_0x37629c['id']]=new Conversation(_0x37629c['id'],_0x37629c[_0x1ef409(0x19f)]);continue;case'4':_0x39df3b[_0x37629c['id']]['createdAt']=_0x37629c[_0x1ef409(0x1b4)];continue;}break;}},{}),_0x5996a4[_0x20fd05(0x1ac)](Object[_0x20fd05(0x1a0)](this[_0x20fd05(0x18e)])['length'],0x0)&&(this['currentConversationId']=Object[_0x20fd05(0x1a0)](this[_0x20fd05(0x18e)])[0x0]),Logger[_0x20fd05(0x1b8)]('Loaded\x20'+Object['keys'](this[_0x20fd05(0x18e)])[_0x20fd05(0x1a4)]+_0x20fd05(0x193));}}catch(_0x51e1c1){const _0x555cad=Logger[_0x20fd05(0x184)](_0x5996a4[_0x20fd05(0x1a1)],_0x51e1c1);this[_0x20fd05(0x198)](_0x555cad),this['conversations']={};}}async[_0x3bf3b6(0x192)](){const _0x38a23b=_0x3bf3b6,_0x16b897={'ByHTs':_0x38a23b(0x18e),'pnOPQ':_0x38a23b(0x1c5)};try{const _0x163f3f=JSON['stringify'](Object['values'](this['conversations']));_0x163f3f['length']>this[_0x38a23b(0x18a)]&&await this[_0x38a23b(0x191)](),localStorage['setItem'](_0x16b897[_0x38a23b(0x18b)],_0x163f3f),this[_0x38a23b(0x1c4)](),Logger[_0x38a23b(0x1b8)](_0x38a23b(0x181));}catch(_0x3c8806){const _0x52e920=Logger['error'](_0x16b897[_0x38a23b(0x180)],_0x3c8806);this[_0x38a23b(0x198)](_0x52e920);}}async['cleanupStorage'](){const _0x19a23c=_0x3bf3b6,_0x1f3b53={'hPYXS':function(_0x254574,_0x5d9abf){return _0x254574>_0x5d9abf;},'TDCDo':function(_0x21f3c8,_0x125a87){return _0x21f3c8>_0x125a87;},'qzgqT':'Storage\x20cleanup\x20completed'};Logger[_0x19a23c(0x1a6)](_0x19a23c(0x194));const _0x21c14=this[_0x19a23c(0x1a8)]();_0x1f3b53[_0x19a23c(0x182)](_0x21c14[_0x19a23c(0x1a4)],this[_0x19a23c(0x17a)])&&(this[_0x19a23c(0x18e)]=_0x21c14[_0x19a23c(0x190)](0x0,this['MAX_CONVERSATIONS'])[_0x19a23c(0x1c2)]((_0x270a46,_0x37ecac)=>{return _0x270a46[_0x37ecac['id']]=_0x37ecac,_0x270a46;},{}),Logger['info'](_0x19a23c(0x17b)+this[_0x19a23c(0x17a)]+_0x19a23c(0x1b9)));let _0xaf87f4=JSON[_0x19a23c(0x1ab)](Object[_0x19a23c(0x1af)](this[_0x19a23c(0x18e)]))[_0x19a23c(0x1a4)];while(_0x1f3b53[_0x19a23c(0x183)](_0xaf87f4,this['MAX_STORAGE_SIZE'])&&_0x1f3b53[_0x19a23c(0x183)](Object[_0x19a23c(0x1a0)](this[_0x19a23c(0x18e)])['length'],0x0)){const _0x5d9803=_0x21c14['pop']();_0x1f3b53[_0x19a23c(0x182)](_0x5d9803[_0x19a23c(0x18c)]['length'],0xa)?_0x5d9803[_0x19a23c(0x18c)]=_0x5d9803[_0x19a23c(0x18c)][_0x19a23c(0x190)](-0xa):delete this['conversations'][_0x5d9803['id']],_0xaf87f4=JSON[_0x19a23c(0x1ab)](Object[_0x19a23c(0x1af)](this['conversations']))[_0x19a23c(0x1a4)];}Logger[_0x19a23c(0x1b8)](_0x1f3b53[_0x19a23c(0x196)]);}async[_0x3bf3b6(0x1a5)](_0x5ebfd2=_0x3bf3b6(0x197)){const _0x232f12=_0x3bf3b6,_0x1471ea=_0x232f12(0x1aa)+Date[_0x232f12(0x1b7)](),_0x2a0371=new Conversation(_0x1471ea,_0x5ebfd2);return this['conversations'][_0x1471ea]=_0x2a0371,this['currentConversationId']=_0x1471ea,await this[_0x232f12(0x192)](),this[_0x232f12(0x1a3)](),_0x1471ea;}['getCurrentConversation'](){const _0x1cc225=_0x3bf3b6;return this[_0x1cc225(0x18e)][this[_0x1cc225(0x1b0)]]||null;}async[_0x3bf3b6(0x17e)](_0x4a848,_0x2d6207){const _0xd9b5c9=_0x3bf3b6,_0x187866={'MSzRS':function(_0x219678,_0x13fe61){return _0x219678===_0x13fe61;},'WeSnP':function(_0x175b9c,_0x57add0){return _0x175b9c===_0x57add0;},'lyQHh':function(_0x3430f7,_0x1d5da3){return _0x3430f7+_0x1d5da3;},'zimIO':'...'},_0x395ab2=this[_0xd9b5c9(0x1b3)]();if(!_0x395ab2)return![];const _0x1a17fa={'role':_0x2d6207,'content':_0x4a848,'timestamp':new Date()[_0xd9b5c9(0x185)]()};return _0x395ab2['messages']['push'](_0x1a17fa),_0x395ab2[_0xd9b5c9(0x1bb)]=new Date()[_0xd9b5c9(0x185)](),_0x187866['MSzRS'](_0x2d6207,_0xd9b5c9(0x1c1))&&_0x187866[_0xd9b5c9(0x1bd)](_0x395ab2[_0xd9b5c9(0x19f)],'New\x20Conversation')&&_0x395ab2[_0xd9b5c9(0x18c)][_0xd9b5c9(0x1a4)]===0x1&&(_0x395ab2[_0xd9b5c9(0x19f)]=_0x187866[_0xd9b5c9(0x17d)](_0x4a848[_0xd9b5c9(0x188)]('\x20')['slice'](0x0,0x4)[_0xd9b5c9(0x189)]('\x20'),_0x187866[_0xd9b5c9(0x1ba)])),await this['saveConversations'](),!![];}async[_0x3bf3b6(0x1a2)](_0x4f2873){const _0x569653=_0x3bf3b6,_0xfcfed0={'hJGFx':function(_0x4c8d57,_0x19e717){return _0x4c8d57===_0x19e717;}};this[_0x569653(0x18e)][_0x4f2873]&&(delete this[_0x569653(0x18e)][_0x4f2873],_0xfcfed0[_0x569653(0x1b2)](this['currentConversationId'],_0x4f2873)&&(this[_0x569653(0x1b0)]=Object[_0x569653(0x1a0)](this[_0x569653(0x18e)])[0x0]||null),await this['saveConversations']());}[_0x3bf3b6(0x1c3)](_0xace2ea){const _0x3266b7=_0x3bf3b6;if(this[_0x3266b7(0x18e)][_0xace2ea])return this[_0x3266b7(0x1b0)]=_0xace2ea,this[_0x3266b7(0x1a3)](),!![];return![];}[_0x3bf3b6(0x1a8)](){const _0x693b46=_0x3bf3b6;return Object[_0x693b46(0x1af)](this[_0x693b46(0x18e)])['sort']((_0x8b7a0a,_0x4eb34b)=>new Date(_0x4eb34b[_0x693b46(0x1bb)])-new Date(_0x8b7a0a[_0x693b46(0x1bb)]));}[_0x3bf3b6(0x1c4)](){const _0x55b994=_0x3bf3b6;this['listeners'][_0x55b994(0x1a9)][_0x55b994(0x1be)](_0x25db67=>_0x25db67(Object[_0x55b994(0x1af)](this[_0x55b994(0x18e)])));}[_0x3bf3b6(0x1a3)](){const _0x314db7=_0x3bf3b6;this[_0x314db7(0x186)][_0x314db7(0x187)][_0x314db7(0x1be)](_0x30cdc3=>_0x30cdc3(this[_0x314db7(0x1b3)]()));}['notifyError'](_0x815ee8){const _0x447af1=_0x3bf3b6;this[_0x447af1(0x186)]['onError'][_0x447af1(0x1be)](_0x2e77b5=>_0x2e77b5(_0x815ee8));}[_0x3bf3b6(0x19d)](_0x161637,_0x4986f3){const _0x94f97f=_0x3bf3b6;this[_0x94f97f(0x186)][_0x161637]&&this[_0x94f97f(0x186)][_0x161637][_0x94f97f(0x1c0)](_0x4986f3);}['removeEventListener'](_0x5775da,_0x2c254a){const _0x651375=_0x3bf3b6;this[_0x651375(0x186)][_0x5775da]&&(this[_0x651375(0x186)][_0x5775da]=this[_0x651375(0x186)][_0x5775da]['filter'](_0x892b0e=>_0x892b0e!==_0x2c254a));}}export{ChatManager};function _0x4d7b(){const _0x5e6106=['lyQHh','addMessage','loadConversations','pnOPQ','Conversations\x20saved\x20successfully','hPYXS','TDCDo','error','toISOString','listeners','onCurrentConversationChange','split','join','MAX_STORAGE_SIZE','ByHTs','messages','4|2|3|0|1','conversations','oBxiP','slice','cleanupStorage','saveConversations','\x20conversations','Storage\x20cleanup\x20initiated','parse','qzgqT','New\x20Conversation','notifyError','912852WrRNTX','Failed\x20to\x20load\x20conversations','27RAUEOt','20lvLHHd','addEventListener','LNPPZ','title','keys','jKKpp','deleteConversation','notifyCurrentConversationChange','length','createNewConversation','warn','894855xcjpHa','getSortedConversations','onConversationUpdate','conv_','stringify','eSTuG','196cvLUDq','3993016DaycUJ','values','currentConversationId','173336Mremfd','hJGFx','getCurrentConversation','createdAt','1587216QcuHnR','vtrtP','now','info','\x20most\x20recent\x20conversations','zimIO','updatedAt','vOhct','WeSnP','forEach','1764870RhdUox','push','user','reduce','switchConversation','notifyConversationUpdate','Failed\x20to\x20save\x20conversations','MAX_CONVERSATIONS','Trimmed\x20to\x20','1095220FUaKZv'];_0x4d7b=function(){return _0x5e6106;};return _0x4d7b();}