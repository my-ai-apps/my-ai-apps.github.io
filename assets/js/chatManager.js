
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
function _0x4f91(){const _0x44dd6c=['keys','MAX_CONVERSATIONS','...','431928SgyEEN','getSortedConversations','title','getCurrentConversation','deleteConversation','Failed\x20to\x20save\x20conversations','amPTo','switchConversation','onCurrentConversationChange','length','join','gdbic','New\x20Conversation','2|1|3|0|4|5','171316AabYET','onError','kauch','Trimmed\x20to\x20','4653250QKiYyC','notifyCurrentConversationChange','392284mPrZln','listeners','forEach','filter','conversations','parse','Loaded\x20','2|0|4|3|1','15cSYHtc','addMessage','info','Storage\x20cleanup\x20initiated','838738pGydCR','6709260CPrjcZ','jhrfj','stringify','saveConversations','setItem','loadConversations','conv_','sort','createdAt','ZeJDC','notifyConversationUpdate','slice','currentConversationId','2002008FxnwLz','getItem','user','notifyError','messages','gpVIk','\x20most\x20recent\x20conversations','toISOString','104mUSHeB','reduce','9gApenw','error','Failed\x20to\x20load\x20conversations','values','LhoTl','nkOFG','pop','cnzRH','updatedAt','onConversationUpdate','MAX_STORAGE_SIZE','push','split','addEventListener'];_0x4f91=function(){return _0x44dd6c;};return _0x4f91();}const _0x15c3f5=_0x1e96;(function(_0x40d048,_0x639152){const _0x47d203=_0x1e96,_0x2a32ef=_0x40d048();while(!![]){try{const _0x423b74=-parseInt(_0x47d203(0x1a8))/0x1+-parseInt(_0x47d203(0x196))/0x2*(-parseInt(_0x47d203(0x1c0))/0x3)+-parseInt(_0x47d203(0x19c))/0x4*(-parseInt(_0x47d203(0x1a4))/0x5)+parseInt(_0x47d203(0x1b6))/0x6+-parseInt(_0x47d203(0x19a))/0x7+parseInt(_0x47d203(0x1be))/0x8*(parseInt(_0x47d203(0x188))/0x9)+parseInt(_0x47d203(0x1a9))/0xa;if(_0x423b74===_0x639152)break;else _0x2a32ef['push'](_0x2a32ef['shift']());}catch(_0x13dfa4){_0x2a32ef['push'](_0x2a32ef['shift']());}}}(_0x4f91,0xa515d));import{Logger}from'./common.js';class Conversation{constructor(_0x55bed6,_0x3d9d4d){const _0x4371e8=_0x1e96,_0x2c445f=_0x4371e8(0x1a3)[_0x4371e8(0x1cc)]('|');let _0x242980=0x0;while(!![]){switch(_0x2c445f[_0x242980++]){case'0':this[_0x4371e8(0x18a)]=_0x3d9d4d;continue;case'1':this[_0x4371e8(0x1c8)]=new Date()[_0x4371e8(0x1bd)]();continue;case'2':this['id']=_0x55bed6;continue;case'3':this[_0x4371e8(0x1b1)]=new Date()[_0x4371e8(0x1bd)]();continue;case'4':this[_0x4371e8(0x1ba)]=[];continue;}break;}}}class ChatManager{constructor(){const _0x30106d=_0x1e96,_0x112f3d={'nkOFG':function(_0x5ac776,_0x2909b4){return _0x5ac776*_0x2909b4;}},_0x5bea07=_0x30106d(0x195)[_0x30106d(0x1cc)]('|');let _0xb5daef=0x0;while(!![]){switch(_0x5bea07[_0xb5daef++]){case'0':this[_0x30106d(0x1ca)]=_0x112f3d[_0x30106d(0x1c5)](4.5*0x400,0x400);continue;case'1':this['currentConversationId']=null;continue;case'2':this[_0x30106d(0x1a0)]={};continue;case'3':this[_0x30106d(0x19d)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'4':this[_0x30106d(0x1cf)]=0x32;continue;case'5':this[_0x30106d(0x1ae)]();continue;}break;}}async['loadConversations'](){const _0x202f12=_0x1e96,_0x763b7e={'gpVIk':_0x202f12(0x1a0),'amPTo':function(_0x4b3b84,_0x1f26b5){return _0x4b3b84>_0x1f26b5;},'fALer':_0x202f12(0x1c2)};try{const _0xd132d9=localStorage[_0x202f12(0x1b7)](_0x763b7e[_0x202f12(0x1bb)]);if(_0xd132d9){const _0x1ded0e=JSON[_0x202f12(0x1a1)](_0xd132d9)||[];this[_0x202f12(0x1a0)]=_0x1ded0e[_0x202f12(0x1bf)]((_0x379a7b,_0x381c35)=>{const _0x4751dd=_0x202f12;return _0x379a7b[_0x381c35['id']]=new Conversation(_0x381c35['id'],_0x381c35[_0x4751dd(0x18a)]),_0x379a7b[_0x381c35['id']]['messages']=_0x381c35[_0x4751dd(0x1ba)]||[],_0x379a7b[_0x381c35['id']][_0x4751dd(0x1b1)]=_0x381c35['createdAt'],_0x379a7b[_0x381c35['id']][_0x4751dd(0x1c8)]=_0x381c35['updatedAt'],_0x379a7b;},{}),_0x763b7e[_0x202f12(0x18e)](Object[_0x202f12(0x1ce)](this['conversations'])[_0x202f12(0x191)],0x0)&&(this[_0x202f12(0x1b5)]=Object[_0x202f12(0x1ce)](this[_0x202f12(0x1a0)])[0x0]),Logger[_0x202f12(0x1a6)](_0x202f12(0x1a2)+Object[_0x202f12(0x1ce)](this['conversations'])['length']+'\x20conversations');}}catch(_0x5de923){const _0x1de500=Logger[_0x202f12(0x1c1)](_0x763b7e['fALer'],_0x5de923);this['notifyError'](_0x1de500),this[_0x202f12(0x1a0)]={};}}async[_0x15c3f5(0x1ac)](){const _0x149293=_0x15c3f5,_0x51f482={'gdbic':function(_0xc94d30,_0x1fcf84){return _0xc94d30>_0x1fcf84;},'xpByu':'Conversations\x20saved\x20successfully','ZeJDC':_0x149293(0x18d)};try{const _0x182bbe=JSON[_0x149293(0x1ab)](Object['values'](this['conversations']));_0x51f482[_0x149293(0x193)](_0x182bbe[_0x149293(0x191)],this[_0x149293(0x1ca)])&&await this['cleanupStorage'](),localStorage[_0x149293(0x1ad)](_0x149293(0x1a0),_0x182bbe),this[_0x149293(0x1b3)](),Logger[_0x149293(0x1a6)](_0x51f482['xpByu']);}catch(_0x1c18c1){const _0x485b8e=Logger['error'](_0x51f482[_0x149293(0x1b2)],_0x1c18c1);this[_0x149293(0x1b9)](_0x485b8e);}}async['cleanupStorage'](){const _0x15d55b=_0x15c3f5,_0x377ad1={'Ykcsu':_0x15d55b(0x1a7),'kauch':function(_0x3b4ceb,_0x46b684){return _0x3b4ceb>_0x46b684;}};Logger['warn'](_0x377ad1['Ykcsu']);const _0x53d212=this[_0x15d55b(0x189)]();_0x53d212[_0x15d55b(0x191)]>this['MAX_CONVERSATIONS']&&(this[_0x15d55b(0x1a0)]=_0x53d212[_0x15d55b(0x1b4)](0x0,this[_0x15d55b(0x1cf)])[_0x15d55b(0x1bf)]((_0x1ae26b,_0x16f1ee)=>{return _0x1ae26b[_0x16f1ee['id']]=_0x16f1ee,_0x1ae26b;},{}),Logger[_0x15d55b(0x1a6)](_0x15d55b(0x199)+this['MAX_CONVERSATIONS']+_0x15d55b(0x1bc)));let _0x1ab792=JSON['stringify'](Object['values'](this[_0x15d55b(0x1a0)]))['length'];while(_0x1ab792>this[_0x15d55b(0x1ca)]&&_0x377ad1[_0x15d55b(0x198)](Object[_0x15d55b(0x1ce)](this[_0x15d55b(0x1a0)])[_0x15d55b(0x191)],0x0)){const _0x198b05=_0x53d212[_0x15d55b(0x1c6)]();_0x198b05[_0x15d55b(0x1ba)]['length']>0xa?_0x198b05[_0x15d55b(0x1ba)]=_0x198b05[_0x15d55b(0x1ba)][_0x15d55b(0x1b4)](-0xa):delete this[_0x15d55b(0x1a0)][_0x198b05['id']],_0x1ab792=JSON[_0x15d55b(0x1ab)](Object[_0x15d55b(0x1c3)](this['conversations']))['length'];}Logger[_0x15d55b(0x1a6)]('Storage\x20cleanup\x20completed');}async['createNewConversation'](_0x1a5d72='New\x20Conversation'){const _0x295e9f=_0x15c3f5,_0x2c263c=_0x295e9f(0x1af)+Date['now'](),_0x29b934=new Conversation(_0x2c263c,_0x1a5d72);return this[_0x295e9f(0x1a0)][_0x2c263c]=_0x29b934,this[_0x295e9f(0x1b5)]=_0x2c263c,await this[_0x295e9f(0x1ac)](),this[_0x295e9f(0x19b)](),_0x2c263c;}[_0x15c3f5(0x18b)](){const _0x3b0b46=_0x15c3f5;return this[_0x3b0b46(0x1a0)][this['currentConversationId']]||null;}async[_0x15c3f5(0x1a5)](_0x27ce3c,_0x2e73ad){const _0x41f8d6=_0x15c3f5,_0x280fe1={'LhoTl':function(_0x4de419,_0xe3fa98){return _0x4de419===_0xe3fa98;},'cnzRH':_0x41f8d6(0x194),'fiGTp':function(_0x4602e5,_0x2522bb){return _0x4602e5===_0x2522bb;},'jhrfj':function(_0x5c03d5,_0x3071be){return _0x5c03d5+_0x3071be;},'ASSmo':_0x41f8d6(0x187)},_0x45e727=this[_0x41f8d6(0x18b)]();if(!_0x45e727)return![];const _0x48ae38={'role':_0x2e73ad,'content':_0x27ce3c,'timestamp':new Date()[_0x41f8d6(0x1bd)]()};return _0x45e727[_0x41f8d6(0x1ba)][_0x41f8d6(0x1cb)](_0x48ae38),_0x45e727[_0x41f8d6(0x1c8)]=new Date()[_0x41f8d6(0x1bd)](),_0x280fe1[_0x41f8d6(0x1c4)](_0x2e73ad,_0x41f8d6(0x1b8))&&_0x280fe1['LhoTl'](_0x45e727[_0x41f8d6(0x18a)],_0x280fe1[_0x41f8d6(0x1c7)])&&_0x280fe1['fiGTp'](_0x45e727[_0x41f8d6(0x1ba)]['length'],0x1)&&(_0x45e727[_0x41f8d6(0x18a)]=_0x280fe1[_0x41f8d6(0x1aa)](_0x27ce3c[_0x41f8d6(0x1cc)]('\x20')[_0x41f8d6(0x1b4)](0x0,0x4)[_0x41f8d6(0x192)]('\x20'),_0x280fe1['ASSmo'])),await this[_0x41f8d6(0x1ac)](),!![];}async[_0x15c3f5(0x18c)](_0x134f1f){const _0x26b9a9=_0x15c3f5;this[_0x26b9a9(0x1a0)][_0x134f1f]&&(delete this[_0x26b9a9(0x1a0)][_0x134f1f],this[_0x26b9a9(0x1b5)]===_0x134f1f&&(this[_0x26b9a9(0x1b5)]=Object[_0x26b9a9(0x1ce)](this['conversations'])[0x0]||null),await this[_0x26b9a9(0x1ac)]());}[_0x15c3f5(0x18f)](_0xaf54cc){const _0x35eeef=_0x15c3f5;if(this[_0x35eeef(0x1a0)][_0xaf54cc])return this[_0x35eeef(0x1b5)]=_0xaf54cc,this[_0x35eeef(0x19b)](),!![];return![];}[_0x15c3f5(0x189)](){const _0x38bfeb=_0x15c3f5;return Object[_0x38bfeb(0x1c3)](this['conversations'])[_0x38bfeb(0x1b0)]((_0x5871b9,_0x43b0f3)=>new Date(_0x43b0f3[_0x38bfeb(0x1c8)])-new Date(_0x5871b9['updatedAt']));}['notifyConversationUpdate'](){const _0x35cb7b=_0x15c3f5;this[_0x35cb7b(0x19d)][_0x35cb7b(0x1c9)]['forEach'](_0x30dab6=>_0x30dab6(Object[_0x35cb7b(0x1c3)](this[_0x35cb7b(0x1a0)])));}[_0x15c3f5(0x19b)](){const _0xc52346=_0x15c3f5;this[_0xc52346(0x19d)][_0xc52346(0x190)][_0xc52346(0x19e)](_0x5d30e0=>_0x5d30e0(this[_0xc52346(0x18b)]()));}[_0x15c3f5(0x1b9)](_0x2065ab){const _0x16a753=_0x15c3f5;this[_0x16a753(0x19d)][_0x16a753(0x197)][_0x16a753(0x19e)](_0x5f157f=>_0x5f157f(_0x2065ab));}[_0x15c3f5(0x1cd)](_0x33e7b6,_0xe163d6){const _0x5a7182=_0x15c3f5;this[_0x5a7182(0x19d)][_0x33e7b6]&&this['listeners'][_0x33e7b6]['push'](_0xe163d6);}['removeEventListener'](_0x315306,_0x4efa60){const _0x19683f=_0x15c3f5;this[_0x19683f(0x19d)][_0x315306]&&(this['listeners'][_0x315306]=this[_0x19683f(0x19d)][_0x315306][_0x19683f(0x19f)](_0x5118ce=>_0x5118ce!==_0x4efa60));}}function _0x1e96(_0x236b21,_0x5ef847){const _0x4f9102=_0x4f91();return _0x1e96=function(_0x1e9630,_0x453d9a){_0x1e9630=_0x1e9630-0x187;let _0x206c50=_0x4f9102[_0x1e9630];return _0x206c50;},_0x1e96(_0x236b21,_0x5ef847);}export{ChatManager};